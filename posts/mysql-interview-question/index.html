<!DOCTYPE html><html lang="en-EN"> <head><meta charset="utf-8"><meta content="width=device-width, initial-scale=1.0, shrink-to-fit=no" name="viewport"><meta content="IE=edge" http-equiv="X-UA-Compatible"><title>Mysql • 知道的越多,才知知道的越少</title><link href="/astro-theme-cactus/favicon.ico" rel="icon" sizes="any"><link href="/astro-theme-cactus/icon.svg" rel="icon" type="image/svg+xml"><link href="/astro-theme-cactus/apple-touch-icon.png" rel="apple-touch-icon"><link href="/astro-theme-cactus/manifest.webmanifest" rel="manifest"><link href="https://chou401.github.io/astro-theme-cactus/posts/mysql-interview-question/" rel="canonical"><meta content="Mysql • 知道的越多,才知知道的越少" name="title"><meta content="Mysql 底层实现 &#38; 性能优化" name="description"><meta content="chou401" name="author"><meta content="" name="theme-color"><meta content="article" property="og:type"><meta content="Mysql" property="og:title"><meta content="Mysql 底层实现 &#38; 性能优化" property="og:description"><meta content="https://chou401.github.io/astro-theme-cactus/posts/mysql-interview-question/" property="og:url"><meta content="知道的越多,才知知道的越少" property="og:site_name"><meta content="en-EN" property="og:locale"><meta content="https://chou401.github.io/og-image/mysql-interview-question.png" property="og:image"><meta content="1200" property="og:image:width"><meta content="630" property="og:image:height"><meta content="chou401" property="article:author"><meta content="2024-05-16T14:00:40.000Z" property="article:published_time"><meta content="summary_large_image" property="twitter:card"><meta content="https://chou401.github.io/astro-theme-cactus/posts/mysql-interview-question/" property="twitter:url"><meta content="Mysql" property="twitter:title"><meta content="Mysql 底层实现 &#38; 性能优化" property="twitter:description"><meta content="https://chou401.github.io/og-image/mysql-interview-question.png" property="twitter:image"><link href="/sitemap-index.xml" rel="sitemap"><link href="/rss.xml" rel="alternate" title="知道的越多,才知知道的越少" type="application/rss+xml"><link href="http://localhost:4321/astro-theme-cactus/" rel="webmention"><meta content="Astro v4.5.16" name="generator"><link rel="stylesheet" href="/astro-theme-cactus/_astro/_slug_.vObVOHgF.css"><script type="module" src="/astro-theme-cactus/_astro/hoisted.BjpvhLSh.js"></script>
<script type="module" src="/astro-theme-cactus/_astro/page.BG5lM7_G.js"></script></head> <body> <script>
	const lightModePref = window.matchMedia("(prefers-color-scheme: light)");

	function getUserPref() {
		const storedTheme = typeof localStorage !== "undefined" && localStorage.getItem("theme");
		return storedTheme || (lightModePref.matches ? "light" : "dark");
	}

	function setTheme(newTheme) {
		if (newTheme !== "light" && newTheme !== "dark") {
			return console.warn(
				`Invalid theme value '${newTheme}' received. Expected 'light' or 'dark'.`,
			);
		}

		const root = document.documentElement;

		// root already set to newTheme, exit early
		if (newTheme === root.getAttribute("data-theme")) {
			return;
		}

		root.setAttribute("data-theme", newTheme);

		const colorThemeMetaTag = document.querySelector("meta[name='theme-color']");
		const bgColour = getComputedStyle(document.body).getPropertyValue("--theme-bg");
		colorThemeMetaTag.setAttribute("content", `hsl(${bgColour})`);
		if (typeof localStorage !== "undefined") {
			localStorage.setItem("theme", newTheme);
		}
	}

	// initial setup
	setTheme(getUserPref());

	// View Transitions hook to restore theme
	document.addEventListener("astro:after-swap", () => setTheme(getUserPref()));

	// listen for theme-change custom event, fired in src/components/ThemeToggle.astro
	document.addEventListener("theme-change", (e) => {
		setTheme(e.detail.theme);
	});

	// listen for prefers-color-scheme change.
	lightModePref.addEventListener("change", (e) => setTheme(e.matches ? "light" : "dark"));
</script> <a class="sr-only focus:not-sr-only focus:fixed focus:start-1 focus:top-1.5" href="#main">skip to content
</a> <header class="group relative mb-8 flex items-center sm:ps-[3.5rem]" id="main-header"> <div class="flex sm:flex-col"> <a class="inline-flex items-center grayscale hover:filter-none sm:relative sm:inline-block" href="/astro-theme-cactus/"> <svg aria-hidden="true" class="me-3 h-10 w-6 sm:absolute sm:start-[-3.5rem] sm:me-0 sm:h-20 sm:w-12" fill="none" focusable="false" viewBox="0 0 272 480" xmlns="http://www.w3.org/2000/svg"> <g stroke="null"> <title>Layer 1</title> <g transform="translate(0,800) scale(0.10000000149011612,-0.10000000149011612) " fill="#000000" id="svg_1" stroke="null"> <path d="m1330.461549,8010.447731c-9.667991,-6.119317 -19.647851,-12.578595 -21.830946,-14.618368c-2.494965,-2.039772 -11.851085,-7.819127 -20.583464,-12.238633c-9.044249,-4.759469 -15.593533,-9.518937 -14.346051,-10.538823c0.935612,-1.359848 0,-2.379734 -2.806836,-2.379734c-2.494965,0 -9.979861,-4.419507 -16.841016,-10.198861c-6.549283,-5.439393 -14.657921,-10.198861 -17.464757,-10.198861c-3.118707,0 -5.613672,-1.019886 -5.613672,-2.379734c0,-1.69981 -6.549283,-7.139203 -14.969791,-12.918557c-17.464757,-11.898671 -18.088498,-12.578595 -30.251454,-24.137304c-9.044249,-8.499051 -9.35612,-9.518937 -9.35612,-39.435596c0,-23.117419 1.247483,-31.61647 4.67806,-34.336166c2.494965,-2.379734 6.549283,-10.198861 9.044249,-17.678026c2.494965,-7.479165 5.301801,-14.278406 6.237413,-15.298292c3.742448,-3.399621 9.667991,-16.998102 9.667991,-22.437495c0,-3.059659 2.806836,-9.518937 5.925543,-14.618368c3.430577,-5.099431 6.549283,-11.558709 7.173025,-13.938444c0.623741,-2.719696 2.806836,-7.139203 4.98993,-9.518937c1.871224,-2.379734 3.742448,-6.799241 3.742448,-9.518937c0,-2.719696 1.559353,-4.759469 3.118707,-4.759469c1.871224,0 3.118707,-2.039772 3.118707,-4.419507c0,-2.379734 2.806836,-7.819127 6.237413,-11.898671c3.430577,-4.079545 6.237413,-8.499051 6.237413,-9.858899c0,-4.759469 13.722309,-32.636356 19.335981,-39.775558c3.118707,-3.739583 6.237413,-9.518937 7.484896,-12.918557c0.935612,-3.399621 3.118707,-5.439393 4.67806,-4.419507c1.559353,1.359848 2.806836,-1.019886 2.806836,-4.759469c0,-4.079545 0.935612,-7.139203 2.494965,-7.139203c2.806836,0 9.979861,-16.65814 9.979861,-23.457381c0,-4.079545 0.623741,-4.419507 2.494965,-1.019886c1.871224,2.719696 4.054318,0.339962 6.861155,-7.819127c2.494965,-6.459279 5.925543,-11.898671 7.484896,-11.898671c1.871224,0 -0.623741,-2.379734 -5.613672,-5.099431c-4.67806,-2.719696 -11.227344,-5.099431 -14.03418,-5.099431c-4.36619,0 -4.36619,-0.679924 -0.31187,-3.399621c3.118707,-2.379734 3.430577,-3.399621 0.623741,-3.399621c-5.613672,0 -27.756489,-16.65814 -42.10254,-30.936546c-13.410438,-13.938444 -18.088498,-15.298292 -69.235287,-20.057761c-31.498937,-2.719696 -61.750391,-6.799241 -102.917319,-13.258519c-8.420508,-1.019886 -17.776628,-3.739583 -20.271593,-5.439393c-2.494965,-1.69981 -11.539215,-4.419507 -20.271593,-5.779355c-26.509006,-4.079545 -35.865127,-6.799241 -35.865127,-9.858899c0,-1.69981 -2.494965,-3.059659 -5.301801,-3.059659c-6.861155,0 -39.607574,-14.278406 -40.855057,-17.678026c-0.623741,-1.69981 -3.742448,-2.719696 -6.861155,-2.719696c-3.118707,0 -6.861155,-1.359848 -7.796766,-3.399621c-0.935612,-1.69981 -6.861155,-3.399621 -12.786697,-3.399621c-5.925543,0 -10.291732,-1.359848 -9.044249,-3.059659c1.559353,-2.719696 -7.796766,-8.159089 -41.166927,-24.477266c-5.613672,-2.379734 -10.291732,-5.779355 -10.291732,-7.139203c0,-1.69981 -2.494965,-2.719696 -5.925543,-2.719696c-3.118707,0 -9.979861,-4.419507 -15.281663,-10.198861c-5.613672,-5.439393 -11.227344,-10.198861 -13.098568,-10.198861c-1.559353,0 -6.237413,6.119317 -9.979861,13.598481c-4.054318,7.479165 -9.35612,13.598481 -11.851085,13.938444c-3.118707,0 -3.430577,0.679924 -0.935612,2.039772c2.806836,1.019886 2.183095,3.739583 -2.183095,8.839013c-3.430577,3.739583 -6.237413,9.858899 -6.237413,13.258519c0,3.739583 -1.247483,5.439393 -3.118707,4.419507c-1.559353,-1.019886 -3.118707,0.339962 -3.118707,3.059659c0,3.059659 -1.247483,5.439393 -3.118707,5.439393c-1.559353,0 -3.118707,3.059659 -3.118707,6.799241c0,3.739583 -1.247483,6.799241 -2.806836,6.799241c-1.247483,0 -9.044249,8.839013 -16.841016,19.717799c-14.657921,20.057761 -24.014041,31.956432 -39.607574,50.994306c-5.301801,6.119317 -9.35612,12.578595 -9.35612,14.618368c0,2.039772 -1.247483,2.719696 -2.806836,1.69981c-1.559353,-1.019886 -5.925543,3.399621 -9.979861,9.858899c-4.054318,6.459279 -8.420508,11.898671 -9.667991,11.898671c-1.559353,0 -2.494965,2.719696 -2.494965,5.779355c0,3.059659 -0.935612,4.759469 -1.871224,3.399621c-2.183095,-2.039772 -8.420508,3.739583 -41.166927,37.735786c-13.410438,13.258519 -24.949653,24.477266 -26.197136,24.477266c-1.559353,0 -4.98993,2.719696 -8.108638,6.119317c-3.118707,3.059659 -11.227344,10.538823 -17.776628,15.978216c-6.549283,5.779355 -14.969791,12.918557 -18.400369,15.978216c-14.969791,13.258519 -25.885265,21.757571 -34.305773,26.517039c-4.98993,2.719696 -13.098568,9.178975 -17.776628,14.618368c-4.67806,5.099431 -10.915473,9.178975 -13.410438,9.178975c-2.806836,0 -4.98993,1.359848 -4.98993,2.719696c0,1.69981 -4.98993,4.759469 -10.915473,7.479165c-5.925543,2.719696 -10.915473,6.119317 -10.915473,7.479165c0,3.399621 -28.068359,18.017988 -31.810807,16.998102c-1.559353,-0.339962 -2.494965,1.69981 -2.494965,4.419507c0,2.719696 -2.806836,5.099431 -6.237413,5.099431c-3.430577,0 -6.237413,1.69981 -6.237413,3.399621c0,2.039772 -2.183095,3.399621 -4.67806,3.399621c-2.494965,0 -4.67806,1.359848 -4.67806,3.059659c0,1.69981 -4.67806,4.759469 -9.979861,7.139203c-25.261524,10.198861 -56.136719,28.556811 -53.641754,31.61647c1.247483,1.359848 -0.623741,2.379734 -4.36619,2.379734c-3.742448,0 -11.227344,3.059659 -16.841016,6.799241c-5.613672,3.739583 -12.786697,6.799241 -15.593533,6.799241c-3.118707,0 -5.613672,1.359848 -5.613672,3.059659c0,1.69981 -3.118707,4.419507 -6.861155,5.439393c-13.098568,4.419507 -36.800738,16.998102 -36.800738,19.377837c0,1.69981 -2.806836,2.719696 -6.237413,2.719696c-3.430577,0 -6.237413,1.69981 -6.237413,3.399621c0,2.039772 -4.054318,3.399621 -9.044249,3.399621c-5.301801,0 -10.291732,1.69981 -11.227344,3.399621c-0.935612,2.039772 -5.925543,3.399621 -11.227344,3.399621c-4.98993,0 -9.044249,1.69981 -9.044249,3.399621c0,2.039772 -9.044249,3.399621 -20.583464,3.399621c-25.261524,0 -37.42448,-7.819127 -40.543186,-25.497153c-0.935612,-6.459279 -3.430577,-11.898671 -4.98993,-11.898671c-1.871224,0 -2.494965,-10.878785 -1.559353,-26.177077c0.935612,-20.057761 4.054318,-35.01609 12.786697,-60.513243c6.549283,-18.697912 12.474826,-39.095634 13.410438,-44.874989c0.935612,-6.119317 2.494965,-11.218747 3.742448,-11.218747c0.935612,0 3.742448,-5.099431 5.925543,-10.878785c2.494965,-6.119317 6.861155,-16.998102 10.291732,-24.137304c3.118707,-7.479165 5.925543,-15.298292 5.925543,-17.678026c0,-5.099431 16.217274,-40.455482 19.024111,-41.815331c1.247483,-0.679924 4.054318,-7.819127 6.237413,-16.318178c2.183095,-8.159089 5.301801,-14.95833 6.549283,-14.95833c1.247483,0 2.494965,-3.059659 2.494965,-6.799241c0,-3.739583 0.935612,-6.799241 2.494965,-6.799241c2.494965,0 9.979861,-16.65814 9.979861,-22.777457c0,-2.379734 1.559353,-4.419507 3.118707,-4.419507c1.871224,0 3.118707,-2.379734 3.118707,-5.099431c0,-4.759469 8.108638,-21.417609 12.474826,-25.497153c1.871224,-1.69981 9.35612,-19.037874 19.024111,-43.175179c2.494965,-6.119317 5.301801,-11.218747 6.549283,-11.218747c1.559353,0 2.494965,-2.379734 2.494965,-5.099431c0,-2.719696 2.806836,-8.159089 6.237413,-11.898671c3.430577,-3.739583 6.237413,-9.178975 6.237413,-11.898671c0,-2.719696 4.98993,-13.258519 10.915473,-23.457381c5.925543,-10.198861 10.915473,-20.397723 10.915473,-22.437495c0,-1.69981 1.559353,-3.399621 3.118707,-3.399621c1.871224,0 3.118707,-2.379734 3.118707,-5.099431c0,-2.719696 1.559353,-5.099431 3.118707,-5.099431c1.871224,0 3.118707,-3.739583 3.118707,-8.499051c0,-4.759469 1.247483,-8.499051 2.806836,-8.499051c1.559353,0 9.667991,-14.618368 17.776628,-32.296394c8.420508,-17.678026 15.593533,-31.276508 16.529145,-30.256622c1.247483,1.359848 14.346051,-26.177077 13.410438,-28.216849c-0.31187,-0.679924 3.118707,-4.759469 7.173025,-9.858899c4.054318,-4.759469 8.420508,-11.898671 9.35612,-15.298292c1.247483,-3.739583 3.430577,-6.459279 4.98993,-6.459279c1.559353,0 2.806836,-2.039772 2.806836,-4.419507c0,-3.739583 17.152886,-31.61647 28.068359,-45.554913c1.559353,-2.379734 3.118707,-5.099431 3.118707,-6.119317c0,-1.359848 1.871224,-4.079545 4.054318,-6.459279c1.871224,-2.379734 7.173025,-9.178975 11.539215,-15.638254c4.36619,-6.119317 11.539215,-15.638254 16.529145,-20.737685c4.67806,-5.439393 8.420508,-10.538823 8.420508,-11.558709c0,-1.019886 2.806836,-5.099431 6.237413,-9.178975c3.430577,-4.079545 6.237413,-9.518937 6.237413,-12.238633c0,-6.459279 -6.237413,-18.35795 -13.098568,-24.817229c-3.118707,-3.059659 -5.613672,-6.459279 -5.613672,-7.819127c0,-1.019886 -2.806836,-5.099431 -6.237413,-8.839013c-3.430577,-3.739583 -6.237413,-9.178975 -6.237413,-11.898671c0,-2.719696 -1.247483,-5.099431 -3.118707,-5.099431c-1.559353,0 -3.118707,-2.039772 -3.118707,-4.759469c0,-2.379734 -3.430577,-7.479165 -7.796766,-10.878785c-4.36619,-3.399621 -7.796766,-8.159089 -7.796766,-10.538823c0,-2.379734 -1.247483,-4.419507 -3.118707,-4.419507c-1.559353,0 -3.118707,-2.039772 -3.118707,-4.079545c0,-3.739583 -4.98993,-11.558709 -19.335981,-29.916659c-2.183095,-2.719696 -3.742448,-5.099431 -3.118707,-5.099431c2.494965,0 -5.925543,-18.697912 -8.420508,-18.697912c-1.559353,0 -3.742448,-3.739583 -4.67806,-8.159089c-0.935612,-4.759469 -3.742448,-10.538823 -5.925543,-12.918557c-5.925543,-7.139203 -11.539215,-19.037874 -11.539215,-24.817229c0,-2.719696 -1.247483,-5.099431 -3.118707,-5.099431c-1.559353,0 -3.118707,-3.059659 -3.118707,-6.459279c0,-3.399621 -2.183095,-7.479165 -4.98993,-8.499051c-2.494965,-1.019886 -3.742448,-3.399621 -2.806836,-5.439393c0.935612,-1.69981 0.31187,-3.399621 -1.247483,-3.399621c-1.871224,0 -3.430577,-2.039772 -3.430577,-4.759469c0,-2.719696 -1.247483,-5.439393 -2.806836,-6.119317c-1.559353,-0.339962 -6.237413,-9.858899 -10.915473,-20.397723c-4.36619,-10.878785 -9.35612,-19.717799 -11.227344,-19.717799c-1.559353,0 -3.118707,-3.059659 -3.118707,-6.459279c0,-3.739583 -1.559353,-7.819127 -3.118707,-8.839013c-1.871224,-1.019886 -3.118707,-5.779355 -3.118707,-10.538823c0,-4.419507 -1.247483,-8.159089 -2.494965,-8.159089c-3.430577,0 -9.979861,-15.638254 -9.979861,-23.457381c0,-3.739583 -2.183095,-7.139203 -4.67806,-8.499051c-2.494965,-1.019886 -4.67806,-5.099431 -4.67806,-8.839013c0,-3.739583 -1.247483,-9.518937 -2.806836,-12.918557c-1.559353,-3.059659 -4.67806,-12.918557 -7.173025,-21.757571c-2.183095,-9.178975 -4.98993,-16.318178 -6.237413,-16.318178c-1.247483,0 -2.494965,-4.419507 -2.494965,-10.198861c0,-5.439393 -1.247483,-10.198861 -2.494965,-10.198861c-3.430577,0 -13.410438,-38.075748 -15.281663,-59.833319c-0.935612,-10.198861 -3.118707,-19.377837 -4.36619,-20.397723c-1.559353,-1.019886 -2.806836,-9.178975 -2.806836,-18.35795c0,-8.839013 -1.559353,-16.998102 -3.430577,-17.678026c-3.430577,-1.359848 -7.173025,-29.236735 -10.915473,-79.89108c-1.247483,-15.638254 -3.430577,-28.216849 -4.67806,-28.216849c-1.559353,0 -2.806836,-25.837115 -2.806836,-57.793547c0,-32.296394 1.247483,-57.793547 2.806836,-57.793547c1.559353,0 3.430577,-8.159089 4.36619,-17.678026c2.183095,-25.837115 7.173025,-48.27461 11.227344,-49.634458c1.871224,-0.679924 3.430577,-6.459279 3.430577,-12.578595c0,-6.459279 1.247483,-12.238633 2.806836,-13.258519c1.559353,-1.019886 3.430577,-6.799241 4.36619,-12.918557c0.935612,-6.119317 3.118707,-17.338064 5.301801,-24.817229c2.183095,-7.479165 4.36619,-18.697912 5.301801,-24.477266c0.935612,-6.119317 2.806836,-11.218747 4.36619,-11.218747c1.559353,0 2.806836,-6.799241 2.806836,-15.298292c0,-8.499051 1.559353,-15.298292 3.118707,-15.298292c1.871224,0 3.118707,-1.69981 3.118707,-3.739583c0,-12.578595 13.410438,-50.314382 21.519076,-59.833319c4.98993,-5.779355 9.35612,-10.198861 9.979861,-9.518937c0.623741,0.339962 4.36619,-5.779355 7.796766,-13.938444l6.861155,-14.95833l-41.166927,0c-43.973763,0 -65.180969,-2.379734 -62.374133,-7.139203c0.935612,-1.69981 -4.67806,-3.059659 -12.162956,-3.059659c-8.420508,0 -15.281663,-2.039772 -17.776628,-5.099431c-2.183095,-3.059659 -9.044249,-5.099431 -15.905404,-5.099431c-6.861155,0 -12.162956,-1.359848 -12.162956,-3.399621c0,-1.69981 -2.494965,-3.399621 -5.613672,-3.399621c-2.806836,0 -10.603603,-3.059659 -16.841016,-6.459279c-5.925543,-3.739583 -12.162956,-5.779355 -13.098568,-4.759469c-0.935612,1.359848 -1.871224,-0.339962 -1.871224,-3.399621c0,-4.079545 -2.494965,-5.779355 -8.108638,-5.779355c-7.484896,0 -17.152886,-6.459279 -33.682032,-22.437495c-3.118707,-3.059659 -9.35612,-6.799241 -14.03418,-7.819127l-8.108638,-2.379734l-0.623741,-44.195065c-0.623741,-39.095634 0,-42.835217 3.742448,-33.656242c2.183095,5.439393 3.742448,15.298292 3.118707,21.757571c-0.623741,8.839013 0.623741,11.898671 4.98993,12.918557c6.549283,2.039772 8.108638,7.819127 2.183095,7.819127c-2.806836,0 -2.806836,1.019886 0,4.079545c2.183095,2.379734 3.742448,6.799241 3.742448,9.858899c0,3.059659 4.054318,7.479165 9.044249,9.858899c4.98993,2.039772 9.979861,6.459279 10.915473,9.178975c1.247483,3.399621 4.36619,4.419507 9.044249,3.059659c3.742448,-1.019886 9.044249,-0.339962 11.539215,1.359848c4.054318,2.719696 3.742448,3.399621 -0.623741,3.399621c-3.118707,0 -5.613672,1.69981 -5.613672,3.399621c0,2.039772 4.98993,3.399621 10.915473,3.399621c7.484896,0 10.915473,1.69981 10.915473,5.099431c0,2.719696 2.806836,5.099431 5.925543,5.099431c3.430577,0 7.173025,1.69981 8.108638,3.399621c0.935612,2.039772 5.301801,3.399621 9.667991,3.399621c4.36619,0 8.420508,2.379734 9.35612,5.099431c1.559353,3.739583 7.484896,5.099431 24.325912,5.439393c12.162956,0.339962 19.024111,1.359848 14.969791,2.039772c-9.667991,2.039772 -5.613672,7.819127 5.613672,7.819127c4.67806,0 9.35612,2.039772 9.979861,4.419507c1.247483,3.059659 15.281663,4.419507 53.329883,5.099431c43.973763,1.019886 52.082401,2.039772 52.082401,6.459279c0,2.719696 1.871224,4.419507 4.054318,3.399621c1.871224,-0.679924 3.430577,-3.399621 3.118707,-5.439393c-0.623741,-2.039772 1.871224,-3.739583 4.98993,-3.739583c7.484896,0 11.227344,-5.439393 5.925543,-7.819127c-3.118707,-1.359848 -2.806836,-2.039772 0.31187,-2.039772c5.613672,-0.339962 16.217274,-13.938444 14.03418,-17.678026c-0.935612,-1.69981 0.935612,-3.059659 4.054318,-3.399621c4.98993,0 4.98993,-0.339962 -0.623741,-3.059659c-3.430577,-1.359848 -9.044249,-2.039772 -12.786697,-1.019886c-3.742448,0.679924 -8.732378,-1.019886 -11.539215,-3.739583c-2.494965,-3.059659 -6.549283,-5.439393 -8.420508,-5.439393c-1.871224,0 -4.054318,-2.379734 -4.98993,-5.099431c-1.247483,-2.719696 -3.742448,-5.099431 -5.925543,-5.099431c-6.861155,0 -23.390299,-10.538823 -21.830946,-13.938444c1.247483,-1.69981 -1.559353,-3.059659 -6.237413,-3.059659c-4.36619,0 -8.732378,-2.379734 -9.667991,-5.099431c-1.247483,-2.719696 -4.67806,-5.099431 -8.108638,-5.099431c-3.430577,0 -9.979861,-4.079545 -14.657921,-9.178975c-19.959722,-22.777457 -38.360092,-36.7159 -42.10254,-32.296394c-1.247483,1.019886 -1.247483,-0.339962 -0.31187,-3.399621c1.247483,-3.739583 -0.31187,-6.799241 -5.301801,-9.858899c-4.054318,-2.039772 -8.420508,-6.119317 -9.667991,-8.499051c-1.247483,-2.719696 -4.67806,-4.759469 -6.861155,-4.759469c-2.494965,0 -4.67806,-3.059659 -4.67806,-6.799241c0,-6.119317 -11.227344,-15.978216 -16.217274,-14.278406c-1.247483,0.339962 -3.742448,-4.759469 -5.613672,-11.558709c-2.183095,-6.459279 -4.36619,-11.218747 -5.301801,-10.198861c-1.871224,2.039772 -22.142817,-24.817229 -24.637782,-32.636356c-1.247483,-3.399621 -3.118707,-6.119317 -4.67806,-6.119317c-1.559353,0 -2.806836,-2.379734 -2.806836,-5.099431c0,-2.719696 -1.247483,-5.099431 -3.118707,-5.099431c-1.559353,0 -3.118707,-2.719696 -3.118707,-6.459279c0,-3.399621 -2.183095,-8.159089 -4.67806,-10.538823c-2.494965,-2.379734 -4.67806,-6.459279 -4.67806,-9.178975c0,-2.719696 -1.559353,-3.739583 -3.742448,-2.379734c-2.183095,1.69981 -2.806836,0.679924 -1.559353,-3.059659c1.247483,-3.399621 -0.935612,-8.499051 -5.613672,-13.258519c-4.36619,-4.419507 -7.796766,-11.898671 -7.796766,-16.65814c0,-7.819127 -1.247483,-8.839013 -7.796766,-7.139203c-4.36619,0.679924 -7.796766,3.739583 -7.796766,6.119317c0,2.719696 -1.247483,4.759469 -3.118707,4.759469c-1.559353,0 -3.118707,3.059659 -3.118707,7.139203c0,5.099431 -1.559353,6.459279 -4.67806,5.099431c-3.742448,-1.359848 -4.67806,1.019886 -4.67806,12.578595c0,7.819127 -1.559353,16.65814 -3.118707,19.377837c-4.98993,8.499051 -4.054318,-78.871193 0.935612,-89.749978c2.494965,-4.759469 5.301801,-7.819127 6.237413,-6.459279c1.247483,1.019886 2.183095,-2.719696 2.183095,-8.839013c0,-6.119317 -1.247483,-10.198861 -2.806836,-9.178975c-6.237413,4.419507 -7.484896,-27.876887 -8.732378,-192.418514l-0.935612,-172.700716l12.474826,0c10.915473,0 12.474826,1.019886 12.474826,7.819127c-0.31187,4.079545 -2.183095,11.218747 -4.67806,15.978216c-2.494965,4.759469 -4.67806,14.618368 -4.67806,22.097533c0,19.037874 -3.118707,30.596584 -6.549283,25.157191c-1.247483,-2.719696 -2.494965,20.737685 -2.183095,51.334268c0,30.936546 -0.623741,58.133509 -1.247483,60.853205c-0.31187,2.379734 0.935612,5.439393 3.118707,6.119317c1.871224,1.019886 3.742448,-0.679924 3.742448,-3.739583c0,-3.059659 3.430577,-6.119317 7.484896,-7.479165c4.36619,-1.019886 8.420508,-4.079545 9.35612,-7.139203c0.935612,-2.719696 3.118707,-3.739583 4.98993,-2.719696c1.871224,1.019886 3.118707,-1.359848 3.118707,-5.779355c0,-4.419507 3.742448,-11.558709 7.796766,-15.978216c4.36619,-4.419507 8.732378,-11.558709 9.667991,-15.978216c0.935612,-4.419507 3.742448,-8.159089 6.237413,-8.159089c2.494965,0 4.36619,-2.719696 4.36619,-5.779355c0,-3.059659 2.494965,-8.499051 5.301801,-11.898671c4.67806,-5.779355 4.67806,-7.139203 0.935612,-10.198861c-4.054318,-2.719696 -3.742448,-3.059659 0.623741,-1.69981c4.67806,1.69981 10.603603,-5.779355 9.35612,-11.898671c-0.31187,-1.69981 0.935612,-2.719696 2.806836,-2.719696c1.871224,0 2.806836,-2.379734 1.559353,-5.099431c-0.935612,-2.719696 -0.31187,-5.099431 1.247483,-5.099431c1.871224,0 3.118707,-2.379734 3.118707,-5.099431c0,-2.719696 1.559353,-5.099431 3.118707,-5.099431c1.871224,0 3.118707,-2.379734 3.118707,-5.099431c0,-2.719696 2.806836,-6.459279 6.237413,-8.499051c3.430577,-2.039772 5.925543,-4.759469 5.613672,-6.119317c-0.623741,-1.359848 3.118707,-6.799241 7.796766,-12.238633c9.044249,-10.538823 10.915473,-21.077647 4.67806,-23.117419c-2.183095,-1.019886 9.35612,-1.69981 25.573394,-1.69981c16.217274,-0.339962 27.132747,0.339962 24.014041,1.359848c-2.806836,0.679924 -5.301801,3.059659 -5.301801,4.759469c0,1.69981 -2.183095,3.059659 -4.98993,3.059659c-2.494965,0 -3.742448,1.69981 -2.494965,3.739583c0.935612,2.039772 0.935612,4.759469 -0.623741,6.119317c-1.559353,1.019886 -9.35612,11.218747 -17.152886,22.437495c-15.281663,21.757571 -24.637782,40.455482 -24.637782,48.614572c0,3.059659 -0.935612,4.079545 -1.871224,3.059659c-2.494965,-2.379734 -13.722309,12.238633 -13.722309,17.678026c0,2.039772 -1.559353,3.739583 -3.118707,3.739583c-1.871224,0 -3.118707,2.039772 -2.806836,4.419507c0.935612,7.479165 -0.31187,13.598481 -2.183095,11.558709c-2.494965,-2.719696 -16.841016,20.057761 -16.841016,26.517039c0,2.719696 -1.871224,5.099431 -3.742448,5.099431c-2.806836,0 -2.494965,1.359848 0.623741,3.399621c4.054318,2.719696 3.742448,3.399621 -1.247483,3.399621c-4.054318,0 -4.98993,1.69981 -3.742448,5.779355c1.247483,3.399621 1.247483,4.759469 0,3.739583c-0.935612,-1.359848 -5.613672,1.359848 -9.979861,5.779355c-7.173025,7.139203 -7.484896,8.839013 -3.430577,13.938444c3.742448,5.439393 3.742448,5.779355 -0.935612,3.739583c-5.925543,-2.379734 -15.905404,6.119317 -19.335981,16.318178c-1.559353,4.759469 -2.806836,5.439393 -4.67806,2.379734c-1.871224,-3.399621 -3.742448,-1.359848 -6.549283,5.779355c-2.183095,5.779355 -4.67806,10.538823 -5.925543,10.538823c-1.247483,0 -1.871224,6.459279 -1.871224,14.278406c0,12.238633 1.247483,14.95833 6.549283,15.638254c3.430577,0.679924 9.979861,-2.719696 14.969791,-7.819127c4.67806,-4.759469 9.044249,-8.499051 9.979861,-8.499051c0.935612,0 9.044249,-6.119317 18.400369,-13.598481c9.35612,-7.479165 18.088498,-13.598481 19.647851,-13.598481c1.559353,0 5.925543,-3.739583 9.979861,-8.159089c3.742448,-4.759469 10.603603,-9.518937 15.281663,-10.538823c4.67806,-1.019886 12.474826,-5.779355 17.152886,-10.198861c4.98993,-4.759469 11.539215,-8.499051 14.657921,-8.499051c4.054318,0 4.98993,-1.69981 3.742448,-5.779355c-1.559353,-4.079545 -0.623741,-5.099431 2.806836,-3.739583c2.806836,1.359848 8.732378,0 13.722309,-3.059659c4.98993,-2.719696 12.162956,-5.779355 16.217274,-6.459279c3.742448,-1.019886 9.667991,-4.419507 12.786697,-7.819127c3.430577,-3.739583 10.603603,-7.479165 16.217274,-8.839013c11.539215,-2.379734 31.187066,-11.898671 34.305773,-16.318178c0.935612,-1.359848 7.173025,-3.399621 14.03418,-4.419507c6.549283,-1.019886 12.786697,-2.719696 13.722309,-4.419507c0.935612,-1.69981 8.108638,-3.739583 16.217274,-5.099431c9.044249,-1.359848 15.281663,-4.419507 16.529145,-8.159089c1.559353,-4.419507 2.494965,-4.759469 4.36619,-1.019886c1.871224,3.059659 3.430577,3.399621 4.67806,0.679924c1.247483,-2.039772 4.98993,-3.739583 8.420508,-3.739583c3.118707,0 5.925543,-1.359848 5.925543,-3.399621c0,-1.69981 7.173025,-3.399621 15.593533,-3.399621c8.732378,0 15.593533,-1.359848 15.593533,-3.399621c0,-1.69981 -1.247483,-3.399621 -3.118707,-3.399621c-1.559353,0 -2.183095,-4.419507 -0.935612,-10.198861c1.247483,-7.819127 0.623741,-10.198861 -2.806836,-10.198861c-3.118707,0 -5.301801,-4.419507 -6.549283,-11.218747c-0.935612,-6.119317 -5.925543,-21.077647 -11.227344,-33.31628c-5.301801,-12.238633 -9.667991,-24.137304 -9.667991,-26.177077c0,-3.059659 75.4727,-4.079545 299.707707,-4.079545l299.707707,0l-1.559353,46.914762c-2.806836,71.73199 -4.98993,91.109827 -13.410438,115.927055c-4.054318,12.238633 -10.603603,31.61647 -14.03418,42.495255c-3.430577,11.218747 -10.603603,30.256622 -15.593533,42.155293c-4.98993,12.238633 -9.044249,23.797342 -9.044249,25.837115c-0.31187,2.039772 -2.806836,9.858899 -6.237413,17.338064c-3.430577,7.479165 -5.925543,14.618368 -6.237413,16.318178c0,1.359848 -4.98993,10.198861 -10.915473,19.377837c-5.925543,9.178975 -10.915473,18.017988 -10.915473,19.377837c0,3.059659 -14.03418,18.017988 -16.529145,18.017988c-0.935612,0 -6.237413,4.419507 -11.539215,9.518937c-11.851085,11.898671 -35.553255,26.177077 -48.963694,29.236735c-5.301801,1.359848 -14.657921,7.819127 -20.583464,13.938444c-10.915473,11.558709 -11.227344,11.898671 -7.173025,26.177077c4.67806,18.697912 13.722309,23.797342 34.617644,21.077647c8.732378,-1.019886 18.71224,-4.079545 22.454688,-6.799241c3.742448,-2.719696 9.044249,-4.759469 11.539215,-4.759469c3.742448,0 15.281663,-8.499051 48.339953,-35.356052c2.494965,-2.039772 12.162956,-12.238633 21.207205,-22.437495c22.142817,-24.477266 36.176997,-50.994306 53.018013,-100.288801c2.494965,-7.479165 7.173025,-19.717799 10.291732,-27.196963c9.35612,-21.757571 18.71224,-48.614572 18.71224,-52.354154c0,-2.039772 2.494965,-10.198861 5.925543,-18.35795c11.539215,-28.556811 15.905404,-45.214951 16.217274,-65.272712c0.31187,-11.218747 2.494965,-23.797342 4.98993,-27.876887c2.183095,-4.079545 4.054318,-13.258519 4.054318,-19.717799c0,-6.799241 1.559353,-15.298292 3.118707,-19.037874c2.183095,-4.419507 2.183095,-6.459279 0,-6.459279c-1.871224,0 -3.118707,-10.538823 -3.118707,-26.857001c0,-18.35795 -1.247483,-27.536925 -3.742448,-28.556811c-2.183095,-1.019886 175.583183,-2.039772 395.452,-2.039772l399.506318,-0.339962l2.183095,26.177077c0.935612,14.278406 1.871224,49.294496 1.871224,77.851307c0,28.556811 1.247483,55.753774 3.118707,60.513243c1.559353,5.099431 4.054318,21.077647 4.98993,36.375938c1.247483,15.638254 4.67806,32.636356 8.108638,39.775558c3.118707,6.799241 5.613672,15.298292 5.613672,19.377837c0,3.739583 5.613672,19.037874 12.474826,33.996204c6.861155,14.95833 12.474826,29.236735 12.474826,31.61647c0,2.039772 1.247483,4.079545 2.806836,4.079545c1.559353,0 3.742448,4.079545 4.67806,8.839013c3.742448,15.978216 18.088498,36.7159 49.587435,71.73199c35.553255,39.775558 44.909375,44.535027 61.12665,31.61647c10.915473,-8.159089 14.657921,-19.377837 11.227344,-32.976318c-0.935612,-5.099431 -14.969791,-23.457381 -31.810807,-41.475369c-19.647851,-21.417609 -32.434549,-38.41571 -38.04822,-50.994306c-4.67806,-10.538823 -9.979861,-22.097533 -11.851085,-25.837115c-13.410438,-26.177077 -28.068359,-76.151497 -30.563325,-104.028384c-1.247483,-11.898671 -3.118707,-25.497153 -4.67806,-30.256622c-1.559353,-4.759469 -3.118707,-41.815331 -3.742448,-82.610776l-0.935612,-73.771763l159.98965,0c155.935331,0 159.677779,0 159.677779,6.459279c0,3.739583 -1.247483,7.819127 -3.118707,8.839013c-1.559353,1.019886 -3.118707,6.459279 -3.118707,11.898671c0,5.439393 -1.247483,10.878785 -3.118707,11.898671c-1.559353,1.019886 -3.118707,6.459279 -3.118707,12.238633c0,5.439393 -0.935612,9.858899 -2.183095,9.858899c-3.430577,0 -10.291732,16.998102 -10.291732,25.837115c0,4.079545 -2.183095,9.178975 -4.67806,11.558709c-2.494965,2.379734 -4.67806,7.479165 -4.67806,11.558709c0,8.839013 -12.786697,42.835217 -16.217274,42.835217c-1.247483,0 -2.494965,2.379734 -2.494965,5.099431c0,8.159089 -7.484896,32.296394 -9.979861,32.296394c-1.559353,0 -2.494965,4.079545 -2.494965,8.839013c0,4.759469 -1.247483,7.819127 -3.118707,6.459279c-1.559353,-1.019886 -3.118707,1.019886 -3.118707,4.759469c0,4.079545 -1.247483,7.139203 -3.118707,7.139203c-1.559353,0 -3.118707,2.719696 -3.118707,6.119317c0,3.399621 -1.871224,8.839013 -4.36619,12.578595c-2.183095,3.739583 -5.925543,12.578595 -7.796766,19.717799c-2.183095,6.799241 -4.98993,11.898671 -6.237413,10.878785c-1.559353,-0.679924 -4.36619,4.759469 -6.549283,11.898671c-2.183095,7.479165 -5.925543,15.298292 -8.420508,17.338064c-2.183095,2.039772 -4.054318,5.779355 -4.054318,8.159089c0,2.379734 -2.183095,6.119317 -4.67806,8.499051c-2.494965,2.379734 -4.67806,6.799241 -4.67806,10.198861c0,3.399621 -1.871224,6.799241 -4.36619,7.819127c-2.494965,1.019886 -5.925543,7.479165 -8.108638,13.938444c-1.871224,6.799241 -4.98993,11.558709 -6.549283,10.538823c-1.559353,-1.359848 -2.806836,1.69981 -2.806836,6.119317c0,4.759469 -1.871224,9.178975 -4.36619,10.198861c-4.054318,1.69981 -7.173025,6.799241 -18.088498,29.576697c-2.183095,4.419507 -8.108638,13.258519 -13.410438,19.377837c-15.593533,18.35795 -17.152886,20.737685 -17.152886,28.216849c0,4.759469 2.183095,6.799241 6.549283,6.799241c3.430577,0 5.301801,1.69981 4.36619,3.399621c-0.935612,2.039772 1.559353,3.399621 5.925543,3.399621c5.925543,0 7.484896,1.359848 5.925543,5.099431c-0.935612,3.059659 -0.623741,5.099431 0.935612,4.419507c5.613672,-1.359848 16.841016,4.759469 16.841016,9.518937c0,2.719696 1.871224,4.759469 4.054318,4.759469c2.183095,0 8.108638,4.759469 13.098568,10.198861c4.98993,5.779355 10.915473,10.198861 13.098568,10.198861c2.183095,0 4.054318,1.69981 4.054318,3.399621c0,2.039772 2.183095,3.399621 4.67806,3.399621c2.494965,0 4.67806,2.039772 4.67806,4.419507c0,2.719696 3.430577,6.799241 7.796766,9.178975c4.36619,2.379734 7.796766,5.779355 7.796766,7.479165c0,1.359848 2.183095,2.719696 4.67806,2.719696c2.494965,0 4.67806,1.69981 4.67806,3.739583c0,1.69981 4.36619,5.099431 9.667991,7.139203c7.173025,2.719696 8.420508,4.419507 5.301801,6.459279c-3.118707,2.379734 -2.806836,3.059659 0.935612,3.059659c2.806836,0 8.420508,3.739583 12.474826,8.499051c4.054318,4.419507 9.044249,8.499051 10.915473,8.499051c4.36619,0 44.909375,42.495255 44.909375,47.254724c0,2.039772 1.871224,3.739583 4.054318,3.739583c1.871224,0 8.732378,7.819127 14.657921,17.338064c5.925543,9.518937 13.722309,20.737685 17.152886,25.157191c13.722309,17.338064 17.152886,22.097533 17.152886,23.797342c0,1.69981 8.420508,13.258519 16.529145,22.777457c2.806836,3.399621 5.301801,7.479165 5.301801,9.178975c0,2.039772 2.806836,8.839013 6.549283,15.298292c3.742448,6.799241 5.301801,12.238633 3.742448,12.238633c-1.247483,0 0,1.69981 3.118707,3.739583c2.806836,1.69981 5.301801,6.459279 5.301801,9.858899c0,3.739583 1.559353,6.799241 3.118707,6.799241c1.871224,0 3.118707,3.059659 3.118707,7.139203c0,3.739583 1.247483,6.119317 2.806836,5.099431c3.118707,-2.039772 9.667991,12.578595 9.667991,21.757571c0,3.739583 1.247483,6.799241 3.118707,6.799241c1.559353,0 4.054318,4.079545 4.98993,9.178975c1.247483,5.439393 3.118707,11.218747 4.054318,12.918557c1.247483,2.039772 5.301801,12.578595 9.35612,23.797342c3.742448,11.218747 8.420508,23.117419 9.979861,26.177077c1.559353,3.399621 2.806836,10.878785 2.806836,16.318178c0,5.779355 1.247483,9.858899 2.494965,8.839013c2.806836,-2.039772 9.979861,27.196963 9.979861,40.455482c0,4.419507 1.559353,9.178975 3.118707,10.198861c1.871224,1.019886 3.118707,11.898671 3.118707,24.137304c0,11.898671 1.247483,21.757571 2.494965,21.757571c1.559353,0 5.301801,16.318178 8.420508,36.7159c3.118707,20.057761 6.861155,37.735786 8.108638,39.775558c3.430577,3.739583 3.742448,142.444095 0.623741,145.843715c-3.430577,3.739583 -9.979861,38.755672 -9.979861,54.733888c-0.31187,7.479165 -1.247483,17.338064 -2.494965,21.757571c-1.871224,7.819127 -2.183095,7.819127 -4.36619,1.69981c-1.247483,-3.739583 -2.494965,6.459279 -2.494965,24.477266c-0.31187,16.998102 -1.559353,35.356052 -3.118707,40.795444c-1.559353,5.439393 -4.67806,25.497153 -6.861155,44.874989c-2.183095,20.737685 -4.98993,33.31628 -6.549283,30.596584c-1.247483,-2.719696 -2.494965,2.039772 -2.494965,11.558709c0,8.839013 -1.247483,16.998102 -3.118707,18.017988c-1.559353,1.019886 -3.118707,7.139203 -3.118707,13.258519c0,6.459279 -2.183095,15.978216 -4.67806,21.077647c-2.494965,5.439393 -5.613672,15.298292 -6.549283,21.757571c-1.247483,6.459279 -5.301801,16.65814 -9.044249,22.097533c-4.054318,5.779355 -8.732378,19.037874 -10.915473,29.916659c-1.871224,10.538823 -4.67806,19.377837 -5.925543,19.377837c-0.935612,0 -4.054318,7.139203 -6.237413,16.318178c-2.494965,8.839013 -5.925543,16.998102 -7.484896,18.35795c-1.871224,1.019886 -3.742448,5.099431 -4.054318,8.499051c-0.623741,3.739583 -3.118707,11.218747 -5.925543,16.65814c-2.494965,5.439393 -4.67806,12.578595 -4.67806,15.638254c0,3.059659 -1.559353,6.799241 -3.118707,7.819127c-1.871224,1.359848 -5.613672,8.159089 -8.420508,15.638254c-2.494965,7.139203 -5.925543,13.258519 -7.484896,13.258519c-1.559353,0 -2.806836,2.379734 -2.806836,5.099431c0,6.119317 -10.603603,27.196963 -18.71224,36.375938c-3.430577,4.079545 -5.301801,8.499051 -4.36619,9.858899c0.623741,1.359848 -1.247483,4.759469 -4.36619,7.139203c-3.430577,2.379734 -5.925543,5.439393 -5.613672,6.799241c0,1.019886 -4.36619,7.819127 -9.667991,14.618368c-5.613672,6.799241 -10.291732,13.258519 -10.291732,13.938444c0,1.019886 -3.118707,5.439393 -6.861155,10.198861c-4.054318,4.759469 -9.979861,11.898671 -13.410438,16.318178c-3.430577,4.079545 -9.667991,13.258519 -14.03418,20.057761c-4.36619,6.799241 -8.732378,12.578595 -9.979861,12.578595c-1.559353,0 -2.494965,2.379734 -2.494965,5.439393c0,2.719696 -1.247483,4.079545 -3.118707,3.059659c-1.559353,-1.019886 -3.118707,-0.339962 -3.118707,1.359848c0,2.039772 1.559353,3.739583 3.118707,3.739583c1.871224,0 3.118707,2.039772 3.118707,4.759469c0,2.719696 0.935612,5.439393 2.494965,6.119317c1.247483,0.679924 5.925543,7.139203 10.915473,14.95833c4.67806,7.479165 11.227344,16.998102 14.657921,21.077647c3.430577,4.079545 6.237413,8.839013 6.237413,10.878785c0,1.69981 1.247483,3.399621 2.494965,3.399621c1.559353,0 4.67806,4.079545 7.173025,9.518937c2.494965,5.099431 6.861155,11.898671 10.291732,15.298292c3.118707,3.059659 4.98993,5.779355 3.742448,5.779355c-1.247483,0 0,2.379734 2.494965,5.439393c2.806836,2.719696 4.98993,7.139203 4.98993,9.178975c0,2.379734 3.430577,8.499051 7.796766,13.598481c4.36619,5.099431 7.484896,9.178975 6.549283,9.178975c-0.935612,0 1.871224,5.439393 5.925543,12.238633c4.36619,6.799241 7.796766,14.95833 7.796766,18.017988c0,4.759469 0.623741,4.759469 3.118707,0.339962c2.183095,-3.739583 3.118707,-2.379734 3.118707,6.459279c0,6.459279 0.935612,10.538823 2.183095,9.518937c0.935612,-1.359848 4.36619,3.739583 7.484896,11.218747c3.118707,7.479165 7.173025,13.598481 9.044249,13.598481c1.559353,0 3.118707,3.059659 3.118707,6.799241c0,3.739583 1.247483,6.799241 2.806836,6.799241c1.559353,0 3.430577,4.419507 4.36619,9.858899c0.935612,5.439393 3.742448,11.898671 5.925543,14.278406c2.183095,2.719696 5.925543,8.839013 8.420508,14.278406c2.494965,5.099431 5.613672,9.178975 7.173025,9.178975c1.247483,0 2.494965,3.059659 2.494965,7.139203c0,3.739583 2.183095,9.178975 4.67806,12.238633c2.494965,2.719696 4.054318,6.459279 3.118707,8.159089c-1.247483,1.69981 0.31187,3.059659 2.806836,3.059659c2.806836,0 4.98993,3.059659 4.98993,6.799241c0,3.739583 1.559353,6.799241 3.118707,6.799241c1.871224,0 3.118707,2.719696 3.118707,6.119317c0,3.399621 2.806836,9.518937 6.237413,13.598481c3.430577,4.079545 6.237413,9.178975 6.237413,11.218747c0,2.379734 3.430577,9.178975 7.796766,15.298292c4.36619,6.119317 7.796766,12.918557 7.796766,14.95833c0,3.739583 5.301801,16.318178 12.786697,30.596584c1.559353,2.719696 5.301801,10.538823 8.420508,16.998102c2.806836,6.459279 6.237413,12.578595 7.796766,12.918557c1.247483,0.679924 2.183095,3.399621 2.183095,6.119317c0,2.719696 1.247483,7.479165 2.806836,10.878785c1.559353,3.059659 4.67806,10.538823 6.861155,16.65814c2.183095,5.779355 5.301801,9.858899 6.549283,9.178975c1.247483,-1.019886 2.494965,2.039772 2.494965,6.799241c0,4.759469 1.559353,9.518937 3.118707,10.538823c1.871224,1.019886 3.118707,4.759469 3.118707,8.499051c0,3.399621 2.183095,6.799241 4.67806,8.159089c2.494965,1.019886 4.67806,4.079545 4.67806,6.799241c0,8.159089 6.861155,22.437495 9.667991,20.397723c1.559353,-1.019886 2.806836,2.039772 2.806836,7.139203c0,4.759469 1.247483,11.558709 3.118707,15.298292c1.871224,3.739583 4.67806,9.858899 6.237413,13.598481c1.871224,3.739583 3.118707,9.178975 3.118707,11.898671c0,2.719696 1.247483,5.099431 2.494965,5.099431c1.247483,0 4.36619,7.139203 6.549283,16.318178c2.494965,8.839013 5.613672,17.678026 7.173025,20.057761c1.559353,2.039772 5.613672,16.65814 9.044249,32.296394c9.979861,43.175179 4.67806,101.308688 -9.044249,101.308688c-2.494965,0 -3.742448,2.039772 -2.494965,5.099431c1.247483,4.419507 -2.494965,5.099431 -23.078429,5.099431c-13.410438,0 -25.261524,-1.359848 -26.197136,-3.059659c-0.935612,-1.359848 -12.162956,-6.799241 -25.261524,-12.238633c-12.786697,-5.099431 -24.325912,-10.538823 -25.261524,-12.238633c-0.935612,-1.69981 -4.36619,-3.059659 -7.796766,-3.059659c-3.118707,0 -5.925543,-1.359848 -5.925543,-3.399621c0,-1.69981 -3.430577,-3.399621 -7.796766,-3.399621c-4.36619,0 -7.796766,-1.019886 -7.796766,-2.719696c0,-1.359848 -4.67806,-4.419507 -9.979861,-6.799241c-5.613672,-2.379734 -12.786697,-6.119317 -15.593533,-7.819127c-3.118707,-1.69981 -8.732378,-3.059659 -12.474826,-3.059659c-3.742448,0 -5.613672,-1.019886 -4.67806,-2.379734c2.494965,-2.379734 -11.851085,-11.218747 -18.400369,-11.218747c-2.494965,0 -4.36619,-2.379734 -4.36619,-5.099431c0,-2.719696 -2.806836,-5.099431 -5.925543,-5.099431c-3.430577,0 -7.173025,-1.359848 -8.108638,-3.399621c-0.935612,-1.69981 -6.549283,-3.399621 -11.851085,-3.739583c-8.420508,0 -9.044249,-0.679924 -3.742448,-3.059659c5.301801,-2.379734 5.301801,-3.059659 0.935612,-3.059659c-3.118707,-0.339962 -12.162956,-4.419507 -20.271593,-9.518937c-8.108638,-4.759469 -19.959722,-11.898671 -25.885265,-15.638254c-5.925543,-3.739583 -11.539215,-7.479165 -12.474826,-8.839013c-3.118707,-4.079545 -15.593533,-10.538823 -20.271593,-10.538823c-2.806836,0 -4.054318,-1.359848 -3.118707,-3.399621c0.935612,-1.69981 -0.31187,-3.399621 -2.806836,-3.399621c-4.36619,0 -11.539215,-5.099431 -22.142817,-15.978216c-2.183095,-2.039772 -9.979861,-7.139203 -17.776628,-11.218747c-7.796766,-3.739583 -19.335981,-12.238633 -25.885265,-18.697912c-6.549283,-6.459279 -12.786697,-11.898671 -14.03418,-11.898671c-1.247483,0 -6.549283,-4.419507 -11.851085,-9.858899c-5.301801,-5.779355 -14.969791,-13.938444 -21.519076,-18.35795c-6.549283,-4.759469 -15.281663,-11.898671 -19.647851,-16.318178c-4.054318,-4.419507 -8.732378,-7.819127 -9.979861,-7.139203c-1.559353,0.339962 -2.494965,-0.679924 -2.494965,-2.719696c0,-1.69981 -3.742448,-5.439393 -8.420508,-8.159089c-4.98993,-2.719696 -7.484896,-5.099431 -6.237413,-5.439393c3.742448,0 -23.390299,-27.196963 -27.444619,-27.196963c-1.559353,0 -4.98993,-4.759469 -7.173025,-10.198861c-2.494965,-5.779355 -5.301801,-9.518937 -6.861155,-8.499051c-2.806836,2.039772 -15.593533,-15.978216 -15.593533,-21.757571c0,-2.039772 -1.871224,-3.739583 -4.36619,-3.739583c-2.494965,0 -6.549283,-3.059659 -9.044249,-6.799241c-2.494965,-3.739583 -5.301801,-5.779355 -6.237413,-4.419507c-1.247483,1.019886 -2.183095,0.339962 -2.183095,-2.039772c0,-2.039772 -3.118707,-7.479165 -6.861155,-11.898671c-4.054318,-4.419507 -11.227344,-13.598481 -16.529145,-20.737685c-4.98993,-6.799241 -13.410438,-17.678026 -18.71224,-23.457381c-4.98993,-6.119317 -9.667991,-12.918557 -10.291732,-15.298292c-0.31187,-2.379734 -2.806836,-6.799241 -5.301801,-9.518937c-2.806836,-2.719696 -4.054318,-6.119317 -3.118707,-7.819127c0.935612,-1.69981 -1.247483,-3.739583 -4.67806,-5.099431c-5.613672,-2.039772 -7.484896,-5.779355 -6.549283,-12.578595c0,-1.69981 -1.559353,-2.719696 -3.430577,-2.719696c-2.183095,0 -7.484896,-8.159089 -11.851085,-18.017988c-10.915473,-25.157191 -11.539215,-25.837115 -26.197136,-20.057761c-7.173025,2.379734 -14.03418,6.119317 -15.905404,7.819127c-1.559353,1.69981 -7.796766,3.059659 -13.722309,3.059659c-10.603603,0 -27.756489,4.759469 -38.360092,10.538823c-3.118707,1.69981 -8.420508,3.059659 -11.539215,3.059659c-3.430577,0 -7.173025,1.69981 -8.108638,3.399621c-0.935612,2.039772 -5.925543,3.399621 -11.227344,3.399621c-4.98993,0 -9.044249,1.69981 -9.044249,3.399621c0,2.039772 -4.36619,3.399621 -9.35612,3.399621c-5.301801,0 -11.851085,1.359848 -14.969791,3.399621c-2.806836,1.69981 -16.217274,5.779355 -29.315842,8.839013c-13.410438,3.059659 -23.702171,6.799241 -22.766559,8.159089c0.935612,1.359848 -11.539215,3.399621 -27.444619,4.419507c-15.593533,1.359848 -42.10254,3.739583 -58.319814,5.439393c-16.217274,2.039772 -43.973763,4.759469 -61.438521,5.779355c-17.776628,1.359848 -32.122678,3.059659 -32.122678,4.079545c0,2.379734 19.335981,21.077647 22.142817,21.077647c1.247483,0 6.237413,3.739583 10.603603,8.159089c10.603603,10.538823 13.098568,28.556811 6.549283,43.175179c-2.806836,5.779355 -4.98993,12.918557 -4.98993,15.638254c0,2.379734 -2.183095,5.439393 -4.67806,6.459279c-2.494965,1.359848 -4.67806,5.779355 -4.67806,10.198861c0,4.419507 -1.247483,8.159089 -3.118707,8.159089c-1.559353,0 -3.118707,3.739583 -3.118707,8.499051c0,4.759469 -1.247483,8.499051 -3.118707,8.499051c-1.559353,0 -3.118707,2.379734 -3.118707,5.099431c0,2.719696 -1.247483,5.099431 -3.118707,5.099431c-1.559353,0 -3.118707,1.69981 -3.118707,3.399621c0,2.039772 2.183095,3.399621 4.67806,3.399621c2.806836,0 5.613672,2.379734 6.549283,5.099431c1.247483,2.719696 3.742448,5.099431 6.237413,5.099431c2.494965,0 4.36619,1.69981 4.36619,3.399621c0,2.039772 3.430577,3.399621 7.796766,3.399621c4.36619,0 7.796766,1.359848 7.796766,2.719696c0,1.69981 4.98993,4.759469 10.915473,7.479165c5.925543,2.719696 10.915473,5.779355 10.915473,7.479165c0,1.359848 2.806836,2.719696 6.549283,2.719696c3.430577,0 5.613672,1.359848 4.36619,3.399621c-0.935612,1.69981 4.054318,4.759469 10.915473,6.799241c6.861155,2.039772 12.474826,5.099431 12.474826,6.799241c0,2.039772 2.806836,3.399621 6.237413,3.399621c3.118707,0 7.173025,2.039772 8.420508,4.419507c2.494965,4.079545 25.885265,17.678026 29.627713,16.65814c0.935612,-0.339962 3.742448,1.69981 5.613672,4.419507c2.183095,2.719696 7.173025,5.099431 11.539215,5.099431c4.054318,0 6.861155,1.359848 5.925543,3.059659c-1.247483,1.69981 4.054318,5.439393 11.227344,7.819127c7.173025,2.719696 15.593533,8.499051 18.71224,13.258519c6.861155,9.858899 8.420508,38.075748 3.118707,62.553015c-1.871224,9.518937 -4.36619,21.757571 -5.301801,27.196963c-1.247483,5.779355 -4.67806,16.318178 -7.796766,23.797342c-3.430577,7.479165 -6.861155,18.017988 -7.796766,23.117419c-0.935612,5.099431 -3.118707,8.499051 -4.67806,7.479165c-1.871224,-1.019886 -3.118707,1.69981 -3.118707,6.459279c0,4.759469 -1.247483,9.518937 -3.118707,10.538823c-1.559353,1.019886 -3.118707,5.099431 -3.118707,8.839013c0,3.739583 -1.247483,5.779355 -3.118707,4.759469c-1.559353,-1.019886 -3.118707,0.339962 -3.118707,3.059659c0,6.459279 -12.474826,36.035977 -17.776628,42.155293c-1.871224,2.039772 -4.67806,7.139203 -5.613672,10.878785c-1.871224,6.119317 -4.67806,6.799241 -33.05829,6.799241c-28.692101,0 -30.875196,-0.339962 -30.875196,-6.799241c0,-3.739583 0.935612,-6.799241 2.494965,-6.799241c1.247483,0 5.613672,-8.159089 9.979861,-18.017988c4.36619,-9.518937 9.667991,-19.037874 11.851085,-20.397723c1.871224,-1.359848 3.742448,-4.759469 3.742448,-7.139203c0,-6.119317 7.484896,-22.437495 10.291732,-22.437495c1.247483,0 2.183095,-2.379734 2.183095,-5.099431c0,-2.719696 1.247483,-5.099431 2.494965,-5.099431c1.559353,0 4.67806,-6.459279 6.861155,-14.278406c2.183095,-8.159089 4.98993,-17.678026 6.237413,-21.417609c1.559353,-3.739583 4.36619,-12.918557 6.237413,-20.397723c2.183095,-7.479165 5.613672,-18.017988 8.108638,-23.117419c10.291732,-22.437495 4.67806,-33.31628 -22.142817,-43.515141c-6.861155,-2.719696 -15.281663,-7.479165 -18.400369,-10.538823c-3.430577,-3.399621 -8.732378,-6.119317 -11.851085,-6.119317c-3.118707,0 -5.613672,-1.359848 -5.613672,-3.059659c0,-1.69981 -9.044249,-7.139203 -20.271593,-12.238633c-11.227344,-5.439393 -20.271593,-10.878785 -20.271593,-12.238633c0,-1.359848 -4.98993,-4.419507 -10.915473,-6.799241c-5.925543,-2.379734 -10.915473,-5.439393 -10.915473,-6.799241c0,-1.359848 -3.430577,-3.399621 -7.796766,-4.419507c-4.36619,-1.359848 -10.603603,-4.759469 -13.410438,-8.159089c-3.118707,-3.059659 -11.227344,-8.839013 -17.776628,-12.578595c-18.400369,-10.198861 -38.671962,-33.31628 -39.607574,-44.874989c-1.247483,-19.717799 0.935612,-26.857001 11.539215,-39.435596c5.925543,-7.139203 10.915473,-15.298292 10.915473,-18.017988c0,-2.719696 1.559353,-4.759469 3.118707,-4.759469c1.871224,0 3.118707,-3.739583 3.118707,-8.499051c0,-4.759469 1.559353,-8.499051 3.118707,-8.499051c5.301801,0 3.430577,-16.998102 -2.183095,-19.377837c-2.806836,-1.359848 -9.35612,-6.459279 -14.657921,-11.898671c-4.98993,-5.099431 -9.979861,-9.518937 -11.539215,-9.518937c-2.806836,0 -16.529145,-12.238633 -25.573394,-22.777457c-5.613672,-7.139203 -9.35612,-7.819127 -33.993902,-7.819127c-14.969791,0 -27.444619,1.019886 -27.444619,2.039772c0,3.739583 9.044249,11.558709 13.722309,11.558709c5.925543,0 23.702171,19.377837 24.014041,26.517039c1.247483,22.777457 -8.108638,55.07385 -15.905404,55.07385c-1.871224,0 -3.118707,3.059659 -3.118707,6.799241c0,3.739583 -1.247483,6.799241 -3.118707,6.799241c-1.559353,0 -3.118707,2.379734 -3.118707,5.439393c0,2.719696 -1.247483,4.419507 -2.494965,3.399621c-1.559353,-1.019886 -4.67806,3.399621 -6.861155,9.858899c-2.494965,6.459279 -5.301801,11.898671 -6.549283,11.898671c-1.247483,0 -6.237413,7.139203 -10.915473,16.318178c-4.67806,8.839013 -9.35612,16.65814 -10.291732,17.678026c-0.935612,1.019886 -4.054318,6.459279 -6.549283,11.898671c-2.494965,5.779355 -5.301801,10.878785 -6.237413,11.898671c-4.36619,4.759469 -12.162956,23.117419 -10.291732,25.157191c0.935612,1.019886 0.31187,2.039772 -1.559353,2.039772c-2.183095,0 -3.742448,3.059659 -3.742448,6.799241c0,3.739583 -2.806836,10.198861 -6.237413,14.618368c-12.786697,15.298292 -14.346051,18.017988 -18.71224,32.976318c-2.494965,8.499051 -5.613672,16.318178 -7.173025,17.338064c-1.247483,1.019886 -2.806836,5.099431 -3.118707,9.178975c0,3.739583 -1.559353,6.119317 -2.806836,5.439393c-1.247483,-1.019886 -2.494965,1.359848 -2.494965,5.099431c0,4.079545 -1.559353,7.139203 -3.430577,7.139203c-1.871224,0 -2.806836,5.439393 -2.183095,12.578595c0.623741,9.518937 2.806836,13.938444 8.420508,16.65814c4.054318,2.379734 8.108638,5.439393 9.35612,7.139203c0.935612,1.359848 5.613672,4.759469 10.291732,7.479165c4.67806,2.719696 11.227344,7.139203 14.346051,10.198861c8.420508,7.819127 18.71224,13.938444 24.014041,13.938444c2.494965,0 4.67806,1.359848 4.67806,2.719696c0,1.69981 6.549283,6.799241 14.969791,11.218747c8.108638,4.419507 15.905404,9.858899 17.152886,12.238633c1.247483,2.379734 5.301801,4.419507 8.420508,4.419507c3.430577,0 9.044249,3.059659 12.474826,6.799241c3.430577,3.739583 8.108638,6.799241 10.603603,6.799241c2.494965,0 4.98993,1.019886 5.613672,2.719696c0.623741,1.359848 8.108638,6.119317 16.529145,10.538823c8.732378,4.419507 18.088498,9.178975 20.895334,10.878785c3.118707,1.69981 7.796766,3.059659 10.291732,3.059659c2.494965,0 4.67806,2.039772 4.67806,4.419507c0,2.719696 6.861155,6.459279 15.593533,9.178975c8.420508,2.379734 14.657921,5.779355 13.722309,7.479165c-0.935612,1.359848 1.247483,2.719696 4.67806,2.719696c3.430577,0 7.173025,1.69981 8.108638,3.399621c1.247483,2.379734 -19.335981,3.399621 -59.879167,3.059659l-61.750391,-0.339962l-17.464757,-10.538823l0.000003,-0.000007l0.000016,-0.000008zm1002.352309,-260.070961c-0.935612,-29.236735 -3.118707,-55.07385 -4.67806,-57.453585c-1.559353,-2.379734 -4.36619,-18.35795 -5.613672,-35.696015c-4.36619,-47.934648 -11.851085,-95.869296 -15.593533,-97.229143c-1.559353,-0.679924 -3.118707,-6.459279 -3.118707,-12.918557c0,-13.258519 -6.549283,-38.755672 -9.979861,-38.755672c-1.559353,0 -2.494965,-2.379734 -2.494965,-5.099431c0,-4.759469 -11.227344,-28.896773 -15.281663,-32.296394c-0.935612,-1.019886 -5.925543,-10.878785 -11.227344,-22.097533c-4.98993,-11.218747 -10.291732,-20.737685 -11.539215,-21.417609c-1.559353,-0.679924 -2.494965,-4.079545 -2.494965,-7.819127c0,-3.399621 -1.247483,-6.459279 -3.118707,-6.459279c-1.559353,0 -3.118707,-2.379734 -3.118707,-5.099431c0,-2.719696 -0.935612,-5.099431 -2.183095,-5.099431c-3.118707,0 -10.291732,-16.65814 -10.291732,-23.117419c0,-2.379734 -1.247483,-3.399621 -3.118707,-2.379734c-1.559353,1.019886 -3.118707,-0.339962 -3.118707,-3.059659c0,-3.059659 -1.247483,-5.439393 -3.118707,-5.439393c-1.559353,0 -3.118707,-2.379734 -3.118707,-5.099431c0,-3.059659 -2.183095,-6.119317 -4.67806,-7.139203c-2.494965,-1.359848 -4.67806,-4.079545 -4.67806,-6.459279c0,-6.119317 -12.474826,-29.236735 -19.335981,-36.035977c-3.118707,-3.059659 -5.613672,-8.159089 -5.613672,-11.218747c0,-3.059659 -2.183095,-5.439393 -4.98993,-5.439393c-2.494965,0 -4.054318,-1.359848 -3.118707,-2.719696c0.935612,-1.69981 -1.247483,-6.119317 -4.36619,-10.198861c-3.430577,-4.079545 -6.237413,-8.159089 -6.237413,-9.518937c0,-1.359848 -2.183095,-4.759469 -4.67806,-7.819127c-13.410438,-16.318178 -16.217274,-20.057761 -18.088498,-25.157191c-2.806836,-8.159089 -8.108638,-7.139203 -15.281663,2.719696c-3.430577,4.759469 -8.108638,8.499051 -10.603603,8.499051c-2.494965,0 -8.108638,3.739583 -12.162956,8.159089c-4.054318,4.759469 -10.603603,9.178975 -14.03418,10.538823c-3.430577,1.019886 -6.237413,4.419507 -6.237413,7.139203c0,2.719696 -1.871224,4.759469 -4.36619,4.759469c-2.494965,0 -9.044249,4.419507 -14.657921,9.858899c-5.613672,5.779355 -14.03418,11.898671 -19.024111,14.278406c-4.67806,2.039772 -7.796766,5.099431 -6.861155,6.799241c0.935612,1.69981 -0.623741,3.059659 -3.118707,3.059659c-2.806836,0 -6.549283,3.059659 -8.732378,6.799241c-2.183095,3.739583 -5.613672,6.799241 -7.796766,6.799241c-2.183095,0 -4.054318,1.359848 -4.054318,3.059659c0,1.69981 -3.430577,4.079545 -7.796766,5.099431c-4.36619,1.359848 -7.796766,3.739583 -7.796766,5.439393c0,2.039772 -2.183095,3.399621 -4.67806,3.399621c-2.494965,0 -4.67806,1.69981 -4.67806,3.399621c0,2.039772 -2.183095,3.399621 -4.67806,3.399621c-2.494965,0 -4.67806,1.69981 -4.67806,3.399621c0,2.039772 -2.183095,3.399621 -4.67806,3.399621c-2.494965,0 -4.67806,1.69981 -4.67806,3.399621c0,2.039772 -2.806836,3.399621 -6.237413,3.399621c-3.430577,0 -6.237413,1.69981 -6.237413,3.399621c0,2.039772 -3.118707,3.399621 -6.861155,3.399621c-3.742448,0 -5.613672,1.019886 -4.67806,2.379734c2.494965,2.719696 -19.335981,17.678026 -25.885265,18.017988c-5.925543,0 -13.410438,12.578595 -9.35612,15.298292c1.871224,1.019886 3.118707,5.099431 3.118707,8.839013c0,3.399621 0.935612,6.459279 2.494965,6.459279c1.247483,0 5.613672,6.799241 9.979861,15.298292c4.36619,8.499051 8.732378,15.298292 9.979861,15.298292c1.247483,0 4.67806,5.439393 7.484896,11.898671c2.806836,6.459279 6.237413,11.898671 7.796766,11.898671c1.559353,0 4.36619,3.739583 6.549283,8.159089c4.98993,9.858899 19.024111,29.236735 33.682032,46.234837c28.068359,32.976318 37.42448,44.535027 37.42448,47.594686c0,2.039772 0.935612,3.059659 2.494965,2.719696c1.247483,-0.679924 8.732378,6.459279 17.152886,15.298292c8.108638,8.839013 15.281663,15.978216 16.217274,15.978216c0.935612,0 8.732378,7.479165 17.152886,16.65814c8.732378,9.178975 19.647851,18.697912 24.325912,21.077647c4.67806,2.039772 12.162956,9.178975 16.217274,15.298292c4.36619,5.779355 8.732378,10.198861 9.667991,9.518937c1.247483,-0.679924 3.742448,1.019886 5.925543,3.739583c2.183095,2.719696 5.925543,5.099431 8.108638,5.099431c2.494965,0 4.36619,1.69981 4.36619,3.399621c0,2.039772 1.871224,3.399621 4.054318,3.399621c1.871224,0 8.108638,4.419507 13.098568,9.518937c5.301801,5.099431 15.905404,13.598481 24.325912,18.697912c8.108638,5.099431 14.657921,10.538823 14.657921,11.898671c0,1.359848 7.796766,6.119317 17.152886,10.878785c9.35612,4.759469 17.152886,9.518937 17.152886,11.218747c0,1.359848 2.183095,2.379734 4.67806,2.379734c2.494965,0 4.67806,1.359848 4.67806,3.059659c0,1.69981 8.420508,6.799241 18.71224,11.218747c10.291732,4.079545 18.71224,9.858899 18.71224,11.898671c0,2.379734 2.806836,4.419507 6.237413,4.419507c3.430577,0 6.237413,1.69981 6.237413,3.399621c0,2.039772 2.806836,3.399621 6.549283,3.399621c3.430577,0 5.613672,1.359848 4.36619,3.059659c-1.871224,3.399621 9.979861,6.459279 16.217274,4.419507c2.494965,-0.679924 3.118707,-15.638254 1.871224,-54.393926l-0.000002,-0.000004l0.000008,-0.000004zm-1930.79127,-14.278406c4.36619,-3.399621 8.732378,-5.439393 9.979861,-4.419507c0.935612,1.019886 1.871224,0.679924 1.871224,-1.359848c0,-1.69981 5.613672,-6.119317 12.474826,-9.518937c6.861155,-3.399621 12.474826,-7.479165 12.474826,-9.178975c0,-1.359848 2.806836,-2.719696 6.237413,-2.719696c3.430577,0 6.237413,-1.359848 6.237413,-3.399621c0,-1.69981 2.183095,-3.399621 4.98993,-3.399621c2.494965,0 3.742448,-1.359848 2.806836,-3.399621c-0.935612,-1.69981 0.935612,-3.399621 4.36619,-3.399621c3.742448,0 6.549283,-1.359848 6.549283,-3.399621c0,-1.69981 1.871224,-3.399621 4.36619,-3.399621c5.925543,0 20.895334,-8.839013 18.71224,-11.218747c-0.935612,-1.019886 1.559353,-3.739583 5.613672,-6.119317c3.742448,-2.039772 8.420508,-6.119317 9.667991,-8.499051c1.247483,-2.719696 4.67806,-4.759469 6.861155,-4.759469c2.494965,0 4.67806,-1.359848 4.67806,-3.399621c0,-1.69981 1.559353,-3.399621 3.118707,-3.399621c3.742448,0 22.766559,-13.938444 24.325912,-17.678026c0.623741,-1.69981 2.183095,-2.719696 3.742448,-2.719696c2.494965,0 9.979861,-6.459279 28.692101,-24.477266c4.98993,-5.439393 10.603603,-9.518937 12.162956,-9.518937c1.559353,0 2.806836,-1.69981 2.806836,-3.739583c0,-4.079545 7.796766,-13.258519 11.539215,-13.258519c1.247483,0 6.549283,-4.759469 11.539215,-10.198861c4.98993,-5.779355 10.291732,-10.198861 11.851085,-10.198861c1.247483,0 2.494965,-2.039772 2.494965,-4.419507c0,-2.719696 3.430577,-6.799241 7.796766,-9.178975c4.36619,-2.379734 7.796766,-6.799241 7.796766,-9.518937c0,-3.059659 0.935612,-4.419507 1.871224,-3.059659c1.871224,2.039772 10.603603,-5.439393 10.603603,-9.518937c0,-1.019886 3.430577,-5.439393 7.796766,-9.858899c4.36619,-4.419507 7.796766,-9.518937 7.796766,-11.558709c0,-2.039772 2.806836,-4.759469 6.237413,-5.779355c3.430577,-1.019886 6.237413,-3.739583 6.237413,-5.779355c0,-1.69981 4.36619,-7.819127 9.35612,-12.918557c5.301801,-5.099431 9.35612,-10.878785 9.35612,-12.578595c0,-1.359848 5.613672,-9.518937 12.162956,-17.678026c6.861155,-8.499051 11.851085,-16.318178 11.227344,-17.338064c-0.623741,-1.359848 1.559353,-4.419507 4.98993,-6.799241c3.118707,-2.719696 5.925543,-6.799241 5.925543,-9.178975c0,-2.379734 1.247483,-4.419507 2.806836,-4.419507c1.559353,0 4.36619,-4.419507 6.549283,-10.198861c2.183095,-5.439393 4.98993,-10.198861 6.549283,-10.198861c1.559353,0 2.806836,-2.379734 2.806836,-5.099431c0,-3.059659 2.806836,-8.499051 6.237413,-12.578595c3.430577,-4.079545 6.237413,-9.178975 6.237413,-11.558709c0,-4.759469 -25.261524,-25.157191 -31.187066,-25.157191c-1.871224,0 -4.054318,-2.379734 -4.98993,-5.099431c-1.247483,-2.719696 -3.742448,-5.099431 -6.237413,-5.099431c-2.494965,0 -4.36619,-1.359848 -4.36619,-3.399621c0,-1.69981 -1.247483,-3.399621 -3.118707,-3.399621c-2.806836,0 -10.915473,-6.459279 -20.271593,-15.978216c-2.494965,-2.379734 -4.98993,-4.419507 -5.925543,-4.419507c-1.871224,0 -3.118707,-1.019886 -26.820877,-23.797342c-7.796766,-7.479165 -14.969791,-13.598481 -16.217274,-13.598481c-0.935612,0 -21.830946,-21.077647 -45.844987,-47.254724l-44.285634,-46.914762l-10.603603,11.558709c-5.925543,6.459279 -10.915473,12.578595 -10.915473,13.258519c0,2.379734 -13.098568,21.757571 -22.454688,33.31628c-8.108638,9.518937 -9.044249,11.558709 -8.732378,17.678026c0.31187,1.019886 -2.806836,4.759469 -6.861155,8.159089c-4.054318,3.739583 -5.925543,6.459279 -4.67806,6.799241c1.247483,0 -0.623741,3.399621 -4.054318,7.819127c-3.430577,4.079545 -12.786697,18.35795 -20.271593,31.276508c-7.484896,13.258519 -14.969791,25.497153 -16.529145,27.196963c-1.247483,2.039772 -4.67806,8.499051 -6.861155,14.618368c-2.494965,5.779355 -5.613672,10.878785 -6.549283,10.878785c-0.935612,0 -5.301801,8.499051 -9.35612,18.697912c-4.054318,10.198861 -8.108638,18.697912 -9.35612,18.697912c-0.935612,0 -4.36619,6.119317 -7.484896,13.598481c-3.118707,7.479165 -6.861155,13.598481 -8.420508,13.598481c-1.247483,0 -2.494965,3.059659 -2.494965,6.799241c0,3.739583 -1.247483,6.799241 -3.118707,6.799241c-1.559353,0 -3.118707,3.059659 -3.118707,6.799241c0,3.739583 -1.247483,6.799241 -3.118707,6.799241c-1.559353,0 -3.118707,3.059659 -3.118707,6.799241c0,3.739583 -0.935612,6.799241 -2.183095,6.799241c-8.732378,0 -10.291732,21.417609 -10.291732,131.905271c0,106.068156 3.118707,157.062462 9.35612,157.062462c1.247483,0 5.925543,-3.059659 9.979861,-6.799241l-0.000002,0.000007l0.000006,0zm1090.923576,-286.927962c103.852931,-10.198861 140.341798,-15.298292 140.341798,-19.377837c0,-1.359848 11.539215,-3.399621 25.885265,-4.419507c25.885265,-1.69981 62.686003,-7.139203 56.760461,-8.499051c-1.559353,-0.679924 6.861155,-3.739583 18.71224,-7.139203c12.162956,-3.399621 26.197136,-7.819127 31.187066,-9.518937c5.301801,-2.039772 17.152886,-6.119317 26.509006,-9.518937c17.464757,-5.779355 34.617644,-12.918557 44.285634,-18.697912c3.118707,-1.69981 8.420508,-3.059659 11.851085,-3.059659c3.430577,0 6.237413,-1.359848 6.237413,-3.399621c0,-1.69981 1.871224,-3.399621 4.054318,-3.399621c1.871224,-0.339962 11.539215,-4.759469 20.895334,-10.198861c9.35612,-5.439393 21.830946,-12.238633 27.444619,-15.298292c5.301801,-2.719696 9.979861,-6.799241 9.979861,-8.499051c0,-2.039772 2.806836,-3.399621 6.237413,-3.399621c3.430577,0 6.237413,-1.359848 6.237413,-3.399621c0,-1.69981 2.183095,-3.399621 4.67806,-3.399621c2.494965,0 4.67806,-1.359848 4.67806,-3.059659c0,-1.69981 2.494965,-3.739583 5.613672,-4.759469c7.796766,-2.719696 23.702171,-13.598481 26.197136,-18.017988c1.247483,-2.039772 6.549283,-5.779355 11.851085,-8.159089c4.98993,-2.379734 8.732378,-5.099431 8.108638,-6.459279c-0.935612,-1.359848 2.494965,-4.079545 7.173025,-6.459279c4.67806,-2.379734 11.539215,-7.139203 15.281663,-10.878785c3.742448,-3.739583 7.484896,-6.799241 8.732378,-6.799241c1.247483,0 4.36619,-2.719696 7.173025,-6.119317c2.806836,-3.059659 12.162956,-11.898671 20.583464,-19.037874c19.335981,-16.65814 24.637782,-21.757571 41.166927,-40.11552c32.122678,-35.356052 53.953625,-62.553015 53.953625,-66.63256c0,-2.379734 1.559353,-3.399621 3.118707,-2.379734c1.871224,1.019886 3.118707,-0.339962 3.118707,-3.059659c0,-2.719696 3.118707,-7.819127 7.173025,-11.218747c3.742448,-3.399621 10.291732,-11.898671 14.346051,-18.697912c3.742448,-7.139203 8.420508,-12.918557 9.979861,-12.918557c1.559353,0 2.806836,-2.039772 2.806836,-4.419507c0,-2.379734 3.118707,-8.159089 7.173025,-12.578595c14.657921,-17.338064 45.844987,-70.372142 45.844987,-78.531231c0,-3.739583 1.247483,-6.119317 2.806836,-5.099431c2.494965,1.69981 12.162956,-25.497153 10.291732,-28.216849c-0.623741,-0.679924 0,-2.379734 1.559353,-3.399621c1.559353,-1.019886 5.925543,-9.518937 9.979861,-19.037874c3.742448,-9.178975 9.044249,-21.417609 11.227344,-26.517039c2.494965,-5.439393 4.67806,-11.898671 4.67806,-14.618368c0,-2.719696 1.247483,-7.479165 2.806836,-10.878785c1.559353,-3.059659 4.67806,-12.918557 7.173025,-21.757571c2.183095,-9.178975 4.98993,-16.318178 6.237413,-16.318178c1.247483,0 2.494965,-2.039772 2.494965,-4.419507c0,-2.379734 3.430577,-11.898671 7.796766,-21.417609c6.861155,-14.95833 9.35612,-27.536925 16.841016,-83.630661c1.247483,-8.499051 3.742448,-17.678026 5.613672,-20.397723c1.871224,-2.379734 4.36619,-13.598481 5.613672,-24.817229c1.247483,-11.218747 3.430577,-29.576697 4.67806,-40.795444c1.247483,-11.218747 2.494965,-18.697912 3.118707,-16.998102c0.623741,2.039772 2.183095,-9.518937 3.742448,-25.497153c1.247483,-15.978216 3.118707,-38.755672 4.36619,-50.994306c0.935612,-12.238633 3.430577,-23.117419 5.613672,-24.477266c4.67806,-3.399621 4.36619,-87.030282 -0.623741,-96.209257c-3.118707,-6.119317 -3.430577,-5.439393 -2.183095,4.079545c1.247483,11.558709 -3.430577,18.697912 -6.549283,9.858899c-0.935612,-2.719696 -3.742448,-4.079545 -6.237413,-3.059659c-5.301801,2.039772 -19.959722,-1.359848 -19.959722,-5.099431c0,-5.099431 18.088498,-10.198861 21.519076,-6.459279c3.742448,4.079545 3.742448,3.739583 4.98993,-17.338064c0.623741,-7.819127 -0.31187,-13.598481 -1.871224,-12.238633c-1.559353,1.019886 -2.806836,-1.69981 -2.806836,-5.779355c0,-12.918557 -4.36619,-3.739583 -6.237413,13.258519c-1.247483,13.938444 -2.494965,15.978216 -9.35612,17.338064c-4.36619,0.339962 -8.732378,2.719696 -9.979861,5.099431c-1.871224,2.719696 -2.494965,2.379734 -2.494965,-1.019886c0,-2.379734 -1.871224,-3.739583 -4.67806,-2.379734c-2.806836,1.019886 -4.67806,0 -4.67806,-3.059659c0,-2.719696 -1.247483,-5.099431 -2.806836,-5.099431c-6.237413,0 -12.786697,-10.878785 -11.227344,-18.017988c0.935612,-4.419507 -0.935612,-11.558709 -4.67806,-17.678026c-5.301801,-8.499051 -6.237413,-9.178975 -6.237413,-3.399621c-0.31187,9.518937 -12.474826,-17.678026 -12.474826,-27.536925c0,-4.079545 -2.806836,-13.938444 -6.237413,-22.097533c-3.430577,-8.159089 -6.237413,-19.377837 -6.237413,-24.477266c0,-5.439393 -1.247483,-8.839013 -2.806836,-7.819127c-3.118707,2.379734 -11.227344,-121.366448 -8.732378,-137.684626c4.67806,-33.31628 5.613672,-38.41571 6.549283,-39.435596c1.871224,-2.379734 16.217274,-2.039772 23.078429,0.339962c4.054318,1.69981 6.861155,1.019886 6.861155,-1.019886c0,-2.039772 -2.806836,-3.739583 -6.237413,-3.739583c-4.98993,0 -6.237413,-2.379734 -6.549283,-10.878785c-0.31187,-6.119317 -0.31187,-12.918557 0,-14.95833c0.31187,-2.379734 -1.559353,-4.759469 -4.36619,-6.119317c-2.494965,-1.019886 -4.67806,-4.079545 -4.67806,-7.139203c0,-3.059659 -2.806836,-8.499051 -6.237413,-12.578595c-3.430577,-4.079545 -6.237413,-9.518937 -6.237413,-12.578595c0,-2.719696 -0.935612,-4.079545 -1.871224,-2.719696c-2.183095,2.039772 -10.603603,-5.779355 -10.603603,-9.518937c0,-1.359848 -4.67806,-7.479165 -10.291732,-13.938444c-12.786697,-14.618368 -15.281663,-18.017988 -20.583464,-29.236735c-2.494965,-5.099431 -5.613672,-8.499051 -7.173025,-7.479165c-1.247483,1.019886 -2.494965,0.339962 -2.494965,-1.359848c0,-5.099431 -37.73635,-44.874989 -47.404341,-50.314382c-4.98993,-2.719696 -12.786697,-9.518937 -17.776628,-14.95833c-4.67806,-5.779355 -9.667991,-10.198861 -10.915473,-10.198861c-0.935612,0 -7.796766,-6.119317 -14.657921,-13.598481c-7.173025,-7.479165 -14.969791,-13.598481 -17.152886,-13.598481c-2.494965,0 -4.36619,-2.039772 -4.36619,-4.759469c0,-2.719696 -4.054318,-6.799241 -9.044249,-9.178975c-4.98993,-2.379734 -8.420508,-5.779355 -7.796766,-7.139203c0.935612,-1.359848 -0.31187,-2.719696 -2.806836,-2.719696c-2.494965,0 -5.613672,-2.379734 -6.549283,-5.439393c-0.935612,-2.719696 -3.118707,-4.419507 -4.36619,-3.399621c-1.559353,1.019886 -4.67806,-1.359848 -6.861155,-5.099431c-2.494965,-3.399621 -6.237413,-6.459279 -8.420508,-6.459279c-4.98993,0 -17.152886,-7.139203 -20.271593,-11.558709c-0.935612,-2.039772 -13.410438,-7.479165 -27.132747,-12.238633c-14.03418,-5.099431 -24.325912,-10.198861 -23.078429,-11.218747c0.935612,-1.359848 -3.118707,-2.379734 -9.35612,-2.379734c-6.237413,0 -11.539215,-1.359848 -11.539215,-3.399621c0,-1.69981 -4.054318,-3.399621 -9.35612,-3.399621c-4.98993,0 -9.35612,-1.359848 -9.35612,-3.059659c0,-3.399621 -12.786697,-6.119317 -42.10254,-9.178975c-10.291732,-1.359848 -20.583464,-3.739583 -22.766559,-5.779355c-5.613672,-5.099431 -9.979861,-5.099431 -140.965539,-9.518937c-90.442492,-3.059659 -136.911221,-3.059659 -188.681751,0c-37.73635,2.039772 -119.758334,4.079545 -182.444338,4.079545c-62.686003,0.339962 -123.500782,2.039772 -135.663738,3.739583c-31.810807,4.419507 -114.768404,9.178975 -195.542906,11.558709c-40.543186,1.019886 -70.170899,3.399621 -69.235287,5.099431c0.935612,1.69981 -9.35612,3.059659 -23.390299,3.059659c-13.722309,0 -25.573394,1.359848 -26.509006,3.059659c-0.935612,1.69981 -7.173025,3.739583 -13.410438,4.759469c-19.959722,3.059659 -61.438521,13.258519 -67.052192,16.318178c-3.118707,1.69981 -9.044249,3.059659 -13.098568,3.059659c-4.36619,0 -9.667991,2.379734 -12.474826,5.099431c-2.494965,2.719696 -7.484896,5.099431 -10.915473,5.099431c-3.430577,0 -7.173025,1.359848 -8.108638,3.399621c-0.935612,1.69981 -5.301801,3.399621 -9.667991,3.399621c-4.054318,0 -7.484896,1.69981 -7.484896,3.399621c0,2.039772 -2.806836,3.399621 -5.925543,3.399621c-3.430577,0 -7.173025,1.69981 -8.108638,3.399621c-0.935612,1.69981 -4.67806,3.399621 -8.108638,3.399621c-3.118707,0 -5.925543,1.69981 -5.925543,3.399621c0,2.039772 -1.871224,3.399621 -4.054318,3.399621c-2.183095,0 -9.979861,3.059659 -17.152886,6.799241c-6.861155,3.739583 -14.969791,6.799241 -17.464757,6.799241c-2.494965,0 -5.301801,1.359848 -6.237413,2.719696c-0.935612,1.69981 -11.851085,7.139203 -24.325912,12.578595c-12.474826,5.099431 -23.390299,10.538823 -24.325912,11.558709c-0.935612,1.019886 -5.613672,4.419507 -10.915473,7.139203c-4.98993,2.719696 -12.162956,7.819127 -15.281663,11.218747c-3.430577,3.059659 -8.108638,5.779355 -10.291732,5.779355c-2.494965,0 -4.98993,2.379734 -5.925543,5.099431c-1.247483,2.719696 -4.054318,5.099431 -6.237413,5.099431c-4.67806,0 -8.420508,2.719696 -20.271593,14.618368c-3.118707,3.059659 -7.796766,5.779355 -9.979861,5.779355c-2.183095,0 -5.925543,3.059659 -8.420508,6.799241c-2.494965,3.739583 -5.613672,6.799241 -6.861155,6.799241c-4.36619,0 -29.315842,25.497153 -68.923416,70.712104c-5.301801,5.779355 -10.915473,10.878785 -12.162956,10.878785c-1.247483,0 -2.494965,2.039772 -2.494965,4.759469c0,2.379734 -4.054318,8.839013 -8.732378,14.618368c-10.291732,11.558709 -39.919445,57.113622 -35.241385,54.053964c1.559353,-1.359848 3.742448,-0.679924 4.98993,1.359848c0.935612,1.69981 0,3.399621 -2.494965,3.399621c-5.301801,0 -12.162956,8.159089 -9.667991,11.218747c1.247483,1.019886 4.98993,0 8.420508,-2.719696c3.742448,-2.719696 7.796766,-3.739583 9.667991,-2.039772c5.301801,4.419507 33.05829,7.479165 33.05829,3.739583c0,-2.039772 -3.742448,-3.739583 -8.420508,-3.739583c-6.237413,-0.339962 -6.861155,-1.019886 -2.806836,-2.039772c3.118707,-1.019886 14.969791,-0.679924 25.885265,0.679924c16.217274,1.69981 19.335981,3.059659 16.529145,6.799241c-2.806836,3.399621 -2.183095,4.759469 2.183095,6.119317c3.118707,0.679924 1.871224,1.359848 -2.494965,1.019886c-5.925543,-0.679924 -7.796766,0.679924 -6.861155,3.739583c0.935612,2.379734 3.430577,4.419507 5.925543,4.419507c2.494965,0 4.36619,1.69981 4.36619,3.739583c0,2.379734 3.742448,3.059659 10.915473,1.69981c8.732378,-2.039772 10.603603,-1.359848 9.044249,2.719696c-1.247483,3.059659 0.623741,5.439393 5.613672,6.459279c5.301801,1.019886 4.67806,1.69981 -3.118707,2.039772c-9.979861,0.339962 -10.291732,0.679924 -9.35612,15.298292c0.623741,8.159089 1.871224,14.278406 3.430577,13.258519c1.247483,-0.679924 2.183095,0.339962 2.183095,2.039772c0,2.039772 1.871224,3.739583 4.054318,3.739583c2.183095,0 7.484896,2.719696 11.539215,5.779355c4.36619,3.399621 10.603603,5.779355 14.03418,5.439393c4.98993,-0.339962 4.98993,-0.339962 0.935612,1.019886c-5.925543,2.039772 -7.484896,13.258519 -2.494965,16.65814c1.871224,1.019886 4.67806,8.839013 6.549283,16.65814c4.36619,18.697912 12.786697,19.717799 15.593533,2.039772c1.247483,-6.459279 2.183095,15.298292 2.183095,48.27461c0,42.155293 -1.247483,64.252826 -4.36619,73.091838c-2.183095,7.139203 -4.054318,18.35795 -3.742448,24.817229l0.31187,11.898671l1.871224,-11.898671l2.183095,-11.898671l2.183095,11.898671c1.559353,7.139203 1.247483,12.238633 -0.935612,12.918557c-1.559353,0.679924 -3.118707,3.739583 -3.118707,6.459279c0,4.419507 -0.935612,4.419507 -4.67806,1.019886c-3.742448,-3.399621 -4.67806,-3.059659 -4.67806,1.359848c0,4.419507 -1.871224,5.439393 -6.861155,3.739583c-5.925543,-1.69981 -6.237413,-1.359848 -2.494965,1.69981c3.118707,2.719696 3.430577,4.419507 1.247483,5.439393c-1.871224,1.019886 -2.806836,5.439393 -1.871224,9.858899c0.623741,5.099431 0,8.499051 -2.183095,8.499051c-1.871224,0 -3.430577,-2.039772 -3.742448,-4.079545c0,-3.399621 -0.623741,-3.399621 -1.871224,0c-1.247483,3.399621 -2.494965,3.059659 -5.925543,-1.69981c-3.742448,-5.779355 -4.054318,-5.779355 -4.36619,-0.339962c0,3.739583 -1.559353,5.099431 -4.67806,4.079545c-4.98993,-2.379734 -6.237413,-10.198861 -2.183095,-12.238633c1.559353,-0.339962 3.742448,-5.099431 4.98993,-10.198861c1.559353,-7.139203 0.935612,-9.518937 -2.806836,-9.518937c-2.494965,0 -4.67806,-1.359848 -4.67806,-3.399621c0,-1.69981 2.806836,-3.399621 6.237413,-3.399621c3.430577,0 6.237413,-1.359848 6.237413,-3.399621c0,-1.69981 -5.613672,-3.399621 -12.474826,-3.399621l-12.474826,0l0,16.65814c0,11.558709 1.247483,17.338064 4.67806,18.697912c6.237413,2.379734 5.925543,8.839013 -1.559353,19.037874c-7.796766,10.878785 -7.796766,14.618368 0,10.198861c3.430577,-2.039772 5.301801,-5.439393 4.36619,-8.499051c-1.559353,-4.079545 0.935612,-5.099431 11.539215,-4.759469l13.722309,0.339962l-10.915473,4.079545c-10.603603,4.419507 -10.603603,4.759469 -3.118707,6.119317c7.796766,1.69981 7.796766,1.69981 -0.623741,2.379734c-9.667991,0.339962 -11.851085,5.779355 -3.118707,8.159089c4.36619,1.359848 4.36619,1.69981 -0.935612,2.039772c-7.796766,0.679924 -21.207205,12.578595 -19.024111,16.998102c1.247483,1.69981 -0.935612,2.379734 -4.98993,1.019886c-4.36619,-1.019886 -5.925543,-0.679924 -4.36619,2.039772c2.183095,4.079545 -3.430577,5.779355 -13.098568,4.419507c-2.494965,-0.339962 -8.108638,2.039772 -12.474826,5.439393c-4.67806,3.059659 -9.35612,5.439393 -10.915473,5.099431c-1.247483,-0.339962 -4.98993,2.379734 -8.420508,6.119317c-4.36619,4.759469 -10.291732,6.799241 -21.207205,6.799241c-8.108638,0 -19.647851,1.359848 -25.573394,3.399621c-7.484896,2.379734 -15.593533,2.039772 -27.132747,-0.679924c-15.281663,-4.079545 -16.217274,-4.759469 -17.464757,-16.318178c-0.623741,-6.459279 -1.247483,3.059659 -1.559353,21.417609c-0.31187,21.417609 0.623741,32.636356 2.494965,31.276508c1.871224,-1.359848 3.118707,4.079545 3.118707,13.938444c0,22.097533 6.549283,59.833319 11.539215,65.272712c2.183095,2.379734 4.054318,8.159089 4.054318,12.238633c0,4.419507 2.183095,13.598481 4.67806,20.057761c2.494965,6.799241 4.67806,15.978216 4.67806,20.737685c0,4.419507 2.183095,10.538823 4.67806,13.598481c2.494965,2.719696 4.67806,8.839013 4.67806,13.598481c0,4.759469 1.559353,8.839013 3.118707,8.839013c1.871224,0 3.118707,3.739583 3.118707,8.499051c0,4.759469 0.935612,8.499051 2.494965,8.499051c3.430577,0 9.979861,17.338064 9.979861,25.837115c0,4.419507 1.559353,8.839013 3.118707,9.858899c1.871224,1.019886 3.118707,5.099431 3.118707,8.839013c0,3.739583 1.247483,6.119317 2.806836,5.099431c1.247483,-1.019886 4.98993,4.079545 8.108638,11.558709c3.118707,7.479165 6.861155,13.598481 8.420508,13.598481c1.247483,0 2.494965,3.059659 2.494965,6.799241c0,3.739583 1.559353,6.799241 3.430577,6.799241c1.559353,0 2.494965,1.359848 1.559353,2.719696c-0.935612,1.69981 1.871224,8.499051 5.925543,14.95833c4.054318,6.799241 10.915473,20.737685 15.281663,30.936546c4.054318,10.198861 9.979861,21.757571 13.410438,25.157191c3.118707,3.399621 8.732378,13.598481 12.786697,22.437495c3.742448,9.178975 8.420508,18.35795 9.979861,20.397723c10.915473,14.618368 18.088498,26.177077 23.390299,37.395824c3.430577,6.799241 7.173025,12.578595 8.420508,12.578595c1.247483,0 4.67806,5.099431 7.484896,10.878785c2.806836,6.119317 9.044249,14.95833 13.722309,19.717799c4.36619,4.759469 10.915473,13.938444 14.346051,20.397723c3.118707,6.459279 9.667991,15.638254 14.657921,20.397723c4.67806,4.419507 8.420508,10.198861 8.420508,12.918557c0,2.379734 1.247483,3.399621 3.118707,2.379734c1.559353,-1.019886 3.118707,0.339962 3.118707,3.059659c0,3.059659 1.247483,5.439393 2.494965,5.439393c1.559353,0 4.36619,4.079545 6.549283,8.839013c1.871224,5.099431 4.36619,8.159089 5.613672,7.139203c0.935612,-1.359848 5.925543,4.419507 11.227344,12.238633c5.301801,7.819127 13.098568,18.017988 17.776628,22.777457c4.36619,4.759469 9.044249,11.218747 10.291732,14.618368c0.935612,3.059659 4.054318,5.779355 6.861155,5.779355c2.494965,0 4.67806,1.359848 4.67806,2.719696c0,4.759469 43.973763,53.034078 56.136719,61.873091c5.925543,4.419507 13.098568,10.538823 15.905404,13.258519c8.420508,9.178975 16.529145,15.298292 25.573394,20.397723c4.67806,2.719696 8.420508,6.119317 8.420508,7.819127c0,1.359848 2.183095,2.719696 4.67806,2.719696c2.494965,0 4.67806,1.69981 4.67806,3.739583c0,1.69981 4.36619,5.099431 9.35612,6.799241c5.301801,2.039772 9.35612,5.779355 9.35612,8.499051c0,2.719696 2.806836,4.759469 6.237413,4.759469c3.430577,0 6.237413,1.359848 6.237413,2.719696c0,1.69981 4.98993,4.759469 10.915473,7.479165c6.237413,2.719696 13.410438,7.479165 16.217274,10.878785c2.806836,3.399621 7.796766,6.119317 10.915473,6.119317c3.430577,0 5.301801,1.359848 4.36619,2.719696c-1.247483,2.379734 6.237413,6.799241 20.895334,12.238633c3.118707,1.019886 4.67806,3.399621 3.742448,5.439393c-1.247483,2.039772 1.559353,3.399621 5.925543,3.399621c4.36619,0 8.108638,1.69981 8.108638,3.399621c0,2.039772 2.806836,3.399621 6.237413,3.399621c3.430577,0 6.237413,1.69981 6.237413,3.399621c0,2.039772 2.183095,3.399621 4.67806,3.399621c2.494965,0 4.67806,1.359848 4.67806,3.059659c0,1.69981 3.118707,3.739583 7.173025,5.099431c4.054318,1.019886 11.227344,5.439393 15.905404,9.858899c4.98993,4.759469 14.657921,10.198861 21.830946,12.918557c6.861155,2.379734 15.593533,6.119317 19.024111,8.499051c3.430577,2.379734 12.474826,6.119317 20.271593,8.499051c7.796766,2.379734 15.281663,5.439393 16.841016,7.139203c1.871224,1.359848 7.796766,2.719696 13.098568,2.719696c5.613672,0 11.227344,1.69981 12.162956,3.399621c0.935612,2.039772 7.484896,3.399621 14.03418,3.399621c6.549283,0 12.786697,1.359848 13.722309,3.059659c0.935612,1.69981 14.03418,4.759469 29.003972,7.139203c15.281663,2.039772 33.370161,5.439393 40.543186,7.139203c7.173025,1.69981 24.014041,3.059659 37.42448,3.399621c13.410438,0 30.563325,2.379734 38.360092,4.759469c19.647851,6.459279 215.814498,4.419507 290.039716,-3.059659l0.000005,-0.000002l-0.000008,-0.000014zm-1149.24339,-986.909801c-2.494965,-14.95833 -3.430577,-13.598481 -5.925543,7.479165c-1.247483,11.558709 -0.935612,14.618368 0.935612,10.198861c2.806836,-6.459279 3.118707,-6.119317 3.742448,1.69981l0.623741,8.499051l1.247483,-8.159089c0.935612,-4.419507 0.623741,-13.258519 -0.623741,-19.717799l0,0.000001zm147.826694,16.318178c3.742448,-2.719696 2.806836,-3.739583 -3.742448,-5.779355c-4.98993,-1.019886 -9.667991,-1.359848 -10.603603,0c-1.247483,1.019886 0.623741,2.039772 4.054318,2.379734c5.613672,0 5.613672,0.339962 -0.31187,3.059659l-6.237413,3.059659l6.237413,0c3.430577,0 8.420508,-1.019886 10.603603,-2.719696l0,-0.000001zm-159.677779,-69.012294c-0.623741,-4.419507 -1.247483,-1.019886 -1.247483,7.479165c0,8.499051 0.623741,11.898671 1.247483,7.819127c0.623741,-4.419507 0.623741,-11.218747 0,-15.298292l0,0.000001l0,-0.000001zm1984.433024,2.719696c0,-0.679924 -2.183095,-3.059659 -4.67806,-5.439393c-4.054318,-3.739583 -4.36619,-3.399621 -2.806836,1.359848c1.559353,4.759469 7.484896,7.819127 7.484896,4.079545zm27.132747,-60.173281l0.623741,-24.137304l-6.237413,7.819127c-7.484896,9.178975 -7.796766,23.117419 -0.31187,32.976318c2.806836,4.079545 5.301801,7.479165 5.301801,7.479165c0,0 0.31187,-10.878785 0.623741,-24.137304l-0.000001,0l0.000001,-0.000002zm-1998.155334,-9.858899c0,-1.69981 -0.623741,-3.399621 -1.247483,-3.399621c-0.935612,0 -2.494965,1.69981 -3.430577,3.399621c-0.935612,2.039772 -0.31187,3.399621 1.247483,3.399621c1.871224,0 3.430577,-1.359848 3.430577,-3.399621zm1990.358567,-36.035977l-1.871224,-20.057761l-2.183095,20.397723c-1.247483,10.878785 -3.742448,20.737685 -5.613672,21.417609c-2.183095,0.679924 -2.183095,2.719696 0.623741,5.439393c6.861155,8.499051 11.539215,-4.759469 9.044249,-27.196963l-0.000001,0l0.000002,-0.000001zm-1991.294179,18.35795c-0.935612,-2.379734 -1.559353,-0.679924 -1.559353,4.079545c0,4.759469 0.623741,6.459279 1.559353,4.419507c0.623741,-2.379734 0.623741,-6.459279 0,-8.499051l0,-0.000001zm11.539215,-16.998102c-0.935612,-3.399621 -0.31187,-6.119317 1.559353,-6.119317c1.871224,0 3.430577,1.69981 3.430577,4.079545c0,2.039772 0.623741,3.059659 1.559353,2.379734c0.623741,-1.019886 0.31187,-6.799241 -1.247483,-12.578595c-1.871224,-6.799241 -1.871224,-10.878785 0,-10.878785c3.118707,0 3.742448,-18.017988 0.623741,-21.417609c-0.935612,-1.359848 -3.742448,3.399621 -6.237413,10.198861c-4.67806,15.298292 -5.613672,53.034078 -0.935612,45.214951c1.559353,-2.719696 2.183095,-7.819127 1.247483,-10.878785l0.000001,0zm36.176997,-17.678026c0,-25.157191 -0.935612,-32.296394 -4.67806,-33.996204c-9.044249,-3.739583 -3.742448,-49.634458 5.613672,-49.634458c5.301801,0 -0.623741,-4.759469 -7.173025,-5.779355c-3.742448,-0.679924 -6.237413,1.019886 -6.237413,4.079545c0,2.719696 -3.430577,12.918557 -7.796766,22.777457c-8.108638,18.017988 -9.979861,25.497153 -4.67806,16.318178c2.806836,-4.419507 3.118707,-4.419507 3.118707,0c0,2.719696 -1.247483,7.139203 -2.806836,9.858899c-1.559353,2.719696 -2.183095,7.139203 -1.247483,9.518937c3.118707,8.839013 7.173025,-2.719696 7.173025,-20.057761c0,-8.839013 1.559353,-16.998102 3.118707,-18.017988c1.871224,-1.359848 3.118707,4.419507 3.118707,14.95833c0,9.178975 1.559353,18.017988 3.118707,19.037874c1.871224,1.019886 3.118707,15.638254 3.118707,32.636356c0,18.017988 1.247483,30.256622 3.118707,30.256622c1.871224,0 3.118707,-12.918557 3.118707,-31.956432l0.000001,-0.000001l-0.000004,0.000001zm-25.885265,0.679924c-0.935612,-2.719696 -1.871224,-1.69981 -1.871224,2.039772c-0.31187,3.739583 0.623741,5.779355 1.559353,4.419507c0.935612,-1.019886 1.247483,-4.079545 0.31187,-6.459279l0.000001,0zm1959.483371,-17.678026c0,-4.759469 -1.559353,-9.518937 -3.430577,-10.538823c-4.67806,-3.399621 -5.613672,-1.359848 -3.742448,9.518937c2.183095,11.558709 7.173025,12.238633 7.173025,1.019886zm-10.291732,-46.234837c-0.935612,-9.178975 -4.054318,-21.077647 -6.861155,-26.177077c-4.98993,-9.518937 -4.98993,-9.178975 -3.430577,9.858899c1.247483,18.017988 5.925543,33.31628 10.291732,33.31628c0.935612,0 0.935612,-7.479165 0,-16.998102zm-20.895334,-32.976318c-0.935612,-21.077647 0.935612,-24.477266 3.118707,-6.119317l2.183095,16.998102l-0.623741,-20.057761c-0.31187,-14.278406 -1.871224,-21.077647 -5.925543,-24.137304c-2.806836,-2.379734 -5.613672,-7.479165 -5.925543,-11.218747c0,-3.739583 -1.559353,-6.119317 -3.430577,-5.099431c-1.559353,1.019886 -2.183095,-1.69981 -1.247483,-7.139203c0.935612,-4.759469 0.623741,-8.839013 -0.935612,-8.839013c-4.98993,0 -1.871224,35.696015 3.742448,46.234837c3.430577,5.779355 5.925543,15.298292 5.925543,21.417609c0,5.779355 0.935612,10.538823 1.871224,10.538823c0.935612,0 1.559353,-5.779355 1.247483,-12.578595l-0.000001,0zm-1904.906006,-9.518937c-1.871224,-17.338064 -4.98993,-16.65814 -8.420508,1.019886c-1.871224,10.198861 -1.559353,11.218747 3.742448,10.198861c4.054318,-1.019886 5.301801,-3.739583 4.67806,-11.218747zm4.67806,-22.777457c-0.935612,-2.719696 -1.871224,-1.69981 -1.871224,2.039772c-0.31187,3.739583 0.623741,5.779355 1.559353,4.419507c0.935612,-1.019886 1.247483,-4.079545 0.31187,-6.459279l0.000001,0zm1863.427207,-37.395824c-2.183095,-2.379734 -3.742448,-2.719696 -3.742448,-0.679924c0,4.759469 3.742448,8.839013 5.925543,6.459279c0.623741,-1.019886 -0.31187,-3.739583 -2.183095,-5.779355zm10.291732,-6.119317c0.935612,-1.69981 0.31187,-3.399621 -1.247483,-3.399621c-1.871224,0 -3.430577,1.69981 -3.430577,3.399621c0,2.039772 0.623741,3.399621 1.247483,3.399621c0.935612,0 2.494965,-1.359848 3.430577,-3.399621zm-1826.002728,-151.62307c6.237413,-6.119317 8.420508,-9.858899 6.237413,-11.558709c-2.183095,-1.359848 0,-4.079545 5.925543,-6.459279c4.98993,-2.379734 9.979861,-6.799241 11.227344,-9.858899c1.559353,-4.759469 2.183095,-4.759469 4.67806,-0.679924c1.871224,3.059659 3.118707,3.399621 3.118707,1.019886c0,-5.099431 19.024111,-24.817229 24.325912,-24.817229c1.871224,0 3.742448,-3.399621 4.054318,-7.479165c0.31187,-7.479165 0.31187,-7.479165 2.806836,0.679924c1.559353,5.779355 2.494965,6.459279 2.806836,2.719696c0.31187,-3.399621 1.559353,-6.119317 3.118707,-6.119317c1.559353,0 3.742448,-3.739583 4.67806,-8.499051c1.247483,-4.759469 3.742448,-8.499051 6.237413,-8.499051c2.183095,0 7.173025,-3.059659 10.915473,-6.459279c5.925543,-5.779355 15.905404,-11.898671 64.245356,-40.11552c23.078429,-13.598481 32.434549,-18.017988 38.671962,-18.017988c13.098568,0 47.09247,-23.797342 47.09247,-32.976318c0,-1.019886 -6.237413,-7.819127 -14.03418,-15.298292c-7.796766,-7.479165 -13.410438,-14.618368 -12.474826,-15.978216c0.623741,-1.69981 -0.623741,-5.779355 -3.118707,-9.178975c-3.430577,-5.099431 -4.36619,-5.439393 -4.67806,-1.359848c0,4.079545 -0.623741,4.419507 -2.806836,0.339962c-3.118707,-5.099431 -25.261524,-2.379734 -25.261524,3.059659c0,4.419507 -161.237132,4.419507 -162.796486,0c-0.623741,-2.039772 -11.539215,-4.419507 -24.325912,-5.099431c-12.786697,-1.019886 -29.003972,-3.059659 -35.865127,-5.099431c-6.861155,-1.69981 -17.152886,-3.399621 -22.766559,-3.399621c-6.237413,0 -9.667991,-1.359848 -8.420508,-3.399621c0.935612,-1.69981 1.559353,-3.399621 0.935612,-3.739583c-0.623741,0 -7.173025,-1.019886 -14.969791,-2.039772c-7.796766,-1.019886 -14.657921,-3.059659 -15.593533,-4.419507c-0.935612,-1.359848 -9.667991,-3.399621 -19.335981,-4.759469c-9.979861,-1.359848 -18.088498,-4.079545 -18.088498,-5.779355c0,-1.69981 -6.237413,-3.059659 -13.722309,-3.059659c-8.108638,0 -15.905404,-2.039772 -18.71224,-5.099431c-2.494965,-3.059659 -10.291732,-5.099431 -18.088498,-5.099431c-7.484896,0 -14.969791,-1.359848 -16.841016,-3.399621c-4.98993,-5.439393 -70.170899,-5.099431 -73.289606,0.339962c-4.67806,7.819127 -3.118707,20.057761 2.183095,20.057761c2.806836,0 4.36619,2.039772 3.430577,4.419507c-0.623741,2.039772 2.494965,9.518937 7.173025,15.978216c4.67806,6.459279 9.667991,15.638254 10.915473,20.397723l2.806836,8.499051l2.183095,-8.499051c1.871224,-7.819127 2.183095,-7.479165 2.494965,3.059659c0.31187,7.479165 3.430577,15.298292 9.667991,23.117419c4.98993,6.119317 9.35612,12.918557 9.35612,14.95833c0,2.039772 1.247483,2.379734 3.118707,1.359848c1.559353,-1.019886 3.118707,1.019886 3.118707,4.759469c0,4.079545 1.559353,7.139203 3.118707,7.139203c1.871224,0 3.118707,1.69981 3.118707,3.739583c0,2.379734 4.054318,8.839013 9.35612,14.618368c4.98993,5.779355 13.410438,15.978216 18.71224,22.437495c5.925543,7.479165 8.732378,9.518937 7.484896,5.099431c-1.559353,-5.099431 -0.31187,-4.419507 4.67806,2.719696c3.742448,5.099431 9.044249,9.178975 11.227344,9.178975c2.494965,0 5.301801,1.69981 6.549283,4.079545c1.559353,2.719696 0,3.059659 -5.301801,1.69981l-7.484896,-2.039772l7.484896,6.799241c4.054318,3.399621 9.979861,6.459279 13.098568,6.459279c3.742448,0 7.173025,3.399621 9.044249,8.499051c1.559353,4.759469 5.613672,9.518937 8.420508,10.878785c3.118707,1.019886 11.851085,6.799241 19.647851,12.578595c7.796766,5.779355 14.969791,10.198861 16.529145,9.518937c1.247483,-0.339962 2.183095,2.379734 2.183095,5.779355c0,4.759469 3.118707,7.139203 10.291732,8.839013c5.301801,1.359848 11.851085,4.079545 14.03418,5.779355c2.494965,2.719696 3.742448,2.039772 3.742448,-1.69981c0,-2.719696 -1.871224,-6.119317 -3.742448,-6.799241c-2.806836,-1.359848 -2.494965,-2.039772 0.623741,-2.039772c2.494965,-0.339962 6.237413,2.719696 7.796766,6.799241c3.118707,7.139203 7.173025,9.858899 32.746419,22.777457c18.71224,9.178975 22.766559,9.178975 34.305773,-1.359848l0.000001,0l0,-0.000001zm148.138564,-247.832327c6.861155,-2.379734 16.841016,-3.399621 22.142817,-2.719696c9.667991,1.69981 19.024111,-5.439393 11.227344,-8.499051c-2.183095,-0.679924 -3.742448,-2.719696 -3.742448,-4.419507c0,-1.69981 -9.667991,-13.598481 -21.830946,-26.517039c-11.851085,-12.918557 -21.830946,-25.497153 -21.830946,-27.536925c0,-2.039772 -3.430577,-7.479165 -7.796766,-11.898671c-4.054318,-4.759469 -8.420508,-14.278406 -9.667991,-21.417609c-2.183095,-14.278406 -12.474826,-34.676128 -17.464757,-34.676128c-1.871224,0 -2.494965,-2.379734 -1.247483,-5.099431c0.935612,-2.719696 0,-4.759469 -2.183095,-4.079545c-2.183095,0.339962 -4.054318,-4.419507 -4.67806,-12.238633c-0.623741,-6.799241 -2.183095,-11.898671 -3.430577,-11.218747c-1.247483,1.019886 -4.054318,0.339962 -6.549283,-1.69981c-3.430577,-2.039772 -3.742448,-3.059659 -0.623741,-3.059659c2.183095,0 3.118707,-1.69981 2.183095,-3.399621c-1.247483,-2.039772 -3.430577,-2.719696 -4.98993,-1.69981c-1.559353,1.359848 -4.36619,-2.039772 -6.237413,-7.479165c-1.559353,-5.099431 -4.054318,-10.198861 -5.301801,-11.218747c-4.36619,-3.399621 -9.979861,-16.998102 -10.291732,-24.477266c0,-4.419507 -0.935612,-5.779355 -1.871224,-3.399621c-2.183095,5.779355 -7.173025,5.099431 -7.173025,-1.019886c0,-2.379734 -2.183095,-6.119317 -4.98993,-7.819127c-3.742448,-2.039772 -4.67806,-6.119317 -3.742448,-12.238633c0.935612,-4.759469 0.31187,-8.839013 -0.935612,-8.839013c-1.559353,0 -2.806836,-4.419507 -2.806836,-9.858899c0,-8.499051 -0.935612,-9.858899 -6.861155,-8.499051c-4.054318,0.679924 -5.301801,0.679924 -3.118707,-0.679924c1.871224,-1.019886 3.742448,-4.759469 3.742448,-8.499051c0,-5.439393 -2.183095,-6.459279 -15.593533,-6.459279c-10.915473,0 -15.281663,1.359848 -14.657921,4.419507c0.31187,2.379734 -1.871224,3.739583 -5.613672,3.399621c-9.667991,-1.359848 -23.702171,2.719696 -21.519076,6.119317c0.935612,1.69981 -1.247483,3.059659 -4.67806,3.059659c-3.430577,0 -8.108638,2.379734 -10.915473,5.099431c-2.806836,3.059659 -10.291732,5.099431 -19.024111,5.099431c-9.667991,0 -14.657921,1.69981 -15.905404,5.099431c-1.247483,2.719696 -5.301801,5.099431 -9.35612,5.099431c-4.054318,0 -7.484896,1.359848 -7.484896,3.059659c0,1.69981 -4.36619,4.079545 -9.35612,5.439393c-4.98993,1.359848 -9.35612,4.079545 -9.35612,6.459279c0,2.719696 -3.742448,3.739583 -10.915473,2.719696c-7.796766,-1.019886 -11.227344,0 -12.786697,4.079545c-0.935612,3.059659 -5.301801,5.439393 -9.35612,5.439393c-4.67806,0 -7.484896,2.039772 -7.484896,5.099431c0,4.419507 -5.613672,6.799241 -13.098568,5.439393c-1.559353,0 -2.494965,2.039772 -2.494965,4.759469c0,3.059659 -2.806836,5.099431 -7.796766,5.099431c-4.36619,0 -7.796766,1.019886 -7.796766,2.719696c0,1.359848 -7.173025,6.119317 -15.593533,10.538823c-8.732378,4.419507 -19.024111,11.898671 -23.390299,16.65814c-4.36619,4.419507 -7.796766,7.479165 -7.796766,6.119317c0,-1.019886 -2.806836,1.019886 -6.237413,4.759469c-3.430577,3.739583 -6.237413,8.839013 -6.237413,10.878785c0,2.379734 -4.36619,4.759469 -9.35612,5.099431c-5.301801,0.339962 -13.722309,3.739583 -18.400369,7.819127c-4.98993,3.739583 -9.979861,6.799241 -11.227344,6.799241c-0.935612,0 -8.108638,6.459279 -15.593533,14.618368c-11.227344,11.218747 -14.03418,16.65814 -14.03418,25.497153c0,9.858899 0.935612,10.878785 6.237413,9.178975c7.173025,-2.379734 8.732378,3.399621 1.871224,6.119317c-2.806836,1.359848 -3.742448,4.759469 -2.806836,8.839013c1.871224,8.499051 12.162956,9.178975 34.305773,3.399621c10.603603,-3.059659 19.335981,-3.059659 36.176997,0c12.474826,2.379734 35.865127,6.459279 52.082401,9.518937c16.217274,2.719696 31.187066,7.139203 33.05829,9.858899c1.871224,2.379734 10.915473,5.439393 20.271593,6.799241c9.35612,1.019886 18.400369,4.419507 20.583464,7.479165c3.118707,4.079545 4.67806,4.419507 8.732378,0.679924c2.494965,-2.379734 4.67806,-2.719696 4.67806,-1.019886c0,4.759469 19.335981,11.218747 33.682032,11.218747c10.291732,0 12.474826,1.019886 11.227344,5.099431c-1.559353,4.079545 0.935612,5.099431 12.162956,5.099431c8.420508,0 16.217274,2.039772 19.024111,5.099431c5.613672,6.459279 34.929514,7.139203 37.112609,1.019886c0.935612,-3.399621 4.054318,-3.059659 12.786697,1.69981c6.237413,3.059659 14.969791,5.779355 19.024111,5.779355c4.36619,0 7.796766,1.69981 7.796766,3.399621c0,4.759469 78.903277,0.339962 95.120552,-5.099431l-0.000004,-0.000002l-0.000002,-0.000008z" id="svg_2" stroke-width="0" stroke="null"></path> <path d="m1386.286398,7360.440312c-0.935612,-1.019886 -21.207205,-3.739583 -45.221246,-5.779355c-68.611546,-5.439393 -78.903277,-6.459279 -78.903277,-9.518937c0,-1.69981 -9.35612,-3.739583 -20.895334,-5.099431c-29.003972,-3.059659 -53.953625,-8.499051 -53.953625,-11.898671c0,-1.359848 -4.67806,-3.399621 -9.979861,-4.419507c-24.325912,-4.759469 -30.251454,-6.799241 -28.692101,-9.518937c0.935612,-1.69981 -2.806836,-3.059659 -8.108638,-3.059659c-4.98993,0 -12.162956,-1.359848 -15.593533,-3.399621c-3.430577,-1.69981 -9.044249,-4.759469 -12.474826,-6.799241c-3.430577,-1.69981 -9.044249,-3.399621 -12.474826,-3.399621c-3.430577,0 -6.237413,-2.379734 -6.237413,-5.099431c0,-2.719696 -2.806836,-5.099431 -6.237413,-5.099431c-7.173025,0 -21.830946,-6.799241 -27.444619,-12.578595c-2.183095,-2.379734 -7.484896,-5.439393 -11.851085,-6.459279c-4.054318,-1.019886 -7.484896,-3.399621 -7.484896,-5.099431c0,-1.69981 -3.742448,-3.059659 -8.108638,-3.059659c-4.36619,0 -7.173025,-1.359848 -5.925543,-3.399621c0.935612,-1.69981 0,-3.399621 -2.494965,-3.399621c-5.925543,0 -24.014041,-10.198861 -24.014041,-13.258519c0,-1.359848 -5.613672,-5.439393 -12.474826,-8.839013c-7.173025,-3.399621 -16.841016,-11.218747 -21.830946,-17.678026c-4.98993,-6.119317 -10.603603,-11.218747 -12.474826,-11.218747c-1.559353,0 -3.118707,-1.359848 -3.118707,-3.399621c0,-1.69981 -1.871224,-3.399621 -3.742448,-3.399621c-2.183095,0 -7.484896,-4.759469 -11.539215,-10.198861c-4.054318,-5.779355 -9.044249,-10.198861 -11.539215,-10.198861c-2.494965,0 -4.36619,-1.359848 -4.36619,-3.059659c0,-2.039772 -8.420508,-12.918557 -18.71224,-24.477266c-10.291732,-11.558709 -18.71224,-23.797342 -18.71224,-27.196963c0,-3.739583 -1.871224,-6.459279 -4.054318,-6.459279c-2.183095,0 -7.173025,-6.119317 -11.227344,-13.598481c-3.742448,-7.479165 -7.796766,-13.598481 -9.044249,-13.598481c-1.247483,0 -4.054318,-5.099431 -6.549283,-10.878785c-2.494965,-6.119317 -5.301801,-11.898671 -6.237413,-12.918557c-3.742448,-3.399621 -9.667991,-16.998102 -9.667991,-22.097533c0,-2.719696 -2.183095,-5.099431 -4.67806,-5.099431c-2.494965,0 -4.67806,-2.719696 -4.67806,-6.459279c0,-3.399621 -2.183095,-8.159089 -4.67806,-10.538823c-2.494965,-2.379734 -4.67806,-6.459279 -4.67806,-9.178975c0,-2.379734 -2.183095,-5.439393 -4.67806,-6.459279c-2.494965,-1.359848 -4.67806,-4.079545 -4.67806,-6.799241c0,-2.719696 -1.247483,-4.759469 -3.118707,-4.759469c-1.559353,0 -3.118707,-3.059659 -3.118707,-7.139203c0,-3.739583 -1.247483,-5.779355 -3.118707,-4.759469c-1.559353,1.019886 -3.118707,-0.339962 -3.118707,-3.399621c0,-3.059659 -2.806836,-8.499051 -6.237413,-12.578595c-3.430577,-4.079545 -6.237413,-9.518937 -6.237413,-11.898671c0,-2.379734 -1.247483,-4.419507 -2.806836,-4.419507c-1.559353,0 -3.430577,-3.399621 -4.67806,-7.819127c-0.935612,-4.079545 -4.36619,-10.878785 -7.796766,-14.95833c-8.732378,-9.858899 -19.024111,-30.596584 -19.024111,-37.395824c0,-3.059659 -0.935612,-4.759469 -1.871224,-3.399621c-2.494965,2.719696 -23.078429,-39.775558 -23.078429,-46.914762c0,-3.059659 -2.183095,-6.119317 -4.67806,-7.139203c-2.494965,-1.359848 -4.67806,-5.099431 -4.67806,-8.499051c0,-3.399621 -1.247483,-6.459279 -3.118707,-6.459279c-1.559353,0 -3.118707,-1.69981 -3.118707,-3.399621c0,-2.039772 -2.806836,-10.198861 -6.237413,-17.678026c-3.430577,-7.819127 -6.237413,-17.678026 -6.237413,-21.757571c0,-4.419507 -1.559353,-8.839013 -3.118707,-9.858899c-1.871224,-1.019886 -3.118707,-7.139203 -3.118707,-13.598481c0,-6.119317 -1.247483,-11.898671 -2.494965,-12.578595c-4.054318,-1.69981 -16.217274,-73.091838 -16.217274,-94.509447c0,-10.198861 -2.183095,-33.996204 -4.67806,-52.694116c-5.301801,-39.095634 -5.925543,-108.447891 -1.247483,-130.885385c1.871224,-8.499051 4.36619,-29.916659 5.925543,-47.594686c2.806836,-30.596584 6.549283,-61.533129 11.227344,-94.169485c1.247483,-8.159089 3.430577,-14.618368 4.67806,-14.618368c1.559353,0 2.806836,-3.399621 2.806836,-7.479165c0,-7.479165 6.549283,-30.256622 9.35612,-33.31628c0.935612,-1.019886 3.742448,-8.499051 5.925543,-16.998102c4.98993,-19.717799 10.603603,-33.996204 13.410438,-33.996204c0.935612,0 3.430577,-5.099431 5.613672,-11.558709c1.871224,-6.459279 6.861155,-15.978216 10.915473,-21.077647c4.36619,-5.439393 7.796766,-11.898671 7.796766,-13.938444c0,-2.379734 1.559353,-4.419507 3.118707,-4.419507c1.871224,0 3.118707,-2.039772 3.118707,-4.419507c0,-2.719696 2.806836,-7.479165 6.237413,-10.878785c3.430577,-3.399621 6.237413,-8.159089 6.237413,-10.878785c0,-2.379734 1.871224,-4.419507 4.36619,-4.419507c2.183095,0 5.925543,-4.419507 8.108638,-10.198861c2.183095,-5.439393 4.98993,-9.178975 6.549283,-8.159089c1.559353,1.019886 2.806836,0 2.806836,-2.039772c0,-2.379734 4.67806,-8.839013 10.291732,-14.618368c5.301801,-5.439393 9.667991,-11.558709 9.35612,-13.258519c-0.623741,-1.359848 0,-2.719696 1.559353,-2.719696c1.247483,0 6.549283,-4.079545 11.539215,-8.839013c5.301801,-4.759469 13.098568,-11.218747 18.088498,-14.278406c4.67806,-3.059659 8.420508,-7.139203 8.732378,-9.178975c0,-1.69981 13.098568,-10.198861 29.003972,-18.697912c15.905404,-8.499051 28.38023,-16.318178 27.756489,-17.678026c-0.623741,-1.69981 1.247483,-2.719696 4.054318,-2.719696c6.861155,0 27.132747,-7.479165 29.315842,-10.878785c0.935612,-1.359848 7.484896,-4.759469 14.03418,-7.479165c6.861155,-2.379734 12.162956,-6.459279 11.851085,-8.499051c-0.623741,-2.039772 3.118707,-3.739583 8.108638,-3.739583c5.301801,0 10.291732,-1.69981 11.227344,-3.399621c0.935612,-2.039772 5.301801,-3.399621 9.35612,-3.399621c4.054318,0 8.420508,-1.359848 9.35612,-3.399621c0.935612,-1.69981 5.301801,-3.399621 9.667991,-3.399621c4.054318,0 7.484896,-1.359848 7.484896,-3.059659c0,-2.719696 13.410438,-5.099431 59.255426,-10.198861c12.786697,-1.359848 22.142817,-3.059659 20.271593,-3.739583c-1.559353,-0.339962 2.494965,-2.039772 9.35612,-3.399621c6.861155,-1.359848 20.583464,-5.099431 30.563325,-8.159089c9.979861,-3.059659 22.142817,-5.439393 27.132747,-5.439393c4.67806,0 9.35612,-1.69981 9.979861,-4.079545c1.247483,-3.739583 11.851085,-5.439393 64.245356,-11.558709c10.915473,-1.359848 18.088498,-3.399621 15.905404,-5.099431c-2.183095,-1.359848 5.301801,-3.399621 16.217274,-4.419507c39.607574,-3.739583 54.265495,-5.779355 60.502909,-8.839013c3.430577,-1.359848 37.73635,-5.439393 76.408312,-8.839013c87.011915,-7.819127 362.393709,-10.878785 425.703454,-5.099431c86.076303,8.159089 102.293577,10.198861 104.164801,13.258519c0.935612,1.69981 6.549283,4.079545 12.162956,5.439393c25.261524,5.439393 28.692101,6.459279 28.692101,8.839013c0,1.69981 4.054318,3.739583 9.044249,5.099431c4.98993,1.019886 15.593533,6.459279 23.390299,12.238633c8.108638,5.439393 15.593533,9.858899 16.841016,9.858899c1.247483,0 4.36619,3.059659 6.861155,6.799241c2.494965,3.739583 5.925543,6.799241 7.796766,6.799241c4.054318,0 13.722309,9.858899 20.271593,20.397723c2.494965,4.419507 7.796766,10.878785 11.539215,14.618368c3.742448,3.739583 10.915473,13.258519 15.593533,20.737685c4.67806,7.819127 11.227344,16.318178 14.03418,19.377837c3.118707,3.059659 5.613672,7.139203 5.613672,9.518937c0,2.039772 1.559353,3.739583 3.118707,3.739583c1.871224,0 3.118707,3.059659 3.118707,6.799241c0,3.739583 1.871224,6.799241 4.054318,6.799241c1.871224,0 7.173025,8.159089 11.539215,18.017988c4.36619,9.518937 8.732378,18.35795 9.667991,19.377837c0.935612,1.019886 3.430577,7.139203 5.925543,13.598481c2.494965,6.459279 4.98993,12.578595 6.237413,13.598481c3.118707,3.059659 9.35612,20.737685 9.35612,27.196963c0,3.399621 0.935612,6.799241 2.494965,7.479165c1.247483,0.679924 6.237413,12.578595 11.227344,26.517039c4.98993,13.938444 9.979861,26.177077 11.227344,27.196963c1.247483,1.019886 3.118707,6.459279 4.054318,11.898671c2.806836,16.318178 7.796766,34.336166 8.420508,30.596584c0.31187,-1.69981 3.118707,7.479165 6.237413,20.397723c3.118707,13.258519 8.420508,33.656242 11.851085,45.894875c3.430577,12.238633 8.108638,30.596584 9.979861,40.795444c2.183095,10.198861 5.301801,22.437495 7.484896,26.857001c4.67806,11.218747 4.054318,212.136313 -0.935612,213.836123c-1.871224,0.679924 -3.430577,5.439393 -3.430577,10.198861c0,14.618368 -9.35612,60.173281 -12.786697,61.193167c-1.559353,0.679924 -2.806836,6.799241 -2.806836,13.598481c0,11.898671 -4.36619,30.596584 -9.667991,42.155293c-1.559353,3.399621 -2.806836,9.858899 -2.806836,14.618368c0,4.759469 -1.247483,8.499051 -3.118707,8.499051c-1.559353,0 -3.118707,3.739583 -3.118707,8.499051c0,4.759469 -1.247483,8.499051 -3.118707,8.499051c-1.559353,0 -3.118707,4.759469 -3.118707,10.198861c0,5.779355 -0.935612,10.198861 -2.494965,10.198861c-1.247483,0 -4.054318,6.119317 -5.925543,13.598481c-3.430577,11.558709 -9.35612,26.177077 -24.014041,61.193167c-1.871224,4.759469 -4.054318,9.178975 -4.98993,10.198861c-3.742448,4.079545 -9.35612,17.338064 -9.35612,21.757571c0,2.719696 -0.935612,5.439393 -2.183095,6.119317c-3.430577,1.359848 -16.529145,29.576697 -16.529145,35.356052c0,2.719696 -2.183095,4.759469 -4.67806,4.759469c-2.494965,0 -4.67806,3.059659 -4.67806,6.799241c0,3.739583 -1.247483,6.799241 -3.118707,6.799241c-1.559353,0 -3.118707,3.059659 -3.118707,6.799241c0,3.739583 -1.247483,6.799241 -3.118707,6.799241c-1.559353,0 -3.118707,2.379734 -3.118707,5.099431c0,2.719696 -1.247483,5.099431 -3.118707,5.099431c-1.559353,0 -3.118707,2.379734 -3.118707,5.439393c0,3.059659 -2.494965,8.159089 -5.613672,11.218747c-2.806836,3.059659 -7.484896,10.198861 -9.979861,15.638254c-2.494965,5.779355 -7.173025,13.258519 -10.603603,17.338064c-3.118707,4.079545 -5.613672,8.159089 -5.301801,9.518937c0.623741,2.379734 -3.118707,7.479165 -14.346051,20.737685c-4.054318,4.419507 -7.173025,9.858899 -7.173025,11.898671c0,2.039772 -1.247483,2.719696 -3.118707,1.69981c-1.559353,-1.019886 -3.118707,0 -3.118707,2.719696c0,2.719696 -3.118707,8.499051 -6.861155,13.258519c-4.054318,4.419507 -10.603603,13.938444 -14.969791,20.737685c-4.36619,6.799241 -8.732378,12.578595 -9.979861,12.578595c-1.559353,0 -2.494965,2.039772 -2.494965,4.419507c0,2.039772 -5.613672,10.198861 -12.474826,17.338064c-6.861155,7.479165 -12.474826,14.95833 -12.474826,16.998102c0,3.739583 -68.611546,76.831421 -72.353994,76.831421c-1.247483,0 -9.35612,5.439393 -17.776628,11.898671c-8.108638,6.459279 -16.529145,11.898671 -18.71224,11.898671c-1.871224,0 -3.430577,1.69981 -3.430577,3.399621c0,2.039772 -1.871224,3.399621 -4.36619,3.399621c-2.183095,0 -5.925543,2.379734 -8.108638,5.099431c-2.183095,2.719696 -4.98993,4.079545 -6.549283,3.059659c-1.559353,-1.019886 -2.806836,0 -2.806836,1.69981c0,2.039772 -3.742448,3.739583 -8.108638,3.739583c-4.36619,0 -7.173025,1.359848 -6.237413,3.059659c0.935612,1.359848 -4.054318,4.759469 -10.915473,7.139203c-6.861155,2.719696 -13.410438,6.119317 -14.657921,8.159089c-4.36619,7.139203 -19.647851,12.918557 -46.468728,18.017988c-5.613672,1.019886 -10.291732,3.059659 -10.291732,4.759469c0,1.69981 -3.430577,3.059659 -7.484896,3.059659c-4.36619,0 -8.732378,1.69981 -9.667991,3.399621c-0.935612,2.039772 -6.549283,3.399621 -12.162956,3.399621c-5.301801,0 -11.539215,1.69981 -13.410438,3.739583c-1.559353,1.69981 -16.217274,5.439393 -32.122678,8.159089c-15.905404,2.719696 -29.939584,6.119317 -30.875196,7.819127c-2.183095,4.079545 -24.949653,6.799241 -89.19501,10.878785c-80.774502,5.099431 -158.742167,7.479165 -161.237132,5.099431l-0.000002,0.000005l0.000008,0.000001zm202.092189,-176.100336c8.732378,-0.339962 18.088498,-2.719696 20.583464,-5.099431c3.430577,-3.059659 17.152886,-4.079545 47.404341,-3.739583c41.790669,0.339962 47.09247,-0.339962 47.09247,-7.819127c0,-2.039772 5.925543,-6.119317 13.410438,-8.499051c10.603603,-4.079545 13.098568,-6.459279 13.098568,-13.258519c0,-4.759469 1.247483,-7.819127 2.806836,-6.799241c1.559353,1.359848 3.430577,1.019886 4.054318,-0.679924c0.31187,-1.359848 6.861155,-7.479165 14.346051,-13.938444c7.484896,-6.119317 12.786697,-11.898671 12.474826,-12.578595c-1.871224,-1.69981 -47.404341,-11.558709 -54.577366,-11.558709c-4.054318,0 -7.173025,-1.359848 -7.173025,-3.059659c0,-2.719696 -3.430577,-3.739583 -31.810807,-9.178975c-6.549283,-1.019886 -11.851085,-3.059659 -11.851085,-4.419507c0,-1.359848 -4.98993,-4.419507 -10.915473,-6.799241c-5.925543,-2.379734 -12.786697,-6.119317 -14.969791,-8.159089c-5.613672,-5.779355 -17.152886,-12.578595 -21.207205,-12.578595c-4.36619,0 -12.162956,-8.499051 -12.162956,-13.258519c0,-2.039772 -1.559353,-3.739583 -3.118707,-3.739583c-1.871224,0 -4.98993,-3.739583 -6.861155,-8.499051c-1.871224,-4.759469 -5.301801,-8.499051 -7.484896,-8.499051c-2.183095,0 -5.925543,-3.399621 -7.796766,-7.479165c-2.183095,-4.419507 -6.237413,-10.198861 -9.35612,-13.258519c-3.118707,-3.059659 -4.98993,-6.119317 -4.36619,-7.139203c0.935612,-1.019886 -0.31187,-3.739583 -3.118707,-6.119317c-2.494965,-2.379734 -4.67806,-6.459279 -4.67806,-9.178975c0,-2.719696 -1.247483,-3.739583 -3.118707,-2.719696c-1.559353,1.019886 -3.118707,-0.679924 -3.118707,-4.079545c0,-3.399621 -2.806836,-9.858899 -5.925543,-14.278406l-5.613672,-7.819127l-4.98993,13.938444c-2.806836,7.479165 -6.861155,13.938444 -9.044249,13.938444c-1.871224,0 -2.494965,1.019886 -1.559353,2.379734c2.494965,2.379734 -11.227344,29.576697 -20.271593,39.775558c-3.118707,3.739583 -5.613672,8.159089 -5.613672,9.858899c0,1.69981 -2.494965,5.779355 -5.301801,8.839013c-3.118707,3.059659 -10.603603,12.238633 -16.529145,20.737685c-10.603603,15.298292 -23.078429,27.876887 -26.509006,27.196963c-0.935612,-0.339962 -5.925543,4.419507 -10.915473,10.198861c-4.67806,5.439393 -10.915473,10.198861 -13.722309,10.198861c-2.806836,0 -4.98993,1.69981 -4.98993,3.399621c0,2.039772 -2.806836,3.399621 -5.925543,3.399621c-3.118707,0 -6.549283,2.379734 -7.796766,5.099431c-0.935612,2.719696 -4.98993,5.099431 -9.044249,5.099431c-9.667991,0 -21.519076,12.238633 -20.271593,21.417609c0.935612,6.459279 17.152886,18.35795 32.434549,23.797342c3.430577,1.359848 11.539215,4.759469 18.400369,7.819127c24.325912,10.878785 35.241385,11.558709 165.603322,7.139203l-0.000003,-0.000002l0.000001,0.000002zm-224.858748,-126.125917c3.430577,-1.359848 9.979861,-4.079545 14.657921,-6.119317c4.67806,-2.039772 7.796766,-4.759469 6.861155,-6.459279c-0.935612,-1.69981 -0.31187,-3.059659 1.559353,-3.059659c4.054318,0 31.498937,-29.576697 31.498937,-33.996204c0,-2.039772 2.183095,-3.399621 4.67806,-3.399621c4.054318,0 5.301801,-2.039772 4.36619,-8.839013c0,-1.019886 2.494965,-4.419507 5.613672,-7.479165c3.118707,-3.059659 7.484896,-9.858899 9.979861,-14.95833c2.494965,-5.439393 5.613672,-9.518937 7.173025,-9.518937c1.247483,0 2.494965,-2.379734 2.494965,-5.099431c0,-2.719696 1.247483,-5.099431 3.118707,-5.099431c1.559353,0 5.301801,-5.099431 7.796766,-10.878785c2.806836,-6.119317 8.108638,-17.338064 11.851085,-25.157191c3.742448,-7.479165 9.35612,-20.397723 12.474826,-28.896773c3.118707,-8.159089 6.861155,-17.678026 8.732378,-20.737685c1.559353,-3.399621 2.806836,-11.558709 2.806836,-18.017988c0,-6.459279 1.559353,-11.898671 3.118707,-11.898671c1.871224,0 3.118707,-21.077647 3.118707,-56.093736c0,-35.01609 -1.247483,-56.093736 -3.118707,-56.093736c-1.559353,0 -3.118707,-6.799241 -3.118707,-14.95833c0,-8.499051 -1.247483,-16.318178 -3.118707,-17.338064c-1.559353,-1.019886 -3.118707,-5.099431 -3.118707,-8.839013c0,-3.399621 -0.935612,-6.459279 -2.494965,-6.459279c-1.247483,0 -4.054318,-4.759469 -6.549283,-10.538823c-2.494965,-6.119317 -10.291732,-17.678026 -17.776628,-26.177077c-7.484896,-8.499051 -13.722309,-16.65814 -13.722309,-18.35795c0,-1.359848 -1.247483,-2.719696 -3.118707,-2.719696c-1.559353,0 -6.861155,-4.419507 -11.539215,-10.198861c-4.36619,-5.439393 -10.291732,-10.198861 -13.098568,-10.198861c-2.806836,0 -7.796766,-3.739583 -10.915473,-8.499051c-3.118707,-4.759469 -7.484896,-8.499051 -9.35612,-8.499051c-2.183095,0 -8.732378,-4.079545 -14.657921,-8.839013c-5.925543,-4.759469 -15.593533,-11.218747 -21.519076,-14.278406c-5.925543,-3.059659 -11.539215,-6.459279 -12.474826,-7.479165c-3.430577,-4.079545 -19.335981,-10.198861 -26.820877,-10.198861c-4.36619,0 -7.173025,-1.359848 -6.237413,-3.059659c6.861155,-11.558709 -130.050066,-13.938444 -146.267341,-2.379734c-4.054318,3.059659 -10.291732,5.439393 -13.722309,5.439393c-3.430577,0 -7.173025,1.69981 -8.108638,3.399621c-0.935612,2.039772 -5.925543,3.399621 -11.227344,3.399621c-4.98993,0 -9.044249,1.69981 -9.044249,3.399621c0,2.039772 -2.806836,3.399621 -5.925543,3.399621c-3.430577,0 -7.173025,1.69981 -8.108638,3.399621c-0.935612,2.039772 -4.67806,3.399621 -8.108638,3.399621c-3.118707,0 -5.925543,1.69981 -5.925543,3.399621c0,2.039772 -2.806836,3.399621 -6.237413,3.399621c-3.430577,0 -6.237413,1.359848 -6.237413,2.719696c0,1.69981 -5.613672,5.779355 -12.474826,9.178975c-13.098568,6.459279 -40.543186,33.656242 -40.543186,40.455482c0,2.039772 6.237413,9.858899 14.03418,17.338064c7.796766,7.479165 14.03418,15.298292 14.03418,18.017988c0,2.379734 4.67806,6.459279 10.603603,9.178975c5.613672,2.719696 11.227344,7.139203 12.162956,10.198861c1.247483,3.059659 5.925543,5.099431 11.227344,5.099431c6.861155,0 10.915473,2.719696 14.657921,8.499051c3.430577,5.779355 7.796766,8.499051 14.03418,8.499051c7.173025,0 9.667991,2.379734 13.722309,11.898671c2.806836,8.159089 7.796766,13.598481 14.969791,16.998102c5.925543,2.719696 11.539215,7.819127 12.474826,11.898671c2.183095,9.858899 7.484896,8.499051 13.098568,-3.399621c7.484896,-15.638254 14.03418,-12.578595 18.71224,8.159089c2.806836,11.898671 4.67806,13.598481 17.152886,17.678026c27.444619,9.178975 51.146788,4.079545 57.696073,-11.558709c1.559353,-4.079545 4.054318,-7.479165 5.301801,-7.479165c1.559353,0 2.494965,-2.379734 2.494965,-5.439393c0,-6.119317 7.484896,-14.95833 12.786697,-14.95833c1.871224,0 5.925543,-2.719696 8.732378,-5.779355c7.796766,-9.518937 18.088498,-14.618368 28.38023,-14.618368c5.613672,0 9.044249,-1.359848 7.796766,-3.399621c-3.430577,-6.119317 47.404341,-5.779355 52.706142,0.339962c1.871224,1.69981 5.613672,3.059659 8.732378,3.059659c7.173025,0 16.841016,5.779355 29.003972,17.678026c4.98993,5.439393 11.227344,9.518937 13.410438,9.518937c2.183095,0 3.430577,1.359848 2.183095,3.059659c-0.935612,1.69981 0.935612,5.779355 3.742448,9.178975c13.722309,14.618368 19.647851,35.696015 19.647851,69.692218c0,17.678026 -1.247483,33.656242 -2.494965,35.696015c-1.559353,1.69981 -5.301801,10.198861 -8.108638,19.377837c-3.118707,8.839013 -6.861155,15.298292 -8.420508,13.938444c-1.559353,-1.019886 -2.806836,0.679924 -2.806836,3.399621c0,3.059659 -4.98993,8.839013 -10.915473,12.918557c-5.925543,4.419507 -10.915473,9.518937 -10.915473,11.218747c0,2.039772 -6.549283,5.779355 -14.657921,8.159089c-8.420508,2.719696 -15.593533,6.119317 -16.529145,7.479165c-0.935612,1.359848 -14.346051,3.059659 -29.627713,3.739583c-28.068359,1.019886 -28.068359,1.019886 -27.132747,9.518937c0.623741,4.759469 2.494965,10.198861 4.054318,12.238633c1.871224,2.719696 -0.623741,5.779355 -8.108638,9.518937c-7.796766,4.079545 -10.915473,7.819127 -10.915473,13.598481c0,4.419507 -2.183095,9.858899 -4.67806,12.238633c-6.237413,5.779355 -5.925543,11.218747 1.559353,18.697912c3.430577,3.399621 6.237413,9.518937 6.237413,13.258519c0.31187,8.499051 6.861155,36.035977 9.979861,41.135407c2.183095,4.079545 13.410438,4.079545 22.766559,0.339962l0.000003,-0.000001l0.000004,0zm450.964978,-32.976318c4.98993,-5.779355 9.044249,-11.898671 9.044249,-13.598481c0,-1.69981 1.559353,-2.719696 3.742448,-2.039772c1.871224,0.339962 4.98993,-2.379734 6.861155,-6.119317c1.871224,-3.739583 7.173025,-13.938444 11.539215,-22.097533c4.36619,-8.499051 9.044249,-19.377837 10.291732,-24.477266c0.935612,-5.439393 4.054318,-9.518937 6.237413,-9.518937c2.806836,0 3.742448,-2.379734 2.806836,-6.799241c-0.935612,-4.419507 -4.36619,-6.799241 -9.044249,-6.799241c-4.054318,0 -7.484896,-1.359848 -7.484896,-3.399621c0,-1.69981 -2.183095,-3.399621 -4.67806,-3.399621c-2.494965,0 -4.67806,-1.359848 -4.67806,-3.059659c0,-1.69981 -2.806836,-4.079545 -5.925543,-5.439393c-8.732378,-3.059659 -34.617644,-30.936546 -34.617644,-37.395824c0,-3.059659 -1.247483,-4.759469 -2.806836,-3.739583c-3.118707,2.039772 -6.237413,-6.459279 -9.979861,-26.857001c-1.247483,-7.479165 -3.430577,-18.697912 -4.67806,-24.817229c-2.494965,-14.278406 9.044249,-65.272712 14.969791,-65.272712c1.247483,0 2.494965,-2.039772 2.494965,-4.419507c0,-6.459279 23.702171,-32.976318 29.315842,-32.976318c2.806836,0 4.98993,-1.359848 4.98993,-3.399621c0,-1.69981 2.806836,-3.399621 6.237413,-3.399621c3.430577,0 6.237413,-1.359848 6.237413,-3.399621c0,-1.69981 3.430577,-3.399621 7.484896,-3.399621c4.36619,0 8.732378,-1.359848 9.667991,-3.399621c0.935612,-1.69981 13.722309,-3.399621 28.068359,-3.399621c14.346051,0 27.132747,1.69981 28.068359,3.399621c0.935612,2.039772 4.67806,3.399621 8.108638,3.399621c3.118707,0 5.925543,1.69981 5.925543,3.399621c0,2.039772 2.183095,3.399621 4.67806,3.399621c2.494965,0 4.67806,1.69981 4.67806,3.399621c0,2.039772 2.806836,3.399621 6.549283,3.399621c3.430577,0 5.301801,1.69981 4.36619,3.399621c-0.935612,2.039772 -0.623741,3.399621 1.247483,3.399621c4.054318,0 19.024111,16.318178 19.024111,20.397723c0,2.039772 1.247483,3.399621 2.806836,3.399621c2.494965,0 5.613672,7.819127 8.420508,21.417609c1.559353,6.799241 13.722309,22.437495 13.722309,17.338064c0,-1.69981 1.559353,-0.339962 3.430577,3.059659c4.36619,8.159089 8.420508,7.139203 9.667991,-2.719696c0.623741,-4.759469 2.183095,-8.499051 3.742448,-8.499051c1.559353,0.339962 4.36619,-3.059659 6.237413,-7.139203c3.430577,-7.479165 16.529145,-18.017988 27.756489,-22.097533c2.806836,-1.359848 5.301801,-4.079545 5.301801,-6.459279c0,-2.719696 2.806836,-5.439393 5.925543,-6.799241c11.227344,-3.739583 12.786697,-9.518937 7.796766,-27.876887c-2.494965,-9.518937 -6.861155,-19.377837 -9.35612,-21.417609c-2.183095,-2.379734 -4.36619,-7.139203 -4.36619,-10.878785c0,-3.399621 -4.67806,-11.558709 -10.291732,-17.678026c-5.613672,-6.119317 -12.786697,-16.65814 -15.905404,-23.457381c-2.806836,-7.139203 -6.549283,-12.578595 -8.108638,-12.578595c-1.871224,0 -3.118707,-2.039772 -3.118707,-4.759469c0,-2.379734 -4.054318,-9.178975 -9.35612,-14.95833c-4.98993,-6.119317 -9.35612,-12.238633 -9.35612,-14.278406c0,-2.039772 -6.549283,-10.198861 -14.346051,-18.35795c-22.142817,-22.777457 -25.885265,-25.837115 -30.875196,-25.837115c-2.494965,0 -4.67806,-1.019886 -4.67806,-2.719696c0,-4.079545 -29.627713,-17.678026 -38.360092,-17.678026c-4.36619,0 -10.291732,-2.379734 -13.098568,-5.439393c-4.36619,-4.759469 -13.410438,-5.779355 -64.245356,-5.439393c-32.434549,0.339962 -61.438521,1.69981 -64.557227,3.739583c-2.806836,1.69981 -16.529145,4.759469 -30.251454,7.139203c-13.722309,2.379734 -28.068359,6.459279 -31.810807,8.839013c-3.742448,2.719696 -11.227344,4.759469 -16.217274,4.759469c-4.98993,0 -10.291732,1.69981 -11.227344,3.399621c-0.935612,2.039772 -5.301801,3.399621 -9.667991,3.399621c-4.36619,0 -6.861155,1.359848 -5.925543,3.399621c1.247483,2.039772 -1.871224,3.399621 -7.484896,3.399621c-4.98993,0 -10.291732,1.69981 -11.227344,3.399621c-0.935612,2.039772 -4.36619,3.399621 -7.173025,3.399621c-2.806836,0 -10.291732,4.759469 -16.217274,10.198861c-5.925543,5.779355 -13.098568,10.878785 -15.905404,11.898671c-4.98993,1.69981 -18.400369,26.177077 -18.400369,33.656242c0,2.379734 -2.183095,8.839013 -4.67806,14.618368c-15.281663,33.31628 -23.078429,151.963032 -12.474826,190.03878c2.494965,9.178975 4.67806,21.077647 4.67806,26.517039c0,13.598481 6.549283,36.035977 9.667991,33.996204c1.559353,-1.019886 2.806836,1.359848 2.806836,5.439393c0,3.739583 1.247483,9.518937 2.806836,12.918557c1.559353,3.059659 4.36619,9.858899 6.237413,15.298292c7.173025,19.377837 10.915473,26.177077 21.830946,40.795444c6.237413,8.159089 14.03418,19.037874 17.464757,23.797342c3.430577,5.099431 7.796766,9.178975 9.979861,9.178975c2.183095,0 4.054318,1.69981 4.054318,3.399621c0,2.039772 2.183095,3.399621 4.67806,3.399621c2.494965,0 4.67806,1.69981 4.67806,3.399621c0,2.039772 1.871224,3.399621 4.36619,3.399621c2.494965,0 6.549283,2.039772 8.732378,4.419507c9.044249,9.178975 18.400369,12.238633 54.889236,18.017988c7.173025,1.359848 14.03418,3.739583 14.969791,5.099431c0.935612,1.69981 15.593533,3.059659 33.05829,3.059659c30.875196,0 31.187066,0 40.231315,-10.538823l0.000002,-0.000005l0.000005,-0.000001zm-553.882297,-247.832327c1.247483,-2.039772 -3.118707,-3.059659 -11.539215,-3.059659l-13.410438,0.679924l10.915473,2.379734c5.925543,1.359848 11.227344,2.719696 11.539215,3.059659c0.31187,0 1.559353,-1.019886 2.494965,-3.059659l0,0.000001zm879.163397,-124.086145c2.806836,-4.759469 6.549283,-7.819127 8.108638,-6.799241c1.871224,1.359848 3.118707,-0.679924 3.118707,-3.739583c0,-3.399621 1.247483,-10.538823 2.806836,-16.318178c8.420508,-30.596584 12.786697,-61.193167 12.786697,-86.010396l0,-28.216849l-10.915473,0c-5.925543,0 -10.915473,1.69981 -10.915473,3.399621c0,2.039772 -10.915473,3.399621 -26.509006,3.399621c-15.593533,0 -26.509006,-1.359848 -26.509006,-3.399621c0,-1.69981 -2.806836,-3.399621 -5.925543,-3.399621c-3.430577,0 -7.173025,-1.69981 -8.420508,-3.739583c-0.935612,-2.039772 -6.861155,-6.119317 -12.786697,-8.839013c-5.925543,-2.719696 -11.539215,-7.819127 -12.474826,-11.218747c-0.935612,-3.739583 -2.806836,-5.779355 -4.36619,-4.759469c-1.559353,0.679924 -4.36619,-1.359848 -6.549283,-5.439393c-2.183095,-3.739583 -4.98993,-6.799241 -6.237413,-6.799241c-4.054318,0 -17.464757,-16.65814 -24.637782,-30.596584c-3.742448,-7.479165 -8.108638,-13.598481 -9.667991,-13.598481c-1.247483,0 -2.494965,-2.379734 -2.494965,-5.099431c0,-5.099431 -5.925543,-18.697912 -9.667991,-22.097533c-6.861155,-6.119317 -12.162956,-127.145803 -6.237413,-133.605082c1.871224,-2.039772 3.430577,-7.479165 3.430577,-11.898671c0,-4.419507 1.247483,-6.799241 3.118707,-5.779355c1.871224,1.019886 3.118707,-1.019886 3.118707,-4.759469c0,-3.739583 1.559353,-7.819127 3.118707,-8.839013c1.871224,-1.019886 3.118707,-4.419507 3.118707,-7.479165c0,-11.558709 51.77053,-72.751876 70.170899,-82.610776c14.03418,-7.819127 13.410438,-18.017988 -2.806836,-45.894875c-7.796766,-12.918557 -15.593533,-25.497153 -17.464757,-27.876887c-1.559353,-2.379734 -3.118707,-5.779355 -3.118707,-7.819127c0,-1.69981 -1.247483,-3.399621 -3.118707,-3.399621c-1.559353,0 -3.118707,-2.379734 -3.118707,-5.099431c0,-2.719696 -1.871224,-5.099431 -4.36619,-5.099431c-2.494965,0 -5.301801,-3.059659 -6.549283,-6.459279c-0.935612,-3.739583 -8.108638,-12.918557 -15.593533,-20.397723c-7.796766,-7.819127 -14.03418,-15.638254 -14.03418,-17.338064c0,-1.69981 -3.430577,-4.079545 -7.796766,-5.439393c-4.36619,-1.019886 -7.796766,-3.399621 -7.796766,-4.759469c0,-1.359848 -4.67806,-5.099431 -9.979861,-8.159089c-5.613672,-3.059659 -12.474826,-7.139203 -14.969791,-8.839013c-2.494965,-1.359848 -16.529145,-6.119317 -31.187066,-10.538823c-14.657921,-4.079545 -29.315842,-8.499051 -32.746419,-10.198861c-12.786697,-5.439393 -73.601476,-7.479165 -243.259117,-7.139203c-175.895053,0 -258.540779,2.379734 -251.367754,7.139203c3.430577,2.379734 -75.784571,12.918557 -124.436394,16.318178c-11.227344,1.019886 -21.830946,3.059659 -23.702171,4.759469c-1.871224,1.69981 -14.03418,4.759469 -26.509006,6.799241c-39.607574,6.119317 -43.350022,7.139203 -43.350022,10.198861c0,1.69981 -5.613672,3.059659 -12.162956,3.059659c-6.861155,0 -13.410438,1.69981 -14.346051,3.399621c-0.935612,2.039772 -8.108638,3.399621 -15.905404,3.399621c-7.484896,0 -13.722309,1.359848 -13.722309,3.059659c0,1.359848 -6.549283,4.079545 -14.657921,5.099431c-26.509006,4.419507 -48.963694,8.499051 -63.933486,11.558709c-8.420508,1.69981 -14.969791,2.379734 -14.969791,1.69981c0,-0.679924 -3.118707,1.019886 -6.861155,3.739583c-3.742448,3.059659 -9.979861,5.439393 -14.03418,5.439393c-8.420508,0 -22.766559,6.799241 -22.766559,10.878785c0,1.359848 -2.806836,2.719696 -6.237413,2.719696c-3.430577,0 -6.237413,1.69981 -6.237413,3.399621c0,2.039772 -2.806836,3.399621 -5.925543,3.399621c-3.430577,0 -7.173025,1.69981 -8.108638,3.399621c-0.935612,2.039772 -6.861155,3.399621 -13.098568,3.399621c-6.237413,0 -10.291732,1.019886 -9.35612,2.379734c2.494965,2.379734 -11.851085,11.218747 -18.400369,11.218747c-2.494965,0 -5.301801,2.379734 -6.237413,5.099431c-1.247483,2.719696 -3.118707,4.079545 -4.67806,3.059659c-1.559353,-1.019886 -2.806836,1.359848 -2.806836,4.759469c0,3.739583 2.494965,7.479165 5.613672,8.839013c8.420508,3.059659 15.905404,9.178975 32.746419,26.857001c15.281663,15.978216 36.488867,45.554913 36.488867,50.654344c0,1.359848 4.054318,12.578595 9.35612,24.817229c4.98993,12.238633 9.35612,24.477266 9.35612,26.857001c0,2.379734 2.183095,10.538823 4.98993,17.678026c4.36619,10.878785 4.98993,21.077647 3.430577,57.453585c-0.935612,26.517039 -3.118707,44.535027 -4.98993,45.214951c-1.871224,0.679924 -3.430577,6.459279 -3.430577,12.578595c0,6.459279 -1.247483,12.578595 -3.118707,13.598481c-1.559353,1.019886 -3.118707,4.759469 -3.118707,8.159089c0,13.598481 -20.271593,48.614572 -39.607574,68.33237c-10.915473,11.218747 -20.895334,20.397723 -22.454688,20.397723c-1.559353,0 -3.430577,1.019886 -4.054318,2.719696c-1.871224,4.759469 -41.790669,24.477266 -49.899306,24.477266c-4.36619,0 -8.732378,1.69981 -9.35612,3.399621c-0.623741,2.379734 -14.346051,4.079545 -33.682032,4.419507c-33.05829,0.339962 -45.533117,-2.379734 -37.112609,-8.159089c3.430577,-2.379734 3.118707,-3.059659 -0.935612,-3.059659c-8.420508,0 -14.969791,3.739583 -14.969791,8.839013c0,2.719696 -2.494965,4.759469 -5.925543,4.759469c-4.98993,0 -5.301801,1.69981 -3.118707,16.998102c2.494965,16.998102 9.35612,32.296394 13.098568,28.556811c0.935612,-1.019886 3.742448,1.019886 5.925543,5.099431c2.183095,4.079545 6.549283,7.139203 9.667991,7.139203c3.118707,0 4.98993,1.359848 4.054318,3.059659c-4.98993,8.499051 71.730252,14.95833 81.086372,6.799241c1.871224,-1.69981 13.722309,-4.079545 26.509006,-5.099431c17.152886,-1.69981 26.820877,-0.679924 38.04822,3.399621c8.108638,3.059659 15.281663,5.439393 15.905404,5.439393c0.935612,0 6.549283,-5.439393 12.474826,-11.898671c6.237413,-6.459279 13.410438,-11.898671 16.217274,-11.898671c2.494965,0 3.742448,-1.359848 2.806836,-3.399621c-0.935612,-1.69981 -0.31187,-3.399621 1.871224,-3.399621c1.871224,0 5.925543,-2.719696 8.732378,-6.459279c2.806836,-3.399621 9.667991,-8.839013 15.281663,-11.898671c5.301801,-3.059659 9.979861,-7.139203 9.979861,-8.839013c0,-2.039772 2.806836,-3.399621 6.237413,-3.399621c3.430577,0 6.237413,-1.359848 6.237413,-3.399621c0,-1.69981 1.871224,-3.399621 4.054318,-3.399621c5.613672,0 20.895334,-8.159089 20.895334,-10.878785c0,-1.69981 2.806836,-2.719696 6.237413,-2.719696c5.925543,0 18.400369,-6.119317 21.830946,-10.538823c2.806836,-3.739583 43.038152,-16.65814 51.458659,-16.65814c4.67806,0 11.227344,-2.039772 14.969791,-4.079545c3.742448,-2.379734 19.959722,-5.099431 35.553255,-6.119317c15.905404,-1.019886 30.563325,-3.739583 32.122678,-5.439393c2.494965,-2.719696 1.247483,-7.479165 -4.36619,-16.65814c-4.36619,-7.139203 -8.108638,-14.278406 -8.108638,-15.638254c0,-1.69981 -2.183095,-3.059659 -4.67806,-3.059659c-2.494965,0 -4.67806,-1.69981 -4.67806,-3.739583c0,-2.039772 -2.183095,-5.779355 -4.67806,-8.499051c-2.494965,-3.059659 -4.67806,-8.159089 -4.67806,-11.558709c0,-3.399621 -1.247483,-7.139203 -2.806836,-8.499051c-4.36619,-2.719696 -12.786697,-22.097533 -12.786697,-29.236735c0,-3.059659 -1.247483,-6.459279 -3.118707,-7.139203c-9.044249,-3.399621 -10.603603,-68.672332 -1.871224,-78.531231c2.183095,-2.379734 5.925543,-9.178975 8.420508,-14.95833c2.183095,-6.119317 5.301801,-11.218747 6.549283,-11.218747c1.559353,0 2.494965,-1.69981 2.494965,-3.739583c0,-3.739583 14.03418,-18.697912 33.682032,-36.375938c5.925543,-5.099431 14.346051,-12.918557 18.71224,-17.678026c4.67806,-4.759469 12.786697,-10.878785 17.776628,-13.598481c5.301801,-2.719696 12.162956,-7.819127 15.281663,-10.878785c3.430577,-3.399621 7.796766,-6.119317 9.979861,-6.119317c2.183095,0 4.36619,-1.359848 4.98993,-2.719696c1.247483,-3.739583 30.563325,-21.077647 35.553255,-21.077647c2.494965,0 4.36619,-1.359848 4.36619,-3.399621c0,-1.69981 4.054318,-3.399621 9.044249,-3.399621c5.301801,0 10.291732,-1.359848 11.227344,-3.399621c0.935612,-2.039772 6.861155,-3.399621 12.786697,-3.399621c5.925543,0 10.603603,-1.359848 10.603603,-3.399621c0,-1.69981 3.430577,-3.399621 7.796766,-3.399621c4.36619,0 7.796766,-1.359848 7.796766,-3.059659c0,-1.69981 3.118707,-3.739583 7.173025,-4.759469c3.742448,-1.019886 14.657921,-4.759469 24.014041,-8.499051c9.35612,-3.739583 27.444619,-8.499051 39.919445,-10.878785c12.162956,-2.039772 21.830946,-5.439393 20.583464,-7.139203c-1.871224,-3.739583 146.267341,-4.079545 149.697918,-0.339962c1.247483,1.359848 19.335981,4.759469 40.231315,7.819127c43.350022,6.459279 53.018013,10.198861 77.343924,30.596584c28.068359,23.117419 57.384201,54.733888 63.933486,68.672332c2.494965,5.099431 5.925543,9.178975 7.484896,9.178975c1.871224,0 3.118707,2.039772 3.118707,4.419507c0,2.039772 4.36619,9.518937 9.35612,15.978216c4.98993,6.459279 9.35612,13.938444 9.35612,16.318178c0,2.039772 1.247483,4.079545 2.494965,4.079545c2.494965,0 13.410438,26.517039 17.776628,43.515141c1.247483,4.079545 3.430577,6.799241 4.98993,5.779355c1.559353,-1.359848 2.806836,11.898671 2.806836,31.956432c0,20.397723 -1.247483,34.336166 -3.118707,34.336166c-1.559353,0 -4.98993,5.439393 -7.484896,11.898671c-5.613672,14.278406 -33.370161,45.894875 -40.543186,45.894875c-2.806836,0 -4.98993,2.379734 -4.98993,5.099431c0,2.719696 -2.183095,5.099431 -4.67806,5.099431c-2.494965,0 -4.67806,1.69981 -4.67806,3.399621c0,2.039772 -1.871224,3.399621 -4.36619,3.399621c-3.430577,0 -9.979861,9.178975 -7.173025,10.538823c0.31187,0 14.657921,1.69981 31.810807,3.399621c35.241385,3.399621 67.052192,8.499051 62.374133,9.858899c-3.118707,1.019886 16.217274,5.779355 36.488867,9.178975c6.549283,1.019886 13.098568,3.739583 15.281663,6.459279c1.871224,2.719696 5.925543,4.759469 9.044249,4.759469c7.484896,0 31.810807,15.298292 29.003972,18.017988c-0.935612,1.359848 0.935612,2.379734 4.67806,2.379734c3.742448,0 6.861155,1.69981 6.861155,3.399621c0,2.039772 1.559353,3.399621 3.430577,3.399621c1.871224,0 4.98993,2.039772 7.173025,4.419507c2.183095,2.039772 7.796766,7.139203 12.162956,10.878785c4.67806,3.739583 8.420508,8.499051 8.420508,10.878785c0,2.379734 1.559353,4.419507 3.430577,4.419507c3.742448,0 21.519076,20.397723 21.519076,24.477266c0,1.359848 1.871224,4.419507 4.054318,6.799241c2.183095,2.379734 8.108638,10.538823 13.098568,18.017988c5.301801,7.479165 10.291732,14.278406 11.227344,15.298292c0.935612,1.019886 3.742448,6.799241 6.237413,12.918557c2.494965,5.779355 5.301801,10.878785 6.549283,10.878785c1.559353,0 2.494965,2.039772 2.494965,4.419507c0,7.819127 9.667991,27.196963 18.400369,37.055862c9.044249,10.198861 14.657921,8.839013 23.390299,-5.779355l0.000003,0l0.000007,0.000002zm-613.449593,-64.252826c6.861155,-16.65814 5.613672,-19.037874 -10.915473,-19.037874c-8.420508,0 -15.905404,1.019886 -17.152886,2.039772c-2.806836,3.399621 1.247483,11.558709 5.925543,11.558709c2.494965,0 4.36619,1.69981 4.36619,3.399621c0,5.099431 7.173025,12.918557 10.915473,12.578595c1.559353,-0.339962 4.67806,-5.099431 6.861155,-10.538823l-0.000001,0l-0.000001,0zm77.343924,-93.829523c0.935612,-1.69981 4.98993,-3.399621 9.044249,-3.399621c3.742448,0 12.474826,-2.719696 19.335981,-6.459279c6.549283,-3.399621 17.776628,-8.499051 24.637782,-10.878785c6.861155,-2.719696 13.722309,-6.799241 14.969791,-8.839013c1.247483,-2.379734 4.054318,-4.419507 6.237413,-4.419507c2.183095,0 7.796766,-3.739583 12.786697,-8.499051c4.98993,-4.759469 10.291732,-8.499051 11.851085,-8.499051c1.247483,0 2.494965,-2.379734 2.494965,-5.099431c0,-2.719696 1.559353,-5.099431 3.118707,-5.099431c1.871224,0 3.118707,-2.379734 3.118707,-5.439393c0,-2.719696 1.247483,-4.419507 2.494965,-3.399621c1.559353,1.019886 4.67806,-2.039772 6.861155,-6.459279c2.183095,-4.759469 4.98993,-8.499051 6.237413,-8.499051c0.935612,0 9.979861,-8.499051 19.959722,-18.697912c9.667991,-10.198861 19.024111,-18.697912 20.271593,-18.697912c1.247483,0 7.484896,-5.439393 13.722309,-11.898671c6.237413,-6.459279 13.098568,-11.898671 14.657921,-11.898671c1.871224,0 3.118707,-2.379734 3.118707,-5.099431c0,-3.059659 -2.806836,-5.099431 -7.484896,-5.099431c-4.36619,0 -8.732378,-1.359848 -9.667991,-3.399621c-0.935612,-1.69981 -8.732378,-3.399621 -17.152886,-3.399621c-8.420508,0 -16.217274,-1.359848 -17.152886,-3.399621c-0.935612,-1.69981 -13.722309,-3.399621 -27.756489,-3.399621c-14.346051,0 -33.370161,-1.69981 -42.41441,-3.399621c-9.35612,-2.039772 -51.77053,-3.739583 -94.808681,-3.739583c-43.038152,-0.339962 -74.848959,-1.69981 -70.482769,-3.059659c6.549283,-2.379734 5.613672,-2.719696 -5.301801,-3.059659c-7.484896,-0.339962 -13.410438,1.359848 -13.410438,3.059659c0,2.039772 -15.281663,3.399621 -39.607574,3.399621c-42.41441,0 -103.852931,6.459279 -103.852931,10.878785c0,1.359848 -4.98993,2.719696 -10.915473,2.719696c-5.925543,0 -10.915473,1.69981 -10.915473,3.399621c0,2.039772 -2.494965,3.399621 -5.301801,3.399621c-3.118707,0 -9.044249,3.059659 -13.410438,6.799241c-4.36619,3.739583 -10.603603,6.799241 -14.03418,6.799241c-3.430577,0 -10.915473,4.419507 -16.841016,9.858899c-9.35612,8.159089 -9.979861,10.198861 -6.861155,16.65814c1.871224,4.079545 4.98993,7.479165 6.549283,7.479165c1.871224,0 3.118707,2.379734 3.118707,5.099431c0,2.719696 1.559353,5.099431 3.430577,5.099431c1.559353,0 2.494965,1.359848 1.559353,2.719696c-0.935612,1.69981 3.118707,8.499051 9.044249,15.298292c5.925543,7.139203 10.915473,13.938444 10.915473,15.298292c0,4.419507 9.35612,14.618368 21.207205,23.797342c15.905404,12.238633 50.834918,31.276508 57.072331,31.276508c3.430577,0 5.925543,1.69981 5.925543,3.399621c0,2.039772 5.301801,3.399621 11.851085,3.399621c6.237413,0 13.722309,1.69981 16.217274,3.399621c6.549283,4.419507 183.068079,4.419507 185.563044,0l0,0.000002l0.000002,0.000001zm-345.552694,-202.617376c-0.935612,-1.019886 -3.742448,-1.359848 -5.925543,-0.339962c-2.494965,1.019886 -1.559353,2.039772 1.871224,2.039772c3.430577,0.339962 5.301801,-0.679924 4.054318,-1.69981l0.000001,0zm10.291732,-8.159089c0,-1.69981 1.871224,-3.399621 4.36619,-3.399621c2.494965,0 9.667991,-2.719696 16.529145,-6.459279c16.217274,-8.499051 32.434549,-13.938444 42.41441,-13.938444c4.36619,0 9.35612,-2.039772 10.603603,-4.759469c2.806836,-5.099431 19.335981,-7.819127 67.987804,-10.878785c20.583464,-1.359848 29.003972,-3.059659 24.949653,-5.099431c-3.430577,-1.359848 34.617644,-2.719696 84.205079,-2.719696c49.899306,0 87.635656,1.359848 84.205079,2.719696c-3.742448,1.69981 11.227344,3.739583 37.42448,5.099431c35.865127,1.69981 106.347896,7.139203 110.090344,8.499051c0.623741,0.339962 0,2.039772 -0.935612,3.739583c-1.247483,2.039772 5.301801,3.399621 16.841016,3.399621c19.647851,0 24.325912,-4.419507 14.346051,-13.598481c-2.494965,-2.379734 -3.742448,-5.779355 -2.494965,-7.819127c0.935612,-2.039772 0.31187,-2.379734 -1.559353,-1.019886c-2.183095,1.359848 -5.301801,-1.019886 -7.484896,-6.119317c-1.871224,-4.759469 -4.67806,-8.839013 -5.925543,-8.839013c-1.247483,0 -5.301801,-5.439393 -9.044249,-11.898671c-3.742448,-6.459279 -7.796766,-11.898671 -9.35612,-11.898671c-1.247483,0 -6.861155,-4.419507 -12.474826,-10.198861c-5.613672,-5.439393 -12.786697,-10.198861 -15.905404,-10.198861c-3.118707,0 -7.484896,-3.059659 -9.667991,-6.799241c-2.183095,-3.739583 -7.173025,-6.799241 -10.915473,-6.799241c-4.054318,0 -7.173025,-1.359848 -7.173025,-3.399621c0,-2.039772 -9.35612,-3.399621 -22.142817,-3.399621c-11.851085,0 -21.207205,-1.359848 -20.271593,-3.059659c4.054318,-7.139203 -114.768404,-10.198861 -141.589281,-3.399621c-7.796766,2.039772 -18.71224,4.419507 -24.325912,5.439393c-5.613672,1.019886 -10.915473,3.059659 -11.851085,4.759469c-0.935612,1.69981 -5.613672,3.059659 -10.915473,3.059659c-4.98993,0 -9.044249,1.359848 -9.044249,2.719696c0,1.359848 -6.549283,4.419507 -14.657921,6.799241c-8.420508,2.719696 -17.464757,6.119317 -20.271593,7.819127c-3.118707,1.69981 -8.420508,3.059659 -11.539215,3.059659c-3.430577,0 -6.861155,1.359848 -7.796766,3.059659c-0.935612,1.69981 -8.732378,4.759469 -17.152886,7.139203c-8.732378,2.039772 -17.152886,6.119317 -19.335981,8.839013c-1.871224,2.719696 -6.237413,4.759469 -9.35612,4.759469c-5.925543,0 -25.885265,10.878785 -32.434549,18.017988c-1.871224,2.379734 -10.915473,9.518937 -19.647851,15.978216c-9.044249,6.459279 -16.217274,13.598481 -16.217274,15.978216c0,2.039772 -2.806836,5.099431 -6.237413,6.119317c-3.430577,1.019886 -6.237413,3.739583 -6.237413,5.439393c0,1.69981 -1.871224,3.059659 -4.054318,3.059659c-2.183095,0 -5.613672,3.059659 -7.796766,6.799241c-3.430577,6.119317 -3.118707,6.799241 4.054318,6.799241c4.36619,0 7.796766,-1.359848 7.796766,-3.399621l-0.000001,0l-0.000004,-0.000003z" id="svg_3" stroke-width="0" stroke="null"></path> <path d="m557.957919,6372.850587c0,-4.759469 0.623741,-6.459279 1.559353,-4.079545c0.623741,2.039772 0.623741,6.119317 0,8.499051c-0.935612,2.039772 -1.559353,0.339962 -1.559353,-4.419507l0,0.000001z" id="svg_4" stroke-width="0" stroke="null"></path> <path d="m547.978057,6237.205733c0,-1.69981 -0.935612,-5.439393 -1.871224,-8.499051c-1.247483,-3.739583 -0.31187,-5.439393 3.118707,-5.439393c3.118707,0 4.98993,3.059659 4.98993,8.499051c0,4.759469 -1.247483,8.499051 -3.118707,8.499051c-1.559353,0 -3.118707,-1.359848 -3.118707,-3.059659l0.000001,0.000001z" id="svg_5" stroke-width="0" stroke="null"></path> <path d="m522.092792,6197.090212c-1.247483,-1.019886 -2.183095,-6.459279 -2.183095,-11.898671c0,-13.598481 7.484896,-10.538823 8.732378,3.399621c0.935612,10.198861 -1.871224,13.938444 -6.549283,8.499051l0,-0.000001z" id="svg_6" stroke-width="0" stroke="null"></path> <path d="m497.45501,6146.095906c2.183095,-1.019886 4.98993,-0.679924 5.925543,0.339962c1.247483,1.019886 -0.623741,2.039772 -4.054318,1.69981c-3.430577,0 -4.36619,-1.019886 -1.871224,-2.039772l-0.000001,0z" id="svg_7" stroke-width="0" stroke="null"></path> <path d="m2238.628918,6132.837387c0,-3.739583 0.935612,-4.759469 1.871224,-2.039772c0.935612,2.379734 0.623741,5.439393 -0.31187,6.459279c-0.935612,1.359848 -1.871224,-0.679924 -1.559353,-4.419507l-0.000001,0z" id="svg_8" stroke-width="0" stroke="null"></path> <path d="m993.329363,5785.736144c2.183095,-1.019886 4.98993,-0.679924 5.925543,0.339962c1.247483,1.019886 -0.623741,2.039772 -4.054318,1.69981c-3.430577,0 -4.36619,-1.019886 -1.871224,-2.039772l-0.000001,0z" id="svg_9" stroke-width="0" stroke="null"></path> <path d="m376.449193,5685.787304c0,-1.69981 1.559353,-2.379734 3.118707,-1.359848c1.871224,1.019886 3.118707,2.719696 3.118707,3.739583c0,0.679924 -1.247483,1.359848 -3.118707,1.359848c-1.559353,0 -3.118707,-1.69981 -3.118707,-3.739583z" id="svg_10" stroke-width="0" stroke="null"></path> <path d="m111.982871,5924.100694c0,-4.759469 0.623741,-6.459279 1.559353,-4.079545c0.623741,2.039772 0.623741,6.119317 0,8.499051c-0.935612,2.039772 -1.559353,0.339962 -1.559353,-4.419507l0,0.000001z" id="svg_11" stroke-width="0" stroke="null"></path> </g> </g> </svg> <span class="text-xl font-bold sm:text-2xl">知道的越多，才知知道的越少</span> </a> <nav aria-label="Main menu" class="absolute -inset-x-4 top-14 hidden flex-col items-end gap-y-4 rounded-md bg-bgColor/[.85] py-4 text-accent shadow backdrop-blur group-[.menu-open]:z-50 group-[.menu-open]:flex sm:static sm:z-auto sm:-ms-4 sm:mt-1 sm:flex sm:flex-row sm:items-center sm:divide-x sm:divide-dashed sm:divide-accent sm:rounded-none sm:bg-transparent sm:py-0 sm:shadow-none sm:backdrop-blur-none" id="navigation-menu"> <a class="px-4 py-4 underline-offset-2 sm:py-0 sm:hover:underline" data-astro-prefetch href="/astro-theme-cactus/"> Home </a><a class="px-4 py-4 underline-offset-2 sm:py-0 sm:hover:underline" data-astro-prefetch href="/astro-theme-cactus/posts/"> Blog </a> </nav> </div> <site-search class="ms-auto" id="search" data-astro-cid-otpdt6jm> <button class="flex h-9 w-9 items-center justify-center rounded-md ring-zinc-400 transition-all hover:ring-2" data-open-modal disabled data-astro-cid-otpdt6jm> <svg aria-label="search" class="h-7 w-7" fill="none" height="16" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" viewBox="0 0 24 24" width="16" xmlns="http://www.w3.org/2000/svg" data-astro-cid-otpdt6jm> <path d="M0 0h24v24H0z" stroke="none" data-astro-cid-otpdt6jm></path> <path d="M3 10a7 7 0 1 0 14 0 7 7 0 1 0-14 0M21 21l-6-6" data-astro-cid-otpdt6jm></path> </svg> </button> <dialog aria-label="search" class="h-full max-h-full w-full max-w-full border border-zinc-400 bg-bgColor shadow backdrop:backdrop-blur sm:mx-auto sm:mb-auto sm:mt-16 sm:h-max sm:max-h-[calc(100%-8rem)] sm:min-h-[15rem] sm:w-5/6 sm:max-w-[48rem] sm:rounded-md" data-astro-cid-otpdt6jm> <div class="dialog-frame flex flex-col gap-4 p-6 pt-12 sm:pt-6" data-astro-cid-otpdt6jm> <button class="ms-auto cursor-pointer rounded-md bg-zinc-200 p-2 font-semibold dark:bg-zinc-700" data-close-modal data-astro-cid-otpdt6jm>Close</button> <div class="search-container" data-astro-cid-otpdt6jm> <div id="cactus__search" data-astro-cid-otpdt6jm></div> </div> </div> </dialog> </site-search>    <theme-toggle class="ms-2 sm:ms-4"> <button class="relative h-9 w-9 rounded-md p-2 ring-zinc-400 transition-all hover:ring-2" type="button"> <span class="sr-only">Dark Theme</span> <svg aria-hidden="true" class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-100 opacity-100 transition-all dark:scale-0 dark:opacity-0" fill="none" focusable="false" id="sun-svg" stroke-width="1.5" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"> <path d="M12 18C15.3137 18 18 15.3137 18 12C18 8.68629 15.3137 6 12 6C8.68629 6 6 8.68629 6 12C6 15.3137 8.68629 18 12 18Z" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path> <path d="M22 12L23 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path> <path d="M12 2V1" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path> <path d="M12 23V22" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path> <path d="M20 20L19 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path> <path d="M20 4L19 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path> <path d="M4 20L5 19" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path> <path d="M4 4L5 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path> <path d="M1 12L2 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path> </svg> <svg aria-hidden="true" class="absolute start-1/2 top-1/2 h-7 w-7 -translate-x-1/2 -translate-y-1/2 scale-0 opacity-0 transition-all dark:scale-100 dark:opacity-100" fill="none" focusable="false" id="moon-svg" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"> <path d="M0 0h24v24H0z" fill="none" stroke="none"></path> <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z"></path> <path d="M17 4a2 2 0 0 0 2 2a2 2 0 0 0 -2 2a2 2 0 0 0 -2 -2a2 2 0 0 0 2 -2"></path> <path d="M19 11h2m-1 -1v2"></path> </svg> </button> </theme-toggle>  <mobile-button> <button aria-expanded="false" aria-haspopup="menu" aria-label="Open main menu" class="group relative ms-4 h-7 w-7 sm:invisible sm:hidden" id="toggle-navigation-menu" type="button"> <svg aria-hidden="true" class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 transition-all group-aria-expanded:scale-0 group-aria-expanded:opacity-0" fill="none" focusable="false" id="line-svg" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"> <path d="M3.75 9h16.5m-16.5 6.75h16.5" stroke-linecap="round" stroke-linejoin="round"></path> </svg> <svg aria-hidden="true" class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 scale-0 text-accent opacity-0 transition-all group-aria-expanded:scale-100 group-aria-expanded:opacity-100" class="text-accent" fill="none" focusable="false" id="cross-svg" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"> <path d="M6 18L18 6M6 6l12 12" stroke-linecap="round" stroke-linejoin="round"></path> </svg> </button> </mobile-button> </header>  <main id="main">  <div class="gap-x-10 lg:flex lg:items-start"> <aside class="sticky top-20 order-2 -me-32 hidden basis-64 lg:block"> <h2 class="font-semibold">Table of Contents</h2> <ul class="mt-4 text-xs"> <li class=""> <a aria-label="Scroll to section: Mysql InnoDB" class="block line-clamp-2 hover:text-accent mt-3" href="#mysql-innodb"><span class="me-0.5">#</span>Mysql InnoDB</a> <ul> <li class="ms-2"> <a aria-label="Scroll to section: InnoDB 简介" class="block line-clamp-2 hover:text-accent mt-2 text-[0.6875rem]" href="#innodb-简介"><span class="me-0.5">#</span>InnoDB 简介</a>  </li><li class="ms-2"> <a aria-label="Scroll to section: InnoDB 的行格式" class="block line-clamp-2 hover:text-accent mt-2 text-[0.6875rem]" href="#innodb-的行格式"><span class="me-0.5">#</span>InnoDB 的行格式</a> <ul> <li class="ms-2"> <a aria-label="Scroll to section: compact 格式" class="block line-clamp-2 hover:text-accent mt-2 text-[0.6875rem]" href="#compact-格式"><span class="me-0.5">#</span>compact 格式</a>  </li><li class="ms-2"> <a aria-label="Scroll to section: redundant 格式" class="block line-clamp-2 hover:text-accent mt-2 text-[0.6875rem]" href="#redundant-格式"><span class="me-0.5">#</span>redundant 格式</a>  </li><li class="ms-2"> <a aria-label="Scroll to section: dynamic 格式" class="block line-clamp-2 hover:text-accent mt-2 text-[0.6875rem]" href="#dynamic-格式"><span class="me-0.5">#</span>dynamic 格式</a>  </li><li class="ms-2"> <a aria-label="Scroll to section: compressed 格式" class="block line-clamp-2 hover:text-accent mt-2 text-[0.6875rem]" href="#compressed-格式"><span class="me-0.5">#</span>compressed 格式</a>  </li> </ul> </li><li class="ms-2"> <a aria-label="Scroll to section: Page Directory(页目录)" class="block line-clamp-2 hover:text-accent mt-2 text-[0.6875rem]" href="#page-directory页目录"><span class="me-0.5">#</span>Page Directory(页目录)</a>  </li><li class="ms-2"> <a aria-label="Scroll to section: Page Header(页面头部)" class="block line-clamp-2 hover:text-accent mt-2 text-[0.6875rem]" href="#page-header页面头部"><span class="me-0.5">#</span>Page Header(页面头部)</a>  </li><li class="ms-2"> <a aria-label="Scroll to section: File Header(文件头部)" class="block line-clamp-2 hover:text-accent mt-2 text-[0.6875rem]" href="#file-header文件头部"><span class="me-0.5">#</span>File Header(文件头部)</a>  </li><li class="ms-2"> <a aria-label="Scroll to section: File Trailer(文件尾部)" class="block line-clamp-2 hover:text-accent mt-2 text-[0.6875rem]" href="#file-trailer文件尾部"><span class="me-0.5">#</span>File Trailer(文件尾部)</a>  </li><li class="ms-2"> <a aria-label="Scroll to section: InnoDB 的 Buffer Pool 是如何管理数据页的" class="block line-clamp-2 hover:text-accent mt-2 text-[0.6875rem]" href="#innodb-的-buffer-pool-是如何管理数据页的"><span class="me-0.5">#</span>InnoDB 的 Buffer Pool 是如何管理数据页的</a> <ul> <li class="ms-2"> <a aria-label="Scroll to section: InnoDB结构图" class="block line-clamp-2 hover:text-accent mt-2 text-[0.6875rem]" href="#innodb结构图"><span class="me-0.5">#</span>InnoDB结构图</a>  </li><li class="ms-2"> <a aria-label="Scroll to section: Buffer Pool(缓冲池)" class="block line-clamp-2 hover:text-accent mt-2 text-[0.6875rem]" href="#buffer-pool缓冲池"><span class="me-0.5">#</span>Buffer Pool(缓冲池)</a>  </li><li class="ms-2"> <a aria-label="Scroll to section: 管理Buffer Pool" class="block line-clamp-2 hover:text-accent mt-2 text-[0.6875rem]" href="#管理buffer-pool"><span class="me-0.5">#</span>管理Buffer Pool</a>  </li> </ul> </li> </ul> </li><li class=""> <a aria-label="Scroll to section: 疑问" class="block line-clamp-2 hover:text-accent mt-3" href="#疑问"><span class="me-0.5">#</span>疑问</a> <ul> <li class="ms-2"> <a aria-label="Scroll to section: 小数精度问题" class="block line-clamp-2 hover:text-accent mt-2 text-[0.6875rem]" href="#小数精度问题"><span class="me-0.5">#</span>小数精度问题</a>  </li><li class="ms-2"> <a aria-label="Scroll to section: 大数据查询" class="block line-clamp-2 hover:text-accent mt-2 text-[0.6875rem]" href="#大数据查询"><span class="me-0.5">#</span>大数据查询</a> <ul> <li class="ms-2"> <a aria-label="Scroll to section: 创建表" class="block line-clamp-2 hover:text-accent mt-2 text-[0.6875rem]" href="#创建表"><span class="me-0.5">#</span>创建表</a>  </li><li class="ms-2"> <a aria-label="Scroll to section: 创建数据脚本" class="block line-clamp-2 hover:text-accent mt-2 text-[0.6875rem]" href="#创建数据脚本"><span class="me-0.5">#</span>创建数据脚本</a>  </li><li class="ms-2"> <a aria-label="Scroll to section: 开始测试" class="block line-clamp-2 hover:text-accent mt-2 text-[0.6875rem]" href="#开始测试"><span class="me-0.5">#</span>开始测试</a>  </li><li class="ms-2"> <a aria-label="Scroll to section: 普通分页查询" class="block line-clamp-2 hover:text-accent mt-2 text-[0.6875rem]" href="#普通分页查询"><span class="me-0.5">#</span>普通分页查询</a>  </li><li class="ms-2"> <a aria-label="Scroll to section: 相同偏移量,不同数据量" class="block line-clamp-2 hover:text-accent mt-2 text-[0.6875rem]" href="#相同偏移量不同数据量"><span class="me-0.5">#</span>相同偏移量,不同数据量</a>  </li><li class="ms-2"> <a aria-label="Scroll to section: 相同数据量,不同偏移量" class="block line-clamp-2 hover:text-accent mt-2 text-[0.6875rem]" href="#相同数据量不同偏移量"><span class="me-0.5">#</span>相同数据量,不同偏移量</a>  </li><li class="ms-2"> <a aria-label="Scroll to section: 如何优化" class="block line-clamp-2 hover:text-accent mt-2 text-[0.6875rem]" href="#如何优化"><span class="me-0.5">#</span>如何优化</a>  </li><li class="ms-2"> <a aria-label="Scroll to section: 采用子查询方式" class="block line-clamp-2 hover:text-accent mt-2 text-[0.6875rem]" href="#采用子查询方式"><span class="me-0.5">#</span>采用子查询方式</a>  </li><li class="ms-2"> <a aria-label="Scroll to section: 采用 id 限定方式" class="block line-clamp-2 hover:text-accent mt-2 text-[0.6875rem]" href="#采用-id-限定方式"><span class="me-0.5">#</span>采用 id 限定方式</a>  </li><li class="ms-2"> <a aria-label="Scroll to section: 优化数据量大问题" class="block line-clamp-2 hover:text-accent mt-2 text-[0.6875rem]" href="#优化数据量大问题"><span class="me-0.5">#</span>优化数据量大问题</a>  </li> </ul> </li><li class="ms-2"> <a aria-label="Scroll to section: 批量修改数据表和数据表中所有字段的字符集" class="block line-clamp-2 hover:text-accent mt-2 text-[0.6875rem]" href="#批量修改数据表和数据表中所有字段的字符集"><span class="me-0.5">#</span>批量修改数据表和数据表中所有字段的字符集</a>  </li><li class="ms-2"> <a aria-label="Scroll to section: Specified key was too long; max key length is 767 bytes" class="block line-clamp-2 hover:text-accent mt-2 text-[0.6875rem]" href="#specified-key-was-too-long-max-key-length-is-767-bytes"><span class="me-0.5">#</span>Specified key was too long; max key length is 767 bytes</a> <ul> <li class="ms-2"> <a aria-label="Scroll to section: 解决方法" class="block line-clamp-2 hover:text-accent mt-2 text-[0.6875rem]" href="#解决方法"><span class="me-0.5">#</span>解决方法</a>  </li> </ul> </li> </ul> </li><li class=""> <a aria-label="Scroll to section: 性能优化" class="block line-clamp-2 hover:text-accent mt-3" href="#性能优化"><span class="me-0.5">#</span>性能优化</a> <ul> <li class="ms-2"> <a aria-label="Scroll to section: 建立索引的几个准则" class="block line-clamp-2 hover:text-accent mt-2 text-[0.6875rem]" href="#建立索引的几个准则"><span class="me-0.5">#</span>建立索引的几个准则</a>  </li><li class="ms-2"> <a aria-label="Scroll to section: count的优化" class="block line-clamp-2 hover:text-accent mt-2 text-[0.6875rem]" href="#count的优化"><span class="me-0.5">#</span>count的优化</a>  </li><li class="ms-2"> <a aria-label="Scroll to section: 避免使用不兼容的数据类型" class="block line-clamp-2 hover:text-accent mt-2 text-[0.6875rem]" href="#避免使用不兼容的数据类型"><span class="me-0.5">#</span>避免使用不兼容的数据类型</a>  </li><li class="ms-2"> <a aria-label="Scroll to section: 索引字段上进行运算会使索引失效" class="block line-clamp-2 hover:text-accent mt-2 text-[0.6875rem]" href="#索引字段上进行运算会使索引失效"><span class="me-0.5">#</span>索引字段上进行运算会使索引失效</a>  </li><li class="ms-2"> <a aria-label="Scroll to section: 避免使用某些操作符" class="block line-clamp-2 hover:text-accent mt-2 text-[0.6875rem]" href="#避免使用某些操作符"><span class="me-0.5">#</span>避免使用某些操作符</a>  </li><li class="ms-2"> <a aria-label="Scroll to section: 尽量使用数字型字段" class="block line-clamp-2 hover:text-accent mt-2 text-[0.6875rem]" href="#尽量使用数字型字段"><span class="me-0.5">#</span>尽量使用数字型字段</a>  </li><li class="ms-2"> <a aria-label="Scroll to section: 合理使用EXISTS、NOT EXISTS子句" class="block line-clamp-2 hover:text-accent mt-2 text-[0.6875rem]" href="#合理使用existsnot-exists子句"><span class="me-0.5">#</span>合理使用EXISTS、NOT EXISTS子句</a>  </li><li class="ms-2"> <a aria-label="Scroll to section: 避免使用一些语句" class="block line-clamp-2 hover:text-accent mt-2 text-[0.6875rem]" href="#避免使用一些语句"><span class="me-0.5">#</span>避免使用一些语句</a>  </li><li class="ms-2"> <a aria-label="Scroll to section: 必要时强制查询优化器使用某个索引" class="block line-clamp-2 hover:text-accent mt-2 text-[0.6875rem]" href="#必要时强制查询优化器使用某个索引"><span class="me-0.5">#</span>必要时强制查询优化器使用某个索引</a>  </li><li class="ms-2"> <a aria-label="Scroll to section: 消除对大型表行数据的顺序存取" class="block line-clamp-2 hover:text-accent mt-2 text-[0.6875rem]" href="#消除对大型表行数据的顺序存取"><span class="me-0.5">#</span>消除对大型表行数据的顺序存取</a>  </li><li class="ms-2"> <a aria-label="Scroll to section: 避免使用非打头字母搜索" class="block line-clamp-2 hover:text-accent mt-2 text-[0.6875rem]" href="#避免使用非打头字母搜索"><span class="me-0.5">#</span>避免使用非打头字母搜索</a>  </li><li class="ms-2"> <a aria-label="Scroll to section: 建议" class="block line-clamp-2 hover:text-accent mt-2 text-[0.6875rem]" href="#建议"><span class="me-0.5">#</span>建议</a>  </li><li class="ms-2"> <a aria-label="Scroll to section: 能用UNION ALL就不要用UNION" class="block line-clamp-2 hover:text-accent mt-2 text-[0.6875rem]" href="#能用union-all就不要用union"><span class="me-0.5">#</span>能用UNION ALL就不要用UNION</a>  </li><li class="ms-2"> <a aria-label="Scroll to section: 字段数据类型优化" class="block line-clamp-2 hover:text-accent mt-2 text-[0.6875rem]" href="#字段数据类型优化"><span class="me-0.5">#</span>字段数据类型优化</a>  </li><li class="ms-2"> <a aria-label="Scroll to section: 一次性插入多条数据" class="block line-clamp-2 hover:text-accent mt-2 text-[0.6875rem]" href="#一次性插入多条数据"><span class="me-0.5">#</span>一次性插入多条数据</a>  </li><li class="ms-2"> <a aria-label="Scroll to section: 无意义语句" class="block line-clamp-2 hover:text-accent mt-2 text-[0.6875rem]" href="#无意义语句"><span class="me-0.5">#</span>无意义语句</a>  </li><li class="ms-2"> <a aria-label="Scroll to section: ORDER BY语句的MySQL优化" class="block line-clamp-2 hover:text-accent mt-2 text-[0.6875rem]" href="#order-by语句的mysql优化"><span class="me-0.5">#</span>ORDER BY语句的MySQL优化</a>  </li> </ul> </li><li class=""> <a aria-label="Scroll to section: 面试须知" class="block line-clamp-2 hover:text-accent mt-3" href="#面试须知"><span class="me-0.5">#</span>面试须知</a> <ul> <li class="ms-2"> <a aria-label="Scroll to section: 什么是BufferPool" class="block line-clamp-2 hover:text-accent mt-2 text-[0.6875rem]" href="#什么是bufferpool"><span class="me-0.5">#</span>什么是BufferPool</a> <ul> <li class="ms-2"> <a aria-label="Scroll to section: 基本概念" class="block line-clamp-2 hover:text-accent mt-2 text-[0.6875rem]" href="#基本概念"><span class="me-0.5">#</span>基本概念</a>  </li><li class="ms-2"> <a aria-label="Scroll to section: 如何判断一个页是否在 Buffer Pool 中缓存" class="block line-clamp-2 hover:text-accent mt-2 text-[0.6875rem]" href="#如何判断一个页是否在-buffer-pool-中缓存"><span class="me-0.5">#</span>如何判断一个页是否在 Buffer Pool 中缓存</a>  </li> </ul> </li><li class="ms-2"> <a aria-label="Scroll to section: InnoDB引擎如何管理Page页" class="block line-clamp-2 hover:text-accent mt-2 text-[0.6875rem]" href="#innodb引擎如何管理page页"><span class="me-0.5">#</span>InnoDB引擎如何管理Page页</a> <ul> <li class="ms-2"> <a aria-label="Scroll to section: Page 页分类" class="block line-clamp-2 hover:text-accent mt-2 text-[0.6875rem]" href="#page-页分类"><span class="me-0.5">#</span>Page 页分类</a>  </li><li class="ms-2"> <a aria-label="Scroll to section: Page 页如何管理" class="block line-clamp-2 hover:text-accent mt-2 text-[0.6875rem]" href="#page-页如何管理"><span class="me-0.5">#</span>Page 页如何管理</a>  </li> </ul> </li><li class="ms-2"> <a aria-label="Scroll to section: 为什么写缓冲区,仅适用于非唯一普通索引页" class="block line-clamp-2 hover:text-accent mt-2 text-[0.6875rem]" href="#为什么写缓冲区仅适用于非唯一普通索引页"><span class="me-0.5">#</span>为什么写缓冲区,仅适用于非唯一普通索引页</a> <ul> <li class="ms-2"> <a aria-label="Scroll to section: change buffer 更新流程" class="block line-clamp-2 hover:text-accent mt-2 text-[0.6875rem]" href="#change-buffer-更新流程"><span class="me-0.5">#</span>change buffer 更新流程</a>  </li> </ul> </li><li class="ms-2"> <a aria-label="Scroll to section: MySQL为什么要改进LRU算法" class="block line-clamp-2 hover:text-accent mt-2 text-[0.6875rem]" href="#mysql为什么要改进lru算法"><span class="me-0.5">#</span>MySQL为什么要改进LRU算法</a> <ul> <li class="ms-2"> <a aria-label="Scroll to section: 普通 LRU 算法" class="block line-clamp-2 hover:text-accent mt-2 text-[0.6875rem]" href="#普通-lru-算法"><span class="me-0.5">#</span>普通 LRU 算法</a>  </li><li class="ms-2"> <a aria-label="Scroll to section: 普通 LRU 链表的优缺点" class="block line-clamp-2 hover:text-accent mt-2 text-[0.6875rem]" href="#普通-lru-链表的优缺点"><span class="me-0.5">#</span>普通 LRU 链表的优缺点</a>  </li><li class="ms-2"> <a aria-label="Scroll to section: 改进型 LRU 算法" class="block line-clamp-2 hover:text-accent mt-2 text-[0.6875rem]" href="#改进型-lru-算法"><span class="me-0.5">#</span>改进型 LRU 算法</a>  </li> </ul> </li><li class="ms-2"> <a aria-label="Scroll to section: 使用索引一定可以提升效率吗" class="block line-clamp-2 hover:text-accent mt-2 text-[0.6875rem]" href="#使用索引一定可以提升效率吗"><span class="me-0.5">#</span>使用索引一定可以提升效率吗</a>  </li><li class="ms-2"> <a aria-label="Scroll to section: 介绍一下Page页的结构" class="block line-clamp-2 hover:text-accent mt-2 text-[0.6875rem]" href="#介绍一下page页的结构"><span class="me-0.5">#</span>介绍一下Page页的结构</a>  </li><li class="ms-2"> <a aria-label="Scroll to section: 聚簇索引与非聚簇索引" class="block line-clamp-2 hover:text-accent mt-2 text-[0.6875rem]" href="#聚簇索引与非聚簇索引"><span class="me-0.5">#</span>聚簇索引与非聚簇索引</a> <ul> <li class="ms-2"> <a aria-label="Scroll to section: 聚簇索引(聚集索引)" class="block line-clamp-2 hover:text-accent mt-2 text-[0.6875rem]" href="#聚簇索引聚集索引"><span class="me-0.5">#</span>聚簇索引(聚集索引)</a>  </li><li class="ms-2"> <a aria-label="Scroll to section: 非聚簇索引" class="block line-clamp-2 hover:text-accent mt-2 text-[0.6875rem]" href="#非聚簇索引"><span class="me-0.5">#</span>非聚簇索引</a>  </li><li class="ms-2"> <a aria-label="Scroll to section: 聚簇索引的优点" class="block line-clamp-2 hover:text-accent mt-2 text-[0.6875rem]" href="#聚簇索引的优点"><span class="me-0.5">#</span>聚簇索引的优点</a>  </li><li class="ms-2"> <a aria-label="Scroll to section: 聚簇索引的缺点" class="block line-clamp-2 hover:text-accent mt-2 text-[0.6875rem]" href="#聚簇索引的缺点"><span class="me-0.5">#</span>聚簇索引的缺点</a>  </li> </ul> </li><li class="ms-2"> <a aria-label="Scroll to section: 索引有哪几种类型" class="block line-clamp-2 hover:text-accent mt-2 text-[0.6875rem]" href="#索引有哪几种类型"><span class="me-0.5">#</span>索引有哪几种类型</a>  </li><li class="ms-2"> <a aria-label="Scroll to section: 介绍一下最佳左前缀法则" class="block line-clamp-2 hover:text-accent mt-2 text-[0.6875rem]" href="#介绍一下最佳左前缀法则"><span class="me-0.5">#</span>介绍一下最佳左前缀法则</a>  </li><li class="ms-2"> <a aria-label="Scroll to section: 什么是索引下推" class="block line-clamp-2 hover:text-accent mt-2 text-[0.6875rem]" href="#什么是索引下推"><span class="me-0.5">#</span>什么是索引下推</a>  </li><li class="ms-2"> <a aria-label="Scroll to section: 什么是自适应哈希索引" class="block line-clamp-2 hover:text-accent mt-2 text-[0.6875rem]" href="#什么是自适应哈希索引"><span class="me-0.5">#</span>什么是自适应哈希索引</a>  </li><li class="ms-2"> <a aria-label="Scroll to section: 为什么LIKE以%开头索引会失效" class="block line-clamp-2 hover:text-accent mt-2 text-[0.6875rem]" href="#为什么like以开头索引会失效"><span class="me-0.5">#</span>为什么LIKE以%开头索引会失效</a> <ul> <li class="ms-2"> <a aria-label="Scroll to section: like 失效的原因" class="block line-clamp-2 hover:text-accent mt-2 text-[0.6875rem]" href="#like-失效的原因"><span class="me-0.5">#</span>like 失效的原因</a>  </li> </ul> </li><li class="ms-2"> <a aria-label="Scroll to section: 自增还是UUID 数据库主键的类型该如何选择" class="block line-clamp-2 hover:text-accent mt-2 text-[0.6875rem]" href="#自增还是uuid-数据库主键的类型该如何选择"><span class="me-0.5">#</span>自增还是UUID 数据库主键的类型该如何选择</a> <ul> <li class="ms-2"> <a aria-label="Scroll to section: auto_increment 的优点" class="block line-clamp-2 hover:text-accent mt-2 text-[0.6875rem]" href="#auto_increment-的优点"><span class="me-0.5">#</span>auto_increment 的优点</a>  </li><li class="ms-2"> <a aria-label="Scroll to section: auto_increment 的缺点" class="block line-clamp-2 hover:text-accent mt-2 text-[0.6875rem]" href="#auto_increment-的缺点"><span class="me-0.5">#</span>auto_increment 的缺点</a>  </li><li class="ms-2"> <a aria-label="Scroll to section: uuid 优点" class="block line-clamp-2 hover:text-accent mt-2 text-[0.6875rem]" href="#uuid-优点"><span class="me-0.5">#</span>uuid 优点</a>  </li><li class="ms-2"> <a aria-label="Scroll to section: uuid 缺点" class="block line-clamp-2 hover:text-accent mt-2 text-[0.6875rem]" href="#uuid-缺点"><span class="me-0.5">#</span>uuid 缺点</a>  </li><li class="ms-2"> <a aria-label="Scroll to section: uuid 和自增 id 的索引结构对比" class="block line-clamp-2 hover:text-accent mt-2 text-[0.6875rem]" href="#uuid-和自增-id-的索引结构对比"><span class="me-0.5">#</span>uuid 和自增 id 的索引结构对比</a>  </li> </ul> </li><li class="ms-2"> <a aria-label="Scroll to section: InnoDB与MyISAM的区别" class="block line-clamp-2 hover:text-accent mt-2 text-[0.6875rem]" href="#innodb与myisam的区别"><span class="me-0.5">#</span>InnoDB与MyISAM的区别</a>  </li><li class="ms-2"> <a aria-label="Scroll to section: B树和B+树的区别是什么" class="block line-clamp-2 hover:text-accent mt-2 text-[0.6875rem]" href="#b树和b树的区别是什么"><span class="me-0.5">#</span>B树和B+树的区别是什么</a> <ul> <li class="ms-2"> <a aria-label="Scroll to section: B-Tree 介绍" class="block line-clamp-2 hover:text-accent mt-2 text-[0.6875rem]" href="#b-tree-介绍"><span class="me-0.5">#</span>B-Tree 介绍</a>  </li><li class="ms-2"> <a aria-label="Scroll to section: B+Tree" class="block line-clamp-2 hover:text-accent mt-2 text-[0.6875rem]" href="#btree"><span class="me-0.5">#</span>B+Tree</a>  </li> </ul> </li><li class="ms-2"> <a aria-label="Scroll to section: 一个B+树中大概能存放多少条索引记录" class="block line-clamp-2 hover:text-accent mt-2 text-[0.6875rem]" href="#一个b树中大概能存放多少条索引记录"><span class="me-0.5">#</span>一个B+树中大概能存放多少条索引记录</a>  </li><li class="ms-2"> <a aria-label="Scroll to section: explain 有哪些主要字段" class="block line-clamp-2 hover:text-accent mt-2 text-[0.6875rem]" href="#explain-有哪些主要字段"><span class="me-0.5">#</span>explain 有哪些主要字段</a>  </li><li class="ms-2"> <a aria-label="Scroll to section: 如何进行分页查询优化" class="block line-clamp-2 hover:text-accent mt-2 text-[0.6875rem]" href="#如何进行分页查询优化"><span class="me-0.5">#</span>如何进行分页查询优化</a>  </li><li class="ms-2"> <a aria-label="Scroll to section: 分页优化方案" class="block line-clamp-2 hover:text-accent mt-2 text-[0.6875rem]" href="#分页优化方案"><span class="me-0.5">#</span>分页优化方案</a>  </li><li class="ms-2"> <a aria-label="Scroll to section: 如何做慢查询优化" class="block line-clamp-2 hover:text-accent mt-2 text-[0.6875rem]" href="#如何做慢查询优化"><span class="me-0.5">#</span>如何做慢查询优化</a> <ul> <li class="ms-2"> <a aria-label="Scroll to section: 慢查询SQL优化思路" class="block line-clamp-2 hover:text-accent mt-2 text-[0.6875rem]" href="#慢查询sql优化思路"><span class="me-0.5">#</span>慢查询SQL优化思路</a>  </li> </ul> </li><li class="ms-2"> <a aria-label="Scroll to section: Hash索引有哪些优缺点" class="block line-clamp-2 hover:text-accent mt-2 text-[0.6875rem]" href="#hash索引有哪些优缺点"><span class="me-0.5">#</span>Hash索引有哪些优缺点</a>  </li><li class="ms-2"> <a aria-label="Scroll to section: InnoDB内存相关的参数优化" class="block line-clamp-2 hover:text-accent mt-2 text-[0.6875rem]" href="#innodb内存相关的参数优化"><span class="me-0.5">#</span>InnoDB内存相关的参数优化</a>  </li><li class="ms-2"> <a aria-label="Scroll to section: InnoDB日志相关的参数优化" class="block line-clamp-2 hover:text-accent mt-2 text-[0.6875rem]" href="#innodb日志相关的参数优化"><span class="me-0.5">#</span>InnoDB日志相关的参数优化</a> <ul> <li class="ms-2"> <a aria-label="Scroll to section: 优化建议" class="block line-clamp-2 hover:text-accent mt-2 text-[0.6875rem]" href="#优化建议"><span class="me-0.5">#</span>优化建议</a>  </li> </ul> </li><li class="ms-2"> <a aria-label="Scroll to section: InnoDB IO线程相关参数优化" class="block line-clamp-2 hover:text-accent mt-2 text-[0.6875rem]" href="#innodb-io线程相关参数优化"><span class="me-0.5">#</span>InnoDB IO线程相关参数优化</a> <ul> <li class="ms-2"> <a aria-label="Scroll to section: 参数: query_cache_size &#38; have_auery_cache" class="block line-clamp-2 hover:text-accent mt-2 text-[0.6875rem]" href="#参数-query_cache_size--have_auery_cache"><span class="me-0.5">#</span>参数: query_cache_size &amp; have_auery_cache</a>  </li><li class="ms-2"> <a aria-label="Scroll to section: 查看查询缓存是否开启" class="block line-clamp-2 hover:text-accent mt-2 text-[0.6875rem]" href="#查看查询缓存是否开启"><span class="me-0.5">#</span>查看查询缓存是否开启</a>  </li><li class="ms-2"> <a aria-label="Scroll to section: 开启缓存,在 my.ini 中添加下面一行参数" class="block line-clamp-2 hover:text-accent mt-2 text-[0.6875rem]" href="#开启缓存在-myini-中添加下面一行参数"><span class="me-0.5">#</span>开启缓存,在 my.ini 中添加下面一行参数</a>  </li><li class="ms-2"> <a aria-label="Scroll to section: 测试能否缓存查询" class="block line-clamp-2 hover:text-accent mt-2 text-[0.6875rem]" href="#测试能否缓存查询"><span class="me-0.5">#</span>测试能否缓存查询</a>  </li><li class="ms-2"> <a aria-label="Scroll to section: 参数: innodb_max_dirty_pages_pct" class="block line-clamp-2 hover:text-accent mt-2 text-[0.6875rem]" href="#参数-innodb_max_dirty_pages_pct"><span class="me-0.5">#</span>参数: innodb_max_dirty_pages_pct</a>  </li><li class="ms-2"> <a aria-label="Scroll to section: 参数: innodb_old_blocks_pct &#38; innodb_old_blocks_time" class="block line-clamp-2 hover:text-accent mt-2 text-[0.6875rem]" href="#参数-innodb_old_blocks_pct--innodb_old_blocks_time"><span class="me-0.5">#</span>参数: innodb_old_blocks_pct &amp; innodb_old_blocks_time</a>  </li> </ul> </li><li class="ms-2"> <a aria-label="Scroll to section: 什么是写失效" class="block line-clamp-2 hover:text-accent mt-2 text-[0.6875rem]" href="#什么是写失效"><span class="me-0.5">#</span>什么是写失效</a> <ul> <li class="ms-2"> <a aria-label="Scroll to section: 双写缓冲区 Doublewrite Buffer" class="block line-clamp-2 hover:text-accent mt-2 text-[0.6875rem]" href="#双写缓冲区-doublewrite-buffer"><span class="me-0.5">#</span>双写缓冲区 Doublewrite Buffer</a>  </li><li class="ms-2"> <a aria-label="Scroll to section: 为什么写两次" class="block line-clamp-2 hover:text-accent mt-2 text-[0.6875rem]" href="#为什么写两次"><span class="me-0.5">#</span>为什么写两次</a>  </li> </ul> </li><li class="ms-2"> <a aria-label="Scroll to section: 什么是行溢出" class="block line-clamp-2 hover:text-accent mt-2 text-[0.6875rem]" href="#什么是行溢出"><span class="me-0.5">#</span>什么是行溢出</a> <ul> <li class="ms-2"> <a aria-label="Scroll to section: 行记录格式" class="block line-clamp-2 hover:text-accent mt-2 text-[0.6875rem]" href="#行记录格式"><span class="me-0.5">#</span>行记录格式</a>  </li> </ul> </li><li class="ms-2"> <a aria-label="Scroll to section: 如何进行JOIN优化" class="block line-clamp-2 hover:text-accent mt-2 text-[0.6875rem]" href="#如何进行join优化"><span class="me-0.5">#</span>如何进行JOIN优化</a> <ul> <li class="ms-2"> <a aria-label="Scroll to section: 什么是驱动表" class="block line-clamp-2 hover:text-accent mt-2 text-[0.6875rem]" href="#什么是驱动表"><span class="me-0.5">#</span>什么是驱动表</a>  </li><li class="ms-2"> <a aria-label="Scroll to section: 三种 JOIN 算法" class="block line-clamp-2 hover:text-accent mt-2 text-[0.6875rem]" href="#三种-join-算法"><span class="me-0.5">#</span>三种 JOIN 算法</a>  </li> </ul> </li><li class="ms-2"> <a aria-label="Scroll to section: 索引哪些情况下会失效" class="block line-clamp-2 hover:text-accent mt-2 text-[0.6875rem]" href="#索引哪些情况下会失效"><span class="me-0.5">#</span>索引哪些情况下会失效</a>  </li><li class="ms-2"> <a aria-label="Scroll to section: 什么是覆盖索引" class="block line-clamp-2 hover:text-accent mt-2 text-[0.6875rem]" href="#什么是覆盖索引"><span class="me-0.5">#</span>什么是覆盖索引</a>  </li><li class="ms-2"> <a aria-label="Scroll to section: 介绍一下MySQL中事务的特性" class="block line-clamp-2 hover:text-accent mt-2 text-[0.6875rem]" href="#介绍一下mysql中事务的特性"><span class="me-0.5">#</span>介绍一下MySQL中事务的特性</a> <ul> <li class="ms-2"> <a aria-label="Scroll to section: MySQL的可重复读怎么实现的" class="block line-clamp-2 hover:text-accent mt-2 text-[0.6875rem]" href="#mysql的可重复读怎么实现的"><span class="me-0.5">#</span>MySQL的可重复读怎么实现的</a>  </li><li class="ms-2"> <a aria-label="Scroll to section: undo log 多版本链" class="block line-clamp-2 hover:text-accent mt-2 text-[0.6875rem]" href="#undo-log-多版本链"><span class="me-0.5">#</span>undo log 多版本链</a>  </li><li class="ms-2"> <a aria-label="Scroll to section: ReadView" class="block line-clamp-2 hover:text-accent mt-2 text-[0.6875rem]" href="#readview"><span class="me-0.5">#</span>ReadView</a>  </li><li class="ms-2"> <a aria-label="Scroll to section: MySQL AP 和 CP" class="block line-clamp-2 hover:text-accent mt-2 text-[0.6875rem]" href="#mysql-ap-和-cp"><span class="me-0.5">#</span>MySQL AP 和 CP</a>  </li> </ul> </li> </ul> </li> </ul> </aside> <article class="flex-grow break-words" data-pagefind-body> <div id="blog-hero"><h1 class="title mb-3 sm:mb-1"> Mysql </h1> <div class="flex flex-wrap items-center gap-x-3 gap-y-2"> <p class="font-semibold"> <time datetime="2022-09-25T15:20:35.000Z"> September 25, 2022 </time> /  193 min read </p> <span class="rounded-lg bg-quote/10 p-1 text-quote">
Last Updated:
<time datetime="2024-05-16T14:00:40.000Z" class="ms-1"> May 16, 2024 </time> </span> </div> <div class="mt-3"> <svg aria-hidden="true" class="inline-block h-6 w-6" fill="none" focusable="false" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"> <path d="M0 0h24v24H0z" fill="none" stroke="none"></path> <path d="M7.859 6h-2.834a2.025 2.025 0 0 0 -2.025 2.025v2.834c0 .537 .213 1.052 .593 1.432l6.116 6.116a2.025 2.025 0 0 0 2.864 0l2.834 -2.834a2.025 2.025 0 0 0 0 -2.864l-6.117 -6.116a2.025 2.025 0 0 0 -1.431 -.593z"></path> <path d="M17.573 18.407l2.834 -2.834a2.025 2.025 0 0 0 0 -2.864l-7.117 -7.116"></path> <path d="M6 9h-.01"></path> </svg>  <a aria-label="View more blogs with the tag java" class="cactus-link inline-block before:content-['#']" data-pagefind-filter="tag" href="/astro-theme-cactus/tags/java/"> java </a> ,  <a aria-label="View more blogs with the tag mysql" class="cactus-link inline-block before:content-['#']" data-pagefind-filter="tag" href="/astro-theme-cactus/tags/mysql/"> mysql </a>  </div></div> <div class="prose prose-sm prose-cactus mt-12 prose-headings:font-semibold prose-headings:text-accent-2 prose-headings:before:absolute prose-headings:before:-ms-4 prose-headings:before:text-accent prose-headings:before:content-['#'] prose-th:before:content-none">  <h2 id="mysql-innodb">Mysql InnoDB</h2>
<p>MYSQL InnoDB二级索引存储主键值而不是存储行指针的优点与缺点。</p>
<blockquote>
<p>优点:</p>
<ul>
<li>减少了出现行移动或者数据页分裂时二级索引的维护工作(当数据需要更新的时候,二级索引不需要修改,只需要修改聚簇索引,一个表只能有一个聚簇索引,其他的都是二级索引,这样只需要修改聚簇索引就可以了,不需要重新构建二级索引)</li>
</ul>
<p>缺点:</p>
<ul>
<li>二级索引体积可能会变大,因为二级索引中存储了主键的信息</li>
<li>二级索引的访问需要两次索引查找。第一次通过查找 <em>二级索引</em> 找二级索引中叶子节点存储的 <em>主键的值</em>;第二次通过这个主键的值去
<strong><em>聚簇索引</em></strong> 中查找对应的行</li>
</ul>
</blockquote>
<h3 id="innodb-简介">InnoDB 简介</h3>
<p>InnoDB是一个将表中的数据存储到磁盘上的存储引擎。而真正处理数据的过程是发生在内存中的,所以需要把磁盘中的数据加载到内存中,如果是处理写入或修改请求的话,还需要把内存中的内容刷新到磁盘上。而我们知道读写磁盘的速度非常慢,和内存读写差了几个数量级。所以当我们想从表中获取某些记录时,InnoDB存储引擎需要一条一条的把记录从磁盘上读出来么?想要了解这个问题,我们首先需要了解InnoDB的存储结构是怎样的。</p>
<img src="https://cdn.jsdelivr.net/gh/chou401/pic-md@main/img/image-20230703165807448.png" alt="image-20230703165807448"/>
<p>InnoDB采取的方式是: 将数据划分为若干个页,以页作为磁盘和内存之间交互的基本单位innodb_page_size选项指定了MySQL实例的所有InnoDB表空间的页面大小。这个值是在创建实例时设置的,之后保持不变。有效值为64KB,32KB,16KB(默认值 ),8kB和4kB。也就是在一般情况下,一次最少从磁盘中读取16KB的内容到内存中,一次最少把内存中的16KB内容刷新到磁盘中。</p>
<h3 id="innodb-的行格式">InnoDB 的行格式</h3>
<p>我们平时是以记录为单位来向表中插入数据的,这些记录在磁盘上的存放方式也被称为行格式或者记录格式。一行记录可以以不同的格式存在InnoDB中,行格式分别是compact、redundant、dynamic和compressed行格式。可以在创建或修改的语句中指定行格式:</p>
<blockquote>
<p>— 创建数据表时,显示指定行格式CREATE TABLE 表名 (列的信息) ROW_FORMAT=行格式名称;</p>
<p>— 创建数据表时,修改行格式ALTER TABLE 表名 ROW_FORMAT=行格式名称;</p>
<p>— 查看数据表的行格式show table status like ”;</p>
</blockquote>
<p>mysql5.0之前默认的行格式是redundant,mysql5.0之后的默认行格式为compact , 5.7之后的默认行格式为dynamic。</p>
<h4 id="compact-格式">compact 格式</h4>
<img src="https://cdn.jsdelivr.net/gh/chou401/pic-md@main/img/859ab55da7e84b9da3ec34cd4ca9d611.png" alt="img"/>
<h5 id="变长字段长度列表">变长字段长度列表</h5>
<p>我们知道 MySQL 支持一些变长的数据类型,比如 VARCHAR(M) 、 VARBINARY(M) 、各种 TEXT 类型,各种 BLOB 类型,我们也可以把拥有这些数据类型的列称为 变长字段 ,变长字段中存储多少字节的数据是不固定的,所以我们在存储真实数据的时候需要顺便把这些数据占用的字节数也存起来,这样才不至于把 MySQL 服务器搞懵,所以这些变长字段占用的存储空间分为两部分:</p>
<ol>
<li>真正的数据内容</li>
<li>占用的字节数</li>
</ol>
<p>在 Compact 行格式中,把所有变长字段的真实数据占用的字节长度都存放在记录的开头部位,从而形成一个变长字段长度列表,各变长字段数据占用的字节数按照列的顺序逆序存放。</p>
<p>举个例子:</p>
<blockquote>
<p>一个表中有c1、c2、c3三列数据为varchar,其中有一行数据存储了(“1234”,“123”,“1”),它们分别的字符长度就为04、03、01,若其使用ascii字符集存储,则每个的字节大小为,04、03、01(ascii用一字节表示一个字符,utf-8为3字节),则这一行在”变长字段长度列表“中存储的则为”01 03 04“(实际存储为二进制且没有空格)</p>
</blockquote>
<p>由于上面的字符串都比较短,也就是说内容占用的字节数比较小,用1个字节就可以表示,但是如果变长列的内容占用的字节数比较多,可能就需要用2个字节来表示。具体用1个还是2个字节来表示真实数据占用的字节数, InnoDB 有它的一套规则,首先我们声明一下 W 、 M 和 L 的意思:</p>
<blockquote>
<p>假设某个字符集中表示一个字符最多需要使用的字节数为 W ,比方说 utf8 字符集中的 W 就是 1-3 , ascii 字符集中的 W 就是1 。
对于 VARCHAR(M) 来说,表示此列最多能储存 M 个字符,所以这个类型能表示的字符串最多占用的字节数就是 M×W 。(比如: 对于一个字符串”aaa“使用ascii表示则占用1<em>3个字节,而对于utf-8则为3</em>3个字节)
假设某字符串实际占用的字节数是 L 。</p>
</blockquote>
<p>基于以上的声明,则使用1字节还是2 字节来表示变长字段长度的规则为:</p>
<ul>
<li>如果一个字段最长可以储存的字节数小于等于255 B,即<code>W*M &lt;= 255</code>: 使用一个字节表示</li>
<li>如果W*M &gt; 255 B,则分为两种情况:
<ul>
<li>若L ≤ 127 B 则用1字节表示</li>
<li>若L &gt; 127 B 则用2字节表示</li>
</ul>
</li>
</ul>
<p>此外,innoDB使用 字节的第一位作为标志位,如果第一位为0,则此字节就是一个单独的字段长度。如果为1,则该字节为半个字段长度。</p>
<p>对于一些占用字节数非常多的字段,比方说某个字段长度大于了16KB,那么如果该记录在单个页面中无法存储时,InnoDB会把一部分数据存放到所谓的溢出页中,在变长字段长度列表处只存储留在本页面中的长度,所以使用两个字节也可以存放下来。</p>
<p>另外需要注意的一点是,变长字段长度列表中只存储值为 非NULL 的列内容占用的长度,值为 NULL 的列的长度是不储存的 。</p>
<p>字符集utf-8,英文字符占用1个字节,中文字符3字节,对于char类型来说,若使用utf-8字符集,则char也属于 可变长字段</p>
<h5 id="null值列表">NULL值列表</h5>
<p>我们知道表中的某些列可能存储 NULL 值,如果把这些 NULL 值都放到记录的真实数据中存储会很占地方,所以 Compact 行格式把这些值为 NULL 的列统一管理起来,存储到 NULL 值列表中,它的处理过程是这样的:</p>
<ol>
<li>
<p>首先统计表中允许存储 NULL 的列有哪些。我们前边说过,主键列、被 NOT NULL 修饰的列都是不可以存储 NULL 值的,所以在统计的时候不会把这些列算进去。</p>
</li>
<li>
<p>如果表中没有允许存储 NULL 的列,则 NULL值列表不存在。若允许,则将每个允许存储 NULL 的列对应一个二进制位,二进制位按照列的顺序逆序排列: 二进制位的值为 1 时,代表该列的值为 NULL 。二进制位的值为 0 时,代表该列的值不为 NULL 。</p>
</li>
<li>
<p>MySQL 规定 NULL值列表 必须用整数个字节的位表示,如果使用的二进制位个数不是整数个字节,则在字节的高位补 0 。即若一个表有9个值允许为null,则这个记录null值列表的部分需要用 2 字节表示。</p>
</li>
</ol>
<p><strong>举个例子</strong>: 若有一张表,有c1 c2 c3 c4四个字段,其中c2 被NOT NULL修饰,则其NULL值列表 表示如下:</p>
<img src="https://cdn.jsdelivr.net/gh/chou401/pic-md@main/img/4f4a765331f84efda30d2ae165f45707.png" alt="img"/>
<h5 id="记录头信息">记录头信息</h5>
<p>记录头信息部分如下图所示:</p>
<img src="https://cdn.jsdelivr.net/gh/chou401/pic-md@main/img/d35c888d876641768d782acb0e6668d3.png" alt="img"/>
<img src="https://cdn.jsdelivr.net/gh/chou401/pic-md@main/img/9fac7f2392674842aba39dc969dfa126.png" alt="img"/>
<img src="https://cdn.jsdelivr.net/gh/chou401/pic-md@main/img/aef632ad1be7455ab7e23909f68255f1.png" alt="img"/>
<p>我们使用如下的sql语句插入几行数据:</p>
<div class="expressive-code"><link rel="stylesheet" href="/astro-theme-cactus/_astro/ec.v6sg1.css"/><script type="module" src="/astro-theme-cactus/_astro/ec.3zb7u.js"></script><figure class="frame"><figcaption class="header"></figcaption><pre data-language="sql"><code><div class="ec-line"><div class="code"><span style="--0:#FF79C6;--1:#BF3441">INSERT INTO</span><span style="--0:#F8F8F2;--1:#24292E"> page_demo</span></div></div><div class="ec-line"><div class="code"><span style="--0:#FF79C6;--1:#BF3441">VALUES</span></div></div><div class="ec-line"><div class="code"><span style="--0:#F8F8F2;--1:#24292E">(</span><span style="--0:#BD93F9;--1:#005CC5">1</span><span style="--0:#F8F8F2;--1:#24292E">, </span><span style="--0:#BD93F9;--1:#005CC5">100</span><span style="--0:#F8F8F2;--1:#24292E">, </span><span style="--1:#032F62"><span style="--0:#E9F284">&#39;</span><span style="--0:#F1FA8C">aaaa</span><span style="--0:#E9F284">&#39;</span></span><span style="--0:#F8F8F2;--1:#24292E">),</span></div></div><div class="ec-line"><div class="code"><span style="--0:#F8F8F2;--1:#24292E">(</span><span style="--0:#BD93F9;--1:#005CC5">2</span><span style="--0:#F8F8F2;--1:#24292E">, </span><span style="--0:#BD93F9;--1:#005CC5">200</span><span style="--0:#F8F8F2;--1:#24292E">, </span><span style="--1:#032F62"><span style="--0:#E9F284">&#39;</span><span style="--0:#F1FA8C">bbbb</span><span style="--0:#E9F284">&#39;</span></span><span style="--0:#F8F8F2;--1:#24292E">),</span></div></div><div class="ec-line"><div class="code"><span style="--0:#F8F8F2;--1:#24292E">(</span><span style="--0:#BD93F9;--1:#005CC5">3</span><span style="--0:#F8F8F2;--1:#24292E">, </span><span style="--0:#BD93F9;--1:#005CC5">300</span><span style="--0:#F8F8F2;--1:#24292E">, </span><span style="--1:#032F62"><span style="--0:#E9F284">&#39;</span><span style="--0:#F1FA8C">cccc</span><span style="--0:#E9F284">&#39;</span></span><span style="--0:#F8F8F2;--1:#24292E">),</span></div></div><div class="ec-line"><div class="code"><span style="--0:#F8F8F2;--1:#24292E">(</span><span style="--0:#BD93F9;--1:#005CC5">4</span><span style="--0:#F8F8F2;--1:#24292E">, </span><span style="--0:#BD93F9;--1:#005CC5">400</span><span style="--0:#F8F8F2;--1:#24292E">, </span><span style="--1:#032F62"><span style="--0:#E9F284">&#39;</span><span style="--0:#F1FA8C">dddd</span><span style="--0:#E9F284">&#39;</span></span><span style="--0:#F8F8F2;--1:#24292E">);</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="INSERT INTO page_demoVALUES(1, 100, 'aaaa'),(2, 200, 'bbbb'),(3, 300, 'cccc'),(4, 400, 'dddd');"><div></div></button></div></figure></div>
<p>则它们这几条数据记录在 页 的 User Records 部分为:</p>
<img src="https://cdn.jsdelivr.net/gh/chou401/pic-md@main/img/ae0a8a7826e4429683f2c12de76760a1.png" alt="img"/>
<h6 id="delete_mask">delete_mask</h6>
<p>这个属性标记着当前记录是否被删除,占用1个二进制位,值为 0 的时候代表记录并没有被删除,为 1 的时候代表记录被删除掉了。</p>
<p>被删除的记录还在页中。这些被删除的记录之所以不立即从磁盘上移除,是因为移除它们之后把其他的记录在磁盘上重新排列需要性能消耗,所以只是打一个删除标记而已,所有被删除掉的记录都会组成一个所谓的 <strong>垃圾链表</strong> ,在这个链表中的记录占用的空间称之为所谓的 <strong>可重用空间</strong> ,之后如果有新记录插入到表中的话,可能把这些被删除的记录占用的存储空间覆盖掉。</p>
<p>将这个delete_mask位设置为1和将被删除的记录加入到垃圾链表中其实是两个阶段。</p>
<h6 id="min_rec_mask">min_rec_mask</h6>
<p>B+树的每层非叶子节点中的最小记录都会添加该标记。上方插入的四条记录的 min_rec_mask 值都是 0 ,意味着它们都不是 B+ 树的非叶子节点中的最小记录。</p>
<h6 id="n_owned">n_owned</h6>
<p>当前组的最大记录,记录当前组有几个元素的字段。</p>
<h6 id="heap_no">heap_no</h6>
<p>在数据页的User Records中插入的记录是一条一条紧凑的排列的,这种紧凑排列的结构又被称为<strong>堆</strong>。为了便于管理这个堆,把记录在堆中的相对位置给定一个编号——heap_no。所以heap_no这个属性表示当前记录在本页中的位置。</p>
<p>在例子中,插入的4条记录在本页中的位置分别是: 2 、3 、4 、5。为什么没有0和1呢?</p>
<p>是因为每个页里面加了两个记录,这两个记录并不是我们自己插入的,所以有时候也称为<strong>伪记录</strong>或者<strong>虚拟记录</strong>。这两个伪记录一个代表<strong>最小记录</strong> Infimum,一个代表<strong>最大记录</strong>Supremum,对应的heap_no分别为0和1。</p>
<p>记录可以比较大小,对于一条完整的记录来说,比较记录的大小就是比较主键的大小。</p>
<p>不管我们向页中插入了多少记录,InnoDB 规定任何用户记录都要比最小记录大,比最大记录小。这两条记录的构造,都是由5字节大小的记录头信息和8字节大小的固定部分组成的,如图:</p>
<img src="https://cdn.jsdelivr.net/gh/chou401/pic-md@main/img/image-20230703174800471.png" alt="image-20230703174800471"/>
<p>最大最小记录不是自己定义的记录,所以它们并不存放在页的User Records 部分,而是被单独放在一个称为Infimum + Supremum 的部分,如图所示:</p>
<img src="https://cdn.jsdelivr.net/gh/chou401/pic-md@main/img/image-20230703174836315.png" alt="image-20230703174836315"/>
<p>从图中可以看出来,最小记录和最大记录的heap_no 值分别是0 和1 ,也就是说它们的位置也在Uesr Records前面。</p>
<h6 id="record_type">record_type</h6>
<p>这个属性表示当前记录的类型,一共有4种类型的记录, 0 表示普通用户记录, 1 表示B+树非叶节点记录, 2 表示最小记录, 3 表示最大记录。</p>
<h6 id="next_record">next_record</h6>
<p>这个属性非常重要！！它表示从当前记录的真实数据到下一条记录的真实数据的地址偏移量,可以理解为指向下一条记录地址的指针。值为正数说明下一条记录在当前记录后面,为负数说明下一条记录在当前记录的前面。比方说第1条记录的next_record 值为32 ,意味着从第1条记录的真实数据的地址处向后找32 个字节便是下一条记录的真实数据。这里的下一条记录指得并不是按照我们插入顺序的下一条记录,而是按照主键值由小到大的顺序的下一条记录。</p>
<img src="https://cdn.jsdelivr.net/gh/chou401/pic-md@main/img/image-20230703175113161.png" alt="image-20230703175113161"/>
<p>从图中可以看出来,我们的记录按照主键从小到大的顺序形成了一个单链表。最大记录的next_record 的值为0 ,这也就是说最大记录是没有下一条记录了,它是这个单链表中的最后一个节点。</p>
<p>如果从中删除掉一条记录,这个链表也是会跟着变化的,比如我们把第2条记录删掉:</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="sql"><code><div class="ec-line"><div class="code"><span style="--0:#FF79C6;--1:#BF3441">DELETE</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">FROM</span><span style="--0:#F8F8F2;--1:#24292E"> page_demo </span><span style="--0:#FF79C6;--1:#BF3441">WHERE</span><span style="--0:#F8F8F2;--1:#24292E"> c1 </span><span style="--0:#FF79C6;--1:#BF3441">=</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#BD93F9;--1:#005CC5">2</span><span style="--0:#F8F8F2;--1:#24292E">;</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="DELETE FROM page_demo WHERE c1 = 2;"><div></div></button></div></figure></div>
<p>删掉第2条记录后的示意图就是:</p>
<img src="https://cdn.jsdelivr.net/gh/chou401/pic-md@main/img/image-20230703175303142.png" alt="image-20230703175303142"/>
<p>从图中可以看出来,删除第2条记录前后主要发生的变化:</p>
<ul>
<li>被删记录没有从存储空间中移除,而是把该记录的delete_mask 设置为1 ,next_record 变为0;</li>
<li>被删记录的前一条记录的next_record 指向后一条记录: 第1条记录的next_record 指向了第3条记录;</li>
<li>最大记录的n_owned 值减1。</li>
</ul>
<p>所以,不论我们怎么对页中的记录做增删改操作,InnoDB始终会维护一条记录的单链表,链表中的各个节点是按照主键值由小到大的顺序连接起来的。并规定 Infimum记录(也就是最小记录) 的下一条记录就是本页中主键值最小的用户记录,而本页中主键值最大的用户记录的下一条记录就是 Supremum记录(也就是最大记录)。</p>
<p>而当我们再次插入第二条记录的时候 不会申请新的空间,而是直接连接被删的记录的next_record。</p>
<h5 id="默认隐藏列信息">默认隐藏列信息</h5>
<p>MySQL 会为每个记录默认的添加一些列(也称为 隐藏列 )</p>
<img src="https://cdn.jsdelivr.net/gh/chou401/pic-md@main/img/e3ed90eaaf7747c49acfc2c59225a1d2.png" alt="img"/>
<p>实际上这几个列的真正名称其实是: DB_ROW_ID、DB_TRX_ID、DB_ROLL_PTR,我们为了美观才写成了row_id、transaction_id和roll_pointer。</p>
<p>row_id是可选的,表中没有主键的,则选取一个 Unique 键作为主键。如果表中连 Unique 键都没有定义的话,则 InnoDB 会为表默认添加一个名为row_id 的隐藏列作为主键。</p>
<p>roll_pointer 是一个指向记录对应的 undo日志 的一个指针。</p>
<img src="https://cdn.jsdelivr.net/gh/chou401/pic-md@main/img/05aa65d74e8e4f1481eb7409fca14f96.png" alt="img"/>
<h5 id="行溢出的数据">行溢出的数据</h5>
<p>我们知道对于 VARCHAR(M) 类型的列最多可以占用 65535 个字节。其中的 M 代表该类型最多存储的字符数量,如果我们使用 ascii 字符集的话,一个字符就代表一个字节。但是实际上,创建一张表并设置一个字段为<code>VARCHAR(65535)</code>则会报错。</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="sql"><code><div class="ec-line"><div class="code"><span style="--0:#FF79C6;--1:#BF3441">CREATE</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">TABLE</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#50FA7B;--1:#6F42C1">varchar_size_demo</span><span style="--0:#F8F8F2;--1:#24292E">(</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#F8F8F2;--1:#24292E">    </span></span><span style="--0:#F8F8F2;--1:#24292E">c </span><span style="--0:#FF79C6;--1:#BF3441">VARCHAR</span><span style="--0:#F8F8F2;--1:#24292E">(</span><span style="--0:#BD93F9;--1:#005CC5">65535</span><span style="--0:#F8F8F2;--1:#24292E">)</span></div></div><div class="ec-line"><div class="code"><span style="--0:#F8F8F2;--1:#24292E">) CHARSET</span><span style="--0:#FF79C6;--1:#BF3441">=</span><span style="--0:#F8F8F2;--1:#24292E">ascii ROW_FORMAT</span><span style="--0:#FF79C6;--1:#BF3441">=</span><span style="--0:#F8F8F2;--1:#24292E">Compact;</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#F8F8F2;--1:#24292E">ERROR </span><span style="--0:#BD93F9;--1:#005CC5">1118</span><span style="--0:#F8F8F2;--1:#24292E"> (</span><span style="--0:#BD93F9;--1:#005CC5">42000</span><span style="--0:#F8F8F2;--1:#24292E">): </span><span style="--0:#FF79C6;--1:#BF3441">Row</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">size</span><span style="--0:#F8F8F2;--1:#24292E"> too large. The maximum </span><span style="--0:#FF79C6;--1:#BF3441">row</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">size</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">for</span><span style="--0:#F8F8F2;--1:#24292E"> the used </span><span style="--0:#FF79C6;--1:#BF3441">table</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">type</span><span style="--0:#F8F8F2;--1:#24292E">, </span><span style="--0:#FF79C6;--1:#BF3441">not</span></div></div><div class="ec-line"><div class="code"><span style="--0:#F8F8F2;--1:#24292E">counting BLOBs, </span><span style="--0:#FF79C6;--1:#BF3441">is</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#BD93F9;--1:#005CC5">65535</span><span style="--0:#F8F8F2;--1:#24292E">. This includes storage overhead, </span><span style="--0:#FF79C6;--1:#BF3441">check</span><span style="--0:#F8F8F2;--1:#24292E"> the </span><span style="--0:#FF79C6;--1:#BF3441">manual</span><span style="--0:#F8F8F2;--1:#24292E">. You have </span><span style="--0:#FF79C6;--1:#BF3441">to</span><span style="--0:#F8F8F2;--1:#24292E"> c</span></div></div><div class="ec-line"><div class="code"><span style="--0:#F8F8F2;--1:#24292E">hange some columns </span><span style="--0:#FF79C6;--1:#BF3441">to</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">TEXT</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">or</span><span style="--0:#F8F8F2;--1:#24292E"> BLOBs</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="CREATE TABLE varchar_size_demo(    c VARCHAR(65535)) CHARSET=ascii ROW_FORMAT=Compact;ERROR 1118 (42000): Row size too large. The maximum row size for the used table type, notcounting BLOBs, is 65535. This includes storage overhead, check the manual. You have to change some columns to TEXT or BLOBs"><div></div></button></div></figure></div>
<p>从报错信息里可以看出, MySQL 对一条记录占用的最大存储空间是有限制的,除了 BLOB 或者 TEXT 类型的列之外,其他所有的列(不包括隐藏列和记录头信息)占用的字节长度加起来不能超过 65535 个字节。所以 MySQL 服务器建议我们把存储类型改为 TEXT 或者 BLOB 的类型。这个 65535 个字节除了列本身的数据之外,还包括一些其他的数据( storage overhead ),比如说我们为了存储一个 VARCHAR(M) 类型的列,其实需要占用3部分存储空间:</p>
<ul>
<li>真实数据</li>
<li>真实数据占用字节的长度</li>
<li>NULL 值标识,如果该列有 NOT NULL 属性则可以没有这部分存储空间</li>
</ul>
<p>如果该 VARCHAR 类型的列没有 NOT NULL 属性,那最多只能存储 65532 个字节的数据,因为真实数据的长度可能占用2个字节, NULL 值标识需要占用1个字节。</p>
<p>如果 VARCHAR 类型的列有 NOT NULL 属性,那最多只能存储 65533 个字节的数据,因为真实数据的长度可能占用2个字节,不需要 NULL 值标识。</p>
<p>相应的,如果不使用ascii字符集,而使用utf-8的话,则要按照3个字节一个字符来计算。</p>
<blockquote>
<p>另外,这里我们只讨论了一张表只有一个字段的情况,实际上是一行数据最多只能储存上面那些字节。</p>
</blockquote>
<h5 id="记录中的数据太多产生的溢出">记录中的数据太多产生的溢出</h5>
<p>我们知道,一页最大为16KB也就是16384字节,而一个varchar类型的列最多可以储存65532字节,这样就可能造成一张数据页放不了一行数据的情况。</p>
<p>在 Compact 和 Reduntant 行格式中,对于占用存储空间非常大的列,在记录的真实数据处只会存储该列的一部分数据,把剩余的数据分散存储在几个其他的页中,然后 记录的真实数据 处用20个字节存储指向这些页的地址(当然这20个字节中还包括这些分散在其他页面中的数据的占用的字节数),从而可以找到剩余数据所在的页。</p>
<p>对于 Compact 和 Reduntant 行格式来说,如果某一列中的数据非常多的话,在本记录的真实数据处只会存储该列的前 768 个字节的数据和一个指向其他页的地址,然后把剩下的数据存放到其他页中,这个过程也叫做 行溢出 ,存储超出 768 字节的那些页面也被称为 溢出页 。</p>
<img src="https://cdn.jsdelivr.net/gh/chou401/pic-md@main/img/285d9c00300a45af94c31b74e5a9df19.png" alt="img"/>
<h5 id="行溢出的临界点">行溢出的临界点</h5>
<p>首先,MySQL 中规定一个页中至少存放两行记录。其次,以创建只有一个varchar(65532) 字段的表为例,的我们分析一下 一个页面的空间是如何利用的:</p>
<ul>
<li>除了用户储存的真实信息外,储存文件头、文件尾、页面头等信息,需要136个字节。</li>
<li>每条记录需要的额外信息是27字节,这27字节包括:
<ul>
<li>2个字节用于存储真实数据的长度</li>
<li>1个字节用于存储列是否是NULL值</li>
<li>5个字节大小的头信息</li>
<li>6个字节的 row_id 列</li>
<li>6个字节的 transaction_id 列</li>
<li>7个字节的 roll_pointer 列</li>
</ul>
</li>
</ul>
<p>假设一个列中存储的数据字节数为n,那么发生行溢出现象时需要满足这个式子: 136 + 2×(27 + n) &gt; 16384。</p>
<p>求解这个式子得出的解是: n &gt; 8098 。也就是说如果一个列中存储的数据不大于 8098 个字节,那就不会发生行溢出 ,否则就会发生 行溢出 。</p>
<p>不过这个 8098 个字节的结论只是针对只有一个<code>varchar(65532)</code>列的表来说的,如果表中有多个列,那上边的式子和结论都需要改一改了,所以重点就是: 不用关注这个临界点是什么,只要知道如果我们想一个行中存储了很大的数据时,可能发生 行溢出 的现象。</p>
<h4 id="redundant-格式">redundant 格式</h4>
<p>与compact 格式相比,没有了变长字段列表以及 NULL值列表,取而代之的是记录了所有真实数据的偏移地址表,偏移地址表是倒序排放的,但是计算偏移量却还是正序开始的从row_id作为第一个, 第一个从0开始累加字段对应的字节数。在记录头信息中, 大部分字段和compact 中的相同,但是对比compact多了。</p>
<p>n_field(记录列的数量)、1byte_offs_flag(字段长度列表每一列占用的字节数),少了record_type字段。</p>
<p>因为redundant是mysql 5.0 以前就在使用的一种格式,已经非常古老,使用频率非常的低,这里就不过多表述。</p>
<h4 id="dynamic-格式">dynamic 格式</h4>
<p>在现在 mysql 5.7 的版本中,使用的格式就是 dynamic。</p>
<p>dynamic 和 compact 基本是相同的,只有在溢出页的处理上面,有所不同。</p>
<p>在compact行格式中,对于占用存储空间非常大的列,在记录的真实数据处只会存储该列的前768个字节的数据,把剩余的数据分散存储在几个其他的页中,然后记录的真实数据处用20个字节存储指向这些页的地址,从而可以找到剩余数据所在的页。</p>
<p>这种在本记录的真实数据处只会存储该列的前768个字节的数据和一个指向其他页的地址,然后把剩下的数据存放到其他页中的情况就叫做行溢出,存储超出768字节的那些页面也被称为溢出页(uncompresse blob page)。</p>
<p>dynamic中会直接在真实数据区记录 20字节 的溢出页地址,而不再去额外记录一部分的数据了。</p>
<h4 id="compressed-格式">compressed 格式</h4>
<p>compressed 格式将会在Dynamic 的基础上面进行压缩处理特别是对溢出页的压缩处理,存储在其中的行数据会以zlib的算法进行压缩,因此对于blob、text这类大长度类型的数据能够进行非常有效的存储。但compressed格式其实也是以时间换空间,性能并不友好,并不推荐在常见的业务中使用。</p>
<h3 id="page-directory页目录">Page Directory(页目录)</h3>
<p>记录在页中按照主键值由小到大顺序串联成一个单链表,那如果我们想根据主键值查找页中的某条记录该咋办呢?比如说这样的查询语句:</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="sql"><code><div class="ec-line"><div class="code"><span style="--0:#FF79C6;--1:#BF3441">SELECT</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">*</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">FROM</span><span style="--0:#F8F8F2;--1:#24292E"> page_demo </span><span style="--0:#FF79C6;--1:#BF3441">WHERE</span><span style="--0:#F8F8F2;--1:#24292E"> c1 </span><span style="--0:#FF79C6;--1:#BF3441">=</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#BD93F9;--1:#005CC5">3</span><span style="--0:#F8F8F2;--1:#24292E">;</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="SELECT * FROM page_demo WHERE c1 = 3;"><div></div></button></div></figure></div>
<p>可以采用遍历链表的方式,从Infimum 记录(最小记录)开始,向后查找,因为是按照主键值从小到大存放的,当找到或找到大于查找的主键值的时候,就结束了。但这种方法效率太低了。</p>
<p>为了解决直接遍历查询缓慢的问题,设计了类似于课本目录的<strong>页目录</strong>:</p>
<ul>
<li><strong>记录分组</strong>: 将所有正常的记录(包括最大和最小记录,不包括标记为已删除的记录)划分为几个组。</li>
<li><strong>组内最大记录的n_owned 属性记录记录条数</strong>: 每个组的最后一条记录(也就是组内最大的那条记录)的头信息中的n_owned 属性表示该记录拥有多少条记录,也就是该组内共有几条记录。</li>
<li><strong>根据最大最小记录的地址偏移量构造页目录</strong>: 将每个组的最后一条记录的地址偏移量单独提取出来按顺序存储到靠近页的尾部的地方,这个地方就是所谓的Page Directory ,也就是页目录(此时应该返回头看看页面各个部分的图)。页面目录中的这些地址偏移量被称为槽(英文名: Slot ),所以这个页面目录就是由槽组的。</li>
</ul>
<img src="https://cdn.jsdelivr.net/gh/chou401/pic-md@main/img/image-20230703181623066.png" alt="image-20230703181623066"/>
<p>页目录里面有两个槽,说明分为了两个组,分别是最小记录为一组,四条用户记录与最大记录为一组。所以<strong>最小记录的n_owned 属性为1,最大记录的n_owned 属性为5。</strong></p>
<p>对于分组规定的规则:</p>
<ul>
<li>对于最小记录所在的分组只能有 1 条记录,最大记录所在的分组拥有的记录条数只能在 1<del>8 条之间,剩下的分组中记录的条数范围只能在是 4</del>8 条之间。</li>
<li>初始情况下一个数据页里只有最小记录和最大记录两条记录,它们分属于两个分组。</li>
<li>之后每插入一条记录,都会从页目录中找到主键值比本记录的主键值大并且差值最小的槽,然后把该槽中对应的最大记录的n_owned 值加1,表示本组内又添加了一条记录,直到该组中的记录数等于8个。</li>
<li>在一个组中的记录数等于8个后再插入一条记录时,会将组中的记录拆分成两个组,一个组中4条记录,另一个5条记录。这个过程会在页目录中新增一个槽来记录这个新增分组中最大的那条记录的偏移量。</li>
</ul>
<p>往表里继续插入数据</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="sql"><code><div class="ec-line"><div class="code"><span style="--0:#FF79C6;--1:#BF3441">INSERT INTO</span><span style="--0:#F8F8F2;--1:#24292E"> page_demo </span><span style="--0:#FF79C6;--1:#BF3441">VALUES</span><span style="--0:#F8F8F2;--1:#24292E">(</span><span style="--0:#BD93F9;--1:#005CC5">5</span><span style="--0:#F8F8F2;--1:#24292E">, </span><span style="--0:#BD93F9;--1:#005CC5">500</span><span style="--0:#F8F8F2;--1:#24292E">, </span><span style="--1:#032F62"><span style="--0:#E9F284">&#39;</span><span style="--0:#F1FA8C">eeee</span><span style="--0:#E9F284">&#39;</span></span><span style="--0:#F8F8F2;--1:#24292E">), (</span><span style="--0:#BD93F9;--1:#005CC5">6</span><span style="--0:#F8F8F2;--1:#24292E">, </span><span style="--0:#BD93F9;--1:#005CC5">600</span><span style="--0:#F8F8F2;--1:#24292E">, </span><span style="--1:#032F62"><span style="--0:#E9F284">&#39;</span><span style="--0:#F1FA8C">ffff</span><span style="--0:#E9F284">&#39;</span></span><span style="--0:#F8F8F2;--1:#24292E">), (</span><span style="--0:#BD93F9;--1:#005CC5">7</span><span style="--0:#F8F8F2;--1:#24292E">, </span><span style="--0:#BD93F9;--1:#005CC5">700</span><span style="--0:#F8F8F2;--1:#24292E">, </span><span style="--1:#032F62"><span style="--0:#E9F284">&#39;</span><span style="--0:#F1FA8C">gggg</span><span style="--0:#E9F284">&#39;</span></span><span style="--0:#F8F8F2;--1:#24292E">),(</span><span style="--0:#BD93F9;--1:#005CC5">8</span><span style="--0:#F8F8F2;--1:#24292E">, </span><span style="--0:#BD93F9;--1:#005CC5">800</span><span style="--0:#F8F8F2;--1:#24292E">, </span><span style="--1:#032F62"><span style="--0:#E9F284">&#39;</span><span style="--0:#F1FA8C">hhhh</span><span style="--0:#E9F284">&#39;</span></span><span style="--0:#F8F8F2;--1:#24292E">), (</span><span style="--0:#BD93F9;--1:#005CC5">9</span><span style="--0:#F8F8F2;--1:#24292E">, </span><span style="--0:#BD93F9;--1:#005CC5">900</span><span style="--0:#F8F8F2;--1:#24292E">, </span><span style="--1:#032F62"><span style="--0:#E9F284">&#39;</span><span style="--0:#F1FA8C">iiii</span><span style="--0:#E9F284">&#39;</span></span><span style="--0:#F8F8F2;--1:#24292E">), (</span><span style="--0:#BD93F9;--1:#005CC5">10</span><span style="--0:#F8F8F2;--1:#24292E">, </span><span style="--0:#BD93F9;--1:#005CC5">1000</span><span style="--0:#F8F8F2;--1:#24292E">, </span><span style="--1:#032F62"><span style="--0:#E9F284">&#39;</span><span style="--0:#F1FA8C">jjjj</span><span style="--0:#E9F284">&#39;</span></span><span style="--0:#F8F8F2;--1:#24292E">), (</span><span style="--0:#BD93F9;--1:#005CC5">11</span><span style="--0:#F8F8F2;--1:#24292E">, </span><span style="--0:#BD93F9;--1:#005CC5">1100</span><span style="--0:#F8F8F2;--1:#24292E">, </span><span style="--1:#032F62"><span style="--0:#E9F284">&#39;</span><span style="--0:#F1FA8C">kkkk</span><span style="--0:#E9F284">&#39;</span></span><span style="--0:#F8F8F2;--1:#24292E">), (</span><span style="--0:#BD93F9;--1:#005CC5">12</span><span style="--0:#F8F8F2;--1:#24292E">, </span><span style="--0:#BD93F9;--1:#005CC5">1200</span><span style="--0:#F8F8F2;--1:#24292E">, </span><span style="--1:#032F62"><span style="--0:#E9F284">&#39;</span><span style="--0:#F1FA8C">llll</span><span style="--0:#E9F284">&#39;</span></span><span style="--0:#F8F8F2;--1:#24292E">), (</span><span style="--0:#BD93F9;--1:#005CC5">13</span><span style="--0:#F8F8F2;--1:#24292E">, </span><span style="--0:#BD93F9;--1:#005CC5">1300</span><span style="--0:#F8F8F2;--1:#24292E">, </span><span style="--1:#032F62"><span style="--0:#E9F284">&#39;</span><span style="--0:#F1FA8C">mmmm</span><span style="--0:#E9F284">&#39;</span></span><span style="--0:#F8F8F2;--1:#24292E">), (</span><span style="--0:#BD93F9;--1:#005CC5">14</span><span style="--0:#F8F8F2;--1:#24292E">, </span><span style="--0:#BD93F9;--1:#005CC5">1400</span><span style="--0:#F8F8F2;--1:#24292E">, </span><span style="--1:#032F62"><span style="--0:#E9F284">&#39;</span><span style="--0:#F1FA8C">nnnn</span><span style="--0:#E9F284">&#39;</span></span><span style="--0:#F8F8F2;--1:#24292E">), (</span><span style="--0:#BD93F9;--1:#005CC5">15</span><span style="--0:#F8F8F2;--1:#24292E">, </span><span style="--0:#BD93F9;--1:#005CC5">1500</span><span style="--0:#F8F8F2;--1:#24292E">, </span><span style="--1:#032F62"><span style="--0:#E9F284">&#39;</span><span style="--0:#F1FA8C">oooo</span><span style="--0:#E9F284">&#39;</span></span><span style="--0:#F8F8F2;--1:#24292E">), (</span><span style="--0:#BD93F9;--1:#005CC5">16</span><span style="--0:#F8F8F2;--1:#24292E">, </span><span style="--0:#BD93F9;--1:#005CC5">1600</span><span style="--0:#F8F8F2;--1:#24292E">, </span><span style="--1:#032F62"><span style="--0:#E9F284">&#39;</span><span style="--0:#F1FA8C">pppp</span><span style="--0:#E9F284">&#39;</span></span><span style="--0:#F8F8F2;--1:#24292E">);</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="INSERT INTO page_demo VALUES(5, 500, 'eeee'), (6, 600, 'ffff'), (7, 700, 'gggg'),(8, 800, 'hhhh'), (9, 900, 'iiii'), (10, 1000, 'jjjj'), (11, 1100, 'kkkk'), (12, 1200, 'llll'), (13, 1300, 'mmmm'), (14, 1400, 'nnnn'), (15, 1500, 'oooo'), (16, 1600, 'pppp');"><div></div></button></div></figure></div>
<p>注意看,最小记录始终是在用户最小记录之前,最大记录始终是在用户最大记录之后。</p>
<img src="https://cdn.jsdelivr.net/gh/chou401/pic-md@main/img/image-20230703181828283.png" alt="image-20230703181828283"/>
<p>可以看到,每个槽点都记录了每组中最大记录的地址偏移量。</p>
<p>当我们需要在一个数据页中查找指定主键值的记录的过程分为两步:</p>
<ul>
<li>通过<strong>二分法</strong>确定该记录所在的槽,并找到该槽中主键值最小的那条记录。</li>
<li>通过记录的next_record 属性遍历该槽所在的组中的各个记录。</li>
</ul>
<h3 id="page-header页面头部">Page Header(页面头部)</h3>
<p>为了能得到一个数据页中存储的记录的状态信息,比如本页中已经存储了多少条记录,第一条记录的地址是什么,页目录中存储了多少个槽等等,特意在页中定义了一个叫Page Header 的部分,它是页结构的第二部分,这个部分占用固定的56 个字节,专门存储各种状态信息,具体各个字节都是干嘛的看下表:</p>
















































































<table><thead><tr><th>名称</th><th>占用空间(字节)</th><th>描述</th></tr></thead><tbody><tr><td>PAGE_N_DIR_SLOTS</td><td>2</td><td>在页目录中的槽数量</td></tr><tr><td>PAGE_HEAP_TOP</td><td>2</td><td>还未使用的空间最小地址,也就是说从该地址之后就是Free Space</td></tr><tr><td>PAGE_BTR_SEG_TOP</td><td>10</td><td>本页中的记录的数量(包括最小和最大记录以及标记为删除的记录)</td></tr><tr><td>PAGE_N_HEAP</td><td>2</td><td>第一个已经标记为删除的记录地址(各个已删除的记录通过next_record 也会组成一个单链表,单链表中的记录可以被重新利用)</td></tr><tr><td>PAGE_FREE</td><td>2</td><td>已删除记录占用的字节数</td></tr><tr><td>PAGE_GARBAGE</td><td>2</td><td>最后插入记录的位置</td></tr><tr><td>PAGE_LAST_INSERT</td><td>2</td><td>记录插入的方向</td></tr><tr><td>PAGE_DIRECTION</td><td>2</td><td>一个方向连续插入的记录数量</td></tr><tr><td>PAGE_N_DIRECTION</td><td>2</td><td>该页中记录的数量(不包括最小和最大记录以及被标记为删除的记录)</td></tr><tr><td>PAGE_N_RECS</td><td>2</td><td>修改当前页的最大事务ID,该值仅在二级索引中定义</td></tr><tr><td>PAGE_MAX_TRX_ID</td><td>8</td><td>当前页在B+树中所处的层级</td></tr><tr><td>PAGE_LEVEL</td><td>2</td><td>索引ID,表示当前页属于哪个索引</td></tr><tr><td>PAGE_INDEX_ID</td><td>8</td><td>B+树叶子段的头部信息,仅在B+树的Root页定义</td></tr><tr><td>PAGE_BTR_SEG_LEAF</td><td>10</td><td>B+树非叶子段的头部信息,仅在B+树的Root页定义</td></tr></tbody></table>
<ul>
<li>
<p>PAGE_DIRECTION</p>
<ul>
<li>假如新插入的一条记录的主键值比上一条记录的主键值大,我们说这条记录的插入方向是右边,反之则是左边。用来表示最后一条记录插入方向的状态就是PAGE_DIRECTION 。</li>
</ul>
</li>
<li>
<p>PAGE_N_DIRECTION</p>
<ul>
<li>假设连续几次插入新记录的方向都是一致的, InnoDB 会把沿着同一个方向插入记录的条数记下来,这个条数就用PAGE_N_DIRECTION 这个状态表示。当然,如果最后一条记录的插入方向改变了的话,这个状态的值会被清零重新统计。</li>
</ul>
</li>
</ul>
<h3 id="file-header文件头部">File Header(文件头部)</h3>
<p>Page Header 是专门针对数据页记录的各种状态信息,比方说页里头有多少个记录,有多少个槽等信息。</p>
<p>而File Header 是针对各种类型的页都通用,也就是说不同类型的页都会以File Header 作为第一个组成部分,它描述了一些针对各种页都通用的一些信息,比方说这个页的编号是多少,它的上一个页、下一个页是谁, 这个部分占用固定的38 个字节,是由下边这些内容组成的:</p>


















































<table><thead><tr><th>名称</th><th>占用空间(字节)</th><th>描述</th></tr></thead><tbody><tr><td>FIL_PAGE_SPACE_OR_CHKSUM</td><td>4</td><td>页的校验和(checksum值)</td></tr><tr><td>FIL_PAGE_OFFSET</td><td>4</td><td>页号</td></tr><tr><td>FIL_PAGE_PREV</td><td>4</td><td>上一个页的页号</td></tr><tr><td>FIL_PAGE_NEXT</td><td>4</td><td>下一个页的页号</td></tr><tr><td>FIL_PAGE_LSN</td><td>8</td><td>页面被最后修改时对应的日志序列位置(英文名是: Log SequenceNumber)</td></tr><tr><td>FIL_PAGE_TYPE</td><td>2</td><td>该页的类型</td></tr><tr><td>FIL_PAGE_FILE_FLUSH_LSN</td><td>8</td><td>仅在系统表空间的一个页中定义,代表文件至少被刷新到了对应的LSN值</td></tr><tr><td>FIL_PAGE_ARCH_LOG_NO_OR_SPACE_ID</td><td>4</td><td>页属于哪个表空间</td></tr></tbody></table>
<p>看几个重要的部分:</p>
<ul>
<li>
<p>FIL_PAGE_SPACE_OR_CHKSUM</p>
<p>这个代表当前页面的校验和(checksum)。校验和: 就是对于一个很长很长的字节串来说,通过某种算法来计算一个比较短的值来代表这个很长的字节串,这个比较短的值就称为校验和。这样在比较两个很长的字节串之前先比较这两个长字节串的校验和,如果校验和都不一样两个长字节串肯定是不同的,所以省去了直接比较两个比较长的字节串的时间损耗。</p>
</li>
<li>
<p>FIL_PAGE_OFFSET</p>
<p>每一个页都有一个单独的页号,就跟你的身份证号码一样, InnoDB 通过页号来可以唯一定位一个页。</p>
</li>
<li>
<p>FIL_PAGE_TYPE</p>
<p>InnoDB 为了不同的目的而把页分为不同的类型,这篇文章介绍的其实都是存储记录的<strong>数据页</strong>,也就是所谓的索引页。其实还有很多别的类型的页: 日志页、溢出页等。</p>
</li>
<li>
<p>FIL_PAGE_PREV 和FIL_PAGE_NEXT</p>
<p>InnoDB 都是以页为单位存放数据的,存放某种类型的数据占用的空间非常大(比方说一张表中可以有成千上万条记录), InnoDB 可能不可以一次性为这么多数据分配一个非常大的存储空间,如果分散到多个不连续的页中存储的话需要把这些页关联起来, FIL_PAGE_PREV 和FIL_PAGE_NEXT就分别代表本页的上一个和下一个页的页号。这样通过建立一个双向链表把许许多多的页就都串联起来了,而无需这些页在物理上真正连着。</p>
</li>
</ul>
<p>需要注意的是,并不是所有类型的页都有上一个和下一个页的属性,不过本文中唠叨的数据页(也就是类型为FIL_PAGE_INDEX 的页)是有这两个属性的,所以索引的数据页其实是一个双链表。</p>
<h3 id="file-trailer文件尾部">File Trailer(文件尾部)</h3>
<p>InnoDB 存储引擎会把数据存储到磁盘上,但是磁盘速度太慢,需要以页为单位把数据加载到内存中处理,如果该页中的数据在内存中被修改了,那么在修改后的某个时间需要把数据同步到磁盘中。但是在同步了一半的时候中断电了咋办,这不是莫名尴尬么?为了检测一个页是否完整(也就是在同步的时候有没有发生只同步一半的尴尬情况),在每个页的尾部都加了一个File Trailer 部分,这个部分由8 个字节组成,可以分成2个小部分:</p>
<ul>
<li>
<p>前4个字节代表页的校验和</p>
<p>这个部分是和File Header 中的校验和相对应的。每当一个页面在内存中修改了,在同步之前就要把它的校验和算出来,因为File Header 在页面的前边,所以校验和会被首先同步到磁盘,当完全写完时,校验和也会被写到页的尾部,如果完全同步成功,则页的首部和尾部的校验和应该是一致的。如果写了一半儿断电了,那么在File Header 中的校验和就代表着已经修改过的页,而在File Trialer 中的校验和代表着原先的页,二者不同则意味着同步中间出了错。</p>
</li>
<li>
<p>后4个字节代表页面被最后修改时对应的日志序列位置(LSN)</p>
<p>这个部分也是为了校验页的完整性的,只不过我们目前还没说LSN 是个什么意思,所以大家可以先不用管这个属性。这个File Trailer 与File Header 类似,都是所有类型的页通用的。</p>
</li>
</ul>
<h3 id="innodb-的-buffer-pool-是如何管理数据页的">InnoDB 的 Buffer Pool 是如何管理数据页的</h3>
<p>对于 InnoDB 存储引擎来说,数据是存储在磁盘上,而执行引擎想要操作数据,必须先将磁盘的数据加载到内存中才能操作。当数据从磁盘中取出后,缓存内存中,下次查询同样的数据的时候,直接从内存中读取,这样大大提高了查询性能。</p>
<h4 id="innodb结构图">InnoDB结构图</h4>
<img src="https://cdn.jsdelivr.net/gh/chou401/pic-md@main/img/innodb-architecture-5-7.png" alt="InnoDB architecture diagram showing in-memory and on-disk structures."/>
<p>内存结构(In-Memory Structures)主要是针对的是数据及其操作,主要分为:</p>
<ul>
<li><strong>Buffer Pool: 缓冲池</strong>,数据缓冲池里面不直接存放数据而是存放的Page页,将数据存放在了Page页中,在缓冲池Page页是通过链表形式来存放的。</li>
<li><strong>Change Buffer: 写缓冲区</strong>,正常情况下修改数据是先修改的缓冲池中Page的数据,但是缓冲池肯定不是所有的数据,而修改数据没有对应的Page数据的时候并不会直接把数据加载到缓冲池中去,而是放在了写缓冲区中记录,等到数据被读取的时候再把数据合并到缓冲池中。</li>
<li><strong>Adaptive Hash Index: 自适应Hash索引</strong>,InnoDB存储引擎会根据Page页的访问频率和模式建立对应的Hash索引,这个索引是根据查询情况自动建立的,称为自适应Hash索引。</li>
<li><strong>Log Buffer: 日志缓冲区</strong>,主要用来保存写入磁盘的(Redo/Undo)日志文件,日志缓冲区会定期刷新到磁盘log文件中,这样不用每次日志都进行磁盘IO操作,提高效率。</li>
</ul>
<p>磁盘结构(On-Disk Structures)主要针对的是表和表空间,主要分为以下结构:</p>
<ul>
<li><strong>Tablespaces: 表空间</strong>,对于表空间大家应该都不陌生,用来存储表结构和数据的。表空间又被分为系统表空间、独立表空间、通用表空间、临时表空间等多种类型。</li>
<li><strong>InnoDB Data Dictionary: 数据字典</strong>,InnoDB数据字典由内部系统表组成,这些表包含用于查找表、索引和表字段等对象的元数据。</li>
<li><strong>Doublewrite Buffer: 双写缓冲区</strong>,我们知道数据修改先修改的Page页后又刷到磁盘的,在刷到磁盘前这些数据会先存放在双写缓存区中,双写缓存区是用来保障数据写入磁盘时候出现问题的备份。</li>
<li><strong>Redo Logs: 重做日志</strong>,记录了所有缓冲池修改的数据,修改数据的时候先写日志,后修改的缓冲区,假设修改写入操作的时候数据库崩溃了或停电了,等下次启动通过重做日志来保持数据的正确性。</li>
</ul>
<h4 id="buffer-pool缓冲池">Buffer Pool(缓冲池)</h4>
<p><strong>Buffer Pool是MySQL服务在启动的时候向操作系统申请的一片连续地址的内存空间</strong>,其本质就是一片内存,默认大小是 <strong>128M</strong>,可以在启动服务的时候,通过 innodb_buffer_pool 这个参数设置buffer pool的大小,单位是字节(B),最小值是5MB。</p>
<p>那么Buffer Pool这段内存地址到底有什么,可以确定的就是肯定有16KB数据页,这里叫<strong>缓冲页</strong>。除此之外还有,索引页,undo 页,插入缓存、自适应哈希索引、锁信息。</p>
<img src="https://cdn.jsdelivr.net/gh/chou401/pic-md@main/image-20230904181941928.png" alt="image-20230904181941928"/>
<h5 id="内部组成">内部组成</h5>
<p>因为buffer pool被划分为某干个数据页,其数据页大小和表空间使用的页大小一致,为了更好的管理buffer pool中的缓冲页,innoDB为每个缓冲页都创建了一个控制信息。</p>
<p>这些控制信息主要包括该缓冲页的【表空间编号、页号、缓冲页在buffer pool中的地址、链表节点信息】,存储这些控制信息控制块。</p>
<p>缓冲页和控制块是一一对应的,其中控制块在buffer pool前面,而缓冲页在buffer后面。</p>
<p><strong>什么是碎片?</strong></p>
<p>当剩余空间不够一对控制块和缓冲页的大小时,这样的空间称为碎片。</p>
<p><strong>怎么查看MySQL实例的Buffer Pool信息呢?</strong></p>
<p><code>show variables like &#39;%innodb_buffer_pool_size%&#39;;</code> 查看buffer pool的size。</p>
<p><code>show global status like &#39;%innodb_buffer_pool%&#39;;</code> 查看相关参数,详细的参数代表的意思,大家自己去搜搜。</p>
<h4 id="管理buffer-pool">管理Buffer Pool</h4>
<p><code>Buffer Pool</code> 中的页有三种状态:</p>
<ol>
<li>空闲页: 通过空闲页链表(Free List)管理。</li>
<li>正常页: 通过LRU链表(LRU List)管理。</li>
<li>脏页: 通过LRU链表和脏页链表(Flush List)管理。(缓冲池中被修改过的页,与磁盘上的数据页不一致)</li>
</ol>
<p>接下来我们分别看看三种链表是如何进行管理的。</p>
<h5 id="free链表">Free链表</h5>
<p>初始化完的buffer pool时所有的页都是空闲页,所有空闲的缓冲页对应的<strong>控制块信息</strong>作为一个节点放到Free链表中。</p>
<p>要注意Free链表是一个个控制块,而控制块的信息中有缓存页的地址信息。</p>
<p>在有了free链表之后,当需要加载磁盘中的页到buffer pool中时,就去free链表中取一个空闲页所对应的控制块信息,<strong>根据控制块信息中的表空间号、页号找到buffer pool里对应的缓冲页,再将数据加载到该缓冲页中,随后删掉free链表该控制块信息对应的节点。</strong></p>
<p><strong>如何在buffer pool中快速查找缓冲页(数据页)呢?</strong></p>
<p>这里就可以对缓冲页进行Hash处理,用表空间号、页号做为Key,缓冲页的控制块就是value**维护一个Hash表,**根据表空间号、页号做为Key去查找有没有对应的缓冲信息,如果没有就需要去free 链表中取一个空闲的缓冲页控制快信息,随后将磁盘中的数据加载到该缓冲页位置。</p>
<h5 id="flush链表">Flush链表</h5>
<p>修改了buffer pool中缓冲页的数据,那么该页和磁盘就不一致了,这样的页就称为【脏页】,它不是立马刷入到磁盘中,而是由后台线程将脏页写入到磁盘。</p>
<p>Flush链表就是为了能知道哪些是脏页而设计的,它跟Free链表结构图相似,区别在于控制块指向的是脏页地址。</p>
<h5 id="lru链表">LRU链表</h5>
<p>对于频繁访问的数据和很少访问的数据我们对与它的期望是不一样的,很少访问的数据希望在某个时机淘汰掉,避免占用buffer pool的空间,因为缓冲空间大小是有限的。</p>
<p>MySQL设计了根据LRU算法设计了LRU链表来维护和淘汰缓冲页。</p>
<p>LRU 算法简单来说,如果用链表来实现,将最近命中(加载)的数据页移在头部,未使用的向后偏移,直至移除链表。这样的淘汰算法就叫做 LRU 算法,但是简单的LRU算法会带来两个问题: <strong>预读失效、Buffer Pool污染</strong>。</p>
<h5 id="预读机制和预读失效">预读机制和预读失效</h5>
<p><strong>预读机制</strong>: 当数据页从磁盘加载到 Buffer Pool 中时,会把相邻的数据页也提前加载到 Buffer Pool 中,这样做的好处就是减少未来可能的磁盘IO。</p>
<p><strong>预读失效</strong>: 当预读机制提前加载的数据页一直未被访问,这就是失效</p>
<p>好,那么结合简单的LRU算法来看,可能预读页被加载到LRU链表头部,当Buffer Pool空间不够时,会把经常访问的位于LRU链表的尾部数据页给淘汰清理掉,这样缓冲就失效了。</p>
<h5 id="改进的lru-算法">改进的LRU 算法</h5>
<p>Buffer Pool的LRU算法中InnoDB 将LRU链表按照5:3的比例分成了young区域和old区域。链表头部的5/8是young区(被高频访问数据),链表尾部的3/8区域是old区域(低频访问数据)。</p>
<p>这样做的目的是,在预读的时候或访问不存在的缓冲页时,先加入到 old 区域的头部,当页被真正访问的时候,才将页插入 young 区域的头部。</p>
<img src="https://cdn.jsdelivr.net/gh/chou401/pic-md@main/img/v2-7ba7ee9eb267c9d62e95c3e858419e32_1440w.png" alt="img"/>
<p>现在有个编号为 20 的页被预读了,这个页只会被插入到 old 区域头部,而 old 区域末尾的页(10号)会被淘汰掉。</p>
<img src="https://cdn.jsdelivr.net/gh/chou401/pic-md@main/img/v2-b381ae4b18804701b12cad3b770167b2_1440w.png" alt="img"/>
<p>如果 20 号页一直不会被访问,它也没有占用到 young 区域的位置,而且还会比 young 区域的数据更早被淘汰出去。</p>
<p>如果 20 号页被预读后,立刻被访问了,那么就会将它插入到 young 区域的头部,young 区域末尾的页(7号),会被挤到 old 区域,作为 old 区域的头部,这个过程并不会有页被淘汰。</p>
<img src="https://cdn.jsdelivr.net/gh/chou401/pic-md@main/img/v2-73eeea4b1a6b0e6f0553b3ef07e36e4a_1440w.png" alt="img"/>
<h5 id="多buffer实例">多Buffer实例</h5>
<p>我们已经默认情况下**innodb_buffer_pool_size是128M,**此时的innodb_buffer_pool_instances的大小也就是实例是1个。因为innodb_buffer_pool_size 小于1G时,设置innodb_buffer_pool_instances是无效的,都会是1。</p>
<p>当一个buffer pool在多线程访问的时候,各个链表都会加锁处理,这样一来,多线程访问时,性能就会降低。</p>
<p>可以通过<strong>innodb_buffer_pool_instances</strong>参数来设置实例的个数。每个buffer pool实例的大小计算公式: **innodb_buffer_pool_size / innodb_buffer_pool_instances,**每个实例都有其对应的链表管理,互不干扰。</p>
<h5 id="修改buffer-pool大小">修改Buffer Pool大小</h5>
<p><strong>如何修改运行中MySQL的Buffer Pool的大小?</strong></p>
<p><strong>MySQL 5.7.5之前</strong>: 是不允许在运行时调整buffer pool大小的,只能在服务器启动之前,通过innodb_buffer_pool_size大小来调整。</p>
<p>**MySQL 5.7.5之后: **是以chunk为单位来修改Buffer Pool的大小,比如innodb_buffer_pool_chunk_size默认大小是128M,调整Buffer Pool大小就以chunk为单位来增加或减少Buffer Pool大小。</p>
<p>我们应该要有这么一个概念就是: 一个Buffer Pool可能有多个buffer pool实例,而每个实例由多个chunk组成,一个chunk是一块连续的内存空间,一个chunk默认大小是128M。</p>
<h5 id="缓存污染">缓存污染</h5>
<p>虽然 MySQL 通过改进传统的 LRU 数据结构,避免了预读失效带来的影响。但是如果还是使用「只要数据被访问过一次,就将数据加入到 young 区域」这种方式的话,那么<strong>还存在缓存污染的问题</strong>。</p>
<p>当我们在批量读取数据的时候,由于数据被访问了一次,这些大量数据都会被加入到「活跃 LRU 链表」里,然后之前缓存在活跃 LRU 链表(或者 young 区域)里的热点数据全部都被淘汰了,<strong>如果这些大量的数据在很长一段时间都不会被访问的话,那么整个活跃 LRU 链表(或者 young 区域)就被污染了</strong>。</p>
<h5 id="缓存污染会带来什么问题">缓存污染会带来什么问题?</h5>
<p>缓存污染带来的影响就是很致命的,等这些热数据又被再次访问的时候,由于缓存未命中,就会产生大量的磁盘 I/O,系统性能就会急剧下降。</p>
<p>当某一个 SQL 语句<strong>扫描了大量的数据</strong>时,在 Buffer Pool 空间比较有限的情况下,可能会将 <strong>Buffer Pool 里的所有页都替换出去,导致大量热数据被淘汰了</strong>,等这些热数据又被再次访问的时候,由于缓存未命中,就会产生大量的磁盘 I/O,MySQL 性能就会急剧下降。</p>
<p>注意, 缓存污染并不只是查询语句查询出了大量的数据才出现的问题,即使查询出来的结果集很小,也会造成缓存污染。</p>
<p>比如,在一个数据量非常大的表,执行了这条语句:</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="text"><code><div class="ec-line"><div class="code"><span style="--0:#f8f8f2;--1:#24292e">select * from t_user where name like &quot;%xiaolin%&quot;;</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="select * from t_user where name like &#34;%xiaolin%&#34;;"><div></div></button></div></figure></div>
<p>可能这个查询出来的结果就几条记录,但是由于这条语句会发生索引失效,所以这个查询过程是全表扫描的,接着会发生如下的过程:</p>
<ul>
<li>从磁盘读到的页加入到 LRU 链表的 old 区域头部;</li>
<li>当从页里读取行记录时,也就是<strong>页被访问的时候,就要将该页放到 young 区域头部</strong>;</li>
<li>接下来拿行记录的 name 字段和字符串 xiaolin 进行模糊匹配,如果符合条件,就加入到结果集里;</li>
<li>如此往复,直到扫描完表中的所有记录。</li>
</ul>
<p>经过这一番折腾,由于这条 SQL 语句访问的页非常多,每访问一个页,都会将其加入 young 区域头部,那么<strong>原本 young 区域的热点数据都会被替换掉,导致缓存命中率下降</strong>。那些在批量扫描时,而被加入到 young 区域的页,如果在很长一段时间都不会再被访问的话,那么就污染了 young 区域。</p>
<p>举个例子,假设需要批量扫描: 21,22,23,24,25 这五个页,这些页都会被逐一访问(读取页里的记录)。</p>
<img src="https://cdn.jsdelivr.net/gh/chou401/pic-md@main/img/v2-ce159c31ecabe38c68bb35cfce35e410_1440w.png" alt="img"/>
<p>在批量访问这些页的时候,会被逐一插入到 young 区域头部。</p>
<img src="https://cdn.jsdelivr.net/gh/chou401/pic-md@main/img/v2-1c75fa046988f1a9774fb258d73cba6f_1440w.png" alt="img"/>
<p>可以看到,原本在 young 区域的 6 和 7 号页都被淘汰了,而批量扫描的页基本占满了 young 区域,如果这些页在很长一段时间都不会被访问,那么就对 young 区域造成了污染。</p>
<p>如果 6 和 7 号页是热点数据,那么在被淘汰后,后续有 SQL 再次读取 6 和 7 号页时,由于缓存未命中,就要从磁盘中读取了,降低了 MySQL 的性能,这就是缓存污染带来的影响。</p>
<h5 id="怎么避免缓存污染造成的影响">怎么避免缓存污染造成的影响?</h5>
<p>前面的 LRU 算法只要数据被访问一次,就将数据加入活跃 LRU 链表(或者 young 区域),<strong>这种 LRU 算法进入活跃 LRU 链表的门槛太低了</strong>！正式因为门槛太低,才导致在发生缓存污染的时候,很容就将原本在活跃 LRU 链表里的热点数据淘汰了。</p>
<p>所以,<strong>只要我们提高进入到活跃 LRU 链表(或者 young 区域)的门槛,就能有效地保证活跃 LRU 链表(或者 young 区域)里的热点数据不会被轻易替换掉</strong>。</p>
<p>Linux 操作系统和 MySQL Innodb 存储引擎分别是这样提高门槛的:</p>
<ul>
<li>
<p><strong>Linux 操作系统</strong>: 在内存页被访问<strong>第二次</strong>的时候,才将页从 inactive list 升级到 active list 里。</p>
</li>
<li>
<p><strong>MySQL Innodb</strong>: 在内存页被访问<strong>第二次</strong>的时候,并不会马上将该页从 old 区域升级到 young 区域,因为还要进行<strong>停留在 old 区域的时间判断</strong>:</p>
</li>
<li>
<ul>
<li>如果第二次的访问时间与第一次访问的时间<strong>在 1 秒内</strong>(默认值),那么该页就<strong>不会</strong>被从 old 区域升级到 young 区域;</li>
<li>如果第二次的访问时间与第一次访问的时间<strong>超过 1 秒</strong>,那么该页就<strong>会</strong>从 old 区域升级到 young 区域;</li>
</ul>
</li>
</ul>
<p>提高了进入活跃 LRU 链表(或者 young 区域)的门槛后,就很好了避免缓存污染带来的影响。</p>
<p>在批量读取数据时候,<strong>如果这些大量数据只会被访问一次,那么它们就不会进入到活跃 LRU 链表(或者 young 区域)</strong>,也就不会把热点数据淘汰,只会待在非活跃 LRU 链表(或者 old 区域)中,后续很快也会被淘汰。</p>
<h2 id="疑问">疑问</h2>
<h3 id="小数精度问题">小数精度问题</h3>
<p>fload和double在存取时因为精度不一致会发生丢失,这里的丢失指的是扩展或者截断,丢失了原有的精度。</p>
<p>在mysql中,我们用【小数数据类型(总长度,小数点长度)】来表示小数的总长度和小数点后面的长度,如deicmal(m,n)。n就是小数点后面的数字个数。float(m,n)、double(m,n) 含义差不多,都是定义长度和精度的。既然定义了精度,为什么还会发生所谓的精度丢失问题呢?</p>
<p>float和double在<strong>存取</strong>时因为精度不一致会发生丢失,不能盲目的说float和double精度可能丢失。具体原因如下:</p>
<ol>
<li><strong>没有设置精度位数。</strong>
没有设置精度就是使用默认的精度,此时的策略就是,尽可能保证精度,因此一般使用最高精度存储数据。如果设置数据类型指定了精度,那么存储数据时就按照设置的精度来存储。例如,6.214522存入6位小数的float和double是不会丢失小数精度的,取出来的数还是6.214522。也就是说,一个小数存入相同的精度的数据类型时,精度是不会丢失的。</li>
<li><strong>设置的精度和存储时的精度不一致。</strong>
当7或更多位精度的数字存入6位精度类型字段时,会发生什么?结果会发生四舍五入。四舍五入的结果就是匹配字段的数据类型的精度长度。此时精度也会丢失。不管内部如何处理,我们得到的数据是经过四舍五入的。但是有一点可以确定,我们在读取取舍后的数字时,是固定的。虽然浮点数存储的不是确切的数值,但是在你指定的精度长度条件下,存取都是确定的一个数值。而发生精度变化的就是数值的精度和字段的精度长度不匹配,从而发生数值扩展精度和截断精度问题,这也就是浮点数精度不准确的问题。</li>
<li><strong>mysql数据库使用其他数据库引擎来查询。</strong>
这个精度丢失的原因,就可能是不同的数据库引擎对浮点数的精度扩展和截断处理策略不一致,而且,存储时策略也不一致。所以导致精度会出现各种变化。这种问题也就是催生decimal类型的出现。我们前面看到的decimal是可以确切存储小数的精度的。因为在存储的时候会将小数以字符串存储,就不会再发生精度的扩展问题。但是decimal依然会发生精度截断问题。如果decimal指定精度为2位小数,存入的是这样的值: 12.123,你觉得结果如何?当然还是会发生四舍五入。结果就是12.12,然而12.12以字符串形式存入了数据库,此后,12.12始终都是12.12,变现出来的是小数,然而内部是字符串形式存储,所以,小数精度不会再发生变化了。我们不管以什么精度来获取这个值,都是12.12,而且,不管是一般数据库引擎读取到的也都是12.12,所以decimal才是大家推荐使用的金额存储类型。</li>
</ol>
<p>浮点数类型是把十进制数转换成二进制数存储,decimal是把十进制的整数部分和小数部分拆开,分别装换成十六进制,进行存储。这样,所有的数值,就都可以精准表达了。</p>
<h3 id="大数据查询">大数据查询</h3>
<h4 id="创建表">创建表</h4>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="sql"><code><div class="ec-line"><div class="code"><span style="--0:#FF79C6;--1:#BF3441">CREATE</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">TABLE</span><span style="--0:#F8F8F2;--1:#24292E"> `</span><span style="--0:#50FA7B;--1:#6F42C1">user_operation_log</span><span style="--0:#F8F8F2;--1:#24292E">`  (</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--1:#032F62"><span style="--0:#E9F284">`</span><span style="--0:#F1FA8C">id</span><span style="--0:#E9F284">`</span></span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">int</span><span style="--0:#F8F8F2;--1:#24292E">(</span><span style="--0:#BD93F9;--1:#005CC5">11</span><span style="--0:#F8F8F2;--1:#24292E">) </span><span style="--0:#FF79C6;--1:#BF3441">NOT NULL</span><span style="--0:#F8F8F2;--1:#24292E"> AUTO_INCREMENT,</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--1:#032F62"><span style="--0:#E9F284">`</span><span style="--0:#F1FA8C">user_id</span><span style="--0:#E9F284">`</span></span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">varchar</span><span style="--0:#F8F8F2;--1:#24292E">(</span><span style="--0:#BD93F9;--1:#005CC5">64</span><span style="--0:#F8F8F2;--1:#24292E">) </span><span style="--0:#FF79C6;--1:#BF3441">CHARACTER</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">SET</span><span style="--0:#F8F8F2;--1:#24292E"> utf8mb4 </span><span style="--0:#FF79C6;--1:#BF3441">COLLATE</span><span style="--0:#F8F8F2;--1:#24292E"> utf8mb4_general_ci </span><span style="--0:#FF79C6;--1:#BF3441">NULL</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">DEFAULT</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">NULL</span><span style="--0:#F8F8F2;--1:#24292E">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--1:#032F62"><span style="--0:#E9F284">`</span><span style="--0:#F1FA8C">ip</span><span style="--0:#E9F284">`</span></span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">varchar</span><span style="--0:#F8F8F2;--1:#24292E">(</span><span style="--0:#BD93F9;--1:#005CC5">20</span><span style="--0:#F8F8F2;--1:#24292E">) </span><span style="--0:#FF79C6;--1:#BF3441">CHARACTER</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">SET</span><span style="--0:#F8F8F2;--1:#24292E"> utf8mb4 </span><span style="--0:#FF79C6;--1:#BF3441">COLLATE</span><span style="--0:#F8F8F2;--1:#24292E"> utf8mb4_general_ci </span><span style="--0:#FF79C6;--1:#BF3441">NULL</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">DEFAULT</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">NULL</span><span style="--0:#F8F8F2;--1:#24292E">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--1:#032F62"><span style="--0:#E9F284">`</span><span style="--0:#F1FA8C">op_data</span><span style="--0:#E9F284">`</span></span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">varchar</span><span style="--0:#F8F8F2;--1:#24292E">(</span><span style="--0:#BD93F9;--1:#005CC5">255</span><span style="--0:#F8F8F2;--1:#24292E">) </span><span style="--0:#FF79C6;--1:#BF3441">CHARACTER</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">SET</span><span style="--0:#F8F8F2;--1:#24292E"> utf8mb4 </span><span style="--0:#FF79C6;--1:#BF3441">COLLATE</span><span style="--0:#F8F8F2;--1:#24292E"> utf8mb4_general_ci </span><span style="--0:#FF79C6;--1:#BF3441">NULL</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">DEFAULT</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">NULL</span><span style="--0:#F8F8F2;--1:#24292E">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--1:#032F62"><span style="--0:#E9F284">`</span><span style="--0:#F1FA8C">attr1</span><span style="--0:#E9F284">`</span></span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">varchar</span><span style="--0:#F8F8F2;--1:#24292E">(</span><span style="--0:#BD93F9;--1:#005CC5">255</span><span style="--0:#F8F8F2;--1:#24292E">) </span><span style="--0:#FF79C6;--1:#BF3441">CHARACTER</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">SET</span><span style="--0:#F8F8F2;--1:#24292E"> utf8mb4 </span><span style="--0:#FF79C6;--1:#BF3441">COLLATE</span><span style="--0:#F8F8F2;--1:#24292E"> utf8mb4_general_ci </span><span style="--0:#FF79C6;--1:#BF3441">NULL</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">DEFAULT</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">NULL</span><span style="--0:#F8F8F2;--1:#24292E">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--1:#032F62"><span style="--0:#E9F284">`</span><span style="--0:#F1FA8C">attr2</span><span style="--0:#E9F284">`</span></span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">varchar</span><span style="--0:#F8F8F2;--1:#24292E">(</span><span style="--0:#BD93F9;--1:#005CC5">255</span><span style="--0:#F8F8F2;--1:#24292E">) </span><span style="--0:#FF79C6;--1:#BF3441">CHARACTER</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">SET</span><span style="--0:#F8F8F2;--1:#24292E"> utf8mb4 </span><span style="--0:#FF79C6;--1:#BF3441">COLLATE</span><span style="--0:#F8F8F2;--1:#24292E"> utf8mb4_general_ci </span><span style="--0:#FF79C6;--1:#BF3441">NULL</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">DEFAULT</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">NULL</span><span style="--0:#F8F8F2;--1:#24292E">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--1:#032F62"><span style="--0:#E9F284">`</span><span style="--0:#F1FA8C">attr3</span><span style="--0:#E9F284">`</span></span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">varchar</span><span style="--0:#F8F8F2;--1:#24292E">(</span><span style="--0:#BD93F9;--1:#005CC5">255</span><span style="--0:#F8F8F2;--1:#24292E">) </span><span style="--0:#FF79C6;--1:#BF3441">CHARACTER</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">SET</span><span style="--0:#F8F8F2;--1:#24292E"> utf8mb4 </span><span style="--0:#FF79C6;--1:#BF3441">COLLATE</span><span style="--0:#F8F8F2;--1:#24292E"> utf8mb4_general_ci </span><span style="--0:#FF79C6;--1:#BF3441">NULL</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">DEFAULT</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">NULL</span><span style="--0:#F8F8F2;--1:#24292E">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--1:#032F62"><span style="--0:#E9F284">`</span><span style="--0:#F1FA8C">attr4</span><span style="--0:#E9F284">`</span></span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">varchar</span><span style="--0:#F8F8F2;--1:#24292E">(</span><span style="--0:#BD93F9;--1:#005CC5">255</span><span style="--0:#F8F8F2;--1:#24292E">) </span><span style="--0:#FF79C6;--1:#BF3441">CHARACTER</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">SET</span><span style="--0:#F8F8F2;--1:#24292E"> utf8mb4 </span><span style="--0:#FF79C6;--1:#BF3441">COLLATE</span><span style="--0:#F8F8F2;--1:#24292E"> utf8mb4_general_ci </span><span style="--0:#FF79C6;--1:#BF3441">NULL</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">DEFAULT</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">NULL</span><span style="--0:#F8F8F2;--1:#24292E">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--1:#032F62"><span style="--0:#E9F284">`</span><span style="--0:#F1FA8C">attr5</span><span style="--0:#E9F284">`</span></span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">varchar</span><span style="--0:#F8F8F2;--1:#24292E">(</span><span style="--0:#BD93F9;--1:#005CC5">255</span><span style="--0:#F8F8F2;--1:#24292E">) </span><span style="--0:#FF79C6;--1:#BF3441">CHARACTER</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">SET</span><span style="--0:#F8F8F2;--1:#24292E"> utf8mb4 </span><span style="--0:#FF79C6;--1:#BF3441">COLLATE</span><span style="--0:#F8F8F2;--1:#24292E"> utf8mb4_general_ci </span><span style="--0:#FF79C6;--1:#BF3441">NULL</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">DEFAULT</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">NULL</span><span style="--0:#F8F8F2;--1:#24292E">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--1:#032F62"><span style="--0:#E9F284">`</span><span style="--0:#F1FA8C">attr6</span><span style="--0:#E9F284">`</span></span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">varchar</span><span style="--0:#F8F8F2;--1:#24292E">(</span><span style="--0:#BD93F9;--1:#005CC5">255</span><span style="--0:#F8F8F2;--1:#24292E">) </span><span style="--0:#FF79C6;--1:#BF3441">CHARACTER</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">SET</span><span style="--0:#F8F8F2;--1:#24292E"> utf8mb4 </span><span style="--0:#FF79C6;--1:#BF3441">COLLATE</span><span style="--0:#F8F8F2;--1:#24292E"> utf8mb4_general_ci </span><span style="--0:#FF79C6;--1:#BF3441">NULL</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">DEFAULT</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">NULL</span><span style="--0:#F8F8F2;--1:#24292E">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--1:#032F62"><span style="--0:#E9F284">`</span><span style="--0:#F1FA8C">attr7</span><span style="--0:#E9F284">`</span></span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">varchar</span><span style="--0:#F8F8F2;--1:#24292E">(</span><span style="--0:#BD93F9;--1:#005CC5">255</span><span style="--0:#F8F8F2;--1:#24292E">) </span><span style="--0:#FF79C6;--1:#BF3441">CHARACTER</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">SET</span><span style="--0:#F8F8F2;--1:#24292E"> utf8mb4 </span><span style="--0:#FF79C6;--1:#BF3441">COLLATE</span><span style="--0:#F8F8F2;--1:#24292E"> utf8mb4_general_ci </span><span style="--0:#FF79C6;--1:#BF3441">NULL</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">DEFAULT</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">NULL</span><span style="--0:#F8F8F2;--1:#24292E">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--1:#032F62"><span style="--0:#E9F284">`</span><span style="--0:#F1FA8C">attr8</span><span style="--0:#E9F284">`</span></span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">varchar</span><span style="--0:#F8F8F2;--1:#24292E">(</span><span style="--0:#BD93F9;--1:#005CC5">255</span><span style="--0:#F8F8F2;--1:#24292E">) </span><span style="--0:#FF79C6;--1:#BF3441">CHARACTER</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">SET</span><span style="--0:#F8F8F2;--1:#24292E"> utf8mb4 </span><span style="--0:#FF79C6;--1:#BF3441">COLLATE</span><span style="--0:#F8F8F2;--1:#24292E"> utf8mb4_general_ci </span><span style="--0:#FF79C6;--1:#BF3441">NULL</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">DEFAULT</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">NULL</span><span style="--0:#F8F8F2;--1:#24292E">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--1:#032F62"><span style="--0:#E9F284">`</span><span style="--0:#F1FA8C">attr9</span><span style="--0:#E9F284">`</span></span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">varchar</span><span style="--0:#F8F8F2;--1:#24292E">(</span><span style="--0:#BD93F9;--1:#005CC5">255</span><span style="--0:#F8F8F2;--1:#24292E">) </span><span style="--0:#FF79C6;--1:#BF3441">CHARACTER</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">SET</span><span style="--0:#F8F8F2;--1:#24292E"> utf8mb4 </span><span style="--0:#FF79C6;--1:#BF3441">COLLATE</span><span style="--0:#F8F8F2;--1:#24292E"> utf8mb4_general_ci </span><span style="--0:#FF79C6;--1:#BF3441">NULL</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">DEFAULT</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">NULL</span><span style="--0:#F8F8F2;--1:#24292E">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--1:#032F62"><span style="--0:#E9F284">`</span><span style="--0:#F1FA8C">attr10</span><span style="--0:#E9F284">`</span></span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">varchar</span><span style="--0:#F8F8F2;--1:#24292E">(</span><span style="--0:#BD93F9;--1:#005CC5">255</span><span style="--0:#F8F8F2;--1:#24292E">) </span><span style="--0:#FF79C6;--1:#BF3441">CHARACTER</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">SET</span><span style="--0:#F8F8F2;--1:#24292E"> utf8mb4 </span><span style="--0:#FF79C6;--1:#BF3441">COLLATE</span><span style="--0:#F8F8F2;--1:#24292E"> utf8mb4_general_ci </span><span style="--0:#FF79C6;--1:#BF3441">NULL</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">DEFAULT</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">NULL</span><span style="--0:#F8F8F2;--1:#24292E">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--1:#032F62"><span style="--0:#E9F284">`</span><span style="--0:#F1FA8C">attr11</span><span style="--0:#E9F284">`</span></span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">varchar</span><span style="--0:#F8F8F2;--1:#24292E">(</span><span style="--0:#BD93F9;--1:#005CC5">255</span><span style="--0:#F8F8F2;--1:#24292E">) </span><span style="--0:#FF79C6;--1:#BF3441">CHARACTER</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">SET</span><span style="--0:#F8F8F2;--1:#24292E"> utf8mb4 </span><span style="--0:#FF79C6;--1:#BF3441">COLLATE</span><span style="--0:#F8F8F2;--1:#24292E"> utf8mb4_general_ci </span><span style="--0:#FF79C6;--1:#BF3441">NULL</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">DEFAULT</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">NULL</span><span style="--0:#F8F8F2;--1:#24292E">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--1:#032F62"><span style="--0:#E9F284">`</span><span style="--0:#F1FA8C">attr12</span><span style="--0:#E9F284">`</span></span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">varchar</span><span style="--0:#F8F8F2;--1:#24292E">(</span><span style="--0:#BD93F9;--1:#005CC5">255</span><span style="--0:#F8F8F2;--1:#24292E">) </span><span style="--0:#FF79C6;--1:#BF3441">CHARACTER</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">SET</span><span style="--0:#F8F8F2;--1:#24292E"> utf8mb4 </span><span style="--0:#FF79C6;--1:#BF3441">COLLATE</span><span style="--0:#F8F8F2;--1:#24292E"> utf8mb4_general_ci </span><span style="--0:#FF79C6;--1:#BF3441">NULL</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">DEFAULT</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">NULL</span><span style="--0:#F8F8F2;--1:#24292E">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#FF79C6;--1:#BF3441">PRIMARY KEY</span><span style="--0:#F8F8F2;--1:#24292E"> (</span><span style="--1:#032F62"><span style="--0:#E9F284">`</span><span style="--0:#F1FA8C">id</span><span style="--0:#E9F284">`</span></span><span style="--0:#F8F8F2;--1:#24292E">) </span><span style="--0:#FF79C6;--1:#BF3441">USING</span><span style="--0:#F8F8F2;--1:#24292E"> BTREE</span></div></div><div class="ec-line"><div class="code"><span style="--0:#F8F8F2;--1:#24292E">) ENGINE </span><span style="--0:#FF79C6;--1:#BF3441">=</span><span style="--0:#F8F8F2;--1:#24292E"> InnoDB AUTO_INCREMENT </span><span style="--0:#FF79C6;--1:#BF3441">=</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#BD93F9;--1:#005CC5">1</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">CHARACTER</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">SET</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">=</span><span style="--0:#F8F8F2;--1:#24292E"> utf8mb4 </span><span style="--0:#FF79C6;--1:#BF3441">COLLATE</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">=</span><span style="--0:#F8F8F2;--1:#24292E"> utf8mb4_general_ci ROW_FORMAT </span><span style="--0:#FF79C6;--1:#BF3441">=</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">Dynamic</span><span style="--0:#F8F8F2;--1:#24292E">;</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="CREATE TABLE `user_operation_log`  (  `id` int(11) NOT NULL AUTO_INCREMENT,  `user_id` varchar(64) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT NULL,  `ip` varchar(20) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT NULL,  `op_data` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT NULL,  `attr1` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT NULL,  `attr2` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT NULL,  `attr3` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT NULL,  `attr4` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT NULL,  `attr5` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT NULL,  `attr6` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT NULL,  `attr7` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT NULL,  `attr8` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT NULL,  `attr9` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT NULL,  `attr10` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT NULL,  `attr11` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT NULL,  `attr12` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT NULL,  PRIMARY KEY (`id`) USING BTREE) ENGINE = InnoDB AUTO_INCREMENT = 1 CHARACTER SET = utf8mb4 COLLATE = utf8mb4_general_ci ROW_FORMAT = Dynamic;"><div></div></button></div></figure></div>
<h4 id="创建数据脚本">创建数据脚本</h4>
<p>采用批量插入,效率会快很多,而且每1000条数就commit,数据量太大,也会导致批量插入效率慢</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="sql"><code><div class="ec-line"><div class="code"><span style="--0:#F8F8F2;--1:#24292E">DELIMITER ;;</span></div></div><div class="ec-line"><div class="code"><span style="--0:#FF79C6;--1:#BF3441">CREATE</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">PROCEDURE</span><span style="--0:#F8F8F2;--1:#24292E"> batch_insert_log()</span></div></div><div class="ec-line"><div class="code"><span style="--0:#FF79C6;--1:#BF3441">BEGIN</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#FF79C6;--1:#BF3441">DECLARE</span><span style="--0:#F8F8F2;--1:#24292E"> i </span><span style="--0:#FF79C6;--1:#BF3441">INT</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">DEFAULT</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#BD93F9;--1:#005CC5">1</span><span style="--0:#F8F8F2;--1:#24292E">;</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#FF79C6;--1:#BF3441">DECLARE</span><span style="--0:#F8F8F2;--1:#24292E"> userId </span><span style="--0:#FF79C6;--1:#BF3441">INT</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">DEFAULT</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#BD93F9;--1:#005CC5">10000000</span><span style="--0:#F8F8F2;--1:#24292E">;</span></div></div><div class="ec-line"><div class="code"><span class="indent"> </span><span style="--0:#FF79C6;--1:#BF3441">set</span><span style="--0:#F8F8F2;--1:#24292E"> @execSql </span><span style="--0:#FF79C6;--1:#BF3441">=</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--1:#032F62"><span style="--0:#E9F284">&#39;</span><span style="--0:#F1FA8C">INSERT INTO `test`.`user_operation_log`(`user_id`, `ip`, `op_data`, `attr1`, `attr2`, `attr3`, `attr4`, `attr5`, `attr6`, `attr7`, `attr8`, `attr9`, `attr10`, `attr11`, `attr12`) VALUES</span><span style="--0:#E9F284">&#39;</span></span><span style="--0:#F8F8F2;--1:#24292E">;</span></div></div><div class="ec-line"><div class="code"><span class="indent"> </span><span style="--0:#FF79C6;--1:#BF3441">set</span><span style="--0:#F8F8F2;--1:#24292E"> @execData </span><span style="--0:#FF79C6;--1:#BF3441">=</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#E9F284;--1:#032F62">&#39;&#39;</span><span style="--0:#F8F8F2;--1:#24292E">;</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#FF79C6;--1:#BF3441">WHILE</span><span style="--0:#F8F8F2;--1:#24292E"> i</span><span style="--0:#FF79C6;--1:#BF3441">&lt;=</span><span style="--0:#BD93F9;--1:#005CC5">10000000</span><span style="--0:#F8F8F2;--1:#24292E"> DO</span></div></div><div class="ec-line"><div class="code"><span class="indent">   </span><span style="--0:#FF79C6;--1:#BF3441">set</span><span style="--0:#F8F8F2;--1:#24292E"> @attr </span><span style="--0:#FF79C6;--1:#BF3441">=</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--1:#032F62"><span style="--0:#E9F284">&quot;</span><span style="--0:#F1FA8C">&#39;测试很长很长很长很长很长很长很长很长很长很长很长很长很长很长很长很长很长的属性&#39;</span><span style="--0:#E9F284">&quot;</span></span><span style="--0:#F8F8F2;--1:#24292E">;</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#FF79C6;--1:#BF3441">set</span><span style="--0:#F8F8F2;--1:#24292E"> @execData </span><span style="--0:#FF79C6;--1:#BF3441">=</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#8BE9FD;--1:#005CC5">concat</span><span style="--0:#F8F8F2;--1:#24292E">(@execData, </span><span style="--1:#032F62"><span style="--0:#E9F284">&quot;</span><span style="--0:#F1FA8C">(</span><span style="--0:#E9F284">&quot;</span></span><span style="--0:#F8F8F2;--1:#24292E">, userId </span><span style="--0:#FF79C6;--1:#BF3441">+</span><span style="--0:#F8F8F2;--1:#24292E"> i, </span><span style="--1:#032F62"><span style="--0:#E9F284">&quot;</span><span style="--0:#F1FA8C">, &#39;10.0.69.175&#39;, &#39;用户登录操作&#39;</span><span style="--0:#E9F284">&quot;</span></span><span style="--0:#F8F8F2;--1:#24292E">, </span><span style="--1:#032F62"><span style="--0:#E9F284">&quot;</span><span style="--0:#F1FA8C">,</span><span style="--0:#E9F284">&quot;</span></span><span style="--0:#F8F8F2;--1:#24292E">, @attr, </span><span style="--1:#032F62"><span style="--0:#E9F284">&quot;</span><span style="--0:#F1FA8C">,</span><span style="--0:#E9F284">&quot;</span></span><span style="--0:#F8F8F2;--1:#24292E">, @attr, </span><span style="--1:#032F62"><span style="--0:#E9F284">&quot;</span><span style="--0:#F1FA8C">,</span><span style="--0:#E9F284">&quot;</span></span><span style="--0:#F8F8F2;--1:#24292E">, @attr, </span><span style="--1:#032F62"><span style="--0:#E9F284">&quot;</span><span style="--0:#F1FA8C">,</span><span style="--0:#E9F284">&quot;</span></span><span style="--0:#F8F8F2;--1:#24292E">, @attr, </span><span style="--1:#032F62"><span style="--0:#E9F284">&quot;</span><span style="--0:#F1FA8C">,</span><span style="--0:#E9F284">&quot;</span></span><span style="--0:#F8F8F2;--1:#24292E">, @attr, </span><span style="--1:#032F62"><span style="--0:#E9F284">&quot;</span><span style="--0:#F1FA8C">,</span><span style="--0:#E9F284">&quot;</span></span><span style="--0:#F8F8F2;--1:#24292E">, @attr, </span><span style="--1:#032F62"><span style="--0:#E9F284">&quot;</span><span style="--0:#F1FA8C">,</span><span style="--0:#E9F284">&quot;</span></span><span style="--0:#F8F8F2;--1:#24292E">, @attr, </span><span style="--1:#032F62"><span style="--0:#E9F284">&quot;</span><span style="--0:#F1FA8C">,</span><span style="--0:#E9F284">&quot;</span></span><span style="--0:#F8F8F2;--1:#24292E">, @attr, </span><span style="--1:#032F62"><span style="--0:#E9F284">&quot;</span><span style="--0:#F1FA8C">,</span><span style="--0:#E9F284">&quot;</span></span><span style="--0:#F8F8F2;--1:#24292E">, @attr, </span><span style="--1:#032F62"><span style="--0:#E9F284">&quot;</span><span style="--0:#F1FA8C">,</span><span style="--0:#E9F284">&quot;</span></span><span style="--0:#F8F8F2;--1:#24292E">, @attr, </span><span style="--1:#032F62"><span style="--0:#E9F284">&quot;</span><span style="--0:#F1FA8C">,</span><span style="--0:#E9F284">&quot;</span></span><span style="--0:#F8F8F2;--1:#24292E">, @attr, </span><span style="--1:#032F62"><span style="--0:#E9F284">&quot;</span><span style="--0:#F1FA8C">,</span><span style="--0:#E9F284">&quot;</span></span><span style="--0:#F8F8F2;--1:#24292E">, @attr, </span><span style="--1:#032F62"><span style="--0:#E9F284">&quot;</span><span style="--0:#F1FA8C">)</span><span style="--0:#E9F284">&quot;</span></span><span style="--0:#F8F8F2;--1:#24292E">);</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#FF79C6;--1:#BF3441">if</span><span style="--0:#F8F8F2;--1:#24292E"> i % </span><span style="--0:#BD93F9;--1:#005CC5">1000</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">=</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#BD93F9;--1:#005CC5">0</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#FF79C6;--1:#BF3441">then</span></div></div><div class="ec-line"><div class="code"><span class="indent">     </span><span style="--0:#FF79C6;--1:#BF3441">set</span><span style="--0:#F8F8F2;--1:#24292E"> @stmtSql </span><span style="--0:#FF79C6;--1:#BF3441">=</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#8BE9FD;--1:#005CC5">concat</span><span style="--0:#F8F8F2;--1:#24292E">(@execSql, @execData,</span><span style="--1:#032F62"><span style="--0:#E9F284">&quot;</span><span style="--0:#F1FA8C">;</span><span style="--0:#E9F284">&quot;</span></span><span style="--0:#F8F8F2;--1:#24292E">);</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#F8F8F2;--1:#24292E">    </span></span><span style="--0:#F8F8F2;--1:#24292E">prepare stmt </span><span style="--0:#FF79C6;--1:#BF3441">from</span><span style="--0:#F8F8F2;--1:#24292E"> @stmtSql;</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#FF79C6;--1:#BF3441">execute</span><span style="--0:#F8F8F2;--1:#24292E"> stmt;</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#FF79C6;--1:#BF3441">DEALLOCATE</span><span style="--0:#F8F8F2;--1:#24292E"> prepare stmt;</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#FF79C6;--1:#BF3441">commit</span><span style="--0:#F8F8F2;--1:#24292E">;</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#FF79C6;--1:#BF3441">set</span><span style="--0:#F8F8F2;--1:#24292E"> @execData </span><span style="--0:#FF79C6;--1:#BF3441">=</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#E9F284;--1:#032F62">&quot;&quot;</span><span style="--0:#F8F8F2;--1:#24292E">;</span></div></div><div class="ec-line"><div class="code"><span class="indent">   </span><span style="--0:#FF79C6;--1:#BF3441">else</span></div></div><div class="ec-line"><div class="code"><span class="indent">     </span><span style="--0:#FF79C6;--1:#BF3441">set</span><span style="--0:#F8F8F2;--1:#24292E"> @execData </span><span style="--0:#FF79C6;--1:#BF3441">=</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#8BE9FD;--1:#005CC5">concat</span><span style="--0:#F8F8F2;--1:#24292E">(@execData, </span><span style="--1:#032F62"><span style="--0:#E9F284">&quot;</span><span style="--0:#F1FA8C">,</span><span style="--0:#E9F284">&quot;</span></span><span style="--0:#F8F8F2;--1:#24292E">);</span></div></div><div class="ec-line"><div class="code"><span class="indent">   </span><span style="--0:#FF79C6;--1:#BF3441">end</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">if</span><span style="--0:#F8F8F2;--1:#24292E">;</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#FF79C6;--1:#BF3441">SET</span><span style="--0:#F8F8F2;--1:#24292E"> i</span><span style="--0:#FF79C6;--1:#BF3441">=</span><span style="--0:#F8F8F2;--1:#24292E">i</span><span style="--0:#FF79C6;--1:#BF3441">+</span><span style="--0:#BD93F9;--1:#005CC5">1</span><span style="--0:#F8F8F2;--1:#24292E">;</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#FF79C6;--1:#BF3441">END</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">WHILE</span><span style="--0:#F8F8F2;--1:#24292E">;</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#FF79C6;--1:#BF3441">END</span><span style="--0:#F8F8F2;--1:#24292E">;;</span></div></div><div class="ec-line"><div class="code"><span style="--0:#F8F8F2;--1:#24292E">DELIMITER ;</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="DELIMITER ;;CREATE PROCEDURE batch_insert_log()BEGIN  DECLARE i INT DEFAULT 1;  DECLARE userId INT DEFAULT 10000000; set @execSql = 'INSERT INTO `test`.`user_operation_log`(`user_id`, `ip`, `op_data`, `attr1`, `attr2`, `attr3`, `attr4`, `attr5`, `attr6`, `attr7`, `attr8`, `attr9`, `attr10`, `attr11`, `attr12`) VALUES'; set @execData = '';  WHILE i<=10000000 DO   set @attr = &#34;'测试很长很长很长很长很长很长很长很长很长很长很长很长很长很长很长很长很长的属性'&#34;;  set @execData = concat(@execData, &#34;(&#34;, userId + i, &#34;, '10.0.69.175', '用户登录操作'&#34;, &#34;,&#34;, @attr, &#34;,&#34;, @attr, &#34;,&#34;, @attr, &#34;,&#34;, @attr, &#34;,&#34;, @attr, &#34;,&#34;, @attr, &#34;,&#34;, @attr, &#34;,&#34;, @attr, &#34;,&#34;, @attr, &#34;,&#34;, @attr, &#34;,&#34;, @attr, &#34;,&#34;, @attr, &#34;)&#34;);  if i % 1000 = 0  then     set @stmtSql = concat(@execSql, @execData,&#34;;&#34;);    prepare stmt from @stmtSql;    execute stmt;    DEALLOCATE prepare stmt;    commit;    set @execData = &#34;&#34;;   else     set @execData = concat(@execData, &#34;,&#34;);   end if;  SET i=i+1;  END WHILE;END;;DELIMITER ;"><div></div></button></div></figure></div>
<h4 id="开始测试">开始测试</h4>
<blockquote>
<p>电脑配置比较低: win10 标压渣渣i5 读写约500MB的SSD</p>
</blockquote>
<p>由于配置低,本次测试只准备了3148000条数据,占用了磁盘5G(还没建索引的情况下),跑了38min,电脑配置好的同学,可以插入多点数据测试</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="sql"><code><div class="ec-line"><div class="code"><span style="--0:#FF79C6;--1:#BF3441">SELECT</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#8BE9FD;--1:#005CC5">count</span><span style="--0:#F8F8F2;--1:#24292E">(</span><span style="--0:#BD93F9;--1:#005CC5">1</span><span style="--0:#F8F8F2;--1:#24292E">) </span><span style="--0:#FF79C6;--1:#BF3441">FROM</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--1:#032F62"><span style="--0:#E9F284">`</span><span style="--0:#F1FA8C">user_operation_log</span><span style="--0:#E9F284">`</span></span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="SELECT count(1) FROM `user_operation_log`"><div></div></button></div></figure></div>
<p>返回结果: 3148000</p>
<p>三次查询时间分别为:</p>
<ul>
<li>14060 ms</li>
<li>13755 ms</li>
<li>13447 ms</li>
</ul>
<h4 id="普通分页查询">普通分页查询</h4>
<p>MySQL 支持 LIMIT 语句来选取指定的条数数据, Oracle 可以使用 ROWNUM 来选取。</p>
<p>MySQL分页查询语法如下:</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="sql"><code><div class="ec-line"><div class="code"><span style="--0:#FF79C6;--1:#BF3441">SELECT</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">*</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">FROM</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">table</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">LIMIT</span><span style="--0:#F8F8F2;--1:#24292E"> [offset,] </span><span style="--0:#FF79C6;--1:#BF3441">rows</span><span style="--0:#F8F8F2;--1:#24292E"> | </span><span style="--0:#FF79C6;--1:#BF3441">rows</span><span style="--0:#F8F8F2;--1:#24292E"> OFFSET offset</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="SELECT * FROM table LIMIT [offset,] rows | rows OFFSET offset"><div></div></button></div></figure></div>
<ul>
<li>第一个参数指定第一个返回记录行的偏移量</li>
<li>第二个参数指定返回记录行的最大数目</li>
</ul>
<p>下面我们开始测试查询结果:</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="sql"><code><div class="ec-line"><div class="code"><span style="--0:#FF79C6;--1:#BF3441">SELECT</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">*</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">FROM</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--1:#032F62"><span style="--0:#E9F284">`</span><span style="--0:#F1FA8C">user_operation_log</span><span style="--0:#E9F284">`</span></span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">LIMIT</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#BD93F9;--1:#005CC5">10000</span><span style="--0:#F8F8F2;--1:#24292E">, </span><span style="--0:#BD93F9;--1:#005CC5">10</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="SELECT * FROM `user_operation_log` LIMIT 10000, 10"><div></div></button></div></figure></div>
<p>查询3次时间分别为:</p>
<ul>
<li>59 ms</li>
<li>49 ms</li>
<li>50 ms</li>
</ul>
<p>这样看起来速度还行,不过是本地数据库,速度自然快点。</p>
<p>换个角度来测试</p>
<h4 id="相同偏移量不同数据量">相同偏移量,不同数据量</h4>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="sql"><code><div class="ec-line"><div class="code"><span style="--0:#FF79C6;--1:#BF3441">SELECT</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">*</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">FROM</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--1:#032F62"><span style="--0:#E9F284">`</span><span style="--0:#F1FA8C">user_operation_log</span><span style="--0:#E9F284">`</span></span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">LIMIT</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#BD93F9;--1:#005CC5">10000</span><span style="--0:#F8F8F2;--1:#24292E">, </span><span style="--0:#BD93F9;--1:#005CC5">10</span></div></div><div class="ec-line"><div class="code"><span style="--0:#FF79C6;--1:#BF3441">SELECT</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">*</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">FROM</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--1:#032F62"><span style="--0:#E9F284">`</span><span style="--0:#F1FA8C">user_operation_log</span><span style="--0:#E9F284">`</span></span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">LIMIT</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#BD93F9;--1:#005CC5">10000</span><span style="--0:#F8F8F2;--1:#24292E">, </span><span style="--0:#BD93F9;--1:#005CC5">100</span></div></div><div class="ec-line"><div class="code"><span style="--0:#FF79C6;--1:#BF3441">SELECT</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">*</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">FROM</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--1:#032F62"><span style="--0:#E9F284">`</span><span style="--0:#F1FA8C">user_operation_log</span><span style="--0:#E9F284">`</span></span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">LIMIT</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#BD93F9;--1:#005CC5">10000</span><span style="--0:#F8F8F2;--1:#24292E">, </span><span style="--0:#BD93F9;--1:#005CC5">1000</span></div></div><div class="ec-line"><div class="code"><span style="--0:#FF79C6;--1:#BF3441">SELECT</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">*</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">FROM</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--1:#032F62"><span style="--0:#E9F284">`</span><span style="--0:#F1FA8C">user_operation_log</span><span style="--0:#E9F284">`</span></span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">LIMIT</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#BD93F9;--1:#005CC5">10000</span><span style="--0:#F8F8F2;--1:#24292E">, </span><span style="--0:#BD93F9;--1:#005CC5">10000</span></div></div><div class="ec-line"><div class="code"><span style="--0:#FF79C6;--1:#BF3441">SELECT</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">*</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">FROM</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--1:#032F62"><span style="--0:#E9F284">`</span><span style="--0:#F1FA8C">user_operation_log</span><span style="--0:#E9F284">`</span></span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">LIMIT</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#BD93F9;--1:#005CC5">10000</span><span style="--0:#F8F8F2;--1:#24292E">, </span><span style="--0:#BD93F9;--1:#005CC5">100000</span></div></div><div class="ec-line"><div class="code"><span style="--0:#FF79C6;--1:#BF3441">SELECT</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">*</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">FROM</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--1:#032F62"><span style="--0:#E9F284">`</span><span style="--0:#F1FA8C">user_operation_log</span><span style="--0:#E9F284">`</span></span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">LIMIT</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#BD93F9;--1:#005CC5">10000</span><span style="--0:#F8F8F2;--1:#24292E">, </span><span style="--0:#BD93F9;--1:#005CC5">1000000</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="SELECT * FROM `user_operation_log` LIMIT 10000, 10SELECT * FROM `user_operation_log` LIMIT 10000, 100SELECT * FROM `user_operation_log` LIMIT 10000, 1000SELECT * FROM `user_operation_log` LIMIT 10000, 10000SELECT * FROM `user_operation_log` LIMIT 10000, 100000SELECT * FROM `user_operation_log` LIMIT 10000, 1000000"><div></div></button></div></figure></div>
<p>查询时间如下:</p>















































<table><thead><tr><th style="text-align:left">数量</th><th style="text-align:left">第一次</th><th style="text-align:left">第二次</th><th style="text-align:left">第三次</th></tr></thead><tbody><tr><td style="text-align:left">10条</td><td style="text-align:left">53ms</td><td style="text-align:left">52ms</td><td style="text-align:left">47ms</td></tr><tr><td style="text-align:left">100条</td><td style="text-align:left">50ms</td><td style="text-align:left">60ms</td><td style="text-align:left">55ms</td></tr><tr><td style="text-align:left">1000条</td><td style="text-align:left">61ms</td><td style="text-align:left">74ms</td><td style="text-align:left">60ms</td></tr><tr><td style="text-align:left">10000条</td><td style="text-align:left">164ms</td><td style="text-align:left">180ms</td><td style="text-align:left">217ms</td></tr><tr><td style="text-align:left">100000条</td><td style="text-align:left">1609ms</td><td style="text-align:left">1741ms</td><td style="text-align:left">1764ms</td></tr><tr><td style="text-align:left">1000000条</td><td style="text-align:left">16219ms</td><td style="text-align:left">16889ms</td><td style="text-align:left">17081ms</td></tr></tbody></table>
<p>从上面结果可以得出结束: <strong>数据量越大,花费时间越长</strong></p>
<h4 id="相同数据量不同偏移量">相同数据量,不同偏移量</h4>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="sql"><code><div class="ec-line"><div class="code"><span style="--0:#FF79C6;--1:#BF3441">SELECT</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">*</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">FROM</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--1:#032F62"><span style="--0:#E9F284">`</span><span style="--0:#F1FA8C">user_operation_log</span><span style="--0:#E9F284">`</span></span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">LIMIT</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#BD93F9;--1:#005CC5">100</span><span style="--0:#F8F8F2;--1:#24292E">, </span><span style="--0:#BD93F9;--1:#005CC5">100</span></div></div><div class="ec-line"><div class="code"><span style="--0:#FF79C6;--1:#BF3441">SELECT</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">*</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">FROM</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--1:#032F62"><span style="--0:#E9F284">`</span><span style="--0:#F1FA8C">user_operation_log</span><span style="--0:#E9F284">`</span></span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">LIMIT</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#BD93F9;--1:#005CC5">1000</span><span style="--0:#F8F8F2;--1:#24292E">, </span><span style="--0:#BD93F9;--1:#005CC5">100</span></div></div><div class="ec-line"><div class="code"><span style="--0:#FF79C6;--1:#BF3441">SELECT</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">*</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">FROM</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--1:#032F62"><span style="--0:#E9F284">`</span><span style="--0:#F1FA8C">user_operation_log</span><span style="--0:#E9F284">`</span></span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">LIMIT</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#BD93F9;--1:#005CC5">10000</span><span style="--0:#F8F8F2;--1:#24292E">, </span><span style="--0:#BD93F9;--1:#005CC5">100</span></div></div><div class="ec-line"><div class="code"><span style="--0:#FF79C6;--1:#BF3441">SELECT</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">*</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">FROM</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--1:#032F62"><span style="--0:#E9F284">`</span><span style="--0:#F1FA8C">user_operation_log</span><span style="--0:#E9F284">`</span></span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">LIMIT</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#BD93F9;--1:#005CC5">100000</span><span style="--0:#F8F8F2;--1:#24292E">, </span><span style="--0:#BD93F9;--1:#005CC5">100</span></div></div><div class="ec-line"><div class="code"><span style="--0:#FF79C6;--1:#BF3441">SELECT</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">*</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">FROM</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--1:#032F62"><span style="--0:#E9F284">`</span><span style="--0:#F1FA8C">user_operation_log</span><span style="--0:#E9F284">`</span></span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">LIMIT</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#BD93F9;--1:#005CC5">1000000</span><span style="--0:#F8F8F2;--1:#24292E">, </span><span style="--0:#BD93F9;--1:#005CC5">100</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="SELECT * FROM `user_operation_log` LIMIT 100, 100SELECT * FROM `user_operation_log` LIMIT 1000, 100SELECT * FROM `user_operation_log` LIMIT 10000, 100SELECT * FROM `user_operation_log` LIMIT 100000, 100SELECT * FROM `user_operation_log` LIMIT 1000000, 100"><div></div></button></div></figure></div>









































<table><thead><tr><th style="text-align:left">偏移量</th><th style="text-align:left">第一次</th><th style="text-align:left">第二次</th><th style="text-align:left">第三次</th></tr></thead><tbody><tr><td style="text-align:left">100</td><td style="text-align:left">36ms</td><td style="text-align:left">40ms</td><td style="text-align:left">36ms</td></tr><tr><td style="text-align:left">1000</td><td style="text-align:left">31ms</td><td style="text-align:left">38ms</td><td style="text-align:left">32ms</td></tr><tr><td style="text-align:left">10000</td><td style="text-align:left">53ms</td><td style="text-align:left">48ms</td><td style="text-align:left">51ms</td></tr><tr><td style="text-align:left">100000</td><td style="text-align:left">622ms</td><td style="text-align:left">576ms</td><td style="text-align:left">627ms</td></tr><tr><td style="text-align:left">1000000</td><td style="text-align:left">4891ms</td><td style="text-align:left">5076ms</td><td style="text-align:left">4856ms</td></tr></tbody></table>
<p>从上面结果可以得出结束: <strong>偏移量越大,花费时间越长</strong></p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="sql"><code><div class="ec-line"><div class="code"><span style="--0:#FF79C6;--1:#BF3441">SELECT</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">*</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">FROM</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--1:#032F62"><span style="--0:#E9F284">`</span><span style="--0:#F1FA8C">user_operation_log</span><span style="--0:#E9F284">`</span></span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">LIMIT</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#BD93F9;--1:#005CC5">100</span><span style="--0:#F8F8F2;--1:#24292E">, </span><span style="--0:#BD93F9;--1:#005CC5">100</span></div></div><div class="ec-line"><div class="code"><span style="--0:#FF79C6;--1:#BF3441">SELECT</span><span style="--0:#F8F8F2;--1:#24292E"> id, attr </span><span style="--0:#FF79C6;--1:#BF3441">FROM</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--1:#032F62"><span style="--0:#E9F284">`</span><span style="--0:#F1FA8C">user_operation_log</span><span style="--0:#E9F284">`</span></span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">LIMIT</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#BD93F9;--1:#005CC5">100</span><span style="--0:#F8F8F2;--1:#24292E">, </span><span style="--0:#BD93F9;--1:#005CC5">100</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="SELECT * FROM `user_operation_log` LIMIT 100, 100SELECT id, attr FROM `user_operation_log` LIMIT 100, 100"><div></div></button></div></figure></div>
<h4 id="如何优化">如何优化</h4>
<p>既然我们经过上面一番的折腾,也得出了结论,针对上面两个问题: 偏移大、数据量大,我们分别着手优化</p>
<p>优化偏移量大问题</p>
<h4 id="采用子查询方式">采用子查询方式</h4>
<p>我们可以先定位偏移位置的 id,然后再查询数据</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="sql"><code><div class="ec-line"><div class="code"><span style="--0:#FF79C6;--1:#BF3441">SELECT</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">*</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">FROM</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--1:#032F62"><span style="--0:#E9F284">`</span><span style="--0:#F1FA8C">user_operation_log</span><span style="--0:#E9F284">`</span></span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">LIMIT</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#BD93F9;--1:#005CC5">1000000</span><span style="--0:#F8F8F2;--1:#24292E">, </span><span style="--0:#BD93F9;--1:#005CC5">10</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#FF79C6;--1:#BF3441">SELECT</span><span style="--0:#F8F8F2;--1:#24292E"> id </span><span style="--0:#FF79C6;--1:#BF3441">FROM</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--1:#032F62"><span style="--0:#E9F284">`</span><span style="--0:#F1FA8C">user_operation_log</span><span style="--0:#E9F284">`</span></span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">LIMIT</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#BD93F9;--1:#005CC5">1000000</span><span style="--0:#F8F8F2;--1:#24292E">, </span><span style="--0:#BD93F9;--1:#005CC5">1</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#FF79C6;--1:#BF3441">SELECT</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">*</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">FROM</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--1:#032F62"><span style="--0:#E9F284">`</span><span style="--0:#F1FA8C">user_operation_log</span><span style="--0:#E9F284">`</span></span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">WHERE</span><span style="--0:#F8F8F2;--1:#24292E"> id </span><span style="--0:#FF79C6;--1:#BF3441">&gt;=</span><span style="--0:#F8F8F2;--1:#24292E"> (</span><span style="--0:#FF79C6;--1:#BF3441">SELECT</span><span style="--0:#F8F8F2;--1:#24292E"> id </span><span style="--0:#FF79C6;--1:#BF3441">FROM</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--1:#032F62"><span style="--0:#E9F284">`</span><span style="--0:#F1FA8C">user_operation_log</span><span style="--0:#E9F284">`</span></span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">LIMIT</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#BD93F9;--1:#005CC5">1000000</span><span style="--0:#F8F8F2;--1:#24292E">, </span><span style="--0:#BD93F9;--1:#005CC5">1</span><span style="--0:#F8F8F2;--1:#24292E">) </span><span style="--0:#FF79C6;--1:#BF3441">LIMIT</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#BD93F9;--1:#005CC5">10</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="SELECT * FROM `user_operation_log` LIMIT 1000000, 10SELECT id FROM `user_operation_log` LIMIT 1000000, 1SELECT * FROM `user_operation_log` WHERE id >= (SELECT id FROM `user_operation_log` LIMIT 1000000, 1) LIMIT 10"><div></div></button></div></figure></div>
<p>查询结果如下:</p>





























<table><thead><tr><th style="text-align:left">sql</th><th style="text-align:left">花费时间</th></tr></thead><tbody><tr><td style="text-align:left">第一条</td><td style="text-align:left">4818ms</td></tr><tr><td style="text-align:left">第二条(无索引情况下)</td><td style="text-align:left">4329ms</td></tr><tr><td style="text-align:left">第二条(有索引情况下)</td><td style="text-align:left">199ms</td></tr><tr><td style="text-align:left">第三条(无索引情况下)</td><td style="text-align:left">4319ms</td></tr><tr><td style="text-align:left">第三条(有索引情况下)</td><td style="text-align:left">201ms</td></tr></tbody></table>
<p>从上面结果得出结论:</p>
<ul>
<li>第一条花费的时间最大,第三条比第一条稍微好点</li>
<li>子查询使用索引速度更快</li>
</ul>
<p>缺点: 只适用于id递增的情况</p>
<p>id非递增的情况可以使用以下写法,但这种缺点是分页查询只能放在子查询里面</p>
<p>注意: 某些 mysql 版本不支持在 in 子句中使用 limit,所以采用了多个嵌套select</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="sql"><code><div class="ec-line"><div class="code"><span style="--0:#FF79C6;--1:#BF3441">SELECT</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">*</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">FROM</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--1:#032F62"><span style="--0:#E9F284">`</span><span style="--0:#F1FA8C">user_operation_log</span><span style="--0:#E9F284">`</span></span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">WHERE</span><span style="--0:#F8F8F2;--1:#24292E"> id </span><span style="--0:#FF79C6;--1:#BF3441">IN</span><span style="--0:#F8F8F2;--1:#24292E"> (</span><span style="--0:#FF79C6;--1:#BF3441">SELECT</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#BD93F9;--1:#005CC5">t</span><span style="--0:#F8F8F2;--1:#24292E">.</span><span style="--0:#BD93F9;--1:#005CC5">id</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">FROM</span><span style="--0:#F8F8F2;--1:#24292E"> (</span><span style="--0:#FF79C6;--1:#BF3441">SELECT</span><span style="--0:#F8F8F2;--1:#24292E"> id </span><span style="--0:#FF79C6;--1:#BF3441">FROM</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--1:#032F62"><span style="--0:#E9F284">`</span><span style="--0:#F1FA8C">user_operation_log</span><span style="--0:#E9F284">`</span></span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">LIMIT</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#BD93F9;--1:#005CC5">1000000</span><span style="--0:#F8F8F2;--1:#24292E">, </span><span style="--0:#BD93F9;--1:#005CC5">10</span><span style="--0:#F8F8F2;--1:#24292E">) </span><span style="--0:#FF79C6;--1:#BF3441">AS</span><span style="--0:#F8F8F2;--1:#24292E"> t)</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="SELECT * FROM `user_operation_log` WHERE id IN (SELECT t.id FROM (SELECT id FROM `user_operation_log` LIMIT 1000000, 10) AS t)"><div></div></button></div></figure></div>
<h4 id="采用-id-限定方式">采用 id 限定方式</h4>
<p>这种方法要求更高些,id必须是连续递增,而且还得计算id的范围,然后使用 between,sql如下</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="sql"><code><div class="ec-line"><div class="code"><span style="--0:#FF79C6;--1:#BF3441">SELECT</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">*</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">FROM</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--1:#032F62"><span style="--0:#E9F284">`</span><span style="--0:#F1FA8C">user_operation_log</span><span style="--0:#E9F284">`</span></span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">WHERE</span><span style="--0:#F8F8F2;--1:#24292E"> id </span><span style="--0:#FF79C6;--1:#BF3441">between</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#BD93F9;--1:#005CC5">1000000</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">AND</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#BD93F9;--1:#005CC5">1000100</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">LIMIT</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#BD93F9;--1:#005CC5">100</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#FF79C6;--1:#BF3441">SELECT</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">*</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">FROM</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--1:#032F62"><span style="--0:#E9F284">`</span><span style="--0:#F1FA8C">user_operation_log</span><span style="--0:#E9F284">`</span></span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">WHERE</span><span style="--0:#F8F8F2;--1:#24292E"> id </span><span style="--0:#FF79C6;--1:#BF3441">&gt;=</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#BD93F9;--1:#005CC5">1000000</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">LIMIT</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#BD93F9;--1:#005CC5">100</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="SELECT * FROM `user_operation_log` WHERE id between 1000000 AND 1000100 LIMIT 100SELECT * FROM `user_operation_log` WHERE id >= 1000000 LIMIT 100"><div></div></button></div></figure></div>
<p>查询结果如下:</p>

















<table><thead><tr><th style="text-align:left">sql</th><th style="text-align:left">花费时间</th></tr></thead><tbody><tr><td style="text-align:left">第一条</td><td style="text-align:left">22ms</td></tr><tr><td style="text-align:left">第二条</td><td style="text-align:left">21ms</td></tr></tbody></table>
<p>从结果可以看出这种方式非常快
<em>注意: 这里的 LIMIT 是限制了条数,没有采用偏移量</em></p>
<h4 id="优化数据量大问题">优化数据量大问题</h4>
<p>返回结果的数据量也会直接影响速度</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="sql"><code><div class="ec-line"><div class="code"><span style="--0:#FF79C6;--1:#BF3441">SELECT</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">*</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">FROM</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--1:#032F62"><span style="--0:#E9F284">`</span><span style="--0:#F1FA8C">user_operation_log</span><span style="--0:#E9F284">`</span></span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">LIMIT</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#BD93F9;--1:#005CC5">1</span><span style="--0:#F8F8F2;--1:#24292E">, </span><span style="--0:#BD93F9;--1:#005CC5">1000000</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#FF79C6;--1:#BF3441">SELECT</span><span style="--0:#F8F8F2;--1:#24292E"> id </span><span style="--0:#FF79C6;--1:#BF3441">FROM</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--1:#032F62"><span style="--0:#E9F284">`</span><span style="--0:#F1FA8C">user_operation_log</span><span style="--0:#E9F284">`</span></span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">LIMIT</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#BD93F9;--1:#005CC5">1</span><span style="--0:#F8F8F2;--1:#24292E">, </span><span style="--0:#BD93F9;--1:#005CC5">1000000</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#FF79C6;--1:#BF3441">SELECT</span><span style="--0:#F8F8F2;--1:#24292E"> id, user_id, ip, op_data, attr1, attr2, attr3, attr4, attr5, attr6, attr7, attr8, attr9, attr10, attr11, attr12 </span><span style="--0:#FF79C6;--1:#BF3441">FROM</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--1:#032F62"><span style="--0:#E9F284">`</span><span style="--0:#F1FA8C">user_operation_log</span><span style="--0:#E9F284">`</span></span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">LIMIT</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#BD93F9;--1:#005CC5">1</span><span style="--0:#F8F8F2;--1:#24292E">, </span><span style="--0:#BD93F9;--1:#005CC5">1000000</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="SELECT * FROM `user_operation_log` LIMIT 1, 1000000SELECT id FROM `user_operation_log` LIMIT 1, 1000000SELECT id, user_id, ip, op_data, attr1, attr2, attr3, attr4, attr5, attr6, attr7, attr8, attr9, attr10, attr11, attr12 FROM `user_operation_log` LIMIT 1, 1000000"><div></div></button></div></figure></div>
<p>查询结果如下:</p>





















<table><thead><tr><th style="text-align:left">sql</th><th style="text-align:left">花费时间</th></tr></thead><tbody><tr><td style="text-align:left">第一条</td><td style="text-align:left">15676ms</td></tr><tr><td style="text-align:left">第二条</td><td style="text-align:left">7298ms</td></tr><tr><td style="text-align:left">第三条</td><td style="text-align:left">15960ms</td></tr></tbody></table>
<p>从结果可以看出减少不需要的列,查询效率也可以得到明显提升</p>
<p>第一条和第三条查询速度差不多,这时候你肯定会吐槽,那我还写那么多字段干啥呢,直接 * 不就完事了</p>
<p>注意本人的 MySQL 服务器和客户端是在<strong>同一台机器</strong>上,所以查询数据相差不多,有条件的同学可以测测客户端与MySQL分开</p>
<p><strong>SELECT * 它不香吗?</strong></p>
<p>在这里顺便补充一下为什么要禁止 <code>SELECT *</code>。难道简单无脑,它不香吗?</p>
<p>主要两点:</p>
<ol>
<li>用 “<code>SELECT *</code>” 数据库需要解析更多的对象、字段、权限、属性等相关内容,在 SQL 语句复杂,硬解析较多的情况下,会对数据库造成沉重的负担。</li>
<li>增大网络开销,<code>*</code> 有时会误带上如log、IconMD5之类的无用且大文本字段,数据传输size会几何增涨。特别是MySQL和应用程序不在同一台机器,这种开销非常明显。</li>
</ol>
<h3 id="批量修改数据表和数据表中所有字段的字符集">批量修改数据表和数据表中所有字段的字符集</h3>
<p>查看数据表的行格式:</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="sql"><code><div class="ec-line"><div class="code"><span style="--0:#F8F8F2;--1:#24292E">show </span><span style="--0:#FF79C6;--1:#BF3441">table</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">status</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">like</span><span style="--0:#F8F8F2;--1:#24292E"> 库名</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="show table status like 库名"><div></div></button></div></figure></div>
<p>查看库的字符集:</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="sql"><code><div class="ec-line"><div class="code"><span style="--0:#F8F8F2;--1:#24292E">show </span><span style="--0:#FF79C6;--1:#BF3441">database</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">status</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">from</span><span style="--0:#F8F8F2;--1:#24292E"> 库名</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="show database status from 库名"><div></div></button></div></figure></div>
<p>查看表中所有列的字符集:</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="sql"><code><div class="ec-line"><div class="code"><span style="--0:#F8F8F2;--1:#24292E">show full columns </span><span style="--0:#FF79C6;--1:#BF3441">from</span><span style="--0:#F8F8F2;--1:#24292E"> 表名</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="show full columns from 表名"><div></div></button></div></figure></div>
<p>更改表编码(字符集)<strong>和表中所有字段</strong>的编码(字符集):</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="sql"><code><div class="ec-line"><div class="code"><span style="--0:#FF79C6;--1:#BF3441">ALTER</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">TABLE</span><span style="--0:#F8F8F2;--1:#24292E"> TABLE_NAME CONVERT </span><span style="--0:#FF79C6;--1:#BF3441">TO</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">CHARACTER</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">SET</span><span style="--0:#F8F8F2;--1:#24292E"> utf8mb4 </span><span style="--0:#FF79C6;--1:#BF3441">COLLATE</span><span style="--0:#F8F8F2;--1:#24292E"> utf8mb4_general_ci;</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="ALTER TABLE TABLE_NAME CONVERT TO CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci;"><div></div></button></div></figure></div>
<p>如果一个数据库有很多表要修改,可以使用如下办法:</p>
<p>查询某个数据库所有表名的语句:</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="sql"><code><div class="ec-line"><div class="code"><span style="--0:#FF79C6;--1:#BF3441">SELECT</span><span style="--0:#F8F8F2;--1:#24292E"> TABLE_NAME </span><span style="--0:#FF79C6;--1:#BF3441">from</span><span style="--0:#F8F8F2;--1:#24292E"> information_schema.</span><span style="--1:#032F62"><span style="--0:#E9F284">`</span><span style="--0:#F1FA8C">TABLES</span><span style="--0:#E9F284">`</span></span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">WHERE</span><span style="--0:#F8F8F2;--1:#24292E"> TABLE_SCHEMA </span><span style="--0:#FF79C6;--1:#BF3441">=</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--1:#032F62"><span style="--0:#E9F284">&#39;</span><span style="--0:#F1FA8C">DATABASE_NAME</span><span style="--0:#E9F284">&#39;</span></span><span style="--0:#F8F8F2;--1:#24292E">;</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="SELECT TABLE_NAME from information_schema.`TABLES` WHERE TABLE_SCHEMA = 'DATABASE_NAME';"><div></div></button></div></figure></div>
<p>得到所有的表名,我们可以把表名拼接到上面更改表编码(字符集)<strong>和表中所有字段</strong>的编码(字符集)的语句中去,得到如下语句:</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="sql"><code><div class="ec-line"><div class="code"><span style="--0:#FF79C6;--1:#BF3441">SELECT</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#8BE9FD;--1:#005CC5">CONCAT</span><span style="--0:#F8F8F2;--1:#24292E">(</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--1:#032F62"><span style="--0:#E9F284">&#39;</span><span style="--0:#F1FA8C">ALTER TABLE </span><span style="--0:#E9F284">&#39;</span></span><span style="--0:#F8F8F2;--1:#24292E">,</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#F8F8F2;--1:#24292E">    </span></span><span style="--0:#F8F8F2;--1:#24292E">TABLE_NAME,</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--1:#032F62"><span style="--0:#E9F284">&#39;</span><span style="--0:#F1FA8C"> CONVERT TO CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci;</span><span style="--0:#E9F284">&#39;</span></span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#F8F8F2;--1:#24292E">  </span></span><span style="--0:#F8F8F2;--1:#24292E">)</span></div></div><div class="ec-line"><div class="code"><span style="--0:#FF79C6;--1:#BF3441">FROM</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#F8F8F2;--1:#24292E">  </span></span><span style="--0:#F8F8F2;--1:#24292E">information_schema.</span><span style="--1:#032F62"><span style="--0:#E9F284">`</span><span style="--0:#F1FA8C">TABLES</span><span style="--0:#E9F284">`</span></span></div></div><div class="ec-line"><div class="code"><span style="--0:#FF79C6;--1:#BF3441">WHERE</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#F8F8F2;--1:#24292E">  </span></span><span style="--0:#F8F8F2;--1:#24292E">TABLE_SCHEMA </span><span style="--0:#FF79C6;--1:#BF3441">=</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--1:#032F62"><span style="--0:#E9F284">&#39;</span><span style="--0:#F1FA8C">DATABASE_NAME</span><span style="--0:#E9F284">&#39;</span></span><span style="--0:#F8F8F2;--1:#24292E">;</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="SELECT  CONCAT(    'ALTER TABLE ',    TABLE_NAME,    ' CONVERT TO CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci;'  )FROM  information_schema.`TABLES`WHERE  TABLE_SCHEMA = 'DATABASE_NAME';"><div></div></button></div></figure></div>
<h3 id="specified-key-was-too-long-max-key-length-is-767-bytes">Specified key was too long; max key length is 767 bytes</h3>
<p>在数据库中,索引的字段设置太长了,导致不支持。<strong>【根本原因: 5.6版本的innodb大长度前缀默认是关闭的】</strong></p>
<p>mysql 建立索引时,数据库计算key的长度是累加所有index用到的字段的char长度,按照一定的比例乘起来不能超过限定的key长度767。</p>
<ul>
<li>latin 1 = 1 byte = 1character</li>
<li>uft8 = 3 byte = 1 character</li>
<li>utf8mb4 = 4byte = 1character</li>
<li>gbk = 2 byte = 1 character</li>
</ul>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="sql"><code><div class="ec-line"><div class="code"><span style="--0:#FF79C6;--1:#BF3441">CREATE</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">TABLE</span><span style="--0:#F8F8F2;--1:#24292E"> `</span><span style="--0:#50FA7B;--1:#6F42C1">xxl_job_registry</span><span style="--0:#F8F8F2;--1:#24292E">` (</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--1:#032F62"><span style="--0:#E9F284">`</span><span style="--0:#F1FA8C">id</span><span style="--0:#E9F284">`</span></span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">int</span><span style="--0:#F8F8F2;--1:#24292E">(</span><span style="--0:#BD93F9;--1:#005CC5">11</span><span style="--0:#F8F8F2;--1:#24292E">) </span><span style="--0:#FF79C6;--1:#BF3441">NOT NULL</span><span style="--0:#F8F8F2;--1:#24292E"> AUTO_INCREMENT,</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--1:#032F62"><span style="--0:#E9F284">`</span><span style="--0:#F1FA8C">registry_group</span><span style="--0:#E9F284">`</span></span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">varchar</span><span style="--0:#F8F8F2;--1:#24292E">(</span><span style="--0:#BD93F9;--1:#005CC5">50</span><span style="--0:#F8F8F2;--1:#24292E">) </span><span style="--0:#FF79C6;--1:#BF3441">NOT NULL</span><span style="--0:#F8F8F2;--1:#24292E">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--1:#032F62"><span style="--0:#E9F284">`</span><span style="--0:#F1FA8C">registry_key</span><span style="--0:#E9F284">`</span></span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">varchar</span><span style="--0:#F8F8F2;--1:#24292E">(</span><span style="--0:#BD93F9;--1:#005CC5">190</span><span style="--0:#F8F8F2;--1:#24292E">) </span><span style="--0:#FF79C6;--1:#BF3441">NOT NULL</span><span style="--0:#F8F8F2;--1:#24292E">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--1:#032F62"><span style="--0:#E9F284">`</span><span style="--0:#F1FA8C">registry_value</span><span style="--0:#E9F284">`</span></span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">varchar</span><span style="--0:#F8F8F2;--1:#24292E">(</span><span style="--0:#BD93F9;--1:#005CC5">250</span><span style="--0:#F8F8F2;--1:#24292E">) </span><span style="--0:#FF79C6;--1:#BF3441">NOT NULL</span><span style="--0:#F8F8F2;--1:#24292E">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--1:#032F62"><span style="--0:#E9F284">`</span><span style="--0:#F1FA8C">update_time</span><span style="--0:#E9F284">`</span></span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">datetime</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">DEFAULT</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">NULL</span><span style="--0:#F8F8F2;--1:#24292E">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#FF79C6;--1:#BF3441">PRIMARY KEY</span><span style="--0:#F8F8F2;--1:#24292E"> (</span><span style="--1:#032F62"><span style="--0:#E9F284">`</span><span style="--0:#F1FA8C">id</span><span style="--0:#E9F284">`</span></span><span style="--0:#F8F8F2;--1:#24292E">),</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#FF79C6;--1:#BF3441">KEY</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--1:#032F62"><span style="--0:#E9F284">`</span><span style="--0:#F1FA8C">i_g_k_v</span><span style="--0:#E9F284">`</span></span><span style="--0:#F8F8F2;--1:#24292E"> (</span><span style="--1:#032F62"><span style="--0:#E9F284">`</span><span style="--0:#F1FA8C">registry_key</span><span style="--0:#E9F284">`</span></span><span style="--0:#F8F8F2;--1:#24292E">)</span></div></div><div class="ec-line"><div class="code"><span style="--0:#F8F8F2;--1:#24292E">) ENGINE</span><span style="--0:#FF79C6;--1:#BF3441">=</span><span style="--0:#F8F8F2;--1:#24292E">InnoDB </span><span style="--0:#FF79C6;--1:#BF3441">DEFAULT</span><span style="--0:#F8F8F2;--1:#24292E"> CHARSET</span><span style="--0:#FF79C6;--1:#BF3441">=</span><span style="--0:#F8F8F2;--1:#24292E">utf8mb4;</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#F8F8F2;--1:#24292E">registry_key </span><span style="--0:#BD93F9;--1:#005CC5">190</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">*</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#BD93F9;--1:#005CC5">4</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">=</span><span style="--0:#F8F8F2;--1:#24292E"> 760因此创建成功</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#F8F8F2;--1:#24292E">若将registry_key的字节数改成192,则195 </span><span style="--0:#FF79C6;--1:#BF3441">*</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#BD93F9;--1:#005CC5">4</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">=</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#BD93F9;--1:#005CC5">780</span><span style="--0:#F8F8F2;--1:#24292E"> 则创建不成功</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="CREATE TABLE `xxl_job_registry` (  `id` int(11) NOT NULL AUTO_INCREMENT,  `registry_group` varchar(50) NOT NULL,  `registry_key` varchar(190) NOT NULL,  `registry_value` varchar(250) NOT NULL,  `update_time` datetime DEFAULT NULL,  PRIMARY KEY (`id`),  KEY `i_g_k_v` (`registry_key`)) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;registry_key 190 * 4 = 760因此创建成功若将registry_key的字节数改成192,则195 * 4 = 780 则创建不成功"><div></div></button></div></figure></div>
<p>如果是联合索引时,应该是两个索引的字节加起来,然后折算成字节数。</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="sql"><code><div class="ec-line"><div class="code"><span style="--0:#FF79C6;--1:#BF3441">CREATE</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">TABLE</span><span style="--0:#F8F8F2;--1:#24292E"> `</span><span style="--0:#50FA7B;--1:#6F42C1">xxl_job_registry</span><span style="--0:#F8F8F2;--1:#24292E">` (</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--1:#032F62"><span style="--0:#E9F284">`</span><span style="--0:#F1FA8C">id</span><span style="--0:#E9F284">`</span></span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">int</span><span style="--0:#F8F8F2;--1:#24292E">(</span><span style="--0:#BD93F9;--1:#005CC5">11</span><span style="--0:#F8F8F2;--1:#24292E">) </span><span style="--0:#FF79C6;--1:#BF3441">NOT NULL</span><span style="--0:#F8F8F2;--1:#24292E"> AUTO_INCREMENT,</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--1:#032F62"><span style="--0:#E9F284">`</span><span style="--0:#F1FA8C">registry_group</span><span style="--0:#E9F284">`</span></span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">varchar</span><span style="--0:#F8F8F2;--1:#24292E">(</span><span style="--0:#BD93F9;--1:#005CC5">50</span><span style="--0:#F8F8F2;--1:#24292E">) </span><span style="--0:#FF79C6;--1:#BF3441">NOT NULL</span><span style="--0:#F8F8F2;--1:#24292E">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--1:#032F62"><span style="--0:#E9F284">`</span><span style="--0:#F1FA8C">registry_key</span><span style="--0:#E9F284">`</span></span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">varchar</span><span style="--0:#F8F8F2;--1:#24292E">(</span><span style="--0:#BD93F9;--1:#005CC5">190</span><span style="--0:#F8F8F2;--1:#24292E">) </span><span style="--0:#FF79C6;--1:#BF3441">NOT NULL</span><span style="--0:#F8F8F2;--1:#24292E">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--1:#032F62"><span style="--0:#E9F284">`</span><span style="--0:#F1FA8C">registry_value</span><span style="--0:#E9F284">`</span></span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">varchar</span><span style="--0:#F8F8F2;--1:#24292E">(</span><span style="--0:#BD93F9;--1:#005CC5">110</span><span style="--0:#F8F8F2;--1:#24292E">) </span><span style="--0:#FF79C6;--1:#BF3441">NOT NULL</span><span style="--0:#F8F8F2;--1:#24292E">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--1:#032F62"><span style="--0:#E9F284">`</span><span style="--0:#F1FA8C">update_time</span><span style="--0:#E9F284">`</span></span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">datetime</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">DEFAULT</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">NULL</span><span style="--0:#F8F8F2;--1:#24292E">,</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#FF79C6;--1:#BF3441">PRIMARY KEY</span><span style="--0:#F8F8F2;--1:#24292E"> (</span><span style="--1:#032F62"><span style="--0:#E9F284">`</span><span style="--0:#F1FA8C">id</span><span style="--0:#E9F284">`</span></span><span style="--0:#F8F8F2;--1:#24292E">),</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#FF79C6;--1:#BF3441">KEY</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--1:#032F62"><span style="--0:#E9F284">`</span><span style="--0:#F1FA8C">i_g_k_v</span><span style="--0:#E9F284">`</span></span><span style="--0:#F8F8F2;--1:#24292E"> (</span><span style="--1:#032F62"><span style="--0:#E9F284">`</span><span style="--0:#F1FA8C">registry_key</span><span style="--0:#E9F284">`</span></span><span style="--0:#F8F8F2;--1:#24292E">, </span><span style="--1:#032F62"><span style="--0:#E9F284">`</span><span style="--0:#F1FA8C">registry_value</span><span style="--0:#E9F284">`</span></span><span style="--0:#F8F8F2;--1:#24292E">)</span></div></div><div class="ec-line"><div class="code"><span style="--0:#F8F8F2;--1:#24292E">) ENGINE</span><span style="--0:#FF79C6;--1:#BF3441">=</span><span style="--0:#F8F8F2;--1:#24292E">InnoDB </span><span style="--0:#FF79C6;--1:#BF3441">DEFAULT</span><span style="--0:#F8F8F2;--1:#24292E"> CHARSET</span><span style="--0:#FF79C6;--1:#BF3441">=</span><span style="--0:#F8F8F2;--1:#24292E">utf8mb4;</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#F8F8F2;--1:#24292E">那么索引需要的字节数是: (</span><span style="--0:#BD93F9;--1:#005CC5">190</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">+</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#BD93F9;--1:#005CC5">110</span><span style="--0:#F8F8F2;--1:#24292E">) </span><span style="--0:#FF79C6;--1:#BF3441">*</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#BD93F9;--1:#005CC5">4</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">=</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#BD93F9;--1:#005CC5">1200</span></div></div><div class="ec-line"><div class="code"><span style="--0:#F8F8F2;--1:#24292E">创建不成功</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#F8F8F2;--1:#24292E">但是实际上呢,是能创建成功。</span></div></div><div class="ec-line"><div class="code"><span style="--0:#F8F8F2;--1:#24292E">在创建索引的时候进行了优化,取字节数最长的那个 </span><span style="--0:#BD93F9;--1:#005CC5">190</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">*</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#BD93F9;--1:#005CC5">4</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">=</span><span style="--0:#F8F8F2;--1:#24292E"> 760因此能创建成功。</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="CREATE TABLE `xxl_job_registry` (  `id` int(11) NOT NULL AUTO_INCREMENT,  `registry_group` varchar(50) NOT NULL,  `registry_key` varchar(190) NOT NULL,  `registry_value` varchar(110) NOT NULL,  `update_time` datetime DEFAULT NULL,  PRIMARY KEY (`id`),  KEY `i_g_k_v` (`registry_key`, `registry_value`)) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;那么索引需要的字节数是: (190 + 110) * 4 = 1200创建不成功但是实际上呢,是能创建成功。在创建索引的时候进行了优化,取字节数最长的那个 190 * 4 = 760因此能创建成功。"><div></div></button></div></figure></div>
<h4 id="解决方法">解决方法</h4>
<ol>
<li>
<p>修改索引的varchar字符,只要让字符 * 字节数 &lt; 767 即可。但是有时某个字段的字符数是一定要足够大的,那就用第二种方式。</p>
</li>
<li>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="sql"><code><div class="ec-line"><div class="code"><span style="--0:#FF79C6;--1:#BF3441">//</span><span style="--0:#F8F8F2;--1:#24292E"> 查看</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#F8F8F2;--1:#24292E">show variables </span><span style="--0:#FF79C6;--1:#BF3441">like</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--1:#032F62"><span style="--0:#E9F284">&quot;</span><span style="--0:#F1FA8C">innodb_large_prefix</span><span style="--0:#E9F284">&quot;</span></span><span style="--0:#F8F8F2;--1:#24292E">;</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#F8F8F2;--1:#24292E">show variables </span><span style="--0:#FF79C6;--1:#BF3441">like</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--1:#032F62"><span style="--0:#E9F284">&quot;</span><span style="--0:#F1FA8C">innodb_file_format</span><span style="--0:#E9F284">&quot;</span></span><span style="--0:#F8F8F2;--1:#24292E">;</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#FF79C6;--1:#BF3441">//</span><span style="--0:#F8F8F2;--1:#24292E">修改最大索引长度限制</span></div></div><div class="ec-line"><div class="code"><span style="--0:#FF79C6;--1:#BF3441">set</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">global</span><span style="--0:#F8F8F2;--1:#24292E"> innodb_large_prefix</span><span style="--0:#FF79C6;--1:#BF3441">=</span><span style="--0:#BD93F9;--1:#005CC5">1</span><span style="--0:#F8F8F2;--1:#24292E">;</span></div></div><div class="ec-line"><div class="code"><span style="--0:#F8F8F2;--1:#24292E">或</span></div></div><div class="ec-line"><div class="code"><span style="--0:#FF79C6;--1:#BF3441">set</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">global</span><span style="--0:#F8F8F2;--1:#24292E"> innodb_large_prefix</span><span style="--0:#FF79C6;--1:#BF3441">=on</span><span style="--0:#F8F8F2;--1:#24292E">;</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#FF79C6;--1:#BF3441">set</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">global</span><span style="--0:#F8F8F2;--1:#24292E"> innodb_file_format</span><span style="--0:#FF79C6;--1:#BF3441">=</span><span style="--0:#F8F8F2;--1:#24292E">BARRACUDA;</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="// 查看show variables like &#34;innodb_large_prefix&#34;;show variables like &#34;innodb_file_format&#34;;//修改最大索引长度限制set global innodb_large_prefix=1;或set global innodb_large_prefix=on;set global innodb_file_format=BARRACUDA;"><div></div></button></div></figure></div>
</li>
</ol>
<h2 id="性能优化">性能优化</h2>
<h3 id="建立索引的几个准则">建立索引的几个准则</h3>
<ol>
<li>合理的建立索引能够加速数据读取效率,不合理的建立索引反而会拖慢数据库的响应速度。</li>
<li>索引越多,更新数据的速度越慢。</li>
<li>尽量在采用MyIsam作为引擎的时候使用索引(因为MySQL以BTree存储索引),而不是InnoDB,但MyISAM不支持Transcation。</li>
<li>当你的程序和数据库结构/SQL语句已经优化到无法优化的程度,而程序瓶颈并不能顺利解决,那就是应该考虑使用诸如memcached这样的分布式缓存系统的时候了。</li>
<li>习惯和强迫自己用EXPLAIN来分析你SQL语句的性能。</li>
</ol>
<h3 id="count的优化">count的优化</h3>
<p>比如: 计算id大于5的城市。</p>
<p>a:</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="sql"><code><div class="ec-line"><div class="code"><span style="--0:#FF79C6;--1:#BF3441">select</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#8BE9FD;--1:#005CC5">count</span><span style="--0:#F8F8F2;--1:#24292E">(</span><span style="--0:#FF79C6;--1:#BF3441">*</span><span style="--0:#F8F8F2;--1:#24292E">) </span><span style="--0:#FF79C6;--1:#BF3441">from</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#BD93F9;--1:#005CC5">world</span><span style="--0:#F8F8F2;--1:#24292E">.</span><span style="--0:#BD93F9;--1:#005CC5">city</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">where</span><span style="--0:#F8F8F2;--1:#24292E"> id </span><span style="--0:#FF79C6;--1:#BF3441">&gt;</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#BD93F9;--1:#005CC5">5</span><span style="--0:#F8F8F2;--1:#24292E">;</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="select count(*) from world.city where id > 5;"><div></div></button></div></figure></div>
<p>b:</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="sql"><code><div class="ec-line"><div class="code"><span style="--0:#FF79C6;--1:#BF3441">select</span><span style="--0:#F8F8F2;--1:#24292E"> (</span><span style="--0:#FF79C6;--1:#BF3441">select</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#8BE9FD;--1:#005CC5">count</span><span style="--0:#F8F8F2;--1:#24292E">(</span><span style="--0:#FF79C6;--1:#BF3441">*</span><span style="--0:#F8F8F2;--1:#24292E">) </span><span style="--0:#FF79C6;--1:#BF3441">from</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#BD93F9;--1:#005CC5">world</span><span style="--0:#F8F8F2;--1:#24292E">.</span><span style="--0:#BD93F9;--1:#005CC5">city</span><span style="--0:#F8F8F2;--1:#24292E">) – </span><span style="--0:#8BE9FD;--1:#005CC5">count</span><span style="--0:#F8F8F2;--1:#24292E">(</span><span style="--0:#FF79C6;--1:#BF3441">*</span><span style="--0:#F8F8F2;--1:#24292E">) </span><span style="--0:#FF79C6;--1:#BF3441">from</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#BD93F9;--1:#005CC5">world</span><span style="--0:#F8F8F2;--1:#24292E">.</span><span style="--0:#BD93F9;--1:#005CC5">city</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">where</span><span style="--0:#F8F8F2;--1:#24292E"> id </span><span style="--0:#FF79C6;--1:#BF3441">&lt;=</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#BD93F9;--1:#005CC5">5</span><span style="--0:#F8F8F2;--1:#24292E">;</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="select (select count(*) from world.city) – count(*) from world.city where id <= 5;"><div></div></button></div></figure></div>
<p>a语句当行数超过11行的时候需要扫描的行数比b语句要多,b语句扫描了6行,此种情况下,b语句比a语句更有效率。</p>
<p>当没有where语句的时候直接select count(*) from world.city这样会更快,因为MySQL总是知道表的行数。</p>
<h3 id="避免使用不兼容的数据类型">避免使用不兼容的数据类型</h3>
<p>例如float和int、char和varchar、binary和varbinary是不兼容的,数据类型的不兼容可能使优化器无法执行一些本来可以进行的优化操作。</p>
<p>**在程序中,保证在实现功能的基础上: **</p>
<ul>
<li>尽量减少对数据库的访问次数;</li>
<li>通过搜索参数,尽量减少对表的访问行数,最小化结果集,从而减轻网络负担;</li>
<li>能够分开的操作尽量分开处理,提高每次的响应速度。</li>
</ul>
<p>**在数据窗口使用SQL时: **</p>
<ul>
<li>尽量把使用的索引放在选择的首列;</li>
<li>算法的结构尽量简单。</li>
</ul>
<p>**在查询时: **</p>
<ul>
<li>不要过多地使用通配符如 SELECT * FROM T1语句,要用到几列就选择几列如: SELECT COL1,COL2 FROM T1;</li>
<li>在可能的情况下尽量限制尽量结果集行数如: SELECT TOP 300 COL1,COL2,COL3 FROM T1,因为某些情况下用户是不需要那么多的数据的。</li>
</ul>
<p>**不要在应用中使用数据库游标: **</p>
<ul>
<li>游标是非常有用的工具,但比使用常规的、面向集的SQL语句需要更大的开销;</li>
<li>按照特定顺序提取数据的查找。</li>
</ul>
<h3 id="索引字段上进行运算会使索引失效">索引字段上进行运算会使索引失效</h3>
<p>尽量避免在WHERE子句中对字段进行函数或表达式操作,这将导致引擎放弃使用索引而进行全表扫描。</p>
<p>如:</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="sql"><code><div class="ec-line"><div class="code"><span style="--0:#FF79C6;--1:#BF3441">SELECT</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">*</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">FROM</span><span style="--0:#F8F8F2;--1:#24292E"> T1 </span><span style="--0:#FF79C6;--1:#BF3441">WHERE</span><span style="--0:#F8F8F2;--1:#24292E"> F1</span><span style="--0:#FF79C6;--1:#BF3441">/</span><span style="--0:#BD93F9;--1:#005CC5">2</span><span style="--0:#FF79C6;--1:#BF3441">=</span><span style="--0:#BD93F9;--1:#005CC5">100</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="SELECT * FROM T1 WHERE F1/2=100"><div></div></button></div></figure></div>
<p>应改为:</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="sql"><code><div class="ec-line"><div class="code"><span style="--0:#FF79C6;--1:#BF3441">SELECT</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">*</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">FROM</span><span style="--0:#F8F8F2;--1:#24292E"> T1 </span><span style="--0:#FF79C6;--1:#BF3441">WHERE</span><span style="--0:#F8F8F2;--1:#24292E"> F1</span><span style="--0:#FF79C6;--1:#BF3441">=</span><span style="--0:#BD93F9;--1:#005CC5">100</span><span style="--0:#FF79C6;--1:#BF3441">*</span><span style="--0:#BD93F9;--1:#005CC5">2</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="SELECT * FROM T1 WHERE F1=100*2"><div></div></button></div></figure></div>
<h3 id="避免使用某些操作符">避免使用某些操作符</h3>
<p>避免使用!=或＜＞、IS NULL或IS NOT NULL、IN ,NOT IN等这样的操作符。</p>
<p>因为这会使系统无法使用索引,而只能直接搜索表中的数据。</p>
<p>例如: SELECT id FROM employee WHERE id != “B%” 优化器将无法通过索引来确定将要命中的行数,因此需要搜索该表的所有行。</p>
<p>在in语句中能用exists语句代替的就用exists。</p>
<h3 id="尽量使用数字型字段">尽量使用数字型字段</h3>
<p>一部分开发人员和数据库管理人员喜欢把包含数值信息的字段设计为字符型,这会降低查询和连接的性能,并会增加存储开销。</p>
<p>这是因为引擎在处理查询和连接回逐个比较字符串中每一个字符,而对于数字型而言只需要比较一次就够了。</p>
<h3 id="合理使用existsnot-exists子句">合理使用EXISTS、NOT EXISTS子句</h3>
<p>如下所示:</p>
<p>1:</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="sql"><code><div class="ec-line"><div class="code"><span style="--0:#FF79C6;--1:#BF3441">SELECT</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#8BE9FD;--1:#005CC5">SUM</span><span style="--0:#F8F8F2;--1:#24292E">(</span><span style="--0:#BD93F9;--1:#005CC5">T1</span><span style="--0:#F8F8F2;--1:#24292E">.</span><span style="--0:#BD93F9;--1:#005CC5">C1</span><span style="--0:#F8F8F2;--1:#24292E">) </span><span style="--0:#FF79C6;--1:#BF3441">FROM</span><span style="--0:#F8F8F2;--1:#24292E"> T1 </span><span style="--0:#FF79C6;--1:#BF3441">WHERE</span><span style="--0:#F8F8F2;--1:#24292E"> (</span><span style="--0:#FF79C6;--1:#BF3441">SELECT</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#8BE9FD;--1:#005CC5">COUNT</span><span style="--0:#F8F8F2;--1:#24292E">(</span><span style="--0:#FF79C6;--1:#BF3441">*</span><span style="--0:#F8F8F2;--1:#24292E">)</span><span style="--0:#FF79C6;--1:#BF3441">FROM</span><span style="--0:#F8F8F2;--1:#24292E"> T2 </span><span style="--0:#FF79C6;--1:#BF3441">WHERE</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#BD93F9;--1:#005CC5">T2</span><span style="--0:#F8F8F2;--1:#24292E">.</span><span style="--0:#BD93F9;--1:#005CC5">C2</span><span style="--0:#FF79C6;--1:#BF3441">=</span><span style="--0:#BD93F9;--1:#005CC5">T1</span><span style="--0:#F8F8F2;--1:#24292E">.</span><span style="--0:#BD93F9;--1:#005CC5">C2</span><span style="--0:#FF79C6;--1:#BF3441">&gt;</span><span style="--0:#BD93F9;--1:#005CC5">0</span><span style="--0:#F8F8F2;--1:#24292E">)</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="SELECT SUM(T1.C1) FROM T1 WHERE (SELECT COUNT(*)FROM T2 WHERE T2.C2=T1.C2>0)"><div></div></button></div></figure></div>
<p>2:</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="sql"><code><div class="ec-line"><div class="code"><span style="--0:#FF79C6;--1:#BF3441">SELECT</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#8BE9FD;--1:#005CC5">SUM</span><span style="--0:#F8F8F2;--1:#24292E">(</span><span style="--0:#BD93F9;--1:#005CC5">T1</span><span style="--0:#F8F8F2;--1:#24292E">.</span><span style="--0:#BD93F9;--1:#005CC5">C1</span><span style="--0:#F8F8F2;--1:#24292E">) </span><span style="--0:#FF79C6;--1:#BF3441">FROM</span><span style="--0:#F8F8F2;--1:#24292E"> T1WHERE </span><span style="--0:#FF79C6;--1:#BF3441">EXISTS</span><span style="--0:#F8F8F2;--1:#24292E">(</span><span style="--0:#FF79C6;--1:#BF3441">SELECT</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">*</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">FROM</span><span style="--0:#F8F8F2;--1:#24292E"> T2 </span><span style="--0:#FF79C6;--1:#BF3441">WHERE</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#BD93F9;--1:#005CC5">T2</span><span style="--0:#F8F8F2;--1:#24292E">.</span><span style="--0:#BD93F9;--1:#005CC5">C2</span><span style="--0:#FF79C6;--1:#BF3441">=</span><span style="--0:#BD93F9;--1:#005CC5">T1</span><span style="--0:#F8F8F2;--1:#24292E">.</span><span style="--0:#BD93F9;--1:#005CC5">C2</span><span style="--0:#F8F8F2;--1:#24292E">)</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="SELECT SUM(T1.C1) FROM T1WHERE EXISTS(SELECT * FROM T2 WHERE T2.C2=T1.C2)"><div></div></button></div></figure></div>
<p>两者生相同的结果,但是后者的效率显然要高于前者,因为后者不会产生大量锁定的表扫描或是索引扫描。</p>
<p>如果你想校验表里是否存在某条纪录,不要用count(*)那样效率很低,而且浪费服务器资源。可以用EXISTS代替。</p>
<p>如:</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="sql"><code><div class="ec-line"><div class="code"><span style="--0:#FF79C6;--1:#BF3441">IF</span><span style="--0:#F8F8F2;--1:#24292E"> (</span><span style="--0:#FF79C6;--1:#BF3441">SELECT</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#8BE9FD;--1:#005CC5">COUNT</span><span style="--0:#F8F8F2;--1:#24292E">(</span><span style="--0:#FF79C6;--1:#BF3441">*</span><span style="--0:#F8F8F2;--1:#24292E">) </span><span style="--0:#FF79C6;--1:#BF3441">FROM</span><span style="--0:#F8F8F2;--1:#24292E"> table_name </span><span style="--0:#FF79C6;--1:#BF3441">WHERE</span><span style="--0:#F8F8F2;--1:#24292E"> column_name </span><span style="--0:#FF79C6;--1:#BF3441">=</span><span style="--0:#F8F8F2;--1:#24292E"> ‘xxx’)</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="IF (SELECT COUNT(*) FROM table_name WHERE column_name = ‘xxx’)"><div></div></button></div></figure></div>
<p>可以写成:</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="sql"><code><div class="ec-line"><div class="code"><span style="--0:#FF79C6;--1:#BF3441">IF</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">EXISTS</span><span style="--0:#F8F8F2;--1:#24292E"> (</span><span style="--0:#FF79C6;--1:#BF3441">SELECT</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">*</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">FROM</span><span style="--0:#F8F8F2;--1:#24292E"> table_name </span><span style="--0:#FF79C6;--1:#BF3441">WHERE</span><span style="--0:#F8F8F2;--1:#24292E"> column_name </span><span style="--0:#FF79C6;--1:#BF3441">=</span><span style="--0:#F8F8F2;--1:#24292E"> ‘xxx’)</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="IF EXISTS (SELECT * FROM table_name WHERE column_name = ‘xxx’)"><div></div></button></div></figure></div>
<h3 id="避免使用一些语句">避免使用一些语句</h3>
<ul>
<li>能够用BETWEEN的就不要用IN;</li>
<li>能够用DISTINCT的就不用GROUP BY;</li>
<li>尽量不要用SELECT INTO语句。SELECT INTO 语句会导致表锁定,阻止其他用户访问该表。</li>
</ul>
<h3 id="必要时强制查询优化器使用某个索引">必要时强制查询优化器使用某个索引</h3>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="sql"><code><div class="ec-line"><div class="code"><span style="--0:#FF79C6;--1:#BF3441">SELECT</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">*</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">FROM</span><span style="--0:#F8F8F2;--1:#24292E"> T1 </span><span style="--0:#FF79C6;--1:#BF3441">WHERE</span><span style="--0:#F8F8F2;--1:#24292E"> nextprocess </span><span style="--0:#FF79C6;--1:#BF3441">=</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#BD93F9;--1:#005CC5">1</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">AND</span><span style="--0:#F8F8F2;--1:#24292E"> processid </span><span style="--0:#FF79C6;--1:#BF3441">IN</span><span style="--0:#F8F8F2;--1:#24292E"> (</span><span style="--0:#BD93F9;--1:#005CC5">8</span><span style="--0:#F8F8F2;--1:#24292E">,</span><span style="--0:#BD93F9;--1:#005CC5">32</span><span style="--0:#F8F8F2;--1:#24292E">,</span><span style="--0:#BD93F9;--1:#005CC5">45</span><span style="--0:#F8F8F2;--1:#24292E">)</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="SELECT * FROM T1 WHERE nextprocess = 1 AND processid IN (8,32,45)"><div></div></button></div></figure></div>
<p>改成:</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="sql"><code><div class="ec-line"><div class="code"><span style="--0:#FF79C6;--1:#BF3441">SELECT</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">*</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">FROM</span><span style="--0:#F8F8F2;--1:#24292E"> T1 (</span><span style="--0:#FF79C6;--1:#BF3441">INDEX</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">=</span><span style="--0:#F8F8F2;--1:#24292E"> IX_ProcessID) </span><span style="--0:#FF79C6;--1:#BF3441">WHERE</span><span style="--0:#F8F8F2;--1:#24292E"> nextprocess </span><span style="--0:#FF79C6;--1:#BF3441">=</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#BD93F9;--1:#005CC5">1</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">AND</span><span style="--0:#F8F8F2;--1:#24292E"> processid </span><span style="--0:#FF79C6;--1:#BF3441">IN</span><span style="--0:#F8F8F2;--1:#24292E"> (</span><span style="--0:#BD93F9;--1:#005CC5">8</span><span style="--0:#F8F8F2;--1:#24292E">,</span><span style="--0:#BD93F9;--1:#005CC5">32</span><span style="--0:#F8F8F2;--1:#24292E">,</span><span style="--0:#BD93F9;--1:#005CC5">45</span><span style="--0:#F8F8F2;--1:#24292E">)</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="SELECT * FROM T1 (INDEX = IX_ProcessID) WHERE nextprocess = 1 AND processid IN (8,32,45)"><div></div></button></div></figure></div>
<p>则查询优化器将会强行利用索引IX_ProcessID 执行查询。</p>
<h3 id="消除对大型表行数据的顺序存取">消除对大型表行数据的顺序存取</h3>
<p>尽管在所有的检查列上都有索引,但某些形式的WHERE子句强迫优化器使用顺序存取。</p>
<p>如:</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="sql"><code><div class="ec-line"><div class="code"><span style="--0:#FF79C6;--1:#BF3441">SELECT</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">*</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">FROM</span><span style="--0:#F8F8F2;--1:#24292E"> orders </span><span style="--0:#FF79C6;--1:#BF3441">WHERE</span><span style="--0:#F8F8F2;--1:#24292E"> (customer_num</span><span style="--0:#FF79C6;--1:#BF3441">=</span><span style="--0:#BD93F9;--1:#005CC5">104</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">AND</span><span style="--0:#F8F8F2;--1:#24292E"> order_num</span><span style="--0:#FF79C6;--1:#BF3441">&gt;</span><span style="--0:#BD93F9;--1:#005CC5">1001</span><span style="--0:#F8F8F2;--1:#24292E">) </span><span style="--0:#FF79C6;--1:#BF3441">OR</span><span style="--0:#F8F8F2;--1:#24292E"> order_num</span><span style="--0:#FF79C6;--1:#BF3441">=</span><span style="--0:#BD93F9;--1:#005CC5">1008</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="SELECT * FROM orders WHERE (customer_num=104 AND order_num>1001) OR order_num=1008"><div></div></button></div></figure></div>
<p>解决办法可以使用并集来避免顺序存取:</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="sql"><code><div class="ec-line"><div class="code"><span class="indent"> </span><span style="--0:#FF79C6;--1:#BF3441">SELECT</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">*</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">FROM</span><span style="--0:#F8F8F2;--1:#24292E"> orders </span><span style="--0:#FF79C6;--1:#BF3441">WHERE</span><span style="--0:#F8F8F2;--1:#24292E"> customer_num</span><span style="--0:#FF79C6;--1:#BF3441">=</span><span style="--0:#BD93F9;--1:#005CC5">104</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">AND</span><span style="--0:#F8F8F2;--1:#24292E"> order_num</span><span style="--0:#FF79C6;--1:#BF3441">&gt;</span><span style="--0:#BD93F9;--1:#005CC5">1001</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">UNION</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">SELECT</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">*</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">FROM</span><span style="--0:#F8F8F2;--1:#24292E"> orders </span><span style="--0:#FF79C6;--1:#BF3441">WHERE</span><span style="--0:#F8F8F2;--1:#24292E"> order_num</span><span style="--0:#FF79C6;--1:#BF3441">=</span><span style="--0:#BD93F9;--1:#005CC5">1008</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code=" SELECT * FROM orders WHERE customer_num=104 AND order_num>1001 UNION SELECT * FROM orders WHERE order_num=1008"><div></div></button></div></figure></div>
<p>这样就能利用索引路径处理查询。jacking 数据结果集很多,但查询条件限定后结果集不大的情况下,后面的语句快。</p>
<h3 id="避免使用非打头字母搜索">避免使用非打头字母搜索</h3>
<p>尽量避免在索引过的字符数据中,使用非打头字母搜索。这也使得引擎无法利用索引。</p>
<p>见如下例子:</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="sql"><code><div class="ec-line"><div class="code"><span style="--0:#FF79C6;--1:#BF3441">SELECT</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">*</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">FROM</span><span style="--0:#F8F8F2;--1:#24292E"> T1 </span><span style="--0:#FF79C6;--1:#BF3441">WHERE</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">NAME</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">LIKE</span><span style="--0:#F8F8F2;--1:#24292E"> ‘%L%’ </span><span style="--0:#FF79C6;--1:#BF3441">SELECT</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">*</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">FROM</span><span style="--0:#F8F8F2;--1:#24292E"> T1 </span><span style="--0:#FF79C6;--1:#BF3441">WHERE</span><span style="--0:#F8F8F2;--1:#24292E"> SUBSTING(</span><span style="--0:#FF79C6;--1:#BF3441">NAME</span><span style="--0:#F8F8F2;--1:#24292E">,</span><span style="--0:#BD93F9;--1:#005CC5">2</span><span style="--0:#F8F8F2;--1:#24292E">,</span><span style="--0:#BD93F9;--1:#005CC5">1</span><span style="--0:#F8F8F2;--1:#24292E">)</span><span style="--0:#FF79C6;--1:#BF3441">=</span><span style="--0:#F8F8F2;--1:#24292E">’L’ </span><span style="--0:#FF79C6;--1:#BF3441">SELECT</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">*</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">FROM</span><span style="--0:#F8F8F2;--1:#24292E"> T1 </span><span style="--0:#FF79C6;--1:#BF3441">WHERE</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">NAME</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">LIKE</span><span style="--0:#F8F8F2;--1:#24292E"> ‘L%’</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="SELECT * FROM T1 WHERE NAME LIKE ‘%L%’ SELECT * FROM T1 WHERE SUBSTING(NAME,2,1)=’L’ SELECT * FROM T1 WHERE NAME LIKE ‘L%’"><div></div></button></div></figure></div>
<p>即使NAME字段建有索引,前两个查询依然无法利用索引完成加快操作,引擎不得不对全表所有数据逐条操作来完成任务。</p>
<p>而第三个查询能够使用索引来加快操作,不要习惯性的使用 ‘%L%’这种方式(会导致全表扫描),如果可以使用`L%’相对来说更好。</p>
<h3 id="建议">建议</h3>
<p>虽然UPDATE、DELETE语句的写法基本固定,但是还是对UPDATE语句给点建议:</p>
<ul>
<li>尽量不要修改主键字段;</li>
<li>当修改VARCHAR型字段时,尽量使用相同长度内容的值代替;</li>
<li>尽量最小化对于含有UPDATE触发器的表的UPDATE操作;</li>
<li>避免UPDATE将要复制到其他数据库的列;</li>
<li>避免UPDATE建有很多索引的列;</li>
<li>避免UPDATE在WHERE子句条件中的列。</li>
</ul>
<h3 id="能用union-all就不要用union">能用UNION ALL就不要用UNION</h3>
<p>UNION ALL不执行SELECT DISTINCT函数,这样就会减少很多不必要的资源。</p>
<p>在跨多个不同的数据库时使用UNION是一个有趣的优化方法,UNION从两个互不关联的表中返回数据,这就意味着不会出现重复的行,同时也必须对数据进行排序。</p>
<p>我们知道排序是非常耗费资源的,特别是对大表的排序,UNION ALL可以大大加快速度,如果你已经知道你的数据不会包括重复行,或者你不在乎是否会出现重复的行,在这两种情况下使用UNION ALL更适合。</p>
<p>此外,还可以在应用程序逻辑中采用某些方法避免出现重复的行,这样UNION ALL和UNION返回的结果都是一样的,但UNION ALL不会进行排序。</p>
<p>![图片](data:image/svg+xml,&lt;%3Fxml version=‘1.0’ encoding=‘UTF-8’%3F&gt;<svg width="1px" height="1px" viewBox="0 0 1 1" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><title></title><g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" fill-opacity="0"><g transform="translate(-249.000000, -126.000000)" fill="%23FFFFFF"><rect x="249" y="126" width="1" height="1"></rect></g></g></svg>)</p>
<h3 id="字段数据类型优化">字段数据类型优化</h3>
<p>避免使用NULL类型: NULL对于大多数数据库都需要特殊处理,MySQL也不例外。</p>
<p>它需要更多的代码,更多的检查和特殊的索引逻辑,有些开发人员完全没有意识到,创建表时NULL是默认值,但大多数时候应该使用NOT NULL,或者使用一个特殊的值,如0,-1作为默认值。</p>
<p>尽可能使用更小的字段: MySQL从磁盘读取数据后是存储到内存中的,然后使用cpu周期和磁盘I/O读取它。</p>
<p>这意味着越小的数据类型占用的空间越小,从磁盘读或打包到内存的效率都更好,但也不要太过执着减小数据类型,要是以后应用程序发生什么变化就没有空间了。</p>
<p>修改表将需要重构,间接地可能引起代码的改变,这是很头疼的问题,因此需要找到一个平衡点。</p>
<p>优先使用定长型。</p>
<h3 id="一次性插入多条数据">一次性插入多条数据</h3>
<p>程序中如果一次性对同一个表插入多条数据,比如以下语句:</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="sql"><code><div class="ec-line"><div class="code"><span style="--0:#FF79C6;--1:#BF3441">insert into</span><span style="--0:#F8F8F2;--1:#24292E"> person(</span><span style="--0:#FF79C6;--1:#BF3441">name</span><span style="--0:#F8F8F2;--1:#24292E">,age) </span><span style="--0:#FF79C6;--1:#BF3441">values</span><span style="--0:#F8F8F2;--1:#24292E">(‘xboy’, </span><span style="--0:#BD93F9;--1:#005CC5">14</span><span style="--0:#F8F8F2;--1:#24292E">);</span></div></div><div class="ec-line"><div class="code"><span style="--0:#FF79C6;--1:#BF3441">insert into</span><span style="--0:#F8F8F2;--1:#24292E"> person(</span><span style="--0:#FF79C6;--1:#BF3441">name</span><span style="--0:#F8F8F2;--1:#24292E">,age) </span><span style="--0:#FF79C6;--1:#BF3441">values</span><span style="--0:#F8F8F2;--1:#24292E">(‘xgirl’, </span><span style="--0:#BD93F9;--1:#005CC5">15</span><span style="--0:#F8F8F2;--1:#24292E">);</span></div></div><div class="ec-line"><div class="code"><span style="--0:#FF79C6;--1:#BF3441">insert into</span><span style="--0:#F8F8F2;--1:#24292E"> person(</span><span style="--0:#FF79C6;--1:#BF3441">name</span><span style="--0:#F8F8F2;--1:#24292E">,age) </span><span style="--0:#FF79C6;--1:#BF3441">values</span><span style="--0:#F8F8F2;--1:#24292E">(‘nia’, </span><span style="--0:#BD93F9;--1:#005CC5">19</span><span style="--0:#F8F8F2;--1:#24292E">);</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="insert into person(name,age) values(‘xboy’, 14);insert into person(name,age) values(‘xgirl’, 15);insert into person(name,age) values(‘nia’, 19);"><div></div></button></div></figure></div>
<p>把它拼成一条语句执行效率会更高:</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="sql"><code><div class="ec-line"><div class="code"><span style="--0:#FF79C6;--1:#BF3441">insert into</span><span style="--0:#F8F8F2;--1:#24292E"> person(</span><span style="--0:#FF79C6;--1:#BF3441">name</span><span style="--0:#F8F8F2;--1:#24292E">,age) </span><span style="--0:#FF79C6;--1:#BF3441">values</span><span style="--0:#F8F8F2;--1:#24292E">(‘xboy’, </span><span style="--0:#BD93F9;--1:#005CC5">14</span><span style="--0:#F8F8F2;--1:#24292E">), (‘xgirl’, </span><span style="--0:#BD93F9;--1:#005CC5">15</span><span style="--0:#F8F8F2;--1:#24292E">),(‘nia’, </span><span style="--0:#BD93F9;--1:#005CC5">19</span><span style="--0:#F8F8F2;--1:#24292E">);</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="insert into person(name,age) values(‘xboy’, 14), (‘xgirl’, 15),(‘nia’, 19);"><div></div></button></div></figure></div>
<h3 id="无意义语句">无意义语句</h3>
<p>不要在选择的栏位上放置索引,这是无意义的。应该在条件选择的语句上合理的放置索引,比如where、order by。</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="sql"><code><div class="ec-line"><div class="code"><span style="--0:#FF79C6;--1:#BF3441">SELECT</span><span style="--0:#F8F8F2;--1:#24292E"> id,title,content,cat_id </span><span style="--0:#FF79C6;--1:#BF3441">FROM</span><span style="--0:#F8F8F2;--1:#24292E"> article </span><span style="--0:#FF79C6;--1:#BF3441">WHERE</span><span style="--0:#F8F8F2;--1:#24292E"> cat_id </span><span style="--0:#FF79C6;--1:#BF3441">=</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#BD93F9;--1:#005CC5">1</span><span style="--0:#F8F8F2;--1:#24292E">;</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="SELECT id,title,content,cat_id FROM article WHERE cat_id = 1;"><div></div></button></div></figure></div>
<p>上面这个语句,你在id/title/content上放置索引是毫无意义的,对这个语句没有任何优化作用。但是如果你在外键cat_id上放置一个索引,那作用就相当大了。</p>
<h3 id="order-by语句的mysql优化">ORDER BY语句的MySQL优化</h3>
<p>ORDER BY + LIMIT组合的索引优化。如果一个SQL语句形如:</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="sql"><code><div class="ec-line"><div class="code"><span style="--0:#FF79C6;--1:#BF3441">SELECT</span><span style="--0:#F8F8F2;--1:#24292E"> [column1],[column2],…. </span><span style="--0:#FF79C6;--1:#BF3441">FROM</span><span style="--0:#F8F8F2;--1:#24292E"> [TABLE] </span><span style="--0:#FF79C6;--1:#BF3441">ORDER BY</span><span style="--0:#F8F8F2;--1:#24292E"> [sort] </span><span style="--0:#FF79C6;--1:#BF3441">LIMIT</span><span style="--0:#F8F8F2;--1:#24292E"> [offset],[LIMIT];</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="SELECT [column1],[column2],…. FROM [TABLE] ORDER BY [sort] LIMIT [offset],[LIMIT];"><div></div></button></div></figure></div>
<p>这个SQL语句优化比较简单,在[sort]这个栏位上建立索引即可。</p>
<p>b. WHERE + ORDER BY + LIMIT组合的索引优化,形如:</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="sql"><code><div class="ec-line"><div class="code"><span style="--0:#FF79C6;--1:#BF3441">SELECT</span><span style="--0:#F8F8F2;--1:#24292E"> [column1],[column2],…. </span><span style="--0:#FF79C6;--1:#BF3441">FROM</span><span style="--0:#F8F8F2;--1:#24292E"> [TABLE] </span><span style="--0:#FF79C6;--1:#BF3441">WHERE</span><span style="--0:#F8F8F2;--1:#24292E"> [columnX] </span><span style="--0:#FF79C6;--1:#BF3441">=</span><span style="--0:#F8F8F2;--1:#24292E"> [VALUE] </span><span style="--0:#FF79C6;--1:#BF3441">ORDER BY</span><span style="--0:#F8F8F2;--1:#24292E"> [sort] </span><span style="--0:#FF79C6;--1:#BF3441">LIMIT</span><span style="--0:#F8F8F2;--1:#24292E"> [offset],[LIMIT];</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="SELECT [column1],[column2],…. FROM [TABLE] WHERE [columnX] = [VALUE] ORDER BY [sort] LIMIT [offset],[LIMIT];"><div></div></button></div></figure></div>
<p>这个语句,如果你仍然采用第一个例子中建立索引的方法,虽然可以用到索引,但是效率不高。</p>
<p>更高效的方法是建立一个联合索引(columnX,sort)。WHERE + IN + ORDER BY + LIMIT组合的索引优化,形如:</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="sql"><code><div class="ec-line"><div class="code"><span style="--0:#FF79C6;--1:#BF3441">SELECT</span><span style="--0:#F8F8F2;--1:#24292E"> [column1],[column2],…. </span><span style="--0:#FF79C6;--1:#BF3441">FROM</span><span style="--0:#F8F8F2;--1:#24292E"> [TABLE] </span><span style="--0:#FF79C6;--1:#BF3441">WHERE</span><span style="--0:#F8F8F2;--1:#24292E"> [columnX] </span><span style="--0:#FF79C6;--1:#BF3441">IN</span><span style="--0:#F8F8F2;--1:#24292E"> ([value1],[value2],…) </span><span style="--0:#FF79C6;--1:#BF3441">ORDER BY</span><span style="--0:#F8F8F2;--1:#24292E"> [sort] </span><span style="--0:#FF79C6;--1:#BF3441">LIMIT</span><span style="--0:#F8F8F2;--1:#24292E"> [offset],[LIMIT];</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="SELECT [column1],[column2],…. FROM [TABLE] WHERE [columnX] IN ([value1],[value2],…) ORDER BY [sort] LIMIT [offset],[LIMIT];"><div></div></button></div></figure></div>
<p>这个语句如果你采用第二个例子中建立索引的方法,会得不到预期的效果(仅在[sort]上是using index,WHERE那里是using where;using filesort),理由是这里对应columnX的值对应多个。目前还没有找到比较优秀的办法,等待高手指教。</p>
<p>WHERE+ORDER BY多个栏位+LIMIT,比如:</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="sql"><code><div class="ec-line"><div class="code"><span style="--0:#FF79C6;--1:#BF3441">SELECT</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">*</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">FROM</span><span style="--0:#F8F8F2;--1:#24292E"> [table] </span><span style="--0:#FF79C6;--1:#BF3441">WHERE</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">uid=</span><span style="--0:#BD93F9;--1:#005CC5">1</span><span style="--0:#F8F8F2;--1:#24292E"> ORDER x,y </span><span style="--0:#FF79C6;--1:#BF3441">LIMIT</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#BD93F9;--1:#005CC5">0</span><span style="--0:#F8F8F2;--1:#24292E">,</span><span style="--0:#BD93F9;--1:#005CC5">10</span><span style="--0:#F8F8F2;--1:#24292E">;</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="SELECT * FROM [table] WHERE uid=1 ORDER x,y LIMIT 0,10;"><div></div></button></div></figure></div>
<p>对于这个语句,大家可能是加一个这样的索引: (x,y,uid)。但实际上更好的效果是(uid,x,y)。这是由MySQL处理排序的机制造成的。</p>
<h2 id="面试须知">面试须知</h2>
<h3 id="什么是bufferpool">什么是BufferPool</h3>
<h4 id="基本概念">基本概念</h4>
<p>Buffer Pool: 缓冲池,简称 BP。其作用是用来缓存表数据与索引数据,减少磁盘 IO 操作,提升效率。</p>
<p>Buffer Pool 由<strong>缓存数据页(Page)<strong>和对缓存数据页进行描述的</strong>控制块</strong>组成,控制块中存储着对应缓存页的所属的表空间、数据页的编号、以及对应缓存页在 Buffer Pool 中的地址等信息。</p>
<p>Buffer Pool 默认大小是 128M,以 Page 页为单位,Page 页默认大小 16k,而控制块的大小约为数据页的 5%,大概是 800 字节。</p>
<h4 id="如何判断一个页是否在-buffer-pool-中缓存">如何判断一个页是否在 Buffer Pool 中缓存</h4>
<p>MySQL 中有一个哈希表数据结构,它使用表空间号+数据页号,作为一个 key,然后缓冲页对应的控制块作为 value。</p>
<ul>
<li>当需要访问某个页的数据时,先从哈希表中根据表空间号+页号看看是否存在对应的缓存页。</li>
<li>如果有,则直接使用,如果没有,就从 free 链表中选出一个空闲的缓冲页,然后把磁盘中对应的页加载到该缓冲页的位置。</li>
</ul>
<h3 id="innodb引擎如何管理page页">InnoDB引擎如何管理Page页</h3>
<h4 id="page-页分类">Page 页分类</h4>
<p>BP 的底层采用链表数据结构管理 Page。在 InnoDB 访问表记录和索引时会在 Page 页中缓存,以后使用可以减少磁盘 IO 操作,提升效率。</p>
<p>Page 根据状态可以分为三种类型:</p>
<ul>
<li>free page: 空闲 page,未被使用</li>
<li>clean page: 被使用 page,数据没有被修改过</li>
<li>dirty page: 脏页,被使用 page,数据被修改过,Page 页中数据和磁盘的数据产生了不一致</li>
</ul>
<h4 id="page-页如何管理">Page 页如何管理</h4>
<p>针对上面所说的三种 Page 类型,innodb 通过三种链表结构来维护和管理。</p>
<ol>
<li>free list: 表示空闲缓冲区,管理 free Page。
<ul>
<li>free 链表是把所有空闲的缓冲页对应的控制块作为一个个的节点放到一个链表中,这个链表便称之为 free 链表。</li>
<li>基节点: free 链表中只有一个基节点是不记录缓存页信息(单独申请空间),它里面就存放了 free 链表的头节点的地址,尾节点的地址,还有 free 链表里当前有多少个节点。</li>
</ul>
</li>
<li>Flush list: 表示需要刷新到磁盘的缓冲区,管理 dirty page,内部 page 按修改时间排序。
<ul>
<li>InnoDB 引擎为了提高处理效率,在每次修改缓冲页后,并不是立刻把修改刷新到磁盘上,而是在未来的某个时间点进行刷新操作,所以需要使用到 flush 链表存储脏页,凡是被修改过的缓冲页对应的控制块都会作为节点加入到 flush 链表。</li>
<li>flush 链表的机构与 free 链表的结构相似。</li>
</ul>
</li>
<li>lru list: 表示正在使用的缓冲区,管理 clean page 和 dirty page,缓冲区以 midpoint 为基点,前面链表称为 new 列表区,存放经常访问的数据,占 63%;后面的链表称为 old 列表区,存放使用较少数据,占 37%。</li>
</ol>
<h3 id="为什么写缓冲区仅适用于非唯一普通索引页">为什么写缓冲区,仅适用于非唯一普通索引页</h3>
<p>change buffer: 写缓冲区,是针对二级索引(辅助索引)页的更新优化措施。</p>
<p>作用: 在进行 dml 操作时,如果请求的辅助索引(二级索引)没有在缓冲池中时,并不会立刻将磁盘页加载到缓冲池,而是在 cb 记录缓冲变更,等未来数据被读取时,再将数据合并恢复到 bp 中。</p>
<ol>
<li>change buffer 用于存储 SQL 变更操作,比如 insert/update/delete 等 SQL 语句</li>
<li>change buffer 中的每个变更操作都有其对应的数据页,并且该数据页未加载到缓存中</li>
<li>当 change buffer 中变更操作对应的数据页加载到缓存中后,InnoDB 会把变更操作 merge 到数据页上</li>
<li>InnoDB 会定期加载 change buffer 中操作对应的数据页到缓存中,并 merge 变更操作</li>
</ol>
<h4 id="change-buffer-更新流程">change buffer 更新流程</h4>
<img src="https://cdn.jsdelivr.net/gh/chou401/pic-md@main/img/image-20230905135508966.png" alt="image-20230905135508966"/>
<p>写缓冲区,仅适用于非唯一普通索引页,为什么?</p>
<ul>
<li>如果在索引设置唯一性,在进行修改时,InnoDB 必须要做唯一性校验,因此必须查询磁盘,做一次 IO 操作。会直接将记录查询到 BufferPool 中,然后在缓冲池修改,不会在 change buffer 操作。</li>
</ul>
<h3 id="mysql为什么要改进lru算法">MySQL为什么要改进LRU算法</h3>
<h4 id="普通-lru-算法">普通 LRU 算法</h4>
<p>LRU = least recently used(最近最少使用): 就是末位淘汰法,新数据从链表头部加入,释放空间时从末尾淘汰。</p>
<img src="https://cdn.jsdelivr.net/gh/chou401/pic-md@main/image-20230905151907748.png" alt="image-20230905151907748"/>
<ol>
<li>当要访问某个页时,如果不在 buffer pool,需要把该页加载到缓冲池,并且把该缓冲页对应的控制块作为节点添加到 LRU 链表的头部。</li>
<li>当要访问某个页时,如果在 buffer pool 中,则直接把该页对应的控制块移动到 LRU 链表的头部。</li>
<li>当需要释放空间时,从末尾淘汰。</li>
</ol>
<h4 id="普通-lru-链表的优缺点">普通 LRU 链表的优缺点</h4>
<p>优点</p>
<ul>
<li>所有最近使用的数据都在链表表头,最近未使用的数据都在链表表尾,保证热数据能最快被获取到。</li>
</ul>
<p>缺点</p>
<ul>
<li>如果发生全表扫描(比如: 没有建立河失的索引 or 查询时使用 select * 等),则有很大可能将真正的热数据淘汰掉。</li>
<li>由于 MySQL 中存在预读机制,很多预读的页都会被放到 LRU 链表的表头。如果这些预读的页都没有用到的话,这样,会导致很多尾部的缓冲页很快就会被淘汰。</li>
</ul>
<h4 id="改进型-lru-算法">改进型 LRU 算法</h4>
<p>改进型 LRU: 将链表分为 new 和 old 两个部分,加入元素时并不是从表头插入,而是从中间 midpoint 位置插入(就是说从磁盘中新读出的数据会放在冷数据区的头部),如果数据很快被访问,那么 page 就会向 new 列表头部移动,如果数据没有被访问,会逐步向 old 尾部移动,等待淘汰。</p>
<img src="https://cdn.jsdelivr.net/gh/chou401/pic-md@main/img/image-20230905152906765.png" alt="image-20230905152906765"/>
<p>冷数据区的数据页什么时候会被转到热数据区?</p>
<ol>
<li>如果该数据页在 LRU 链表中存在时间超过 1s,就将其移动到链表头部(链表指的是整个 LRU 链表)</li>
<li>如果该数据页在 LRU 链表中存在的时间短于 1s,其位置不变(由于全表扫描有一个特点,就是它对某个页的频繁访问总耗时会很短)</li>
<li>1s 这个时间是由参数 innodb_old_blocks_time 控制的</li>
</ol>
<h3 id="使用索引一定可以提升效率吗">使用索引一定可以提升效率吗</h3>
<p>索引就是排好序的,帮助我们进行快速查找的数据结构。</p>
<p>简单来讲,索引就是一种将数据库中的记录按照特殊形式存储的数据结构。通过索引,能够显著地提高数据查询的效率,从而提高服务器的性能。。</p>
<p>索引的优势与劣势</p>
<ul>
<li>优点
<ul>
<li>提高数据检索的效率,降低数据库的 IO 成本</li>
<li>通过索引列对数据进行排序,降低数据排序的成本,降低了 CPU 的消耗</li>
</ul>
</li>
<li>缺点
<ul>
<li>创建索引和维护索引要耗费时间,这种时间随着数据量的增加而增加</li>
<li>索引需要占物理空间,除了数据表占用数据空间之外,每一个索引还要占用一定的物理空间</li>
<li>当对表中的数据进行增加、删除和修改的时候,索引也要动态的维护,降低了数据的维护速度</li>
</ul>
</li>
<li>创建索引的原则
<ul>
<li>在经常需要搜索的列上创建索引,可以加快搜索的速度</li>
<li>在作为主键的列上创建索引,强制该列的唯一性和组织表中数据的排列结构</li>
<li>在经常用在链接的列上,这些列主要是一些外键,可以加快连接的速度</li>
<li>在经常需要根据范围进行搜索的列上创建索引,因为索引已经排序,其制定的范围是连续的</li>
<li>在经常需要排序的列上创建索引,因为索引已经排序,这样查询可以利用索引的排序,加快排序查询时间</li>
<li>在经常使用在 where 子句中的列上面创建索引,加快条件的判断速度</li>
</ul>
</li>
</ul>
<h3 id="介绍一下page页的结构">介绍一下Page页的结构</h3>
<p>Page 是真个 InnoDB 存储的最基本构件,也是 InnoDB 磁盘管理的最小单位,与数据库相关的所有内容都存储在这种 Page 结构里。</p>
<p>Page 分为几种类型,常见的页类型有数据页(B+tree Node)、Undo 页(Undo Log Page)、系统页(System Page)、事务数据页(Transaction System Page)等。</p>
<p>页的结构整体上可以分为三大部分,分别为通用部分(文件头、文件尾)、存储记录空间、索引部分。</p>
<ol>
<li>通用部分: 主要指文件头(File Header)和文件尾(File Trailer),将页的内容进行封装,通过文件头和文件尾校验的 CheckSum 方式来确保页的传输是完整的。其中比较重要的是在文件头中的<code>FIL_PAGE_PREV</code>和<code>FIL_PAGE_NEXT</code>字段,通过这两个字段,我们可以找到该页的上一页和下一页,实际上所有页通过两个字段可以形成一条双向链表。</li>
<li>记录部分(User Records &amp; Free Space)。页的主要作用是存储记录,所以“最小和最大记录”和“用户记录”部分占了页结构的主要空间。另外空闲空间是个灵活的部分,当有新的记录插入时,会从空闲空间中进行分配用于存储新纪录。</li>
<li>数据目录部分(Page Directory)。数据页中行记录按照主键值由小到大顺序串联成一个单链表(页中记录是以单向链表的形式进行存储的),且单链表的链表头为最小记录,链表尾为最大记录。并且为了更快速地定位到指定的行记录,通过<code>Page Directory</code>实现目录的功能,借助<code>Page Directory</code>使用二分法快速找到需要查找的行记录。</li>
</ol>
<h3 id="聚簇索引与非聚簇索引">聚簇索引与非聚簇索引</h3>
<p>聚簇索引与非聚簇索引的区别是: 叶节点是否存放一整行记录</p>
<ul>
<li>聚簇索引: 将数据存储与索引放到了一块,索引结构的叶子结点保存了行数据</li>
<li>非聚簇索引: 将数据与索引分开存储,索引结构的叶子结点指向了数据对应的位置</li>
</ul>
<p>InnoDB 主键使用的是聚簇索引,MyISAM 不管是主键索引,还是二级索引使用的都是非聚簇索引。</p>
<p>在 InnoDB 引擎中,主键索引采用的就是聚簇索引结构存储。</p>
<h4 id="聚簇索引聚集索引">聚簇索引(聚集索引)</h4>
<ul>
<li>聚簇索引是一种数据存储方式,InnoDB 的聚簇索引就是按照主键顺序构件 B+Tree 结构。B+Tree 的叶子节点就是行记录,行记录和主键值紧凑地存储在一起。这也意味着 InnoDB 的主键索引就是数据表本身,它按主键顺序存放了整张表的数据,占用的空间就是整个表数据量的大小。通常说的主键索引就是聚集索引。</li>
<li>InnoDB 的表要求必须要有聚簇索引
<ul>
<li>如果表定义了主键,则主键索引就是聚簇索引</li>
<li>如果表没有定义主键,则第一个非空 unique 列作为聚簇索引</li>
<li>否则 InnoDB 会重建一个隐藏的 row-id 作为聚簇索引</li>
</ul>
</li>
<li>辅助索引。InnoDB 辅助索引,也叫作二级索引,是根据索引列构建 B+Tree 结构。但在 B+Tree 的叶子结点中只存了索引列和主键的信息。二级索引占用的空间会比聚簇索引小很多,通常创建辅助索引就是为了提升查询效率。一个表 InnoDB 只能创建一个聚簇索引,但可以创建多个辅助索引。</li>
</ul>
<h4 id="非聚簇索引">非聚簇索引</h4>
<p>与 InnoDB 表存储不同,MyISAM 使用的是非聚簇索引,非聚簇索引的两棵 B+Tree 看上去没什么不同,节点的结构完全一致只是存储的内容不同而已,主键索引 B+Tree 的节点存储了主键,复制索引 B+Tree 存储了辅助键。</p>
<p>表数据存储在独立的地方,这两棵 B+Tree 的叶子结点都使用一个地址指向真正的表数据,对于表数据来说,这两个键没有任何区别。由于索引树是独立的,通过辅助键检索无需访问主键的索引树。</p>
<h4 id="聚簇索引的优点">聚簇索引的优点</h4>
<ol>
<li>当你需要取出一定范围内的数据时,用聚簇索引也比非聚簇索引好。</li>
<li>当通过聚簇索引查找目标数据时理论上比非聚簇索引要快,因为非聚簇索引定位到对应主键时还要多一次目标记录寻址,即多一次 IO。</li>
<li>使用覆盖索引扫描的查询可以直接使用页节点中的主键值。</li>
</ol>
<h4 id="聚簇索引的缺点">聚簇索引的缺点</h4>
<ol>
<li>插入速度严重依赖于插入顺序。</li>
<li>更新主键的代价很高,因为将会导致被更新的行移动。</li>
<li>二级索引访问需要两次索引查找,第一次找到主键值,第二次根据主键值找到行数据。</li>
</ol>
<h3 id="索引有哪几种类型">索引有哪几种类型</h3>
<ol>
<li>
<p>普通索引</p>
<ul>
<li>
<p>这是最基本的索引类型,基于普通字段建立的索引,没有任何限制。</p>
</li>
<li>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="sql"><code><div class="ec-line"><div class="code"><span class="indent"> </span><span style="--0:#FF79C6;--1:#BF3441">CREATE</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">INDEX</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">&lt;</span><span style="--0:#F8F8F2;--1:#24292E">索引的名字</span><span style="--0:#FF79C6;--1:#BF3441">&gt;</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">ON</span><span style="--0:#F8F8F2;--1:#24292E"> tablename(字段名)</span></div></div><div class="ec-line"><div class="code"><span class="indent"> </span><span style="--0:#FF79C6;--1:#BF3441">ALTER</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">TABLE</span><span style="--0:#F8F8F2;--1:#24292E"> tablename </span><span style="--0:#FF79C6;--1:#BF3441">ADD</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">INDEX</span><span style="--0:#F8F8F2;--1:#24292E"> [索引的名字](字段名)</span></div></div><div class="ec-line"><div class="code"><span class="indent"> </span><span style="--0:#FF79C6;--1:#BF3441">CREATE</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">TABLE</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#50FA7B;--1:#6F42C1">tablename</span><span style="--0:#F8F8F2;--1:#24292E"> ([...],</span><span style="--0:#FF79C6;--1:#BF3441">INDEX</span><span style="--0:#F8F8F2;--1:#24292E"> [索引的名字](字段名))</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code=" CREATE INDEX <索引的名字> ON tablename(字段名) ALTER TABLE tablename ADD INDEX [索引的名字](字段名) CREATE TABLE tablename ([...],INDEX [索引的名字](字段名))"><div></div></button></div></figure></div>
</li>
</ul>
</li>
<li>
<p>唯一索引</p>
<ul>
<li>
<p>与“普通索引”类似,不同的就是: 索引字段的值必须唯一,但允许有空值。</p>
</li>
<li>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="sql"><code><div class="ec-line"><div class="code"><span class="indent"> </span><span style="--0:#FF79C6;--1:#BF3441">CREATE</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">UNIQUE</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">INDEX</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">&lt;</span><span style="--0:#F8F8F2;--1:#24292E">索引的名字</span><span style="--0:#FF79C6;--1:#BF3441">&gt;</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">ON</span><span style="--0:#F8F8F2;--1:#24292E"> tablename(字段名)</span></div></div><div class="ec-line"><div class="code"><span style="--0:#FF79C6;--1:#BF3441">ALTER</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">TABLE</span><span style="--0:#F8F8F2;--1:#24292E"> tablename </span><span style="--0:#FF79C6;--1:#BF3441">ADD</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">UNIQUE</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">INDEX</span><span style="--0:#F8F8F2;--1:#24292E"> [索引的名字](字段名)</span></div></div><div class="ec-line"><div class="code"><span style="--0:#FF79C6;--1:#BF3441">CREATE</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">TABLE</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#50FA7B;--1:#6F42C1">tablename</span><span style="--0:#F8F8F2;--1:#24292E"> ([...],</span><span style="--0:#FF79C6;--1:#BF3441">UNIQUE</span><span style="--0:#F8F8F2;--1:#24292E"> [索引的名字](字段名))</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code=" CREATE UNIQUE INDEX <索引的名字> ON tablename(字段名)ALTER TABLE tablename ADD UNIQUE INDEX [索引的名字](字段名)CREATE TABLE tablename ([...],UNIQUE [索引的名字](字段名))"><div></div></button></div></figure></div>
</li>
</ul>
</li>
<li>
<p>主键索引</p>
<ul>
<li>
<p>它是一种特殊的唯一索引,不允许有空值。在创建或修改表时追加主键约束即可,每个表只能有一个主键。</p>
</li>
<li>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="sql"><code><div class="ec-line"><div class="code"><span class="indent"> </span><span style="--0:#FF79C6;--1:#BF3441">CREATE</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">TABLE</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#50FA7B;--1:#6F42C1">tablename</span><span style="--0:#F8F8F2;--1:#24292E"> ([...],</span><span style="--0:#FF79C6;--1:#BF3441">PRIMARY KEY</span><span style="--0:#F8F8F2;--1:#24292E"> [索引的名字](字段名))</span></div></div><div class="ec-line"><div class="code"><span style="--0:#FF79C6;--1:#BF3441">ALTER</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">TABLE</span><span style="--0:#F8F8F2;--1:#24292E"> tablename </span><span style="--0:#FF79C6;--1:#BF3441">ADD</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">PRIMARY KEY</span><span style="--0:#F8F8F2;--1:#24292E">(字段名)</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code=" CREATE TABLE tablename ([...],PRIMARY KEY [索引的名字](字段名))ALTER TABLE tablename ADD PRIMARY KEY(字段名)"><div></div></button></div></figure></div>
</li>
</ul>
</li>
<li>
<p>复合索引</p>
<ul>
<li>
<p>用户可以在多个列上建立索引,这种索引叫做组复合索引(组合索引)。复合索引可以代替多个单一索引,相比多个单一索引复合索引所需的开销更小。</p>
</li>
<li>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="sql"><code><div class="ec-line"><div class="code"><span class="indent"> </span><span style="--0:#FF79C6;--1:#BF3441">CREATE</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">INDEX</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">&lt;</span><span style="--0:#F8F8F2;--1:#24292E">索引的名字</span><span style="--0:#FF79C6;--1:#BF3441">&gt;</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">ON</span><span style="--0:#F8F8F2;--1:#24292E"> tablename(字段名1,字段 </span><span style="--0:#BD93F9;--1:#005CC5">2</span><span style="--0:#F8F8F2;--1:#24292E">...)</span></div></div><div class="ec-line"><div class="code"><span style="--0:#FF79C6;--1:#BF3441">ALTER</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">TABLE</span><span style="--0:#F8F8F2;--1:#24292E"> tablename </span><span style="--0:#FF79C6;--1:#BF3441">ADD</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">INDEX</span><span style="--0:#F8F8F2;--1:#24292E"> [索引的名字](字段名1,字段 </span><span style="--0:#BD93F9;--1:#005CC5">2</span><span style="--0:#F8F8F2;--1:#24292E">...)</span></div></div><div class="ec-line"><div class="code"><span style="--0:#FF79C6;--1:#BF3441">CREATE</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">TABLE</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#50FA7B;--1:#6F42C1">tablename</span><span style="--0:#F8F8F2;--1:#24292E"> ([...],</span><span style="--0:#FF79C6;--1:#BF3441">INDEX</span><span style="--0:#F8F8F2;--1:#24292E"> [索引的名字](字段名1,字段 </span><span style="--0:#BD93F9;--1:#005CC5">2</span><span style="--0:#F8F8F2;--1:#24292E">...))</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code=" CREATE INDEX <索引的名字> ON tablename(字段名1,字段 2...)ALTER TABLE tablename ADD INDEX [索引的名字](字段名1,字段 2...)CREATE TABLE tablename ([...],INDEX [索引的名字](字段名1,字段 2...))"><div></div></button></div></figure></div>
</li>
<li>
<p>复合索引使用注意事项:</p>
<ul>
<li>何时使用复合索引,要根据 where 条件建索引,注意不要过多使用索引,过多使用会对更新操作效率有很大影响。</li>
<li>如果表已经建立了(col1,col2),就没有必要再单独建立(col1);如果现在有(col1)索引,如果查询需要 col1 和 col2 条件,可以建立(col1,col2)复合索引,对于查询有一定提高。</li>
</ul>
</li>
</ul>
</li>
<li>
<p>全文索引</p>
<p>查询操作在数据量比较少时,可以使用 like 模糊查询,但是对于大量的文本数据检索,效率很低。如果使用全文索引,查询速度会比 like 快很多倍。</p>
<p>在 MySQL5.6 以前的版本,只有 MyISAM 存储引擎支持全文索引,从MySQL5.6 开始 MyISAM 和 InnoDB 存储引擎均支持。</p>
</li>
</ol>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="sql"><code><div class="ec-line"><div class="code"><span class="indent"> </span><span style="--0:#FF79C6;--1:#BF3441">CREATE</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">FULLTEXT</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">INDEX</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">&lt;</span><span style="--0:#F8F8F2;--1:#24292E">索引的名字</span><span style="--0:#FF79C6;--1:#BF3441">&gt;</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">ON</span><span style="--0:#F8F8F2;--1:#24292E"> tablename(字段名)</span></div></div><div class="ec-line"><div class="code"><span class="indent"> </span><span style="--0:#FF79C6;--1:#BF3441">ALTER</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">TABLE</span><span style="--0:#F8F8F2;--1:#24292E"> tablename </span><span style="--0:#FF79C6;--1:#BF3441">ADD</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">FULLTEXT</span><span style="--0:#F8F8F2;--1:#24292E"> [索引的名字](字段名)</span></div></div><div class="ec-line"><div class="code"><span class="indent"> </span><span style="--0:#FF79C6;--1:#BF3441">CREATE</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">TABLE</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#50FA7B;--1:#6F42C1">tablename</span><span style="--0:#F8F8F2;--1:#24292E"> ([...],</span><span style="--0:#FF79C6;--1:#BF3441">FULLTEXT</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">KEY</span><span style="--0:#F8F8F2;--1:#24292E"> [索引的名字](字段名))</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code=" CREATE FULLTEXT INDEX <索引的名字> ON tablename(字段名) ALTER TABLE tablename ADD FULLTEXT [索引的名字](字段名) CREATE TABLE tablename ([...],FULLTEXT KEY [索引的名字](字段名))"><div></div></button></div></figure></div>
<p>全文索引方式有自然语言检索<code>IN NATURAL LANGUAGE MODE</code>和布尔检索<code>IN BOOLEAN MODE</code>两种,和常用的 like 模糊查询不同,全文索引有自己的语法格式,使用 match 和 against 关键字。</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="sql"><code><div class="ec-line"><div class="code"><span style="--0:#FF79C6;--1:#BF3441">SELECT</span><span style="--0:#F8F8F2;--1:#24292E"> \</span><span style="--0:#FF79C6;--1:#BF3441">*</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">FROM</span><span style="--0:#F8F8F2;--1:#24292E"> users3 </span><span style="--0:#FF79C6;--1:#BF3441">WHERE</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">MATCH</span><span style="--0:#F8F8F2;--1:#24292E">(</span><span style="--0:#FF79C6;--1:#BF3441">NAME</span><span style="--0:#F8F8F2;--1:#24292E">) AGAINST(</span><span style="--1:#032F62"><span style="--0:#E9F284">&#39;</span><span style="--0:#F1FA8C">aabb</span><span style="--0:#E9F284">&#39;</span></span><span style="--0:#F8F8F2;--1:#24292E">);</span></div></div><div class="ec-line"><div class="code"><span style="--0:#96A1C2;--1:#616972">-- \* 表示通配符,只能在词后面</span></div></div><div class="ec-line"><div class="code"><span style="--0:#FF79C6;--1:#BF3441">SELECT</span><span style="--0:#F8F8F2;--1:#24292E"> \</span><span style="--0:#FF79C6;--1:#BF3441">*</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">FROM</span><span style="--0:#F8F8F2;--1:#24292E"> users3 </span><span style="--0:#FF79C6;--1:#BF3441">WHERE</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">MATCH</span><span style="--0:#F8F8F2;--1:#24292E">(</span><span style="--0:#FF79C6;--1:#BF3441">NAME</span><span style="--0:#F8F8F2;--1:#24292E">) AGAINST(</span><span style="--1:#032F62"><span style="--0:#E9F284">&#39;</span><span style="--0:#F1FA8C">aa\_</span><span style="--0:#E9F284">&#39;</span></span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">IN</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">BOOLEAN</span><span style="--0:#F8F8F2;--1:#24292E"> MODE);</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="SELECT \* FROM users3 WHERE MATCH(NAME) AGAINST('aabb');-- \* 表示通配符,只能在词后面SELECT \* FROM users3 WHERE MATCH(NAME) AGAINST('aa\_' IN BOOLEAN MODE);"><div></div></button></div></figure></div>
<p>全文索引必须在字符串、文本字段上建立。</p>
<p>全文索引字段值必须在最小字符和最大字符之间才会有效。(InnoDB: 3-84;MyISAM: 4-84)</p>
<h3 id="介绍一下最佳左前缀法则">介绍一下最佳左前缀法则</h3>
<ul>
<li>最佳左前缀底层原理</li>
</ul>
<p>MySQL 创建联合索引的规则是: 首先会对联合索引最左边的字段进行排序,在第一个字段的基础上再对第二个字段进行排序。</p>
<h3 id="什么是索引下推">什么是索引下推</h3>
<p>索引下推(index condition pushdown)简称 ICP,在 MySQL5.6 的版本推出,用于优化查询。</p>
<p>需求: 查询 users 表中“名字第一个字是张,年龄为 10 岁的所有记录”。</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="sql"><code><div class="ec-line"><div class="code"><span style="--0:#FF79C6;--1:#BF3441">select</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">*</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">from</span><span style="--0:#F8F8F2;--1:#24292E"> users </span><span style="--0:#FF79C6;--1:#BF3441">where</span><span style="--0:#F8F8F2;--1:#24292E"> user_name </span><span style="--0:#FF79C6;--1:#BF3441">like</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--1:#032F62"><span style="--0:#E9F284">&#39;</span><span style="--0:#F1FA8C">张%</span><span style="--0:#E9F284">&#39;</span></span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">and</span><span style="--0:#F8F8F2;--1:#24292E"> user_age </span><span style="--0:#FF79C6;--1:#BF3441">=</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#BD93F9;--1:#005CC5">10</span><span style="--0:#F8F8F2;--1:#24292E">;</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="select * from users where user_name like '张%' and user_age = 10;"><div></div></button></div></figure></div>
<p>根据最左前缀原则,该语句在搜索索引树的时候,只能匹配到名字第一个字是‘张’的记录,接下来是怎么处理的呢?当然就是从该记录开始,逐个回表,到主键索引上找出相应的记录,在比对 age 这个字段的值是否符合。</p>
<p>MySQL5.6 引入了索引下推优化,可以在索引遍历过程中,对索引中包含的字段先做判断,过滤掉不符合条件的记录,减少回表次数。</p>
<p>如果没有索引下推优化(或简称 ICP 优化),当进行索引查询时,首先根据索引来查找记录,然后再根据 where 条件来过滤记录。</p>
<p>在支持 ICP 优化后,MySQL 会在取出索引的同时,判断是否可以进行 where 条件过滤再进行索引查询,也就是说提前执行 where 的部分过滤操作,在某些场景下,可以大大减少回表次数,从而提升整体性能。</p>
<h3 id="什么是自适应哈希索引">什么是自适应哈希索引</h3>
<p>自适应 hash 索引(Adatptive Hash Index,内部简称 AHI)是 InnoDB 的三大特性之一,还有两个是 BufferPool 简称 BP、双写缓冲区(Doublewrite Buffer)。</p>
<ol>
<li>自适应即我们不需要自己处理,当 InnoDB 引擎根据查询统计发现某一查询满足 hash 索引的数据结构特点,就会给其建立一个 hash 索引。</li>
<li>hash 索引底层的数据结构是散列表((hash 表),其数据特点就是比较适合在内存中使用,自适应 hash 索引存在于 InnoDB 架构中的缓存中(不存在于磁盘架构中)。</li>
<li>自适应 hash 索引只适合搜索等值的查询,如 select * from table where index_col = ‘xxx’,而对于其他查找类型,如范围查找,是不能使用的。</li>
</ol>
<p>AHI 是针对B+树 Search Path 的优化,因此所有会涉及到 Search Path 的操作,均可使用此 hash 索引进行优化。</p>
<p>根据索引键值(前缀)快速定位到叶子结点满足条件记录的 offset,减少了 B+Tree Search Path的代价,将 B+Tree 从 Root 节点至 leaf 节点的路径定位,优化为 Hash Index 的快速查询。</p>
<p>InnoDB 的自适应 Hash 索引是默认开启的,可以通过配置下面的参数设置进行关闭。</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="sql"><code><div class="ec-line"><div class="code"><span style="--0:#F8F8F2;--1:#24292E">innodb_adaptive_hash_index </span><span style="--0:#FF79C6;--1:#BF3441">=</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">off</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="innodb_adaptive_hash_index = off"><div></div></button></div></figure></div>
<p>自适应 Hash 索引使用分片进行实现的,分片数可以使用配置参数设置</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="sql"><code><div class="ec-line"><div class="code"><span style="--0:#F8F8F2;--1:#24292E">innodb_adaptive_hash_index_parts </span><span style="--0:#FF79C6;--1:#BF3441">=</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#BD93F9;--1:#005CC5">8</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="innodb_adaptive_hash_index_parts = 8"><div></div></button></div></figure></div>
<h3 id="为什么like以开头索引会失效">为什么LIKE以%开头索引会失效</h3>
<p>like 查询为范围查询,%出现在左边,则索引失效。%出现在右边索引未失效。</p>
<p>场景 1: 两边都有%或者字段左边有%,索引失效</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="sql"><code><div class="ec-line"><div class="code"><span style="--0:#FF79C6;--1:#BF3441">select</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">*</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">from</span><span style="--0:#F8F8F2;--1:#24292E"> users </span><span style="--0:#FF79C6;--1:#BF3441">where</span><span style="--0:#F8F8F2;--1:#24292E"> user_name </span><span style="--0:#FF79C6;--1:#BF3441">like</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--1:#032F62"><span style="--0:#E9F284">&#39;</span><span style="--0:#F1FA8C">%tom%</span><span style="--0:#E9F284">&#39;</span></span><span style="--0:#F8F8F2;--1:#24292E">;</span></div></div><div class="ec-line"><div class="code"><span style="--0:#FF79C6;--1:#BF3441">select</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">*</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">from</span><span style="--0:#F8F8F2;--1:#24292E"> users </span><span style="--0:#FF79C6;--1:#BF3441">where</span><span style="--0:#F8F8F2;--1:#24292E"> user_name </span><span style="--0:#FF79C6;--1:#BF3441">like</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--1:#032F62"><span style="--0:#E9F284">&#39;</span><span style="--0:#F1FA8C">%tom</span><span style="--0:#E9F284">&#39;</span></span><span style="--0:#F8F8F2;--1:#24292E">;</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="select * from users where user_name like '%tom%';select * from users where user_name like '%tom';"><div></div></button></div></figure></div>
<p>场景 2: 字段右边有%,索引生效</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="sql"><code><div class="ec-line"><div class="code"><span style="--0:#FF79C6;--1:#BF3441">select</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">*</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">from</span><span style="--0:#F8F8F2;--1:#24292E"> users </span><span style="--0:#FF79C6;--1:#BF3441">where</span><span style="--0:#F8F8F2;--1:#24292E"> user_name </span><span style="--0:#FF79C6;--1:#BF3441">like</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--1:#032F62"><span style="--0:#E9F284">&#39;</span><span style="--0:#F1FA8C">tom%</span><span style="--0:#E9F284">&#39;</span></span><span style="--0:#F8F8F2;--1:#24292E">;</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="select * from users where user_name like 'tom%';"><div></div></button></div></figure></div>
<p>解决%出现在左边索引失效的方法,使用覆盖索引。</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="sql"><code><div class="ec-line"><div class="code"><span style="--0:#FF79C6;--1:#BF3441">select</span><span style="--0:#F8F8F2;--1:#24292E"> user_name </span><span style="--0:#FF79C6;--1:#BF3441">from</span><span style="--0:#F8F8F2;--1:#24292E"> users </span><span style="--0:#FF79C6;--1:#BF3441">where</span><span style="--0:#F8F8F2;--1:#24292E"> user_name likt </span><span style="--1:#032F62"><span style="--0:#E9F284">&#39;</span><span style="--0:#F1FA8C">%tom%</span><span style="--0:#E9F284">&#39;</span></span><span style="--0:#F8F8F2;--1:#24292E">;</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="select user_name from users where user_name likt '%tom%';"><div></div></button></div></figure></div>
<h4 id="like-失效的原因">like 失效的原因</h4>
<ol>
<li>%号在右: 由于 B+Tree 的索引顺序,是按照首字母的大小进行排序,%号在右的匹配又是匹配首字母。所以可以在 B+Tree 上进行有序的查找,查找首字母符合要求的数据。</li>
<li>%号在左: 是匹配字符串尾部的数据,我们上面说了排序规则,尾部的字母是没有顺序的,所以不能按照索引顺序查询,就用不到索引。</li>
<li>两个%号: 这个是查询任意位置的字母满足条件即可,只有首字母是进行索引排序的,其他位置的字母都是相对无序的,所以查找任意位置的字母是用不到索引的。</li>
</ol>
<h3 id="自增还是uuid-数据库主键的类型该如何选择">自增还是UUID 数据库主键的类型该如何选择</h3>
<h4 id="auto_increment-的优点">auto_increment 的优点</h4>
<ol>
<li>字段长度较 uuid 小很多,可以是 bigint 甚至是 int 类型,这对检索的性能会有所影响。</li>
<li>在写的方面,因为是自增的,所以主键是趋势自增的,也就是说新增的数据永远在后面,这点对于性能有很大的提升。</li>
<li>数据库自动编号,速度快,而且是增量增长,按顺序存放,对于检索非常有利。</li>
<li>数字型,占用空间小,易排序,在程序中传递也方便。</li>
</ol>
<h4 id="auto_increment-的缺点">auto_increment 的缺点</h4>
<ol>
<li>由于是自增,很容易通过网络爬虫知晓当前系统的业务量。</li>
<li>高并发的情况下,竞争自增锁会降低数据库的吞吐能力。</li>
<li>数据迁移或分库分表场景下,自增方式不再适用。</li>
</ol>
<h4 id="uuid-优点">uuid 优点</h4>
<ol>
<li>不会冲突,进行数据拆分、合并存储的时候,能保证主键全局的唯一性。</li>
<li>可以在应用层生成,提高数据库吞吐能力。</li>
</ol>
<h4 id="uuid-缺点">uuid 缺点</h4>
<ol>
<li>影响插入速度,并且造成硬盘使用率低。与自增相比,最大的缺陷就是随机 IO,下面我们会去具体解释。</li>
<li>字符串类型相比整数类型肯定更消耗空间,而且会比整数类型操作慢。</li>
</ol>
<h4 id="uuid-和自增-id-的索引结构对比">uuid 和自增 id 的索引结构对比</h4>
<ol>
<li>
<p><strong>使用自增 id 的内部结构</strong></p>
<p>自增的主键的值是顺序的,所以 InnoDB 把每一条记录都存储在一条记录的后面。</p>
<ul>
<li>当达到页面的最大填充因子时候(InnoDB 默认的最大填充因子是页大小的 15/16,会留出 1/16的空间做以后的修改)。</li>
<li>下一条记录就会写入新的页中,一旦数据按照这种顺序的方式加载,主键页就会近乎于顺序的记录填满,提升了页面的最大填充率,不会有页的浪费。</li>
<li>新插入的行一定会在原有的最大数据行下一行,MySQL 定位和寻址很快,不会为计算新行的位置而做出额外的消耗,减少了页分裂和碎片的产生。</li>
</ul>
</li>
<li>
<p><strong>使用 uuid 的内部结构</strong></p>
<p>插入 uuid: 新的记录可能会插入之前记录的中间,因此需要移动之前的记录。被写满已经刷新到磁盘上的页可能会被重新读取。</p>
<p>因为 uuid 相对顺序的自增 id 来说是毫无规律可言的,新行的值不一定要比之前的主键的值要大,所以 InnoDB 无法做到总是把新行插入到索引的最后,而是需要为新行寻找新的合适的位置从而来分配新的空间。</p>
<p>这个过程需要做很多额外的操作,数据的毫无顺序会导致数据分布散乱,将会导致以下的问题:</p>
<ol>
<li>写入的目标页很可能已经刷新到磁盘上并且从缓存上移除,或者还没有被加载到缓存中,InnoDB 在插入之前不得不先找到并从磁盘读取目标页到内存中,这将导致大量的随机 IO。</li>
<li>因为写入是乱序的,InnoDB 不得不频繁的做页分裂操作,以便为新的行分配空间,页分裂导致移动大量的数据,一次插入最少需要修改三个页以上。</li>
<li>由于频繁的页分裂,页会变得稀疏并被不规则的填充,最终会导致数据会有碎片。</li>
<li>在把随机值(uuid 和雪花 id)载入到聚簇索引(InnoDB 默认的索引类型)以后,有时候会需要做一次 OPTIMEIZE TABLE 来重建表并优化页的填充,这将又需要一定的时间消耗。</li>
</ol>
<p>结论: 使用 InnoDB 应该尽可能的按主键的自增顺序插入,并且尽可能使用单调增加聚簇键的值来插入新行。如果是分库分表场景下,分布式主键 id 的生成方案,优先选择雪花算法生成全局唯一主键(雪花算法生成的主键在一定程度上是有序的)。</p>
</li>
</ol>
<h3 id="innodb与myisam的区别">InnoDB与MyISAM的区别</h3>
<p>InnoDB 和 MyISAM 是使用 MySQL 时最常用的两种引擎类型,两者区别:</p>
<ul>
<li>
<p>事务和外键</p>
<p>InnoDB 支持事务和外键,具有安全性和完整性,适合大量 insert 或 update 操作。</p>
<p>MyISAM 不支持事务和外键,它提供高速存储和检索,适合大量的 select 查询操作。</p>
</li>
<li>
<p>锁机制</p>
<p>InnoDB 支持行级锁,锁定指定记录,基于索引来加锁区别。</p>
<p>MyISAM 支持表级锁,锁定整张表。</p>
</li>
<li>
<p>索引结构</p>
<p>InnoDB 使用聚集索引,索引和记录在一起存储,既缓存索引,也缓存记录。</p>
<p>MyISAM 使用非聚集索引,索引和记录分开。</p>
</li>
<li>
<p>并发处理能力</p>
<p>InnoDB 读写阻塞可以与隔离级别有关,可以采用多版本并发控制(MVCC)来支持高并发。</p>
<p>MyISAM 使用表锁,会导致写操作并发率低,读之间并不阻塞,读写阻塞。</p>
</li>
<li>
<p>存储文件</p>
<p>InnoDB 表对应两个文件,一个.frm 表结构文件(MySQL8 中废弃,没有对应的.sdi文件,表结构合并在.ibd文件中),一个.ibd 数据文件。InnoDB 表最大支持 64GB。</p>
<p>MyISAM 表对应三个文件,一个.frm 表结构文件(MySQL8 中废弃,出现了新的.sdi文件替代),一个 .MYD 表数据文件,一个.MYI 索引文件。从 MySQL5.0 开始默认限制是 255TB。</p>
</li>
</ul>
<p>MyISAM 适用场景</p>
<ul>
<li>不需要事务支持(不支持)</li>
<li>并发相对较低(锁定机制问题)</li>
<li>数据修改相对较少,以读为主</li>
<li>数据一致性要求不高</li>
</ul>
<p>InnoDB 适用场景</p>
<ul>
<li>需要事务支持(具有较好的事务特性)</li>
<li>行级锁定对高并发有很好的适应能力</li>
<li>数据更新较为频繁的场景</li>
<li>数据一致性要求较高</li>
<li>硬件设备内存较大,可以利用 InnoDB 较好的缓存能力来提高内存利用率,减少磁盘 IO</li>
</ul>
<p>两种引擎如何选择</p>
<ul>
<li>是否需要事务?有,InnoDB</li>
<li>是否存在并发修改?有,InnoDB</li>
<li>是否追求快速查询,且数据修改少?是,MyISAM</li>
<li>在绝大多数情况下,推荐使用 InnoDB</li>
</ul>
<h3 id="b树和b树的区别是什么">B树和B+树的区别是什么</h3>
<h4 id="b-tree-介绍">B-Tree 介绍</h4>
<p>B-Tree 是一种平衡的多路查找树,B树允许一个节点存放多个数据,这样可以在尽可能减少树的深度的同时,存放更多的数据(把瘦高的树变得矮胖)。</p>
<p>B-Tree 中所有节点的子树个数的最大值成为 B-Tree 的阶,用 m 表示,一颗 m 阶的 B 树,如果不为空,就必须满足以下条件:</p>
<ol>
<li>每个节点最多用友 m-1 个关键字(跟节点除外)也就是 m 个子树</li>
<li>跟节点至少有两个子树(可以没有子树,有就必须是两个)</li>
<li>分支节点至少有(m/2)颗子树(除去跟节点和叶子节点其他都是分支节点)</li>
<li>所有叶子节点都在同一层,并且以升序排序</li>
</ol>
<h5 id="b-tree-结构存储索引的特点">B-Tree 结构存储索引的特点</h5>
<p>为了描述 B-Tree 首先定义一条记录为了一个键值对[key,data],key 为记录的键值,对应表中的主键值(聚簇索引),data 为一行记录中除主键外的数据。对于不同的记录,key 值互不相同。</p>
<ul>
<li>索引值和 data 数据分布在整棵树结构中</li>
<li>指针存储着子节点的地址信息</li>
<li>每个节点可以存放多个索引值及对应的 data 数据</li>
<li>树节点中多个索引值从左到右升序排列</li>
</ul>
<h5 id="b-tree-的查找操作">B-Tree 的查找操作</h5>
<p>B-Tree 的每个节点的元素可以视为一次 IO 读取,树的高度表示最多的 IO 次数,在相同数量的总元素个数下,每个节点的元素个数越多,高度越低,查询所需的 IO 次数越少。</p>
<h5 id="b-tree-总结">B-Tree 总结</h5>
<ul>
<li>优点: B-Tree 可以在内部节点存储键值和相关记录数据,因此把频繁访问的数据放在靠近跟节点的位置将大大提高热点数据的查询效率。</li>
<li>缺点: B-Tree 中每个节点不仅包含数据的 key 值,还有 data 数据,所以当 data 数据较大时,会导致每个节点存储的 key 值减少,并且导致 B-Tree 的层数变高,增加查询时的 IO 次数。</li>
<li>使用场景: B-Tree 主要应用于文件系统以及部分数据库索引,如 MongoDB,大部分关系型数据库索引则是使用 B+Tree 实现。</li>
</ul>
<h4 id="btree">B+Tree</h4>
<p>B+Tree 是在 B-Tree 基础上的一种优化,使其更适合实现存储索引结构,InnoDB 存储引起就是用 B+Tree 实现其索引结构。</p>
<h5 id="btree-的特征">B+Tree 的特征</h5>
<ul>
<li>非叶子节点只存储键值信息</li>
<li>所有叶子节点之间都有一个链指针</li>
<li>数据记录都存放在叶子节点中</li>
</ul>
<h5 id="btree-的优势">B+Tree 的优势</h5>
<ol>
<li>B+Tree 是 B-Tree 的变种,B-Tree 能解决的问题,B+Tree 也能够解决(降低树的高度,增大节点存储数据量)。</li>
<li>B+Tree 扫库和扫表能力更强,如果我们要根据索引去进行数据表的扫描,对 B-Tree 进行扫描,需要把整棵树遍历一遍,而 B+Tree 只需要遍历他的所有叶子节点即可(叶子节点之间有引用)。</li>
<li>B+Tree 磁盘读写能力更强,它的根节点和支节点不保存数据区,所有跟节点和支节点同样大小的情况下,保存的关键字要比 B-Tree 多,而叶子节点不保存子节点引用,所以,B+Tree 读写一次磁盘加载的关键字比 B-Tree 更多。</li>
<li>B+Tree 排序能力更强,B+Tree 天然具有排序功能。</li>
<li>B+Tree 查询效率更加稳定,每次查询数据,查询 IO 次数一定是稳定的,当然这个每个人的理解都不同,因为在 B-Tree 如果跟节点命中直接返回,确实效率更高。</li>
</ol>
<h3 id="一个b树中大概能存放多少条索引记录">一个B+树中大概能存放多少条索引记录</h3>
<p>MySQL 设计者将一个 B+Tree 的节点大小设置为一个页(这样做的目的是每个节点只需要一次 IO 就可以完全载入),InnoDB 的一个页的大小是 16KB,所以每个节点的大小也是 16KB,并且 B+Tree 的跟节点是保存在内存中的,子节点是存储在磁盘上。</p>
<p><strong>假设一个 B+Tree 高为 2,即存在一个跟节点和若干个叶子节点,那么这颗 B+Tree 的存放总记录数为: 跟节点指针数 * 单个叶子节点记录行数。</strong></p>
<ul>
<li><strong>计算跟节点指针数</strong>: 假设表的主键为 int 类型,占用的就是 4 个字节,或者是 bigint 占用 8 个字节,指针大小为 6 个字节,那么一个页(就是 B+Tree 的一个节点),大概可以存储: 16348B / (4B + 6B) = 1638,一个节点最多可以存储1638 个索引指针。</li>
<li><strong>计算每个叶子节点的记录数</strong>: 我们假设一行记录的数据大小为 1k,那么一页就可以存储 16 行数据,16kb / 1kb = 16。</li>
<li><strong>一颗高度为 2 的 B+Tree 可以存放的记录数为</strong>: 1638<em>16 = 26208 条数据记录,同样的原理可以推算处一个高度为 3 的 B+Tree 可以存放: 1638</em>1638*16 = 42928704 条这样的数据。</li>
</ul>
<p><strong>所以 InnoDB 中的 B+Tree 高度一般为 1~3 层,就可以满足千万级别的数据存储</strong>,在查找数据时一次页的查找代表一次 IO,所以通过主键索引查询通常只需要 1~3 次 IO 操作即可查找到数据。</p>
<h3 id="explain-有哪些主要字段">explain 有哪些主要字段</h3>
<p>MySQL 查询过程</p>
<img src="https://cdn.jsdelivr.net/gh/chou401/pic-md@main/img/image-20230918172052198.png" alt="image-20230918172052198"/>
<p>通过 explain 我们可以获得以下信息</p>
<ul>
<li>表的读取顺序</li>
<li>数据读取操作的操作类型</li>
<li>哪些索引可以被使用</li>
<li>哪些索引真正被使用</li>
<li>表的直接引用</li>
<li>每张表有多少行被优化器查询了</li>
</ul>
<p>explain 使用方式: explain + sql 语句</p>
<p>**explain 中包含的信息: **</p>
<ul>
<li>
<p><strong>id</strong>: 序列号,id列数字越大越先执行,如果说数字一样大,那么就从上往下依次执行,id列为null的就表是这是一个结果集,不需要使用它来进行查询。</p>
</li>
<li>
<p><strong>select_type</strong>: 查询类型。主要用来分辨查询的类型事普通查询还是联合查询还是子查询。常见的查询类型有:</p>
<ul>
<li>simple: 表示不需要union操作或者不包含子查询的简单select查询。有连接查询时,外层的查询为simple,且只有一个。</li>
<li>primary: 一个需要union操作或者含有子查询的select,位于最外层的单位查询的select_type即为primary。且只有一个。</li>
<li>union: union连接的两个select查询,第一个查询是dervied派生表,除了第一个表外,第二个以后的表select_type都是union。</li>
<li>dependent union: 与union一样,出现在union 或union all语句中,但是这个查询要受到外部查询的影响。</li>
<li>union result: 包含union的结果集,在union和union all语句中,因为它不需要参与查询,所以id字段为null。</li>
<li>subquery: 除了from字句中包含的子查询外,其他地方出现的子查询都可能是subquery。</li>
<li>dependent subquery: 与dependent union类似,表示这个subquery的查询要受到外部表查询的影响。</li>
<li>derived: from字句中出现的子查询,也叫做派生表,其他数据库中可能叫做内联视图或嵌套select。</li>
<li>uncacheable sebquery: 一个子查询的结果不能被缓存。</li>
<li>uncacheable union: 表示 union 的查询结果不能被缓存。</li>
</ul>
</li>
<li>
<p><strong>table</strong>: 表示 explain 语句正在访问哪个表,表名或者别名,可能是临时表或者 union 合并结果集。如果是具体的表名,则表明从实际的物理表中获取数据,当然也可以是表的别名;表名是 derivedN 的形式,表示使用了 id 为 N 的查询所产生的衍生表;当有 union result 的时候,表名是union n1,n2 等的形式,n1,n2 表示参与 union 的 id。</p>
</li>
<li>
<p><strong>partions</strong>: 分区</p>
</li>
<li>
<p><strong>type</strong>: 访问类型,表示以何种方式去访问数据库,最容易想的是全表扫描,即直接暴力的遍历一张表去寻找需要的数据,效率非常低下。</p>
<p>访问的类型有很多,效率从最好到最坏依次是: system &gt; const &gt; eq_ref &gt; ref &gt; fulltext &gt; ref_or_null &gt; index_merge &gt; unique_subquery &gt; index_subquery &gt; range &gt; index &gt; ALL。</p>
<ul>
<li><strong>system</strong>: 表只有一行记录(等于系统表),这是 const 类型的特例,平时不会出现,不需要进行磁盘 IO。</li>
<li><strong>const</strong>: 最多只能匹配到一条数据,通常使用主键或唯一索引进行等值条件查询。</li>
<li><strong>eq_ref</strong>: 当进行等值联表查询使用主键索引或者唯一性非空索引进行数据查找时(实际上唯一索引等值查询 type 不是 eq_ref 而是 const)。</li>
<li><strong>ref</strong>: 使用了非唯一性索引进行数据的查找。</li>
<li><strong>ref_or_null</strong>: 对于某个字段既需要关联条件,也需要 null 值的情况下,查询优化器会选择这种访问方式。</li>
<li><strong>index_merge</strong>: 在查询过程中需要多个索引组合使用。</li>
<li><strong>unique_subquery</strong>: 该连接类型类似于 index_subquery,使用的是唯一索引。大多数情况下使用 SELECT 子查询时,MySQL 查询优化器会自动将子查询优化为联表查询,因此 type 不会显示为 index_subquery,而是 eq_ref。</li>
<li><strong>index_subquery</strong>: 利用索引来关联子查询,不再扫描全表。但是大多数情况下使用 SELECT 子查询时,MySQL 查询优化器会自动将子查询优化为联表查询,因此 type 不会显示 index_subquery,而是 ref。</li>
<li><strong>range</strong>: 表示利用索引查询的时候限制了范围,在指定范围内进行查询,这样避免了 index 的全索引扫描。适用的操作符: <code>=, &lt;&gt;, &gt;, &gt;=, &lt;, ≤, is null, between,like, or, in</code>。</li>
<li><strong>index</strong>: 全索引扫描这个比 all 的效率要好,主要有两种情况,一种是当前的查询覆盖索引,即需要的数据在索引中就可以索取,或者是使用了索引进行排序,这样就避免了数据的重排序。</li>
<li><strong>all</strong>: 全表扫描,需要扫描整张表,从头到尾找到需要的数据行。一般情况下出现这样的 sql 语句而且数据量比较大的话那么就需要进行优化。</li>
</ul>
<p>一般情况下,要保证查询至少达到 range 级别,最好能达到 ref。</p>
</li>
<li>
<p><strong>possibale_keys</strong>: 显示查询可能使用哪些索引来查找,即显示可能应用在这张表中的索引,一个或多个,查询涉及到的字段上若存在索引,则该索引将被列出,但不一定被查询实际使用。</p>
</li>
<li>
<p><strong>key</strong>: 这一列显示 mysql 实际采用哪个索引来优化对该表的访问,即实际使用的索引,如果为 null ,则表示没有使用索引。</p>
</li>
<li>
<p><strong>key_len</strong>: 表示索引中使用的字节数,可以通过 key_len 计算查询中使用的索引长度,在不损失精度的情况下长度越短越好。索引越大占用存储空间越大,这样 io 的次数和量就会增加,影响执行效率。</p>
</li>
<li>
<p><strong>ref</strong>: 显示之前的表在 key 列记录的索引中查找值所用的列或者常量。</p>
</li>
<li>
<p><strong>rows</strong>: 根据表的统计信息及索引使用情况,大致估算出找出所需记录需要读取的数据行数,此参数很重要,直接反应 sql 找了多少数据,在完成目的的情况下越少越好。</p>
</li>
<li>
<p><strong>filtered</strong>: 针对表中符合某个条件(where 子句或者连接条件)的记录数的百分比所做的一个悲观估算。</p>
</li>
<li>
<p><strong>extra</strong>: 显示不适合在其它列的额外信息,虽 然叫额外,但是也有一些重要的信息:</p>
<ul>
<li><strong>using filtersort</strong>: 说明 mysql 无法利用索引进行排序,只能利用排序算法进行排序,会消耗额外的位置。</li>
<li><strong>using index</strong>: 表示当前的查询是覆盖索引的,直接从索引中读取数据,而不用访问数据表。如果同时出现 using where,表示索引被用来执行索引键值的查找,如果没有,表示索引被用来读取数据,而不是真的查找。</li>
<li><strong>using where</strong>: 使用 where 进行条件过滤。</li>
<li><strong>using temporary</strong> : 建立临时表来保存中间结果,查询完成之后把临时表删除。</li>
<li><strong>using join buffer</strong>: 使用连接缓存。会显示 join 连接查询时,MySQL 选择的查询算法。</li>
<li><strong>impossible where</strong>: where 语句的结果总是 false。</li>
<li><strong>Using index condition</strong>: 表示查询包含索引列和非索引列,优化器将首先解析索引列,并在表中查找其他条件(<strong>索引下推</strong>)。</li>
<li><strong>Using index for skip scan</strong>: 索引跳跃。</li>
</ul>
</li>
</ul>
<h3 id="如何进行分页查询优化">如何进行分页查询优化</h3>
<p>一般的分页查询使用简单的 limit 子句就可以实现。limit 格式如下:</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="sql"><code><div class="ec-line"><div class="code"><span style="--0:#FF79C6;--1:#BF3441">select</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">*</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">from</span><span style="--0:#F8F8F2;--1:#24292E"> 表名 </span><span style="--0:#FF79C6;--1:#BF3441">limit</span><span style="--0:#F8F8F2;--1:#24292E"> [offset,] </span><span style="--0:#FF79C6;--1:#BF3441">rows</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="select * from 表名 limit [offset,] rows"><div></div></button></div></figure></div>
<ul>
<li>第一个参数指定第一个返回记录行的偏移量,注意从 0 开始</li>
<li>第二个参数指定返回记录行的最大数目</li>
<li>如果只给定一个参数,它表示返回最大的记录行数目</li>
</ul>
<p><strong>思考 1: 如果偏移量固定,返回记录量对执行时间有什么影响?</strong></p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="sql"><code><div class="ec-line"><div class="code"><span style="--0:#FF79C6;--1:#BF3441">select</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">*</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">from</span><span style="--0:#F8F8F2;--1:#24292E"> user </span><span style="--0:#FF79C6;--1:#BF3441">limit</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#BD93F9;--1:#005CC5">10000</span><span style="--0:#F8F8F2;--1:#24292E">,</span><span style="--0:#BD93F9;--1:#005CC5">1</span><span style="--0:#F8F8F2;--1:#24292E">;</span></div></div><div class="ec-line"><div class="code"><span style="--0:#FF79C6;--1:#BF3441">select</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">*</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">from</span><span style="--0:#F8F8F2;--1:#24292E"> user </span><span style="--0:#FF79C6;--1:#BF3441">limit</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#BD93F9;--1:#005CC5">10000</span><span style="--0:#F8F8F2;--1:#24292E">,</span><span style="--0:#BD93F9;--1:#005CC5">10</span><span style="--0:#F8F8F2;--1:#24292E">;</span></div></div><div class="ec-line"><div class="code"><span style="--0:#FF79C6;--1:#BF3441">select</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">*</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">from</span><span style="--0:#F8F8F2;--1:#24292E"> user </span><span style="--0:#FF79C6;--1:#BF3441">limit</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#BD93F9;--1:#005CC5">10000</span><span style="--0:#F8F8F2;--1:#24292E">,</span><span style="--0:#BD93F9;--1:#005CC5">100</span><span style="--0:#F8F8F2;--1:#24292E">;</span></div></div><div class="ec-line"><div class="code"><span style="--0:#FF79C6;--1:#BF3441">select</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">*</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">from</span><span style="--0:#F8F8F2;--1:#24292E"> user </span><span style="--0:#FF79C6;--1:#BF3441">limit</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#BD93F9;--1:#005CC5">10000</span><span style="--0:#F8F8F2;--1:#24292E">,</span><span style="--0:#BD93F9;--1:#005CC5">1000</span><span style="--0:#F8F8F2;--1:#24292E">;</span></div></div><div class="ec-line"><div class="code"><span style="--0:#FF79C6;--1:#BF3441">select</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">*</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">from</span><span style="--0:#F8F8F2;--1:#24292E"> user </span><span style="--0:#FF79C6;--1:#BF3441">limit</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#BD93F9;--1:#005CC5">10000</span><span style="--0:#F8F8F2;--1:#24292E">,</span><span style="--0:#BD93F9;--1:#005CC5">10000</span><span style="--0:#F8F8F2;--1:#24292E">;</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="select * from user limit 10000,1;select * from user limit 10000,10;select * from user limit 10000,100;select * from user limit 10000,1000;select * from user limit 10000,10000;"><div></div></button></div></figure></div>
<p>结果: 在查询记录时,返回记录量低于 100 条,查询时间基本没有变化,差距不大。随着查询记录量越大,所花费的时间也会越来越多。</p>
<p><strong>思考 2: 如果查询偏移量变化,返回记录数固定对执行时间有什么影响?</strong></p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="sql"><code><div class="ec-line"><div class="code"><span style="--0:#FF79C6;--1:#BF3441">select</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">*</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">from</span><span style="--0:#F8F8F2;--1:#24292E"> user </span><span style="--0:#FF79C6;--1:#BF3441">limit</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#BD93F9;--1:#005CC5">1</span><span style="--0:#F8F8F2;--1:#24292E">,</span><span style="--0:#BD93F9;--1:#005CC5">100</span><span style="--0:#F8F8F2;--1:#24292E">;</span></div></div><div class="ec-line"><div class="code"><span style="--0:#FF79C6;--1:#BF3441">select</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">*</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">from</span><span style="--0:#F8F8F2;--1:#24292E"> user </span><span style="--0:#FF79C6;--1:#BF3441">limit</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#BD93F9;--1:#005CC5">10</span><span style="--0:#F8F8F2;--1:#24292E">,</span><span style="--0:#BD93F9;--1:#005CC5">100</span><span style="--0:#F8F8F2;--1:#24292E">;</span></div></div><div class="ec-line"><div class="code"><span style="--0:#FF79C6;--1:#BF3441">select</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">*</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">from</span><span style="--0:#F8F8F2;--1:#24292E"> user </span><span style="--0:#FF79C6;--1:#BF3441">limit</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#BD93F9;--1:#005CC5">100</span><span style="--0:#F8F8F2;--1:#24292E">,</span><span style="--0:#BD93F9;--1:#005CC5">100</span><span style="--0:#F8F8F2;--1:#24292E">;</span></div></div><div class="ec-line"><div class="code"><span style="--0:#FF79C6;--1:#BF3441">select</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">*</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">from</span><span style="--0:#F8F8F2;--1:#24292E"> user </span><span style="--0:#FF79C6;--1:#BF3441">limit</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#BD93F9;--1:#005CC5">1000</span><span style="--0:#F8F8F2;--1:#24292E">,</span><span style="--0:#BD93F9;--1:#005CC5">100</span><span style="--0:#F8F8F2;--1:#24292E">;</span></div></div><div class="ec-line"><div class="code"><span style="--0:#FF79C6;--1:#BF3441">select</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">*</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">from</span><span style="--0:#F8F8F2;--1:#24292E"> user </span><span style="--0:#FF79C6;--1:#BF3441">limit</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#BD93F9;--1:#005CC5">10000</span><span style="--0:#F8F8F2;--1:#24292E">,</span><span style="--0:#BD93F9;--1:#005CC5">100</span><span style="--0:#F8F8F2;--1:#24292E">;</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="select * from user limit 1,100;select * from user limit 10,100;select * from user limit 100,100;select * from user limit 1000,100;select * from user limit 10000,100;"><div></div></button></div></figure></div>
<p>结果: 在查询记录时,如果查询记录量相同,偏移量超过 100 后就开始随着偏移量增大,查询时间急剧的增加。(这种分页查询机制,每次都会从数据库第一条记录开始扫描,越往后查询越慢,而且查询的数据越多,也会拖慢总查询速度。)</p>
<h3 id="分页优化方案">分页优化方案</h3>
<p>优化 1: 通过索引进行分页</p>
<p>直接进行 limit 操作,会产生全表扫描,速度很慢,limit 限制的是从结果集的 M 位置处取出 N 条输出,其余抛弃。假设 id 是连续递增的,我们根据查询的页数和查询的记录数可以算出查询的 id 范围,然后配合 limit 使用</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="sql"><code><div class="ec-line"><div class="code"><span style="--0:#F8F8F2;--1:#24292E">explain </span><span style="--0:#FF79C6;--1:#BF3441">select</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">*</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">from</span><span style="--0:#F8F8F2;--1:#24292E"> user </span><span style="--0:#FF79C6;--1:#BF3441">where</span><span style="--0:#F8F8F2;--1:#24292E"> id </span><span style="--0:#FF79C6;--1:#BF3441">&gt;=</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#BD93F9;--1:#005CC5">100001</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">limit</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#BD93F9;--1:#005CC5">100</span><span style="--0:#F8F8F2;--1:#24292E">;</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="explain select * from user where id >= 100001 limit 100;"><div></div></button></div></figure></div>
<p>优化 2: 利用子查询优化</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="sql"><code><div class="ec-line"><div class="code"><span style="--0:#F8F8F2;--1:#24292E"># 首先定位偏移位置的 id</span></div></div><div class="ec-line"><div class="code"><span style="--0:#FF79C6;--1:#BF3441">select</span><span style="--0:#F8F8F2;--1:#24292E"> id </span><span style="--0:#FF79C6;--1:#BF3441">from</span><span style="--0:#F8F8F2;--1:#24292E"> user_contacts </span><span style="--0:#FF79C6;--1:#BF3441">limit</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#BD93F9;--1:#005CC5">100000</span><span style="--0:#F8F8F2;--1:#24292E">,</span><span style="--0:#BD93F9;--1:#005CC5">1</span><span style="--0:#F8F8F2;--1:#24292E">;</span></div></div><div class="ec-line"><div class="code"><span style="--0:#F8F8F2;--1:#24292E"># 根据获取到的 id 值向后查询</span></div></div><div class="ec-line"><div class="code"><span style="--0:#F8F8F2;--1:#24292E">explain </span><span style="--0:#FF79C6;--1:#BF3441">select</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">*</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">from</span><span style="--0:#F8F8F2;--1:#24292E"> user_contacts </span><span style="--0:#FF79C6;--1:#BF3441">where</span><span style="--0:#F8F8F2;--1:#24292E"> id </span><span style="--0:#FF79C6;--1:#BF3441">&gt;=</span><span style="--0:#F8F8F2;--1:#24292E"> (</span><span style="--0:#FF79C6;--1:#BF3441">select</span><span style="--0:#F8F8F2;--1:#24292E"> id </span><span style="--0:#FF79C6;--1:#BF3441">from</span><span style="--0:#F8F8F2;--1:#24292E"> user_contacts </span><span style="--0:#FF79C6;--1:#BF3441">limit</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#BD93F9;--1:#005CC5">100000</span><span style="--0:#F8F8F2;--1:#24292E">,</span><span style="--0:#BD93F9;--1:#005CC5">1</span><span style="--0:#F8F8F2;--1:#24292E"> ) </span><span style="--0:#FF79C6;--1:#BF3441">limit</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#BD93F9;--1:#005CC5">100</span><span style="--0:#F8F8F2;--1:#24292E">;</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="# 首先定位偏移位置的 idselect id from user_contacts limit 100000,1;# 根据获取到的 id 值向后查询explain select * from user_contacts where id >= (select id from user_contacts limit 100000,1 ) limit 100;"><div></div></button></div></figure></div>
<p>原因: 使用 id 做主键比较(id &gt;= ),并且子查询使用了覆盖索引进行优化。</p>
<h3 id="如何做慢查询优化">如何做慢查询优化</h3>
<p>MySQL 慢查询的相关参数:</p>
<ul>
<li>slow_query_log: 是否开启慢查询日志,ON(1)表示开启,OFF(0)表示关闭。</li>
<li>slow_query_log_file: MySQL 数据库慢查询日志存储路径。</li>
<li>long_query_time: 慢查询阈值,当查询时间多于设定的阈值时,记录日志。</li>
<li>long_queries_not_using_indexes: 设置是否记录多少使用索引的查询语句。</li>
<li>log_slow_admin_statements: 设置是否记录管理语句的执行时间。</li>
</ul>
<h4 id="慢查询sql优化思路">慢查询SQL优化思路</h4>
<ol>
<li>
<p>SQL 性能下降的原因</p>
<p>当我们拿到 SQL 语句之后,对这些 SQL 进行分析之前,需要明确可能导致 SQL 执行性能下降的原因进行分析,执行性能下降可以体现以下两个方面:</p>
<ul>
<li>等待时间长</li>
</ul>
<p>锁表导致一直处于等待状态,后续我们从 MySQL 锁的机制去分析 SQL 执行的原理</p>
<ul>
<li>
<p>执行时间长</p>
<p>1.查询语句写的烂2.索引失败3.关联查询太多 join 4.服务器调优及各个参数的设置</p>
</li>
</ul>
</li>
<li>
<p>慢查询优化思路</p>
<ol>
<li>
<p>优先选择优化高并发执行的 SQL,因为高并发的 SQL 发生问题带来后果更严重</p>
<p>SQL1: 每小时执行 10000 次,每次 20 个 IO,优化后每次 18 个 IO,每小时节省 2 万次 IO
SQL2: 每小时 10 次,每次 20000 个 IO,每次优化减少 2000 个 IO,每小时节省 2 万次 IO
SQL2 更难优化,SQL1 更好优化,但是第一种属于高并发 SQL,更急需优化,成本更低</p>
</li>
<li>
<p>定位优化对象的性能瓶颈</p>
<p>在去优化 SQL 时,选择优化分方向有三个:
1.IO(数据访问消耗了太多的时间,查看是否正确使用了索引)
2.CPU(数据运算花费了太多时间,数据的运算分祖,排序是不是有问题) 3.网络带宽(加大网络带宽)</p>
</li>
<li>
<p>明确优化目标</p>
<p>需要根据数据库当前的状态
数据库中与该条 SQL 的关系
当前 SQL 的具体功能
最好的情况消耗的资源,最差情况下消耗的资源,优化的结果只有一个给用户一个好的体验</p>
</li>
<li>
<p>从 explain 执行计划入手</p>
<p>只有 explain 能告诉你当前 SQL 的执行状态</p>
</li>
<li>
<p>永远用小的结果集驱动大的结果集</p>
<p>晓得数据集驱动大的数据集,减少内层表读取的次数
类似于嵌套循环</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="java"><code><div class="ec-line"><div class="code"><span style="--0:#FF79C6;--1:#BF3441">for</span><span style="--0:#F8F8F2;--1:#24292E">(</span><span style="--0:#8BE9FD;--0fs:italic;--1:#BF3441">int</span><span style="--0:#F8F8F2;--1:#24292E"> i </span><span style="--0:#FF79C6;--1:#BF3441">=</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#BD93F9;--1:#005CC5">0</span><span style="--0:#F8F8F2;--1:#24292E">;i </span><span style="--0:#FF79C6;--1:#BF3441">&lt;</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#BD93F9;--1:#005CC5">5</span><span style="--0:#F8F8F2;--1:#24292E">;i</span><span style="--0:#FF79C6;--1:#BF3441">++</span><span style="--0:#F8F8F2;--1:#24292E">) {</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#FF79C6;--1:#BF3441">for</span><span style="--0:#F8F8F2;--1:#24292E">(</span><span style="--0:#8BE9FD;--0fs:italic;--1:#BF3441">int</span><span style="--0:#F8F8F2;--1:#24292E"> j </span><span style="--0:#FF79C6;--1:#BF3441">=</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#BD93F9;--1:#005CC5">0</span><span style="--0:#F8F8F2;--1:#24292E">;j </span><span style="--0:#FF79C6;--1:#BF3441">&lt;</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#BD93F9;--1:#005CC5">1000</span><span style="--0:#F8F8F2;--1:#24292E">;j</span><span style="--0:#FF79C6;--1:#BF3441">++</span><span style="--0:#F8F8F2;--1:#24292E">){</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#F8F8F2;--1:#24292E">  </span></span><span style="--0:#F8F8F2;--1:#24292E">}</span></div></div><div class="ec-line"><div class="code"><span style="--0:#F8F8F2;--1:#24292E">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="for(int i = 0;i < 5;i++) {  for(int j = 0;j < 1000;j++){  }}"><div></div></button></div></figure></div>
<p>如果小的循环在外层,对于数据库连接来说就只连接 5 次,进行 5000 次操作,如果 1000 在外,则需要进行 1000 次数据库连接,从而浪费资源,增加消耗,这就是为什么要小表驱动大表。</p>
</li>
<li>
<p>尽可能在索引中完成排序</p>
<p>排序操作用的比较多,order by 后面的字段如果在索引中,索引本来就是排好序的,所以速度很快,没有索引的话,就需要从表中拿数据,在内存中进行排序,如果内存空间不够还会发生落盘操作。</p>
</li>
<li>
<p>只获取自己需要的列</p>
<p>不要使用 select *,select * 很可能不走索引,而且数据量过大。</p>
</li>
<li>
<p>只使用最有效的过滤条件</p>
<p>误区,where 后面的条件越多越好,但实际上是应该用最短的路径访问到数据。</p>
</li>
<li>
<p>尽可能避免复杂的 join 和子查询</p>
<p>每条 SQL 的 join 操作,建议不要超过三张表。
将复杂的 SQL,拆分成多个小的 SQL,单个表执行,获取的结果,在程序中进行封装。
如果 join 占用的资源比较多,会导致其他进程等待时间变长。</p>
</li>
<li>
<p>合理设计并利用索引</p>
<p>如果判定是否需要创建索引?</p>
<ol>
<li>较为频繁的作为查询条件的字段应该创建索引。</li>
<li>唯一性太差的字段不适合单独创建索引,即使频繁作为查询条件。(唯一性太差的字段主要是指哪些呢?如状态字段、类型字段等等这些字段中的数据可能总共就是那么几个几十个数值重复使用)(当一条 query 所返回的数据超过了全表的 15%的时候,就不应该再使用索引扫描来完成这个 query 了)。</li>
<li>更新非常频繁的字段不适合创建索引。(因为索引中的字段被更新的时候,不仅仅需要更新表中的数据,同时还要更新索引数据,以确保所以信息是正确的)。</li>
<li>不会出现在 where 子句中的字段不该创建索引。
如果选择合适索引?</li>
<li>对于单键索引,尽量选择针对当前 query 过滤性更好的索引。</li>
<li>选择联合索引时,当前 query 中过滤性最好的字段在索引字段顺序中排列要靠前。</li>
<li>选择联合索引时,尽量索引字段出现在 where 中比较多的索引。</li>
</ol>
</li>
</ol>
</li>
</ol>
<h3 id="hash索引有哪些优缺点">Hash索引有哪些优缺点</h3>
<p>MySQL 中索引的常用数据结构有两种: 一种是 B+Tree,另一种是 Hash。</p>
<p>Hash 底层实现是由 Hash 表来实现的,是根据键值 <code>&lt;key, value&gt;</code> 存储数据的结构。非常适合根据 key 查找 value 值,也就是单个 key 查询,或者说等值查询。</p>
<img src="https://cdn.jsdelivr.net/gh/chou401/pic-md@main/img/image-20230921175115312.png" alt="image-20230921175115312"/>
<p>对于每一行数据,存储引擎都会对所有的索引列计算一个哈希码,哈希码是一个较小的值,如果出现哈希码值相同的情况会拉出一条链表。</p>
<p>Hash 索引的优点</p>
<ul>
<li>因为索引自身只需要存储对应的 Hash 值,所以索引结构非常紧凑,只需要做等值比较查询,而不包含排序或范围查询的需求,都适合使用哈希索引。</li>
<li>没有哈希冲突的情况下,等值查询访问哈希索引的数据比较快。(如果发生 Hash 冲突,存储引擎必须遍历链表中的所有行指针,逐行进行比较,直到找到所有符合条件的行)。</li>
</ul>
<p>Hash 索引的缺点</p>
<ul>
<li>哈希索引只包含哈希值和行指针,而不存储字段值,所以不能使用索引中的值来避免读取行。</li>
<li>哈希索引只支持等值比较查询,不支持任何范围查询和部分索引列匹配查找。</li>
<li>哈希索引数据并不是按照索引值顺序存储的,所以也就无法用于排序。</li>
</ul>
<h3 id="innodb内存相关的参数优化">InnoDB内存相关的参数优化</h3>
<p>BufferPool 参数优化</p>
<ol>
<li>
<p>缓冲池内存大小配置</p>
<p>一个大的日志缓冲区允许大量的事务在提交之前不写日志到磁盘。因此,如果你有很多事务的更新,插入或删除操作,通过设置这个参数会大量的减少磁盘 IO 的次数。</p>
<p>建议: 在专用数据库服务器上,可以将缓冲池大小设置为服务器物理内存的 60%-80%。</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="sql"><code><div class="ec-line"><div class="code"><span style="--0:#F8F8F2;--1:#24292E"># 查看 BufferPool 缓冲池大小</span></div></div><div class="ec-line"><div class="code"><span style="--0:#F8F8F2;--1:#24292E">show variables </span><span style="--0:#FF79C6;--1:#BF3441">like</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--1:#032F62"><span style="--0:#E9F284">&#39;</span><span style="--0:#F1FA8C">%innodb_buffer_pool_size%</span><span style="--0:#E9F284">&#39;</span></span><span style="--0:#F8F8F2;--1:#24292E">;</span></div></div><div class="ec-line"><div class="code"><span style="--0:#F8F8F2;--1:#24292E"># 调整 BufferPool 缓冲池大小</span></div></div><div class="ec-line"><div class="code"><span style="--0:#FF79C6;--1:#BF3441">set</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">global</span><span style="--0:#F8F8F2;--1:#24292E"> innodb_buffer_pool_size </span><span style="--0:#FF79C6;--1:#BF3441">=</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#BD93F9;--1:#005CC5">268435456</span><span style="--0:#F8F8F2;--1:#24292E">; </span><span style="--0:#96A1C2;--1:#616972">-- 512M</span></div></div><div class="ec-line"><div class="code"><span style="--0:#F8F8F2;--1:#24292E"># 监控在线调整缓冲池的进度</span></div></div><div class="ec-line"><div class="code"><span style="--0:#F8F8F2;--1:#24292E">show </span><span style="--0:#FF79C6;--1:#BF3441">status</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">where</span><span style="--0:#F8F8F2;--1:#24292E"> variable_name </span><span style="--0:#FF79C6;--1:#BF3441">=</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--1:#032F62"><span style="--0:#E9F284">&#39;</span><span style="--0:#F1FA8C">innodb_buffer_pool_resize_status</span><span style="--0:#E9F284">&#39;</span></span><span style="--0:#F8F8F2;--1:#24292E">;</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="# 查看 BufferPool 缓冲池大小show variables like '%innodb_buffer_pool_size%';# 调整 BufferPool 缓冲池大小set global innodb_buffer_pool_size = 268435456; -- 512M# 监控在线调整缓冲池的进度show status where variable_name = 'innodb_buffer_pool_resize_status';"><div></div></button></div></figure></div>
</li>
<li>
<p>InnoDB 缓存性能评估</p>
<p>当前配置的 innodb_pool_size 是否合适,可以通过分析 InnoDB 缓冲池的缓存命中率来验证。</p>
<ul>
<li>
<p>以下公式计算 InnoDB BufferPool 命中率:</p>
<blockquote>
<p>命中率 = innodb_buffer_pool_read_requests / (innodb_buffer_pool_read_requests + innodb_buffer_pool_reads) * 100</p>
<p>参数 1: innodb_buffer_pool_reads: 表示 InnoDB 缓冲池无法满足的请求数,需要从磁盘中读取。</p>
<p>参数 2: innodb_buffer_pool_read_requests: 表示从内存中读取页的请求数。</p>
</blockquote>
<img src="https://cdn.jsdelivr.net/gh/chou401/pic-md@main/img/image-20230922112638300.png" alt="image-20230922112638300"/>
<p>命中率低于 90%,则可以考虑增加innodb_buffer_pool_size。</p>
</li>
</ul>
</li>
<li>
<p>Page 管理相关参数</p>
<p>查看 Page 页的大小(默认 16kb),innodb_page_size 只能在初始化 MySQL 实例之前配置,不能在之后修改。如果没有指定值,则使用默认页面大小初始化实例。</p>
<img src="https://cdn.jsdelivr.net/gh/chou401/pic-md@main/img/image-20230922113121486.png" alt="image-20230922113121486"/>
<p>Page 页管理状态相关参数</p>
<img src="https://cdn.jsdelivr.net/gh/chou401/pic-md@main/img/image-20230922113235811.png" alt="image-20230922113235811"/>
<ul>
<li><strong>Innodb_buffer_pool_pages_data</strong>: InnoDB缓冲池中包含数据的页数。 该数字包括脏页面和干净页面。 使用压缩表时,报告的Innodb_buffer_pool_pages_data值可能大于Innodb_buffer_pool_pages_total。</li>
<li><strong>Innodb_buffer_pool_pages_dirty</strong>: 显示在内存中修改但尚未写入数据文件的InnoDB缓冲池数据页的数量(脏页刷新)。</li>
<li><strong>Innodb_buffer_pool_pages_flushed</strong>: 表示从InnoDB缓冲池中刷新脏页的请求数。</li>
<li><strong>Innodb_buffer_pool_pages_free</strong>: 显示InnoDB缓冲池中的空闲页面。</li>
<li><strong>Innodb_buffer_pool_pages_misc</strong>: InnoDB缓冲池中的页面数量很多,因为它们已被分配用于管理开销,例如行锁或自适应哈希索引。此值也可以计算为Innodb_buffer_pool_pages_total - Innodb_buffer_pool_pages_free - Innodb_buffer_pool_pages_data。</li>
<li><strong>Innodb_buffer_pool_pages_total</strong>: InnoDB缓冲池的总大小,以page为单位。</li>
</ul>
</li>
</ol>
<h3 id="innodb日志相关的参数优化">InnoDB日志相关的参数优化</h3>
<ol>
<li>
<p>日志缓冲区相关参数配置</p>
<p>日志缓冲区的大小。一般默认值 16mb 是够用的,但如果事务之中含有 blog/text 等大字段,这个缓冲区会被很快填满会引起额外的 IO 负载。配置更大的日志缓冲区,可以有效的提高 MySQL 的效率。</p>
<ul>
<li>
<p><strong>Innodb_log_buffer_size 缓冲区大小</strong></p>
<img src="https://cdn.jsdelivr.net/gh/chou401/pic-md@main/img/image-20230922114800080.png" alt="image-20230922114800080"/>
</li>
<li>
<p><strong>innodb_log_files_in_group 日志组文件个数</strong></p>
<p>日志组根据需要来创建。而日志组的成员则需要至少 2 个,实现循环写入并作为冗余策略。</p>
<img src="https://cdn.jsdelivr.net/gh/chou401/pic-md@main/img/image-20230922114934551.png" alt="image-20230922114934551"/>
</li>
<li>
<p><strong>Innodb_log_file_size 日志文件大小</strong></p>
<p>参数 Innodb_log_file_size 用于设定 MySQL 日志组中每个日志文件的大小(默认 48mb)。此参数是一个全局的静态参数,不能动态修改。</p>
<p>参数 Innodb_log_file_size 的最大值,二进制日志文件大小(innodb_log_file_size * innodb_log_files_in_group)不能超过 512gb,所以单个日志文件的大小不能超过 256gb。</p>
<img src="https://cdn.jsdelivr.net/gh/chou401/pic-md@main/img/image-20230922115422562.png" alt="image-20230922115422562"/>
</li>
</ul>
</li>
<li>
<p>日志文件参数优化</p>
<p>首先我们先来看一下日志文件大小设置对性能的影响</p>
<ul>
<li>
<p>设置过小</p>
<ol>
<li>参数 innodb_log_file_size 设置太小,就会导致 MySQL 的日志文件(redo log)频繁切换,频繁的触发数据库的检查点(checkpoint),导致刷新脏页到磁盘的次数增加。从而影响 IO 性能。</li>
<li>处理大事务时,将所有的日志文件写满了,事务内容还没有写完,这样就会导致日志不能切换。</li>
</ol>
</li>
<li>
<p>设置过大</p>
<p>参数 innodb_log_file_size 如果设置过大,虽然可以提升 IO 性能,但是当 MySQL 由于意外宕机时,二进制日志很大,那么恢复的时间必然很长。而且这个恢复时间往往不可控,受多方面因素影响。</p>
</li>
</ul>
</li>
</ol>
<h4 id="优化建议">优化建议</h4>
<p>如何设置合适的日志文件大小?</p>
<ul>
<li>根据实际生产场景的优化经验,一般是计算一段时间内生成的事务日志(redo log)的大小,而 MySQL 的日志文件大小最少应该承载一个小时的业务日志量(官网文档中有说明)。</li>
</ul>
<p>想要估计一下 InnoDB redo log 的大小,需要抓取一段时间内 Log SequenceNumber(日志顺序号)的数据,来计算一小时内产生的日志大小。</p>
<blockquote>
<p>Log SequenceNumber</p>
<p>自系统修改开始,就不断的生成 redo 日志,为了记录一共生成了多少日志,于是 MySQL 设计了全局变量 Log SequenceNumber,简称 lsn,但不是从 0 开始,是从 8704 字节开始。</p>
</blockquote>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="sql"><code><div class="ec-line"><div class="code"><span style="--0:#F8F8F2;--1:#24292E"># pager 分页工具,只获取 </span><span style="--0:#FF79C6;--1:#BF3441">sequence</span><span style="--0:#F8F8F2;--1:#24292E"> 的信息</span></div></div><div class="ec-line"><div class="code"><span style="--0:#F8F8F2;--1:#24292E">mysql</span><span style="--0:#FF79C6;--1:#BF3441">&gt;</span><span style="--0:#F8F8F2;--1:#24292E"> pager grep </span><span style="--0:#FF79C6;--1:#BF3441">sequence</span><span style="--0:#F8F8F2;--1:#24292E">;</span></div></div><div class="ec-line"><div class="code"><span style="--0:#F8F8F2;--1:#24292E">PAGER </span><span style="--0:#FF79C6;--1:#BF3441">set</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">to</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--1:#032F62"><span style="--0:#E9F284">&#39;</span><span style="--0:#F1FA8C">grep sequence</span><span style="--0:#E9F284">&#39;</span></span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#F8F8F2;--1:#24292E"># 查询状态,并倒计时一分钟</span></div></div><div class="ec-line"><div class="code"><span style="--0:#F8F8F2;--1:#24292E">mysql</span><span style="--0:#FF79C6;--1:#BF3441">&gt;</span><span style="--0:#F8F8F2;--1:#24292E"> show engine innodb </span><span style="--0:#FF79C6;--1:#BF3441">status</span><span style="--0:#F8F8F2;--1:#24292E">\G </span><span style="--0:#FF79C6;--1:#BF3441">select</span><span style="--0:#F8F8F2;--1:#24292E"> sleep(</span><span style="--0:#BD93F9;--1:#005CC5">60</span><span style="--0:#F8F8F2;--1:#24292E">);</span></div></div><div class="ec-line"><div class="code"><span style="--0:#FF79C6;--1:#BF3441">Log</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">sequence</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">number</span><span style="--0:#F8F8F2;--1:#24292E">          </span><span style="--0:#BD93F9;--1:#005CC5">21799672</span></div></div><div class="ec-line"><div class="code"><span style="--0:#BD93F9;--1:#005CC5">1</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">row</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">in</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">set</span><span style="--0:#F8F8F2;--1:#24292E"> (</span><span style="--0:#BD93F9;--1:#005CC5">0</span><span style="--0:#F8F8F2;--1:#24292E">.</span><span style="--0:#BD93F9;--1:#005CC5">00</span><span style="--0:#F8F8F2;--1:#24292E"> sec)</span></div></div><div class="ec-line"><div class="code"><span style="--0:#BD93F9;--1:#005CC5">1</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">row</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">in</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">set</span><span style="--0:#F8F8F2;--1:#24292E"> (</span><span style="--0:#BD93F9;--1:#005CC5">1</span><span style="--0:#F8F8F2;--1:#24292E"> min </span><span style="--0:#BD93F9;--1:#005CC5">0</span><span style="--0:#F8F8F2;--1:#24292E">.</span><span style="--0:#BD93F9;--1:#005CC5">00</span><span style="--0:#F8F8F2;--1:#24292E"> sec)</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#F8F8F2;--1:#24292E"># 一分时间内所生成的数据量 (此处)</span></div></div><div class="ec-line"><div class="code"><span style="--0:#F8F8F2;--1:#24292E">mysql</span><span style="--0:#FF79C6;--1:#BF3441">&gt;</span><span style="--0:#F8F8F2;--1:#24292E"> show engine innodb </span><span style="--0:#FF79C6;--1:#BF3441">status</span><span style="--0:#F8F8F2;--1:#24292E">;</span></div></div><div class="ec-line"><div class="code"><span style="--0:#FF79C6;--1:#BF3441">Log</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">sequence</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">number</span><span style="--0:#F8F8F2;--1:#24292E">          </span><span style="--0:#BD93F9;--1:#005CC5">21803964</span></div></div><div class="ec-line"><div class="code"><span style="--0:#BD93F9;--1:#005CC5">1</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">row</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">in</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">set</span><span style="--0:#F8F8F2;--1:#24292E"> (</span><span style="--0:#BD93F9;--1:#005CC5">0</span><span style="--0:#F8F8F2;--1:#24292E">.</span><span style="--0:#BD93F9;--1:#005CC5">00</span><span style="--0:#F8F8F2;--1:#24292E"> sec)</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#F8F8F2;--1:#24292E"># 关闭 pager</span></div></div><div class="ec-line"><div class="code"><span style="--0:#F8F8F2;--1:#24292E">mysql</span><span style="--0:#FF79C6;--1:#BF3441">&gt;</span><span style="--0:#F8F8F2;--1:#24292E"> nopager</span></div></div><div class="ec-line"><div class="code"><span style="--0:#F8F8F2;--1:#24292E">PAGER </span><span style="--0:#FF79C6;--1:#BF3441">set</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">to</span><span style="--0:#F8F8F2;--1:#24292E"> stdout</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="# pager 分页工具,只获取 sequence 的信息mysql> pager grep sequence;PAGER set to 'grep sequence'# 查询状态,并倒计时一分钟mysql> show engine innodb status\G select sleep(60);Log sequence number          217996721 row in set (0.00 sec)1 row in set (1 min 0.00 sec)# 一分时间内所生成的数据量 (此处)mysql> show engine innodb status;Log sequence number          218039641 row in set (0.00 sec)# 关闭 pagermysql> nopagerPAGER set to stdout"><div></div></button></div></figure></div>
<p>有了一分钟的日志量,据此推算一小时内的日志量</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="sql"><code><div class="ec-line"><div class="code"><span style="--0:#F8F8F2;--1:#24292E">mysql</span><span style="--0:#FF79C6;--1:#BF3441">&gt;</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">select</span><span style="--0:#F8F8F2;--1:#24292E"> (</span><span style="--0:#BD93F9;--1:#005CC5">21803964</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">-</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#BD93F9;--1:#005CC5">21799672</span><span style="--0:#F8F8F2;--1:#24292E">) </span><span style="--0:#FF79C6;--1:#BF3441">/</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#BD93F9;--1:#005CC5">1024</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">as</span><span style="--0:#F8F8F2;--1:#24292E"> kb_per_min;</span></div></div><div class="ec-line"><div class="code"><span style="--0:#FF79C6;--1:#BF3441">+</span><span style="--0:#96A1C2;--1:#616972">------------+</span></div></div><div class="ec-line"><div class="code"><span style="--0:#F8F8F2;--1:#24292E">| kb_per_min |</span></div></div><div class="ec-line"><div class="code"><span style="--0:#FF79C6;--1:#BF3441">+</span><span style="--0:#96A1C2;--1:#616972">------------+</span></div></div><div class="ec-line"><div class="code"><span style="--0:#F8F8F2;--1:#24292E">|     </span><span style="--0:#BD93F9;--1:#005CC5">4</span><span style="--0:#F8F8F2;--1:#24292E">.</span><span style="--0:#BD93F9;--1:#005CC5">1914</span><span style="--0:#F8F8F2;--1:#24292E"> |</span></div></div><div class="ec-line"><div class="code"><span style="--0:#FF79C6;--1:#BF3441">+</span><span style="--0:#96A1C2;--1:#616972">------------+</span></div></div><div class="ec-line"><div class="code"><span style="--0:#BD93F9;--1:#005CC5">1</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">row</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">in</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">set</span><span style="--0:#F8F8F2;--1:#24292E"> (</span><span style="--0:#BD93F9;--1:#005CC5">0</span><span style="--0:#F8F8F2;--1:#24292E">.</span><span style="--0:#BD93F9;--1:#005CC5">00</span><span style="--0:#F8F8F2;--1:#24292E"> sec)</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#F8F8F2;--1:#24292E">mysql</span><span style="--0:#FF79C6;--1:#BF3441">&gt;</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">select</span><span style="--0:#F8F8F2;--1:#24292E"> (</span><span style="--0:#BD93F9;--1:#005CC5">21803964</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">-</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#BD93F9;--1:#005CC5">21799672</span><span style="--0:#F8F8F2;--1:#24292E">) </span><span style="--0:#FF79C6;--1:#BF3441">/</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#BD93F9;--1:#005CC5">1024</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">*</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#BD93F9;--1:#005CC5">60</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">as</span><span style="--0:#F8F8F2;--1:#24292E"> kb_per_min;</span></div></div><div class="ec-line"><div class="code"><span style="--0:#FF79C6;--1:#BF3441">+</span><span style="--0:#96A1C2;--1:#616972">------------+</span></div></div><div class="ec-line"><div class="code"><span style="--0:#F8F8F2;--1:#24292E">| kb_per_min |</span></div></div><div class="ec-line"><div class="code"><span style="--0:#FF79C6;--1:#BF3441">+</span><span style="--0:#96A1C2;--1:#616972">------------+</span></div></div><div class="ec-line"><div class="code"><span style="--0:#F8F8F2;--1:#24292E">|   </span><span style="--0:#BD93F9;--1:#005CC5">251</span><span style="--0:#F8F8F2;--1:#24292E">.</span><span style="--0:#BD93F9;--1:#005CC5">4844</span><span style="--0:#F8F8F2;--1:#24292E"> |</span></div></div><div class="ec-line"><div class="code"><span style="--0:#FF79C6;--1:#BF3441">+</span><span style="--0:#96A1C2;--1:#616972">------------+</span></div></div><div class="ec-line"><div class="code"><span style="--0:#BD93F9;--1:#005CC5">1</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">row</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">in</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">set</span><span style="--0:#F8F8F2;--1:#24292E"> (</span><span style="--0:#BD93F9;--1:#005CC5">0</span><span style="--0:#F8F8F2;--1:#24292E">.</span><span style="--0:#BD93F9;--1:#005CC5">00</span><span style="--0:#F8F8F2;--1:#24292E"> sec)</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="mysql> select (21803964 - 21799672) / 1024 as kb_per_min;+------------+| kb_per_min |+------------+|     4.1914 |+------------+1 row in set (0.00 sec)mysql> select (21803964 - 21799672) / 1024 * 60 as kb_per_min;+------------+| kb_per_min |+------------+|   251.4844 |+------------+1 row in set (0.00 sec)"><div></div></button></div></figure></div>
<p>太大的缓冲池或不正常的业务负载可能会计算出非常大(或非常小)的日志大小。这也是公式不足之处,需要根据判断和经验。但这个计算方法是一个很好的参考标准。</p>
<h3 id="innodb-io线程相关参数优化">InnoDB IO线程相关参数优化</h3>
<p>数据库属于 IO 密集型的应用程序,其主要职责就是数据的管理及存储工作。从内存中读取一个数据库数据的时间是微秒级别,而从一块普通硬盘上读取一个 IO 是在毫秒级别。要优化数据库,IO 操作时必须要优化的,尽可能将磁盘 IO 转化为内存 IO。</p>
<h4 id="参数-query_cache_size--have_auery_cache">参数: query_cache_size &amp; have_auery_cache</h4>
<p>MySQL 查询缓存会保存查询返回的完整结果。当查询命中该缓存,会 like 返回结果,跳过了解析,优化和执行阶段。</p>
<p>查询缓存会跟踪查询中涉及的每个表,如果这些表发生变化,那么和这个表相关的所有缓存都将失效。</p>
<h4 id="查看查询缓存是否开启">查看查询缓存是否开启</h4>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="sql"><code><div class="ec-line"><div class="code"><span style="--0:#F8F8F2;--1:#24292E"># 查询是否支持查询缓存</span></div></div><div class="ec-line"><div class="code"><span style="--0:#F8F8F2;--1:#24292E">mysql</span><span style="--0:#FF79C6;--1:#BF3441">&gt;</span><span style="--0:#F8F8F2;--1:#24292E"> show variables </span><span style="--0:#FF79C6;--1:#BF3441">like</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--1:#032F62"><span style="--0:#E9F284">&#39;</span><span style="--0:#F1FA8C">have_query_cache</span><span style="--0:#E9F284">&#39;</span></span><span style="--0:#F8F8F2;--1:#24292E">;</span></div></div><div class="ec-line"><div class="code"><span style="--0:#FF79C6;--1:#BF3441">+</span><span style="--0:#96A1C2;--1:#616972">------------------+-------+</span></div></div><div class="ec-line"><div class="code"><span style="--0:#F8F8F2;--1:#24292E">| Variable_name    | </span><span style="--0:#FF79C6;--1:#BF3441">Value</span><span style="--0:#F8F8F2;--1:#24292E"> |</span></div></div><div class="ec-line"><div class="code"><span style="--0:#FF79C6;--1:#BF3441">+</span><span style="--0:#96A1C2;--1:#616972">------------------+-------+</span></div></div><div class="ec-line"><div class="code"><span style="--0:#F8F8F2;--1:#24292E">| have_query_cache | </span><span style="--0:#FF79C6;--1:#BF3441">NO</span><span style="--0:#F8F8F2;--1:#24292E">    |</span></div></div><div class="ec-line"><div class="code"><span style="--0:#FF79C6;--1:#BF3441">+</span><span style="--0:#96A1C2;--1:#616972">------------------+-------+</span></div></div><div class="ec-line"><div class="code"><span style="--0:#BD93F9;--1:#005CC5">1</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">row</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">in</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">set</span><span style="--0:#F8F8F2;--1:#24292E"> (</span><span style="--0:#BD93F9;--1:#005CC5">0</span><span style="--0:#F8F8F2;--1:#24292E">.</span><span style="--0:#BD93F9;--1:#005CC5">01</span><span style="--0:#F8F8F2;--1:#24292E"> sec)</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#F8F8F2;--1:#24292E"># 查询是否开启查询缓存 默认是关闭的</span></div></div><div class="ec-line"><div class="code"><span style="--0:#F8F8F2;--1:#24292E">mysql</span><span style="--0:#FF79C6;--1:#BF3441">&gt;</span><span style="--0:#F8F8F2;--1:#24292E"> show variables </span><span style="--0:#FF79C6;--1:#BF3441">like</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--1:#032F62"><span style="--0:#E9F284">&#39;</span><span style="--0:#F1FA8C">%query_cache_type%</span><span style="--0:#E9F284">&#39;</span></span><span style="--0:#F8F8F2;--1:#24292E">;</span></div></div><div class="ec-line"><div class="code"><span style="--0:#FF79C6;--1:#BF3441">Empty</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">set</span><span style="--0:#F8F8F2;--1:#24292E"> (</span><span style="--0:#BD93F9;--1:#005CC5">0</span><span style="--0:#F8F8F2;--1:#24292E">.</span><span style="--0:#BD93F9;--1:#005CC5">01</span><span style="--0:#F8F8F2;--1:#24292E"> sec)</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="# 查询是否支持查询缓存mysql> show variables like 'have_query_cache';+------------------+-------+| Variable_name    | Value |+------------------+-------+| have_query_cache | NO    |+------------------+-------+1 row in set (0.01 sec)# 查询是否开启查询缓存 默认是关闭的mysql> show variables like '%query_cache_type%';Empty set (0.01 sec)"><div></div></button></div></figure></div>
<h4 id="开启缓存在-myini-中添加下面一行参数">开启缓存,在 my.ini 中添加下面一行参数</h4>
<blockquote>
<p>query_cache_size=128M</p>
<p>query_cache_type=1</p>
<p>query_cache_type:</p>
<p>设置为0,OFF,缓存禁用</p>
<p>设置为 1,ON,缓存所有结果</p>
<p>设置为 2,DENAND,只缓存在 select 语句中通过 sql_cache 指定需要缓存的查询</p>
</blockquote>
<h4 id="测试能否缓存查询">测试能否缓存查询</h4>
<blockquote>
<p>mysql&gt; show status like ‘%Qcache%‘;</p>
</blockquote>
<ul>
<li>Qcahce_free_blocks: 缓存中目前剩余的 blocks 数量(如果值较大,则查询缓存中的内存碎片过多)</li>
<li>Qcache_free_memory: 空闲缓存的内存大小</li>
<li>Qcache_hist: 命中缓存次数</li>
<li>Qcache_inserts: 未命中然后进行正常查询</li>
<li>Qcache_lowmem_prunes: 查询因为内存不足而被移除出查询缓存记录</li>
<li>Qcache_not_cached: 没有被缓存的查询数量</li>
<li>Qcache_queries_in_cahce: 当前缓存中缓存的查询数量</li>
<li>Qcache_total_blocks: 当前缓存的 block 数量</li>
</ul>
<p>**优化建议: ** Query Cache 的使用需要多个参数配合,其中最为关键的是 query_cache_size 和 query_cache_type,前者设置用于缓存 ResultSet 的内存大小,后者设置在哪种场景下使用 Query Cache。</p>
<p>MySQL 数据库数据变化相对不多,query_cache_size 一般设置为 256MB 比较合适,也可以通过计算 Query Cache 的命中率来进行调整。</p>
<blockquote>
<p>( Qcache_hist / (Qcache_hist + Qcache_inserts) * 100 )</p>
</blockquote>
<h4 id="参数-innodb_max_dirty_pages_pct">参数: innodb_max_dirty_pages_pct</h4>
<p>该参数是 InnoDB 存储引擎用来控制 Buffer pool 中脏页的百分比,当脏页数量占比超过这个参数设置的值时,InnoDB 会启动刷脏页的操作。</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="sql"><code><div class="ec-line"><div class="code"><span style="--0:#96A1C2;--1:#616972">-- innodb_max_dirty_pages_pct 参数可以动态调整,最小值为 0,最大值为 99.99</span></div></div><div class="ec-line"><div class="code"><span style="--0:#F8F8F2;--1:#24292E">mysql</span><span style="--0:#FF79C6;--1:#BF3441">&gt;</span><span style="--0:#F8F8F2;--1:#24292E"> show variables </span><span style="--0:#FF79C6;--1:#BF3441">like</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--1:#032F62"><span style="--0:#E9F284">&#39;</span><span style="--0:#F1FA8C">innodb_max_dirty_pages_pct</span><span style="--0:#E9F284">&#39;</span></span><span style="--0:#F8F8F2;--1:#24292E">;</span></div></div><div class="ec-line"><div class="code"><span style="--0:#FF79C6;--1:#BF3441">+</span><span style="--0:#96A1C2;--1:#616972">----------------------------+-----------+</span></div></div><div class="ec-line"><div class="code"><span style="--0:#F8F8F2;--1:#24292E">| Variable_name              | </span><span style="--0:#FF79C6;--1:#BF3441">Value</span><span style="--0:#F8F8F2;--1:#24292E">     |</span></div></div><div class="ec-line"><div class="code"><span style="--0:#FF79C6;--1:#BF3441">+</span><span style="--0:#96A1C2;--1:#616972">----------------------------+-----------+</span></div></div><div class="ec-line"><div class="code"><span style="--0:#F8F8F2;--1:#24292E">| innodb_max_dirty_pages_pct | </span><span style="--0:#BD93F9;--1:#005CC5">90</span><span style="--0:#F8F8F2;--1:#24292E">.</span><span style="--0:#BD93F9;--1:#005CC5">000000</span><span style="--0:#F8F8F2;--1:#24292E"> |</span></div></div><div class="ec-line"><div class="code"><span style="--0:#FF79C6;--1:#BF3441">+</span><span style="--0:#96A1C2;--1:#616972">----------------------------+-----------+</span></div></div><div class="ec-line"><div class="code"><span style="--0:#BD93F9;--1:#005CC5">1</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">row</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">in</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">set</span><span style="--0:#F8F8F2;--1:#24292E"> (</span><span style="--0:#BD93F9;--1:#005CC5">0</span><span style="--0:#F8F8F2;--1:#24292E">.</span><span style="--0:#BD93F9;--1:#005CC5">01</span><span style="--0:#F8F8F2;--1:#24292E"> sec)</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="-- innodb_max_dirty_pages_pct 参数可以动态调整,最小值为 0,最大值为 99.99mysql> show variables like 'innodb_max_dirty_pages_pct';+----------------------------+-----------+| Variable_name              | Value     |+----------------------------+-----------+| innodb_max_dirty_pages_pct | 90.000000 |+----------------------------+-----------+1 row in set (0.01 sec)"><div></div></button></div></figure></div>
<p>**优化建议: **该参数比例值越大,从内存到磁盘的写入操作就会相对减少,所以能够一定程度减少写入操作的磁盘 IO。但是,如果这个比例值过大,当数据库 crash 之后重启的时间可能就会很长,因为会有大量的事务数据需要从日志文件恢复出来写入数据文件中,最大不建议超过 90,一般重启恢复的数据在超过 1GB 的话,启动速度就会变慢。</p>
<h4 id="参数-innodb_old_blocks_pct--innodb_old_blocks_time">参数: innodb_old_blocks_pct &amp; innodb_old_blocks_time</h4>
<p><code>innodb_old_blocks_pct</code> 用来确定 LRU 链表中 old sublist 所占比例,默认占用 37%。</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="sql"><code><div class="ec-line"><div class="code"><span style="--0:#F8F8F2;--1:#24292E">mysql</span><span style="--0:#FF79C6;--1:#BF3441">&gt;</span><span style="--0:#F8F8F2;--1:#24292E"> show variables </span><span style="--0:#FF79C6;--1:#BF3441">like</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--1:#032F62"><span style="--0:#E9F284">&#39;</span><span style="--0:#F1FA8C">%innodb_old_blocks_pct%</span><span style="--0:#E9F284">&#39;</span></span><span style="--0:#F8F8F2;--1:#24292E">;</span></div></div><div class="ec-line"><div class="code"><span style="--0:#FF79C6;--1:#BF3441">+</span><span style="--0:#96A1C2;--1:#616972">-----------------------+-------+</span></div></div><div class="ec-line"><div class="code"><span style="--0:#F8F8F2;--1:#24292E">| Variable_name         | </span><span style="--0:#FF79C6;--1:#BF3441">Value</span><span style="--0:#F8F8F2;--1:#24292E"> |</span></div></div><div class="ec-line"><div class="code"><span style="--0:#FF79C6;--1:#BF3441">+</span><span style="--0:#96A1C2;--1:#616972">-----------------------+-------+</span></div></div><div class="ec-line"><div class="code"><span style="--0:#F8F8F2;--1:#24292E">| innodb_old_blocks_pct | </span><span style="--0:#BD93F9;--1:#005CC5">37</span><span style="--0:#F8F8F2;--1:#24292E">    |</span></div></div><div class="ec-line"><div class="code"><span style="--0:#FF79C6;--1:#BF3441">+</span><span style="--0:#96A1C2;--1:#616972">-----------------------+-------+</span></div></div><div class="ec-line"><div class="code"><span style="--0:#BD93F9;--1:#005CC5">1</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">row</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">in</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">set</span><span style="--0:#F8F8F2;--1:#24292E"> (</span><span style="--0:#BD93F9;--1:#005CC5">0</span><span style="--0:#F8F8F2;--1:#24292E">.</span><span style="--0:#BD93F9;--1:#005CC5">01</span><span style="--0:#F8F8F2;--1:#24292E"> sec)</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="mysql> show variables like '%innodb_old_blocks_pct%';+-----------------------+-------+| Variable_name         | Value |+-----------------------+-------+| innodb_old_blocks_pct | 37    |+-----------------------+-------+1 row in set (0.01 sec)"><div></div></button></div></figure></div>
<p><code>innodb_old_blocks_time</code> 用来控制 old sublist 中 page 的转移策略,新的 page 页在进入 LRU 链表中时,会先插入到 old sublist 的头部,然后 page 需要在 old sublist 中停留 innodb_old_blocks_time 这么久后,下一次对该 page 的访问才会使其移动到 new sublist 的头部,默认值1 秒。</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="sql"><code><div class="ec-line"><div class="code"><span style="--0:#F8F8F2;--1:#24292E">mysql</span><span style="--0:#FF79C6;--1:#BF3441">&gt;</span><span style="--0:#F8F8F2;--1:#24292E"> show variables </span><span style="--0:#FF79C6;--1:#BF3441">like</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--1:#032F62"><span style="--0:#E9F284">&#39;</span><span style="--0:#F1FA8C">%innodb_old_blocks_time%</span><span style="--0:#E9F284">&#39;</span></span><span style="--0:#F8F8F2;--1:#24292E">;</span></div></div><div class="ec-line"><div class="code"><span style="--0:#FF79C6;--1:#BF3441">+</span><span style="--0:#96A1C2;--1:#616972">------------------------+-------+</span></div></div><div class="ec-line"><div class="code"><span style="--0:#F8F8F2;--1:#24292E">| Variable_name          | </span><span style="--0:#FF79C6;--1:#BF3441">Value</span><span style="--0:#F8F8F2;--1:#24292E"> |</span></div></div><div class="ec-line"><div class="code"><span style="--0:#FF79C6;--1:#BF3441">+</span><span style="--0:#96A1C2;--1:#616972">------------------------+-------+</span></div></div><div class="ec-line"><div class="code"><span style="--0:#F8F8F2;--1:#24292E">| innodb_old_blocks_time | </span><span style="--0:#BD93F9;--1:#005CC5">1000</span><span style="--0:#F8F8F2;--1:#24292E">  |</span></div></div><div class="ec-line"><div class="code"><span style="--0:#FF79C6;--1:#BF3441">+</span><span style="--0:#96A1C2;--1:#616972">------------------------+-------+</span></div></div><div class="ec-line"><div class="code"><span style="--0:#BD93F9;--1:#005CC5">1</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">row</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">in</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">set</span><span style="--0:#F8F8F2;--1:#24292E"> (</span><span style="--0:#BD93F9;--1:#005CC5">0</span><span style="--0:#F8F8F2;--1:#24292E">.</span><span style="--0:#BD93F9;--1:#005CC5">01</span><span style="--0:#F8F8F2;--1:#24292E"> sec)</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="mysql> show variables like '%innodb_old_blocks_time%';+------------------------+-------+| Variable_name          | Value |+------------------------+-------+| innodb_old_blocks_time | 1000  |+------------------------+-------+1 row in set (0.01 sec)"><div></div></button></div></figure></div>
<p>**优化建议: **在没有大表扫描的情况下,并且数据多为频繁使用的数据时,我们可以增加 innodb_old_blocks_pct 的值,并且减少 innodb_old_blocks_time 的值。让数据页能够更快和更多的进入热点数据区。</p>
<h3 id="什么是写失效">什么是写失效</h3>
<p>InnoDB 的页和操作系统的页大小不一致,InnoDB 页大小一般为 16K,操作系统页大小为 4K,InnoDB 的页写入到磁盘时,一个页需要分 4 次写。</p>
<p>如果存储引擎正在写入页的数据到磁盘时发生了宕机,可能出现页只写了一部分的情况,比如只写了 4K,就宕机了,这种情况叫做部分写失效,可能会导致数据丢失。</p>
<h4 id="双写缓冲区-doublewrite-buffer">双写缓冲区 Doublewrite Buffer</h4>
<p>为了解决写失效问题,InnoDB 实现了double write buffer Files,它位于系统表空间,是一个存储区域。</p>
<p>在 BufferPool 的 page 页刷新到磁盘真正的位置前,会先将数据存在 Doublewrite 缓冲区。这样在宕机重启时,如果出现页损坏,那么在应用 redo log 之前,需要通过该页的副本来还原该页,然后再进行 redo log 重做,double write 实现了 InnoDB 引擎数据页的可靠性。</p>
<p>默认情况下启用双写缓冲区,如果要禁用 Doublewrite 缓冲区,可以将<code>innodb_doublewrite</code>设置为 0.</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="sql"><code><div class="ec-line"><div class="code"><span style="--0:#F8F8F2;--1:#24292E">mysql</span><span style="--0:#FF79C6;--1:#BF3441">&gt;</span><span style="--0:#F8F8F2;--1:#24292E"> show variables </span><span style="--0:#FF79C6;--1:#BF3441">like</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--1:#032F62"><span style="--0:#E9F284">&#39;</span><span style="--0:#F1FA8C">%innodb_doublewrite%</span><span style="--0:#E9F284">&#39;</span></span><span style="--0:#F8F8F2;--1:#24292E">;</span></div></div><div class="ec-line"><div class="code"><span style="--0:#FF79C6;--1:#BF3441">+</span><span style="--0:#96A1C2;--1:#616972">-------------------------------+-------+</span></div></div><div class="ec-line"><div class="code"><span style="--0:#F8F8F2;--1:#24292E">| Variable_name                 | </span><span style="--0:#FF79C6;--1:#BF3441">Value</span><span style="--0:#F8F8F2;--1:#24292E"> |</span></div></div><div class="ec-line"><div class="code"><span style="--0:#FF79C6;--1:#BF3441">+</span><span style="--0:#96A1C2;--1:#616972">-------------------------------+-------+</span></div></div><div class="ec-line"><div class="code"><span style="--0:#F8F8F2;--1:#24292E">| innodb_doublewrite            | </span><span style="--0:#FF79C6;--1:#BF3441">ON</span><span style="--0:#F8F8F2;--1:#24292E">    |</span></div></div><div class="ec-line"><div class="code"><span style="--0:#F8F8F2;--1:#24292E">| innodb_doublewrite_batch_size | </span><span style="--0:#BD93F9;--1:#005CC5">0</span><span style="--0:#F8F8F2;--1:#24292E">     |</span></div></div><div class="ec-line"><div class="code"><span style="--0:#F8F8F2;--1:#24292E">| innodb_doublewrite_dir        |       |</span></div></div><div class="ec-line"><div class="code"><span style="--0:#F8F8F2;--1:#24292E">| innodb_doublewrite_files      | </span><span style="--0:#BD93F9;--1:#005CC5">2</span><span style="--0:#F8F8F2;--1:#24292E">     |</span></div></div><div class="ec-line"><div class="code"><span style="--0:#F8F8F2;--1:#24292E">| innodb_doublewrite_pages      | </span><span style="--0:#BD93F9;--1:#005CC5">4</span><span style="--0:#F8F8F2;--1:#24292E">     |</span></div></div><div class="ec-line"><div class="code"><span style="--0:#FF79C6;--1:#BF3441">+</span><span style="--0:#96A1C2;--1:#616972">-------------------------------+-------+</span></div></div><div class="ec-line"><div class="code"><span style="--0:#BD93F9;--1:#005CC5">5</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">rows</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">in</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">set</span><span style="--0:#F8F8F2;--1:#24292E"> (</span><span style="--0:#BD93F9;--1:#005CC5">0</span><span style="--0:#F8F8F2;--1:#24292E">.</span><span style="--0:#BD93F9;--1:#005CC5">01</span><span style="--0:#F8F8F2;--1:#24292E"> sec)</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="mysql> show variables like '%innodb_doublewrite%';+-------------------------------+-------+| Variable_name                 | Value |+-------------------------------+-------+| innodb_doublewrite            | ON    || innodb_doublewrite_batch_size | 0     || innodb_doublewrite_dir        |       || innodb_doublewrite_files      | 2     || innodb_doublewrite_pages      | 4     |+-------------------------------+-------+5 rows in set (0.01 sec)"><div></div></button></div></figure></div>
<img src="https://cdn.jsdelivr.net/gh/chou401/pic-md@main/img/image-20231017153855797.png" alt="image-20231017153855797"/>
<ul>
<li><strong>step1</strong>: 当进行缓冲池中的脏页淑新到磁盘的操作时,并不会直接写磁盘,每次脏页刷新必须要先写doublewrite。</li>
<li><strong>step2</strong>: 通过 memcpy 函数将脏页复制到内存中的 double write buffer。</li>
<li><strong>step3</strong>: double write buffer 再分两次、每次 1MB,顺序写入共享表空间的物理磁盘上,<strong>第一次写</strong>。</li>
<li><strong>step4</strong>: 在完成double write 页的写入后,再将 double write buffer 中的页写入各个表的<strong>独立表空间</strong>文件中(数据文件 .ibd),<strong>第二次写</strong>。</li>
</ul>
<h4 id="为什么写两次">为什么写两次</h4>
<p>共享表空间时在 ibd data 文件中划出 2M 连续的空间,专门给 double write 刷脏页用的,由于在这个过程中,<strong>double write 页的存储是连续的,因此写入磁盘为顺序写,性能很高</strong>;完成 double write 后,再将脏页写入实际的各个表空间文件,这时写入就是离散的了。</p>
<h3 id="什么是行溢出">什么是行溢出</h3>
<h4 id="行记录格式">行记录格式</h4>
<ol>
<li>
<p><strong>行格式分类</strong></p>
<p>表的行格式决定了它的行时如何物理存储的,这反过来又会影响查询和 DML 操作的性能。如果在单个 page 页中容纳更多行,查询和索引查找可以更快地工作,缓冲池中所需的内存更少,写入更新时所需的 IO 更少。</p>
<p>InnoDB 存储引擎支持四种行格式: Redundant、Compact、Dynamic 和 Compressed。</p>
<p>查询 MySQL 使用的行格式,默认为 Dynamic。</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="sql"><code><div class="ec-line"><div class="code"><span style="--0:#F8F8F2;--1:#24292E">mysql</span><span style="--0:#FF79C6;--1:#BF3441">&gt;</span><span style="--0:#F8F8F2;--1:#24292E"> show variables </span><span style="--0:#FF79C6;--1:#BF3441">like</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--1:#032F62"><span style="--0:#E9F284">&#39;</span><span style="--0:#F1FA8C">innodb_default_row_format</span><span style="--0:#E9F284">&#39;</span></span><span style="--0:#F8F8F2;--1:#24292E">;</span></div></div><div class="ec-line"><div class="code"><span style="--0:#FF79C6;--1:#BF3441">+</span><span style="--0:#96A1C2;--1:#616972">---------------------------+---------+</span></div></div><div class="ec-line"><div class="code"><span style="--0:#F8F8F2;--1:#24292E">| Variable_name             | </span><span style="--0:#FF79C6;--1:#BF3441">Value</span><span style="--0:#F8F8F2;--1:#24292E">   |</span></div></div><div class="ec-line"><div class="code"><span style="--0:#FF79C6;--1:#BF3441">+</span><span style="--0:#96A1C2;--1:#616972">---------------------------+---------+</span></div></div><div class="ec-line"><div class="code"><span style="--0:#F8F8F2;--1:#24292E">| innodb_default_row_format | </span><span style="--0:#FF79C6;--1:#BF3441">dynamic</span><span style="--0:#F8F8F2;--1:#24292E"> |</span></div></div><div class="ec-line"><div class="code"><span style="--0:#FF79C6;--1:#BF3441">+</span><span style="--0:#96A1C2;--1:#616972">---------------------------+---------+</span></div></div><div class="ec-line"><div class="code"><span style="--0:#BD93F9;--1:#005CC5">1</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">row</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">in</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">set</span><span style="--0:#F8F8F2;--1:#24292E"> (</span><span style="--0:#BD93F9;--1:#005CC5">0</span><span style="--0:#F8F8F2;--1:#24292E">.</span><span style="--0:#BD93F9;--1:#005CC5">01</span><span style="--0:#F8F8F2;--1:#24292E"> sec)</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="mysql> show variables like 'innodb_default_row_format';+---------------------------+---------+| Variable_name             | Value   |+---------------------------+---------+| innodb_default_row_format | dynamic |+---------------------------+---------+1 row in set (0.01 sec)"><div></div></button></div></figure></div>
<p>指定行格式写法</p>
</li>
</ol>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="sql"><code><div class="ec-line"><div class="code"><span style="--0:#FF79C6;--1:#BF3441">CREATE</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">TABLE</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">&lt;</span><span style="--0:#F8F8F2;--1:#24292E">table_name(column_name)</span><span style="--0:#FF79C6;--1:#BF3441">&gt;</span><span style="--0:#F8F8F2;--1:#24292E"> ROW_FORMAT</span><span style="--0:#FF79C6;--1:#BF3441">=</span><span style="--0:#F8F8F2;--1:#24292E">行格式名称</span></div></div><div class="ec-line"><div class="code"><span style="--0:#FF79C6;--1:#BF3441">ALTER</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">TABLE</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">&lt;</span><span style="--0:#F8F8F2;--1:#24292E">table_name</span><span style="--0:#FF79C6;--1:#BF3441">&gt;</span><span style="--0:#F8F8F2;--1:#24292E"> ROW_FORMAT</span><span style="--0:#FF79C6;--1:#BF3441">=</span><span style="--0:#F8F8F2;--1:#24292E">行格式名称</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="CREATE TABLE <table_name(column_name)> ROW_FORMAT=行格式名称ALTER TABLE <table_name> ROW_FORMAT=行格式名称"><div></div></button></div></figure></div>
<ol start="2">
<li>
<p><strong>Compact 行记录格式</strong></p>
<p>Compact 设计目标是高效地存储数据,一个页中存放的行数据越多,其性能就越高。</p>
<p>Compact 行记录由两部分组成: 记录放入额外信息和记录的真实数据。</p>
<p><strong>记录额外信息部分</strong></p>
<p>服务器为了描述一条记录而添加了一些额外信息(元数据信息),这些额外信息分为 3 类,分别是: 变长字段长度列表、NULL 值列表和记录头信息。</p>
<ul>
<li>
<p><strong>变长字段长度列表</strong></p>
<p>MySQL 支持一些变长的数据类型,比如 VARCHAR、VARBINARY、各种 TEXT 类型、各种 BLOB 类型,这些变长的数据类型占用的存储空间分为两部分:</p>
<ol>
<li>真正的数据内容</li>
<li>占用的字节数</li>
</ol>
<p>变长字段的长度是不固定的,所以在存储数据的时候要把这些数据占用的字节数也存起来,读取数据的时候才能根据这个长度列表去读取对应长度的数据。</p>
<p>在 Compact 行格式中,把所有变成类型的列的长度都存放在记录的开头部位形成一个列表,按照列的顺序逆序存放,这个列表就是变长字段长度列表。</p>
</li>
<li>
<p><strong>NULL 值列表</strong></p>
<p>表中的某些列可能会存储 NULL 值,如果把这些 NULL 值都放到记录的真实数据中会比较浪费空间,所以 Compact 行格式把这些值的 NULL 的列存储到 NULL 值列表中。(如果表中所有列都不允许为 NULL,就不存在 NULL 值列表)。</p>
</li>
<li>
<p><strong>记录头信息</strong></p>
<p>记录头信息是由固定的 5 个字节组成,5 个字节也就是 40 个二进制位,不同的位代表不同的意思。</p>


















































<table><thead><tr><th>名称</th><th>大小(单位: bit)</th><th>描述</th></tr></thead><tbody><tr><td>预留位 1</td><td>1</td><td>没有使用</td></tr><tr><td>预留位 2</td><td>1</td><td>没有使用</td></tr><tr><td>delete_mask</td><td>1</td><td>标记该记录是否被删除</td></tr><tr><td>min_rec_mask</td><td>1</td><td>标记该记录是否是本层 B+Tree 的非叶子节点中的最小记录</td></tr><tr><td>n_owned</td><td>4</td><td>表示当前分组中管理的记录数</td></tr><tr><td>heap_no</td><td>13</td><td>表示当前记录在记录堆中的位置信息</td></tr><tr><td>record_type</td><td>3</td><td>表示当前记录的类型: <br/>0 表示普通记录<br/>1 表示 B+Tree 非叶子节点记录<br/>2 表示最小记录<br/>3 表示最大记录</td></tr><tr><td>next_record</td><td>16</td><td>表示下一条记录的相对位置</td></tr></tbody></table>
<ol>
<li>
<p>delete_mask</p>
<p>这个属性标记着当前记录是否被删除,占用 1 个二进制位,值为 0 的时候代表记录并没有被删除,为 1 的时候代表记录被删除掉了。</p>
</li>
<li>
<p>min_rec_mask</p>
<p>B+Tree 的每层非叶子节点中的最小记录都会添加该标记。</p>
</li>
<li>
<p>n_owned</p>
<p>代表每个分组里,所拥有的记录的数量,一般是分组里主键最大值才有的。</p>
</li>
<li>
<p>heap_no</p>
<p>在数据页的 User Records 中插入的记录是一条一条紧凑的排列的,这种紧凑排列的机构又被称为堆。为了便于管理这个堆,把记录在堆中的相对位置给定一个编号— heap_no。所以 heap_no 这个属性表示当前记录在本页中的位置。</p>
</li>
<li>
<p>record_type</p>
<p>这个属性表示当前记录的类型,一共有 4 种类型的记录,0 表示普通用户记录,1 表示 B+Tree 非叶子节点记录,2 表示最小记录,3 表示最大记录。</p>
</li>
<li>
<p>next_record</p>
<p>表示从当前记录的真实数据到下一条记录的真实数据的地址偏移量,可以理解为指向下一条记录地址的指针。值为正数说明下一条记录在当前记录后面,为负数说明下一条记录在当前记录的前面。</p>
</li>
</ol>
</li>
</ul>
<p>记录真实数据部分</p>
<p>记录的真实数据除了插入的那些列的数据,MySQL 会为每个记录默认的添加一些列(也称为隐藏列),具体的列如下:</p>
<img src="https://cdn.jsdelivr.net/gh/chou401/pic-md@main/img/image-20231018103232216.png" alt="image-20231018103232216"/>





























<table><thead><tr><th>列名</th><th>是否必须</th><th>占用空间</th><th>描述</th></tr></thead><tbody><tr><td>row_id</td><td>否</td><td>6 byte</td><td>行 id,唯一标识一条记录</td></tr><tr><td>transaction_id</td><td>是</td><td>6 byte</td><td>事务 id</td></tr><tr><td>roll_pointer</td><td>是</td><td>7 byte</td><td>回滚指针</td></tr></tbody></table>
<p>生成隐藏主键列的方式有:</p>
<ol>
<li>服务器会在内存中维护一个全局变量,每当向某个包含隐藏的 row_id 列的表中插入一条记录时,就会把该变量的值当做新纪录的 row_id 列的值,并且把该变量自增 1。</li>
<li>每当这个变量的值为 256 的倍数时,就会将该变量的值刷新到系统表空间的页号为 7 的页面中一个 max row id 的属性处。</li>
<li>当系统启动时,会将页中的 max row id 属性加载到内存中,并将该值加上 256 之后赋值给全局变量,因为在上次关机时该全局变量的值可能大于页中 max row id 属性值。</li>
</ol>
</li>
<li>
<p><strong>Compact 中的行溢出机制</strong></p>
<p><strong>什么是行溢出</strong></p>
<p>MySQL 中以页为基本单位,进行磁盘与内存之间的数据交互的,我们知道一个页的大小是 16kb,16kb=16384 字节,而一个 varchar 类型列最多可以存储 65532 个字节,一些大的数据类型比如 text 可以存储更多。</p>
<p>如果一个表中存在这样的大字段,那么一个页就无法存储一条完整的记录,这时就会发生行溢出,多出的数据就会存储在另外的溢出页中。</p>
<p>总结: 如果某些字段信息过长,无法存储在 B 树节点中,这时候会被单独分配空间,此时被称为溢出页,该字段被称为页外列。</p>
<p><strong>Compact 中的行溢出机制</strong></p>
<p>InnoDB 规定一页至少存储两条记录(B+Tree 特点),如果页中只能存放一条记录,InnoDB 存储引擎会自动将行数据存放到溢出页中。</p>
<p>当发生行溢出时,数据页只保存了前 768 字节的前缀数据,接着是 20 个字节的偏移量,指向行溢出页。</p>
<img src="https://cdn.jsdelivr.net/gh/chou401/pic-md@main/img/image-20231018105842012.png" alt="image-20231018105842012"/>
</li>
</ol>
<h3 id="如何进行join优化">如何进行JOIN优化</h3>
<h4 id="什么是驱动表">什么是驱动表</h4>
<ul>
<li>多表关联查询时,第一个被处理的表就是驱动表,使用驱动表去关联其他表。</li>
<li>驱动表的确定非常的关键,会直接影响多表关联的顺序,也决定后续关联查询的性能。</li>
</ul>
<p>驱动表的选择要遵循一个规则:</p>
<ul>
<li>在对最终的结果集没有影响的前提下,优先选择结果集最小的哪张表作为驱动表。</li>
</ul>
<h4 id="三种-join-算法">三种 JOIN 算法</h4>
<ol>
<li>
<p><strong>Simple Nested-Loop Join(简单的嵌套循环连接)</strong></p>
<ul>
<li>
<p>简单来说嵌套循环连接算法就是一个双层 for 循环,通过循环外层表的行数据,逐个与内层表的所有行数据进行比较来获取结果。</p>
</li>
<li>
<p>这种算法是最简单的方案,性能也一般。对内循环没优化。</p>
</li>
<li>
<p>例如有这样一条 SQL:</p>
<p>— 连接用户表与订单表,连接条件是 t1.id = t2.user_id</p>
<blockquote>
<p>select * from user t1 left join order t2 on t1.id = t2.user_id;</p>
<p>— user 表为驱动表,order 表为被驱动表</p>
</blockquote>
</li>
<li>
<p>转换成代码执行时的思路是这样的:</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="java"><code><div class="ec-line"><div class="code"><span style="--0:#FF79C6;--1:#BF3441">for</span><span style="--0:#F8F8F2;--1:#24292E">(user表行 uRow </span><span style="--0:#FF79C6;--1:#BF3441">:</span><span style="--0:#F8F8F2;--1:#24292E"> user 表) {</span></div></div><div class="ec-line"><div class="code"><span style="--0:#FF79C6;--1:#BF3441">for</span><span style="--0:#F8F8F2;--1:#24292E">(order表行 oRow </span><span style="--0:#FF79C6;--1:#BF3441">:</span><span style="--0:#F8F8F2;--1:#24292E"> order 表) {</span></div></div><div class="ec-line"><div class="code"><span class="indent">  </span><span style="--0:#FF79C6;--1:#BF3441">if</span><span style="--0:#F8F8F2;--1:#24292E">(uRow.id </span><span style="--0:#FF79C6;--1:#BF3441">=</span><span style="--0:#F8F8F2;--1:#24292E"> oRow.user_id){</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#FF79C6;--1:#BF3441">return</span><span style="--0:#F8F8F2;--1:#24292E"> uRow;</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#F8F8F2;--1:#24292E">  </span></span><span style="--0:#F8F8F2;--1:#24292E">}</span></div></div><div class="ec-line"><div class="code"><span style="--0:#F8F8F2;--1:#24292E">}</span></div></div><div class="ec-line"><div class="code"><span style="--0:#F8F8F2;--1:#24292E">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="for(user表行 uRow : user 表) {for(order表行 oRow : order 表) {  if(uRow.id = oRow.user_id){    return uRow;  }}}"><div></div></button></div></figure></div>
</li>
<li>
<p>SNL 的特点</p>
<ul>
<li>简单粗暴容易理解,就是通过双层循环比较数据来获得结果。</li>
<li>查询效率会比较慢,假设 A表有 n 行,B 表有 m 行。SNL 的开销如下:
<ul>
<li>A 表扫描 1 次</li>
<li>B 表扫描 m 次</li>
<li>一共有 n 个内循环,每个内循环要 m 次,一共有内循环 n * m 次</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>Index Nested-Loop Join(索引嵌套循环连接)</strong></p>
<ul>
<li>
<p>Index Nested-Loop Join 其优化的思路: 主要是为了减少内层表数据的匹配次数,最大的区别在于,用来进行 Join 的字段已经在被驱动表中建立了索引。</p>
</li>
<li>
<p>从原来的<code>匹配次数 = 外层表行数 * 内层表行数</code>,变成了<code>匹配次数 = 外层表行数 * 内层表索引的高度</code>,极大的提升了 Join 的性能。</p>
</li>
<li>
<p>当 order 表的 user_id 为索引的时候执行过程如下:</p>
<img src="https://cdn.jsdelivr.net/gh/chou401/pic-md@main/img/image-20231018113134392.png" alt="image-20231018113134392"/>
</li>
</ul>
<p><strong>注意: 使用Index Nested-Loop Join 算法的前提是匹配的字段必须建立了索引。</strong></p>
</li>
<li>
<p><strong>Block Nested-Loop Join(块嵌套循环连接)</strong></p>
<p>如果 Join 的字段有索引,MySQL 会使用 INL 算法,如果没有的话,MySQL 会如何处理?</p>
<p>因为不存在索引了,所以驱动表需要进行扫描。这里MySQL 并不会简单粗暴的应用 SNL 算法,而是加入了 buffer 缓冲区,降低了内循环的个数,也就是被驱动表的扫描次数。</p>
<img src="https://cdn.jsdelivr.net/gh/chou401/pic-md@main/img/image-20231018114043166.png" alt="image-20231018114043166"/>
<ul>
<li>
<p>在外层循环扫描 user 表中的所有数据。扫描的时候,会把需要进行 join 用到的列都缓存到 buffer 中。buffer 中的数据有一个特点,里面的记录不需要一条一条地取出来和 order 表进行比较,而是整个 buffer 和 order 表进行批量比较。</p>
</li>
<li>
<p>如果我们把 buffer 的空间开到很大,可以容纳下 user 表的所有记录,那么 order 表也只需要访问一次。</p>
</li>
<li>
<p>MySQL 默认 buffer 大小 256k,如果有 n 个 join 操作,会生成 n-1 个 join buffer。</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre data-language="sql"><code><div class="ec-line"><div class="code"><span style="--0:#F8F8F2;--1:#24292E">mysql</span><span style="--0:#FF79C6;--1:#BF3441">&gt;</span><span style="--0:#F8F8F2;--1:#24292E"> show variables </span><span style="--0:#FF79C6;--1:#BF3441">like</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--1:#032F62"><span style="--0:#E9F284">&#39;</span><span style="--0:#F1FA8C">%join_buffer%</span><span style="--0:#E9F284">&#39;</span></span><span style="--0:#F8F8F2;--1:#24292E">;</span></div></div><div class="ec-line"><div class="code"><span style="--0:#FF79C6;--1:#BF3441">+</span><span style="--0:#96A1C2;--1:#616972">------------------+--------+</span></div></div><div class="ec-line"><div class="code"><span style="--0:#F8F8F2;--1:#24292E">| Variable_name    | </span><span style="--0:#FF79C6;--1:#BF3441">Value</span><span style="--0:#F8F8F2;--1:#24292E">  |</span></div></div><div class="ec-line"><div class="code"><span style="--0:#FF79C6;--1:#BF3441">+</span><span style="--0:#96A1C2;--1:#616972">------------------+--------+</span></div></div><div class="ec-line"><div class="code"><span style="--0:#F8F8F2;--1:#24292E">| join_buffer_size | </span><span style="--0:#BD93F9;--1:#005CC5">262144</span><span style="--0:#F8F8F2;--1:#24292E"> |</span></div></div><div class="ec-line"><div class="code"><span style="--0:#FF79C6;--1:#BF3441">+</span><span style="--0:#96A1C2;--1:#616972">------------------+--------+</span></div></div><div class="ec-line"><div class="code"><span style="--0:#BD93F9;--1:#005CC5">1</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">row</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">in</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">set</span><span style="--0:#F8F8F2;--1:#24292E"> (</span><span style="--0:#BD93F9;--1:#005CC5">0</span><span style="--0:#F8F8F2;--1:#24292E">.</span><span style="--0:#BD93F9;--1:#005CC5">02</span><span style="--0:#F8F8F2;--1:#24292E"> sec)</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="mysql> show variables like '%join_buffer%';+------------------+--------+| Variable_name    | Value  |+------------------+--------+| join_buffer_size | 262144 |+------------------+--------+1 row in set (0.02 sec)"><div></div></button></div></figure></div>
</li>
</ul>
</li>
<li>
<p><strong>JOIN 优化总结</strong></p>
<ol>
<li>永远用小结果集驱动大结果接(其本质就是减少外层循环的数据数量)。</li>
<li>为匹配的条件增加索引(减少内层表的循环匹配次数)。</li>
<li>增大 join buffer size 的大小(一次缓存的数据越多,那么内层包的扫表次数就越少)。</li>
<li>减少不必要的字段查询(字段越少,join buffer 所缓存的数据就越多)。</li>
</ol>
</li>
</ol>
<h3 id="索引哪些情况下会失效">索引哪些情况下会失效</h3>
<ol>
<li>查询条件包含 or,会导致索引失效。</li>
<li>隐式类型转换,会导致索引失效,例如 age 字段类型是 int,我们 where age = “1”,这样就会触发隐式类型转换。</li>
<li>like 通配符会导致索引失效,注意: “abc%“不会失效,会走 range 索引,“%abc”索引会失效。</li>
<li>联合索引,查询时的条件列不是联合索引中的第一个列,索引失效。</li>
<li>对索引字段进行函数运算。</li>
<li>对索引列运算(如: +、-、*、/),索引失效。</li>
<li>索引字段上使用(<code>!= 、&lt;&gt;、not in</code>)时,基本会导致索引失效。</li>
<li>索引字段上使用 is null,is not null,可能导致索引失效。</li>
<li>相 join 的两个表的字符编码不同,不能命中索引,会导致笛卡尔积的循环计算。</li>
<li>MySQL 估计使用全表扫描要比使用索引快,则不会使用索引。</li>
</ol>
<h3 id="什么是覆盖索引">什么是覆盖索引</h3>
<p>覆盖索引是一种避免回表查询的优化策略: 只需要在一棵索引树上就能获取SQL 所需的所有列数据,无需回表,速度更快。</p>
<p>具体的实现方式:</p>
<ul>
<li>将被查询的字段建立普通索引或者联合索引,这样的话就可以直接返回索引中的数据,不需要再通过聚集索引去定位行记录,避免了回表的情况发生。</li>
</ul>
<blockquote>
<p>explain select user_name,user_age,user_level from users where user_name=‘tom’ and user_age=17;</p>
</blockquote>
<img src="https://cdn.jsdelivr.net/gh/chou401/pic-md@main/img/image-20231018145644074.png" alt="image-20231018145644074"/>
<p>覆盖索引的定义与注意事项:</p>
<ul>
<li>如果一个索引包含了所有需要查询的字段的值(不需要回表),这个索引就是覆盖索引。</li>
<li>MySQL 只能使用 B+Tree 索引做覆盖索引(因为只有 B+Tree 能存储索引列值)。</li>
<li>在 explain 的 Extra 列,如果出现<code>USing index</code>表示使用到了覆盖索引,所取的数据完全在索引中就能拿到。</li>
</ul>
<h3 id="介绍一下mysql中事务的特性">介绍一下MySQL中事务的特性</h3>
<p>在关系型数据库管理系统中,一个逻辑工作单元要成为事务,必须满足这四个特性,即所谓的 ACID: 原子性(Atomicity)、一致性(Consistency)、隔离性(Isolation) 和持久性(Durability)。</p>
<ol>
<li>
<p>原子性</p>
<p>原子性: 事务作为一个整体被执行,包含在其中的对数据库的操作要么全部执行,要么都不执行。</p>
<p>InnoDB 存储引擎提供了两种事务日志: redo log(重做日志)和 undo log(回滚日志)。其中 redo log 用于保证事务持久性,undo log 则是事务原子性和隔离性实现的基础。</p>
<p>每写一个事务,都会修改 BufferPool,从而产生相应的 redo/undo 日志:</p>
<ul>
<li>如果要回滚事务,那么就基于 undo log 来回滚就可以了,把之前对缓存页做的修改都给回滚了就可以了。</li>
<li>如果事务提交之后,redo log 刷入磁盘,结果 MySQL 宕机了,是可以根据 redo log 恢复事务修改过的缓存数据的。</li>
</ul>
<p>实现原子性的关键,是当事务回滚时能够撤销所有已经成功执行的 sql 语句。</p>
<p>InnoDB 实现回滚,靠的是 undo log,当事务对数据库进行修改时,InnoDB 会生成对应的 undo log,如果事务执行失败或调用了 rollback,导致事务需要回滚,便可以利用 undo log 中的信息将数据回滚到修改之前的样子。</p>
<img src="https://cdn.jsdelivr.net/gh/chou401/pic-md@main/img/image-20231018154446991.png" alt="image-20231018154446991"/>
</li>
<li>
<p>一致性</p>
<p>一致性: 事务应确保数据库的状态从一个一致状态转变为另一个一致状态。一致状态的含义是数据库中的数据应满足完整性约束。</p>
<ul>
<li>约束一致性: 创建表结构时所执行的外键、唯一索引等约束。</li>
<li>数据一致性: 是一个综合性的规定,因为它是由原子性、持久性、隔离性共同保证的结果,而不是单单依赖于某一种技术。</li>
</ul>
</li>
<li>
<p>隔离性</p>
<p>隔离性: 指的是一个事务的执行不能被其他事务干扰,即一个事务内部的操作及使用的数据对其他的并发事务是隔离的。</p>
<p>不考虑隔离性会引发的问题:</p>
<ul>
<li><strong>脏读</strong>: 一个事务读取到了另一个事务修改但未提交的数据。</li>
<li><strong>不可重复读</strong>: 一个事务多次读取同一行记录的结果不一致,后面读取的跟前面读取的结果不一致。</li>
<li><strong>幻读</strong>: 一个事务多次按相同条件查询,结果不一致。后续查询的结果和面前查询结果不同,多了或少了几行记录。</li>
</ul>
<p>数据库事务的隔离级别有 4 个,由低到高依次为 Read uncommitted、Read committed、Repeatable read、Serializable,这四个级别可以逐个解决脏读、不可重复读、幻读这几类问题。</p>
</li>
<li>
<p>持久性</p>
<p>持久性: 指的是一个事务一旦提交,它对数据库中数据的改变就应该是永久性的,后续的操作或故障不应该对其有任何影响,不会丢失。</p>
<p>MySQL 事务的持久性保证依赖性的日志文件: redo log</p>
<ul>
<li>
<p>redo log 也包括两部分: 一是内存中的日志缓冲(redo log buffer),该部分日志是易失性的;二是磁盘上的重做日志文件(redo log file),该部分日志是持久的,redo log 是物理日志,记录的是数据库中物理页的情况。</p>
</li>
<li>
<p>当数据发生修改时,InnoDB 不仅会修改 Buffer Pool 中的数据,也会在 redo log buffer 记录这次操作;当事务提交时,会对 redo log buffer 进行刷盘,记录到 redo log file 中。如果 MySQL 宕机,重启时可以读取 redo log file 中的数据,对数据库进行恢复。这样就不需要每次提交事务都实时进行刷脏了。</p>
<img src="https://cdn.jsdelivr.net/gh/chou401/pic-md@main/img/image-20231018171335505.png" alt="image-20231018171335505"/>
</li>
</ul>
</li>
<li>
<p>ACID 总结</p>
<ul>
<li>事务的持久化是为了应对系统崩溃造成的数据丢失。</li>
<li>只有保证了事务的一致性,才能保证执行结果的正确性。</li>
<li>在非并发状态下,事务间天然保证隔离性,因此只需要保证事务的原子性即可保证一致性。</li>
<li>在并发状态下,需要严格保证事务的原子性、隔离性。</li>
</ul>
</li>
</ol>
<h4 id="mysql的可重复读怎么实现的">MySQL的可重复读怎么实现的</h4>
<p>可重复读(repeatable read)定义: 一个事务执行过程中看到的数据,总是跟这个事务在启动时看到的数据是一致的。</p>
<p>MVCC</p>
<ul>
<li>MVCC: 多版本并发控制,用于实现<strong>读已提交</strong>和<strong>可重复读</strong>隔离级别。</li>
<li>MVCC 的核心就是 undo log 多版本链 + read view,“MV” 就是通过 undo log 来保存数据的历史版本,实现多版本的管理,“CC” 是通过 read view 来实现管理,通过 read view 原则来决定数据是否显示。同时针对不同的隔离级别,read view 的生成策略不同,也就实现了不同的隔离级别。</li>
</ul>
<h4 id="undo-log-多版本链">undo log 多版本链</h4>
<p>每条数据都有两个隐藏字段:</p>
<ul>
<li>trx_id: 事务 id,记录最近一次更新这条数据的事务 id。</li>
<li>roll_pointer: 回滚指针,指向之前生成的 undo log。</li>
</ul>
<p>每一条数据都有多个版本,版本之间通过 undo log 链条进行连接通过这样的设计方式,可以保证每个事务提交的时候,一旦需要回滚操作,可以保证同一个事务只能读取到比当前版本更早提交的值,不能看到更晚提交的值。</p>
<h4 id="readview">ReadView</h4>
<p>Read View 是 InnoDB 在实现 MVCC 时用到的一致性读视图,即 consistent read view,用于支持 RC(Read Committed,读提交)和 RR(Repeatable Read,可重复读)隔离级别的实现。</p>
<p>Read View 简单理解就是对数据在某个时刻的状态拍成照片记录下来。那么之后获取某时刻的数据时就还是原来的照片上的数据,是不会变的。</p>
<p>Read View 中比较重要的字段有 4 个:</p>
<ul>
<li>m_ids: 用来表示 MySQL 中哪些事务正在执行,但是没有提交。</li>
<li>min_trx_id: 就是 m_ids 里最小的值。</li>
<li>max_trx_id: 下一个要生成的事务 id 值,也就是最大事务 id。</li>
<li>creator_trx_id: 就是你这个事务的 id。</li>
</ul>
<p>当一个事务第一次执行查询 SQL 时,会生成一致性视图 Read View(快照),查询时从 undo log 中最新的一条记录开始跟 Read View 做对比,如果不符合比较规则,就根据回滚指针回滚到上一条记录继续比较,直到得到符合比较条件的查询结果。</p>
<p>Read View 判断记录某个版本是否可见的规则如下:</p>
<img src="https://cdn.jsdelivr.net/gh/chou401/pic-md@main/img/image-20231019170022564.png" alt="image-20231019170022564"/>
<ol>
<li>如果当前记录的事务 id 落在绿色部分(trx_id &lt; min_id),表示这个版本是已提交的事务生成的,可读。</li>
<li>如果当前记录的事务 id 落在红色部分(trx_id ＞ max_id),表示这个版本是由将来启动的事务生成的,不可读。</li>
<li>如果当前记录的事务 id 落在黄色部分(min_id ≤ trx_id ≤ max_id),则分为两种情况:
<ol>
<li>若当前记录的事务 id 在未提交事务的数组中,则此条记录不可读。</li>
<li>若当前记录的事务 id 不在为提交事务的数组中,则此条记录可读。</li>
</ol>
</li>
</ol>
<p>RC 和 RR 隔离级别都是由 MVCC 实现的,区别在于:</p>
<ul>
<li>RC 隔离级别时,Read View 是每次执行 select 语句时都生成一个。</li>
<li>RR 隔离级别时,Read View 是在第一次执行 select 语句时生成一个,同一事务中后面的所有 select 语句都复用这个 Read View。</li>
</ul>
<h4 id="mysql-ap-和-cp">MySQL AP 和 CP</h4>
<ol>
<li>异步复制(默认) : AP模型</li>
</ol>
<p>Master不等待Slave同步,直接返回client =&gt; <strong>性能最高,数据可能出现不一致;可用性优先: 适合对性能要求,能够容忍计算场景少量数据丢失场景</strong></p>
<p>应用发起数据更新(含 操作)请求,insert、update、deleteMaster 在执行完更新操作后立即向应用程序返回响应,然后 Master 再向 Slave 复制数据。</p>
<p>数据更新过程中 Master 不需要等待 Slave 的响应,因此异步复制的数据库实例通常具有较高的性能,且 Slave 不可用并不影响 Master 对外提供服务。但因数据并非实时同步到 Slave,而 Master 在 Slave 有延迟的情况下发生故障则有较小概率会引起数据不一致。2. 半同步复制: AP模型
Master等待Slave写入relaylog返回client &amp; Slave宕机或网络中断,Master暂停10s 降级 异步复制,Slave恢复后 恢复半同步复制 =&gt; <strong>性能居中,可用性优先,极端场景少量不一致</strong>;</p>
<p>应用发起数据更新(含 insert、update、delete 操作)请求,Master 在执行完更新操作后立即向 Slave 复制数据,Slave 接收到数据并写到 relay log 中(无需回放执行)后才向 Master 返回成功信息,Master 必须在接受到 Slave 的成功信息后再向应用程序返回响应。</p>
<p>仅在数据复制发生异常(Slave 节点不可用或者数据复制所用网络发生异常)的情况下,Master 会暂停(MySQL 默认10秒左右)对应用的响应,将复制方式降为异步复制。当数据复制恢复正常,将恢复为半同步复制。3. 强同步复制: CP模型
Master等待Slave写入relaylog返回client; Slave宕机或网络中断,Master不会降级为 异步复制 =&gt; 保证强一致性,暂停对应用响应,直到Slave恢复正常 =&gt; <strong>性能最差,强一致性 =&gt;强一致性: 牺牲可用性,适合对一致性要求高,能够接收服务停机或暂时不可用,保证数据强一致性业务场景</strong>。</p>
<p>应用发起数据更新(含 insert、update、delete 操作)请求,Master 在执行完更新操作后立即向 Slave 复制数据,Slave 接收到数据并写到 relay log 中(无需执行) 后才向 Master 返回成功信息,Master 必须在接受到 Slave 的成功信息后再向应用程序返回响应。</p>
<p>在数据复制发生异常(Slave 节点不可用或者数据复制所用网络发生异常)的情况下,复制方式均不会发生降级,为保障数据一致性,此时 Master 会暂停对应用的响应,直至异常结束。</p>   </div> </article> </div> <button aria-label="Back to Top" class="z-90 fixed bottom-8 end-4 flex h-10 w-10 translate-y-28 items-center justify-center rounded-full border-2 border-transparent bg-zinc-200 text-3xl opacity-0 transition-all duration-300 hover:border-zinc-400 data-[show=true]:translate-y-0 data-[show=true]:opacity-100 dark:bg-zinc-700 sm:end-8 sm:h-12 sm:w-12" data-show="false" id="to-top-btn"><svg aria-hidden="true" class="h-6 w-6" fill="none" focusable="false" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"> <path d="M4.5 15.75l7.5-7.5 7.5 7.5" stroke-linecap="round" stroke-linejoin="round"></path> </svg> </button>  </main> <footer class="mt-auto flex w-full flex-col items-center justify-center gap-y-2 pb-4 pt-20 text-center align-top font-semibold text-gray-600 dark:text-gray-400 sm:flex-row sm:justify-between sm:text-xs"> <div class="me-0 sm:me-4">
&copy; chou401 2024.<span class="inline-block">&nbsp;🚀&nbsp;花易谢、雾易失、梦易逝、云易散</span> </div> <nav aria-label="More on this site" class="flex gap-x-2 sm:gap-x-0 sm:divide-x sm:divide-gray-500"> <a class="px-4 py-2 sm:py-0 sm:hover:text-textColor sm:hover:underline" href="/astro-theme-cactus/"> Home </a><a class="px-4 py-2 sm:py-0 sm:hover:text-textColor sm:hover:underline" href="/astro-theme-cactus/posts/"> Blog </a> </nav> </footer> </body></html> 